import{u as c}from"./role.7936b77b.js";import{n as W,z as X,o as Y,r as k,a as s,b as u,c as Z,d as ee,e as a,w as o,f as v,h as r,u as p,B as L,A as ae,E as f,C as le}from"./index.cc30dbfe.js";import"./http.f2a51fde.js";const te=v("p",null,"\u89D2\u8272\u7BA1\u7406",-1),oe={style:{"text-align":"center"}},se={slot:"footer",class:"dialog-footer",style:{"text-align":"center","padding-top":"20px"}},ne={style:{"text-align":"left"}},re={slot:"footer",class:"dialog-footer",style:{"text-align":"center","padding-top":"20px"}},pe={__name:"Index",setup(de){const w=W();X(async()=>{g()}),Y(async()=>{k({roleId:""})});let N=s([]),R=s(0);const i=k({pageNum:1,pageSize:10,roleName:""}),g=async()=>{const e=await c.getRoleList(i);console.log(e),N.value=e.data.data,console.log(e.data.data),R.value=e.data.total},M=e=>{i.pageSize=e,g()},D=e=>{i.pageNum=e,g()},E=()=>{i.pageNum=1,g()},$=e=>{ae.confirm("\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u89D2\u8272\u4FE1\u606F\u5417?",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{(await c.delRole({roleId:e})).data?(f.success("\u5220\u9664\u89D2\u8272\u6210\u529F"),g()):f.error("\u5220\u9664\u89D2\u8272\u5931\u8D25")}).catch(()=>{f({type:"info",message:"\u53D6\u6D88\u5220\u9664"})})},_=s([]);let b=s([]),V=s([]),C=s([]);const K=k({pageNum:1,pageSize:100,account:""}),m=s(!1),q=async e=>{V.value=e;const l=await c.getUserList(K);_.value=l.data.data,b=_.value,m.value=!0;const t=await c.getRoleUserList({roleId:e});C=t.data.data,le(()=>{for(const z in t.data.data)for(const d in l.data.data)l.data.data[d].userId==t.data.data[z].userId&&b.toggleRowSelection(_.value[d],!0)})};s(),s([]);const A=e=>{C=e,console.log(C)},F=async()=>{(await c.saveRoleUserList({roleId:V.value,userList:C})).data?f.success("\u4FDD\u5B58\u89D2\u8272\u7528\u6237\u6210\u529F"):f.error("\u4FDD\u5B58\u89D2\u8272\u7528\u6237\u5931\u8D25"),m.value=!1},h=s(!1),x=s([]),j=k({children:"children",label:"label"}),I=s([]),S=s([]),y=s(null);let U=s();const P=async e=>{H(),console.log(e);const l=await c.getMenuAll({});U=e,l.data!=null&&(x.value=l.data.data,console.log(x.value));const t=await c.getRoleMenu({roleId:e});t.data!=null&&(I.value=t.data.data),h.value=!0},G=async()=>{if(y.value){const e=y.value.getCheckedKeys();console.log("\u9009\u4E2D\u7684\u952E:",e),(await c.saveRoleMenu({roleId:U,menuList:e})).data?f.success("\u8BBE\u7F6E\u89D2\u8272\u83DC\u5355\u6210\u529F"):f.error("\u89D2\u8272\u83DC\u5355\u5931\u8D25"),h.value=!1}if(y.value){const e=y.value.getCheckedNodes();console.log("\u9009\u4E2D\u7684node:",e)}},H=()=>{I.value=[],S.value=[]};return(e,l)=>{const t=u("el-button"),z=u("el-input"),d=u("el-table-column"),J=u("el-pagination"),O=u("el-card"),Q=u("el-tree"),B=u("el-dialog");return Z(),ee("div",null,[te,a(O,null,{default:o(()=>[a(z,{style:{width:"440px"},onClear:e.searchRole,clearable:"",modelValue:i.roleName,"onUpdate:modelValue":l[0]||(l[0]=n=>i.roleName=n),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272",class:"input-with-select"},{append:o(()=>[a(t,{icon:"Search",onClick:E})]),_:1},8,["onClear","modelValue"]),r(" \xA0\xA0\xA0 "),a(t,{type:"primary",onClick:l[1]||(l[1]=()=>p(w).push({path:"/role/save",query:{userId:""}}))},{default:o(()=>[r("\u65B0\u589E\u89D2\u8272 ")]),_:1}),a(p(L),{data:p(N),border:"",style:{width:"100%","margin-top":"20px"}},{default:o(()=>[a(d,{prop:"roleId",label:"id",width:"180"}),a(d,{prop:"roleName",label:"\u89D2\u8272\u540D\u79F0",width:"180"}),a(d,{prop:"description",label:"\u89D2\u8272\u63CF\u8FF0",width:"180"}),a(d,{label:"\u64CD\u4F5C",width:"530"},{default:o(n=>[a(t,{type:"danger",size:"small",onClick:T=>$(n.row.roleId)},{default:o(()=>[r("\u5220\u9664")]),_:2},1032,["onClick"]),a(t,{size:"small",type:"primary",onClick:()=>p(w).push({path:"/role/detail",query:{roleId:n.row.roleId}})},{default:o(()=>[r("\u89D2\u8272\u8BE6\u60C5 ")]),_:2},1032,["onClick"]),a(t,{size:"small",type:"success",onClick:()=>p(w).push({path:"/role/detail",query:{roleId:n.row.roleId,edit:1}})},{default:o(()=>[r(" \u7F16\u8F91\u89D2\u8272 ")]),_:2},1032,["onClick"]),a(t,{size:"small",onClick:T=>P(n.row.roleId)},{default:o(()=>[r("\u7F16\u8F91\u89D2\u8272\u83DC\u5355 ")]),_:2},1032,["onClick"]),a(t,{size:"small",type:"success",plain:"",onClick:T=>q(n.row.roleId)},{default:o(()=>[r("\u89D2\u8272\u7528\u6237\u5217\u8868 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),a(J,{style:{"margin-top":"20px"},"current-page":i.pageNum,"page-size":i.pageSize,"page-sizes":[10,20,30,40],layout:"->,total, sizes, prev, pager, next, jumper",total:p(R),onSizeChange:M,onCurrentChange:D},null,8,["current-page","page-size","total"])]),_:1}),a(B,{title:"\u9009\u62E9\u83DC\u5355\uFF0C\u53EF\u591A\u9009",modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=n=>h.value=n),width:"700px","before-close":e.handleClose},{default:o(()=>[v("div",oe,[a(Q,{data:x.value,"check-strictly":!0,"show-checkbox":"","default-expand-all":!0,ref_key:"treeRef",ref:y,"node-key":"id","default-expanded-keys":S.value,"default-checked-keys":I.value,props:j},null,8,["data","default-expanded-keys","default-checked-keys","props"])]),v("div",se,[a(t,{onClick:l[2]||(l[2]=n=>h.value=!1)},{default:o(()=>[r("\u53D6 \u6D88")]),_:1}),a(t,{type:"primary",onClick:G},{default:o(()=>[r("\u786E \u5B9A")]),_:1})])]),_:1},8,["modelValue","before-close"]),a(B,{title:"\u9009\u62E9\u7528\u6237\uFF0C\u53EF\u591A\u9009",modelValue:m.value,"onUpdate:modelValue":l[5]||(l[5]=n=>m.value=n),width:"700px","before-close":e.handleClose},{default:o(()=>[v("div",ne,[a(p(L),{data:_.value,border:"",style:{width:"100%","margin-top":"20px"},onSelectionChange:A,ref_key:"myTable",ref:b},{default:o(()=>[a(d,{type:"selection",width:"55"}),a(d,{prop:"userId",label:"id",width:"180"}),a(d,{prop:"userName",label:"\u7528\u6237\u540D",width:"180"})]),_:1},8,["data"])]),v("div",re,[a(t,{onClick:l[4]||(l[4]=n=>m.value=!1)},{default:o(()=>[r("\u53D6 \u6D88")]),_:1}),a(t,{type:"primary",onClick:F},{default:o(()=>[r("\u786E \u5B9A")]),_:1})])]),_:1},8,["modelValue","before-close"])])}}};export{pe as default};
