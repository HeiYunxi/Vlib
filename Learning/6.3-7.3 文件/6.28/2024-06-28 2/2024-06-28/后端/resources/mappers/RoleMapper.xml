<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fzsx.mapper.RoleMapper">
    <insert id="saveRoleInfo"  parameterType="com.fzsx.entity.Role">
        insert into role
        (roleName,description,create_time,update_time)
        values (#{roleName},#{description},#{create_time},#{update_time})
    </insert>
    <select id="getUserByAccountName" resultType="com.fzsx.entity.Role">
		select `userid`,`username`,`phone`,`account` from user where account = #{value}
	</select>


    <select id="getUserByLoginInfo" resultType="com.fzsx.entity.Role">
		select `userid`,`username`,`phone`,`account`,`create_time`,type from user where account = #{account} and password = #{password}
	</select>
    <!-- 用户信息分页查询-->
    <select id="queryRoleList" parameterType="com.fzsx.entity.Role" resultType="com.fzsx.entity.Role">
        select * from role
        <where>
            <if test="roleName != null and roleName != ''">
             and roleName  like concat('%', #{roleName}, '%')
            </if>
        </where>
    </select>
    <delete id="delete"  parameterType="com.fzsx.entity.Role">
        delete from role where roleId=#{roleId}
    </delete>

    <!-- 用户详细信息-->
    <select id="detail" parameterType="com.fzsx.entity.Role" resultType="com.fzsx.entity.Role">
        select * from role
        <where>
            <if test="roleId != null and roleId != ''">
                and roleId=#{roleId}
            </if>
        </where>
    </select>
    <!--更新用户信息 -->
    <update id="update"  parameterType="com.fzsx.entity.Role">
        update role
        set
        <if test="roleName != null and roleName != ''">
            roleName=#{roleName},
        </if>
        <if test="description != null and description != ''">
            description=#{description},
        </if>
        <if test="create_time != null ">
        create_time=#{create_time},
        </if>
        <if test="update_time != null">
        update_time=#{update_time}
        </if>

        where roleId=#{roleId}
    </update>

    <!-- 所有角色信息-->
    <select id="roleList" parameterType="int" resultType="com.fzsx.entity.Role">
        select roleId,roleName   from role
    </select>
    <!-- 查询用户角色信息-->
    <select id="userRoleList" parameterType="int" resultType="com.fzsx.entity.Role">
        select roleId,(select roleName from role b where b.roleId=a.roleId) rolename  from user_role a
        <where>
            <if test="userId != null and userId != ''">
                and userId=#{userId}
            </if>
        </where>
    </select>
    <!-- 按用户ID删除用户角色信息-->
    <delete id="deleteUserRole" parameterType="int">
        delete   from user_role
        <where>
            <if test="userId != null and userId != ''">
                and userId=#{userId}
            </if>
        </where>
    </delete>
    <insert id="saveUserRoleInfo"  parameterType="java.util.HashMap">
        insert into user_role (userId,roleId) values (#{userId},#{roleId})
    </insert>

</mapper>
