"object"==typeof globalThis&&(globalThis.jsExecStartTimeStamp=Date.now()),(self.webpackChunkuni=self.webpackChunkuni||[]).push([[9111],{450057:function(t,e,r){r.d(e,{w:function(){return i}});var n=r(839461),o=r(87363),i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.root=null,e.setRootRef=function(t){return e.root=t},e}return(0,n.__extends)(e,t),e.prototype.componentDidMount=function(){this.attachBox()},e.prototype.componentDidUpdate=function(){this.attachBox()},e.prototype.attachBox=function(){if(this.root){var t=this.props.layoutBox;this.root.__vm__=t,this.root.__type__=t.constructor.name,t.__node__=this.root}},e}(r.n(o)().Component);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}(0,n.__extends)(e,t)}(i)},201463:function(t,e,r){r.d(e,{YQ:function(){return c},tc:function(){return h},uI:function(){return l},rK:function(){return S},Hq:function(){return v},er:function(){return C},yK:function(){return R},yr:function(){return b},uY:function(){return f}});var n,o=r(495155),i=r(750670),a=r(996391),s=function(t){var e,r="left"===t?"workbench-drawer-left":"workbench-drawer-right",n=document.getElementById(r);return n&&null!==(e=n.getBoundingClientRect().width)&&void 0!==e?e:0},l=o.PlatformUtil.isWeWork()?220:290,p=320,c=30,u=52,g=8,h=(0,o.twipsToPx)(i.Defaults.webLayout.adaptive.pageSize.minWidth),d=(0,o.twipsToPx)(i.Defaults.webLayout.adaptive.pageSize.maxWidth),y="grid-root";function f(){var t,e,r=null===(t=document.getElementById("review-menu"))||void 0===t?void 0:t.getBoundingClientRect().width,n=null===(e=document.getElementById("comment-group-wrapper"))||void 0===e?void 0:e.getBoundingClientRect().width;return r||n}function v(){return n||(n=document.getElementById(y)),n}function m(){return v().clientWidth}function P(){var t=s("right"),e=f()?p:0;return Math.max(Math.max(t,e),u)}function T(){return function(){var t,e;if(null===(e=null===(t=null===window||void 0===window?void 0:window.workbench)||void 0===t?void 0:t.store)||void 0===e?void 0:e.getValue){var r=window.workbench.store.getValue(a.j.LeftDrawerOpened),n=window.workbench.store.getValue(a.j.LeftDrawerInfo);return"toc"===(null==n?void 0:n.name)&&!!r}return!1}()?l:c}function S(){var t=v().getBoundingClientRect().width-g,e=T(),r=P(),n=Math.min(t-e-r,d);return n=Math.max(n,h),{width:(0,o.pxToTwips)(n),height:i.Defaults.webLayout.adaptive.pageSize.nonLastPageHeight,top:i.Defaults.webLayout.adaptive.pageMargins.top,right:i.Defaults.webLayout.adaptive.pageMargins.right,bottom:i.Defaults.webLayout.adaptive.pageMargins.bottom,left:i.Defaults.webLayout.adaptive.pageMargins.left,margins:{top:0,bottom:0,left:(0,o.pxToTwips)(e),right:(0,o.pxToTwips)(r)}}}function C(){return{width:i.Defaults.webLayout.standardWide.pageSize.width,height:i.Defaults.webLayout.standardWide.pageSize.height,top:i.Defaults.webLayout.standardWide.pageMargins.top,right:i.Defaults.webLayout.standardWide.pageMargins.right,bottom:i.Defaults.webLayout.standardWide.pageMargins.bottom,left:i.Defaults.webLayout.standardWide.pageMargins.left}}function b(){return{width:i.Defaults.webLayout.ultraWide.pageSize.width,height:i.Defaults.webLayout.ultraWide.pageSize.height,top:i.Defaults.webLayout.ultraWide.pageMargins.top,right:i.Defaults.webLayout.ultraWide.pageMargins.right,bottom:i.Defaults.webLayout.ultraWide.pageMargins.bottom,left:i.Defaults.webLayout.ultraWide.pageMargins.left}}function R(){return{width:Math.max(m(),screen.width),fontSize:20,denseLineHeightRatio:7,looseLineHeightRatio:5}}},169363:function(t,e,r){r.d(e,{C:function(){return i}});var n=r(839461),o=r(12652),i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasDownloadImgs=0,e.currentDocImages=0,e.printStatus=!1,e.loadErrorImages=0,e.loadSuccessImages=0,e.initalImages=0,e.loadedPrintAllImages=!1,e}return(0,n.__extends)(e,t),e.getInstance=function(t){return this.editor=t,this.instance||(this.instance=new e),this.instance},e.prototype.isLoadOn=function(){var t=e.getInstance(e.editor);return!!(this.currentDocImages<=this.hasDownloadImgs&&t.isPrinting()&&0!==this.hasDownloadImgs)&&(t.finishPrinting(),e.editor.fire(new o.$(o.i.FINISH_IMAGE_LOAD)),this.loadedPrintAllImages=!0,!0)},e.loadSuccess=function(t){var r=e.getInstance(t);!r.isPrinting()||(r.addLoadSuccessRecord(),r.isLoadOn())},e.loadError=function(t){var r=e.getInstance(t);!r.isPrinting()||(r.addLoadErrorRecord(),r.isLoadOn())},e.prototype.clear=function(){this.loadErrorImages=0,this.loadSuccessImages=0},Object.defineProperty(e.prototype,"loadErrorRecords",{get:function(){return this.loadErrorImages},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadSuccessRecords",{get:function(){return this.loadSuccessImages},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoadedAllImage",{get:function(){return this.loadedPrintAllImages},enumerable:!1,configurable:!0}),e.prototype.addLoadErrorRecord=function(){this.loadErrorImages+=1,this.hasDownloadImgs+=1},e.prototype.addLoadSuccessRecord=function(){this.hasDownloadImgs+=1,this.loadSuccessImages+=1},Object.defineProperty(e.prototype,"getHasDownloadImgs",{get:function(){return this.hasDownloadImgs},enumerable:!1,configurable:!0}),e.prototype.isPrinting=function(){return this.printStatus&&this.currentDocImages>0},e.prototype.startPrinting=function(t){this.hasDownloadImgs=0,this.printStatus=!0,this.initalImages=t,this.hasDownloadImgs+=t,this.currentDocImages=e.getAllImages(e.editor)},e.prototype.finishPrinting=function(){this.hasDownloadImgs=0,this.printStatus=!1,this.loadedPrintAllImages=!1;var t=document.getElementById("melo-hidden-editor");t&&t.focus()},e.prototype.testMockCurrentImages=function(t){this.currentDocImages=t},e.getAllImageUrl=function(t){var e=[],r=t.service.getDocument().getInlineShapes();return(0,n.__spreadArray)([],(0,n.__read)(r),!1).forEach((function(t){if(t){var r=t.getAnchorId(),n=t.getAnchorId()?t.getAnchorId():"";e.push([r,n])}})),e},e.getAllImages=function(t){return t.service.getDocument().getInlineShapes().imagesCount()},e.getInitImageCount=function(t){var e,r=null===(e=t.getRoot())||void 0===e?void 0:e.getElementsByClassName("image-wrapper");return r?r.length:0},e}((function(){}))},174084:function(t,e,r){r.d(e,{DI:function(){return s},hj:function(){return l},pm:function(){return i}});var n=r(839461),o=r(495155);function i(t){return(t.split("?")[1]||"").split("&").filter((function(t){return t})).map((function(t){return t.split("=").map(decodeURIComponent)})).reduce((function(t,e){var r,o=(0,n.__read)(e,2),i=o[0],a=o[1];return(0,n.__assign)((0,n.__assign)({},t),((r={})[i]=t[i]?[a].concat(t[i]):a,r))}),Object.create(null))}function a(t,e){return t.replace(/(\?.*)?$/,"?".concat((0,o.objectMap)(e,(function(t,e){return[e,t].map(encodeURIComponent).join("=")})).join("&")))}function s(t,e){return a(t,Object.assign(i(t),e))}function l(t,e){var r=i(t);return delete r[e],a(t,r)}},593214:function(t,e,r){r.d(e,{V:function(){return i}});var n=r(750670),o=r(495155);function i(t,e,r){var i;if(!r)return!1;var a=r.start.leafBox,s=r.end.leafBox,l=a.parentBox,p=s.parentBox;if(!l||!p)return!1;var c=n.LayoutUtil.getOffsetPoint(l,n.BoxKind.Document),u=c.x,g=c.y,h=n.LayoutUtil.getOffsetPoint(p,n.BoxKind.Document),d=h.y,y=h.x;if(e.y<g||e.y>d+p.totalHeight)return!1;var f=n.LayoutTableUtil.getOutestTableBox(a);if(f){var v="table-".concat(f.tableId),m=t.view.getRenderState().getScrollerInfo(v);m&&(e.x+=(0,o.pxToTwips)(m.left),e.y+=(0,o.pxToTwips)(m.top))}var P=n.LayoutUtil.getOffsetPoint(a,n.BoxKind.Document).x,T=n.LayoutUtil.getOffsetPoint(s,n.BoxKind.Document).x;if(l===p)return e.x>=P&&e.x<=T+s.totalWidth;if(new o.MeloRect({x:P,y:g,width:u+l.totalWidth-P,height:l.totalHeight}).contains(e))return!0;if(new o.MeloRect({x:y,y:d,width:T-y,height:p.totalHeight}).contains(e))return!0;var S=g+l.totalHeight;return new o.MeloRect({x:u,y:S,width:(null===(i=l.parentBox)||void 0===i?void 0:i.totalWidth)||0,height:d-S}).contains(e)}},371741:function(t,e,r){r.d(e,{G:function(){return a},Q:function(){return i}});var n=r(750670),o=r(252783),i=function(){function t(){this.fieldCodeMap=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.add=function(t,e){this.fieldCodeMap.set(t,e)},t.prototype.get=function(t){return this.fieldCodeMap.get(t)},t.prototype.remove=function(t){return this.fieldCodeMap.delete(t)},t}(),a=function(t){var e,r=t.fieldCode,a=r.name;r.name===n.FieldName.HYPERLINK&&t.layoutType===n.FieldLayoutType.Text?a=o.m7.NormalLink:n.FieldUtil.isComplexField(r.switches)&&(a=null!==(e=n.FieldUtil.getComplexFieldSubType(r.switches))&&void 0!==e?e:a);var s=i.getInstance().get(a);return s?s(t):{}}},740587:function(t,e,r){r.d(e,{x:function(){return P}});var n=r(839461),o=r(87363),i=r.n(o),a=r(750670),s=r(429313),l=r(583865),p=r(824731),c="tdocs-fieldcode-component",u="tdocs-fieldcode-dropdown",g="tdocs-fieldcode-dropdown-button",h="tdocs-fieldcode-mouse-link",d="tdocs-fieldcode-dropdown-backdrop",y="tdocs-toolbar-button-arrow",f=r(218581),v=r(259356),m=r(339106),P=function(t){function e(e){var r=t.call(this,e)||this;return r.onMouseEnter=function(){var t=r.props,e=t.layoutBox,n=t.fieldInfo,o=e.content;if(n&&o&&((0,a.isTextBox)(o)||(0,a.isTextBoxLite)(o))){var i=o.text,s=r.fieldService.convertToFieldCodeInfo(n),l=a.FieldUtil.getComplexFieldSubType(s.switches),p=a.FieldCodeManager.getInstance().getFieldProcessor(s.name,l);if(!p)return;var c=p.getDropdownItems(s,i);(!p.isAutoUpdate||c.length>0)&&p.isShowDropdowns&&r.setState({showButton:!0,dropdowns:c,isAutoUpdate:p.isAutoUpdate}),p.isShowHover&&r.setState({showBackground:!0})}},r.onMouseLeave=function(){r.setState({showBackground:!1,showButton:!1,showDropdown:!1})},r.handleDropdownClick=function(){r.setState({showDropdown:!0});var t=r.props.fieldInfo;if(t){var e=r.fieldService.convertToFieldCodeInfo(t),n=a.FieldUtil.getComplexFieldSubType(e.switches),o=a.FieldCodeManager.getInstance().getFieldProcessor(e.name,n);if(!o)return;o.afterShowDropdown()}},r.hideDropdown=function(){r.setState({showDropdown:!1,showBackground:!1,showButton:!1})},r.handleMenuClick=function(t){var e;if("update-field"!==t){var n=parseInt(t.replace("field-dropdown-",""),10),o=(null!==(e=r.props.fieldInfo)&&void 0!==e?e:{}).fieldRange;if(n>=0&&o){var i=r.state.dropdowns[n].onClick;i&&i(o)}r.hideDropdown()}else r.hideDropdown()},r.handleFieldClick=function(t){var e=r.props,n=e.layoutBox,o=e.fieldInfo;if(o){var i=r.fieldService.convertToFieldCodeInfo(o),s=a.FieldUtil.getComplexFieldSubType(i.switches),l=a.FieldCodeManager.getInstance().getFieldProcessor(i.name,s);if(!l)return;l.handleFieldClick(i,n,t)}},r.rootRef=i().createRef(),r.state={showBackground:!1,showButton:!1,showDropdown:!1,dropdowns:[],isAutoUpdate:!1},r}var r;return(0,n.__extends)(e,t),e.prototype.render=function(){var t=this.props,e=t.children,r=t.overrideStyle;return i().createElement("span",{style:(0,n.__assign)({background:this.state.showBackground?"#d1e6fc":void 0},a.CssUtil.cssPropsToStyle(r)),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.handleFieldClick,className:c,ref:this.rootRef},this.state.showButton&&i().createElement(l.default,{dropContent:i().createElement(p.default,{style:{width:110,transform:"translate(-50%, 0)",position:"relative",left:7},onClick:this.handleMenuClick},!this.state.isAutoUpdate&&i().createElement(p.default.Item,{id:"update-field"},(0,f.$t)("更新域")),!this.state.isAutoUpdate&&this.state.dropdowns.length>0&&i().createElement(s.ZP,null),this.state.dropdowns.map((function(t,e){return i().createElement(p.default.Item,{className:t.checked?"checked":"",key:"field-dropdown-".concat(e),id:"field-dropdown-".concat(e)},t.content)}))),visible:this.state.showDropdown,className:u},i().createElement("button",{className:"".concat(g," ").concat(y),onClick:this.handleDropdownClick})),this.state.showButton&&i().createElement("div",{className:h}),this.state.showDropdown&&i().createElement("div",{className:d,onClick:this.hideDropdown}),e)},(0,n.__decorate)([(0,v.tB)(),(0,n.__metadata)("design:type","function"==typeof(r=void 0!==m.D&&m.D)?r:Object)],e.prototype,"fieldService",void 0),e}(o.Component)},786945:function(t,e,r){r.d(e,{Cy:function(){return i},ZH:function(){return s},_b:function(){return a}});var n=r(750670),o=r(495155),i=function(){function t(){this.fieldCodeParserMap=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.getRegisteredParser=function(t){return this.fieldCodeParserMap.get(t)},t.prototype.registerFieldCodeParser=function(t,e){this.fieldCodeParserMap.set(t,e)},t.prototype.removeFieldCodeParser=function(t){this.fieldCodeParserMap.delete(t)},t}(),a=function(t,e){var r=(0,n.makeEmptyCopyData)();if(!t.fieldProps)return r;var a=i.getInstance().getRegisteredParser(t.fieldProps.fieldCode.name);if(!a){var s=t.getResultNode({});if(s){var l="".concat((0,o.escapeHTML)(s.getTextContent()));return{html:l,plain:l,refText:l}}return r}return a(t,e)};function s(t,e){i.getInstance().registerFieldCodeParser(t,(function(t,r){var i=(0,n.makeEmptyCopyData)();if(!t.fieldProps)return i;var a=e(t.fieldProps);if(!a)return i;var s=(0,o.escapeHTML)(a);return{html:s,plain:s,refText:s}}))}},12652:function(t,e,r){r.d(e,{$:function(){return a},i:function(){return n}});var n,o=r(839461),i=r(495155);!function(t){t.FINISH_IMAGE_LOAD="finish_image_load",t.FINISH_ADDON_IFRAME_LOAD="finish_addon_frame_load"}(n||(n={}));var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e}(i.Notification)},565384:function(t,e,r){r.d(e,{f:function(){return i},s:function(){return a}});var n=r(839461),o=r(750670),i="embed_comment",a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,n.__extends)(e,t),Object.defineProperty(e.prototype,"isFixedRatio",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"measureFit",{get:function(){return!this.isHidden&&this.getProperty().embedCommentHeight>0?o.BoundFit.FitParent:o.BoundFit.None},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extentFit",{get:function(){return o.BoundFit.None},enumerable:!1,configurable:!0}),e.prototype.getProperty=function(){return this.nodeProperty||(this.nodeProperty=this.context.dataStream.getAnnotationStream().createCommentIterator(this.range).getProperty()),this.nodeProperty},Object.defineProperty(e.prototype,"isHidden",{get:function(){if(this.context.dataStream.getTableStream().getTableInfo(this.range.begin()))return!0;var t=this.context.dataStream.getStoryStream().getSubStoryInfoFromGcp(this.range.begin());return!(!t||t.storyProp.storyType===o.STStoryType.mainDocument)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueTypeId",{get:function(){return i},enumerable:!1,configurable:!0}),e}(o.LeafContainerNode)},695591:function(t,e,r){r.d(e,{k:function(){return n}});var n=function(){function t(){this.clients=new Map,this.stickyActions=new Map}return t.prototype.addClient=function(t,e){if(!this.clients.has(t)){this.clients.set(t,e);var r=this.stickyActions.get(t);r&&r.forEach((function(t){return e.onAction(t)}))}},t.prototype.get=function(t){var e=this.clients.get(t);return null==e?void 0:e.get()},t.prototype.sendAction=function(t,e,r,n){void 0===r&&(r=!0),void 0===n&&(n=!1);var o=this.clients.get(t);if(o)o.onAction(e);else if(r){var i=this.stickyActions.get(t);if(i){if(!n){var a=i.findIndex((function(t){return t.type===e.type}));a>=0&&i.splice(a,1)}}else i=[];i.push(e),this.stickyActions.set(t,i)}},t}()},68883:function(t,e,r){var n;r.d(e,{W0:function(){return a},kO:function(){return i},oS:function(){return o},zE:function(){return n}}),function(t){t[t.DatabaseProxy=0]="DatabaseProxy",t[t.List=1]="List",t[t.Splitline=2]="Splitline",t[t.Codeblock=3]="Codeblock",t[t.Location=4]="Location",t[t.Addon=5]="Addon",t[t.Hint=6]="Hint",t[t.AddonLink=7]="AddonLink",t[t.HyperLink=8]="HyperLink",t[t.Attachment=9]="Attachment",t[t.DocLink=10]="DocLink",t[t.ParagraphMenu=11]="ParagraphMenu",t[t.ParagraphMenuButton=12]="ParagraphMenuButton",t[t.NormalLink=13]="NormalLink",t[t.AttachmentPreview=14]="AttachmentPreview",t[t.LightBlock=15]="LightBlock",t[t.Shape=16]="Shape",t[t.DateReminder=17]="DateReminder",t[t.WxworkGroupChat=18]="WxworkGroupChat",t[t.WxworkGroupContactCard=19]="WxworkGroupContactCard",t[t.WxworkMemberContactCard=20]="WxworkMemberContactCard",t[t.WxworkCalender=21]="WxworkCalender",t[t.WxworkApp=22]="WxworkApp",t[t.WxworkMeeting=23]="WxworkMeeting",t[t.WxworkColdStartButton=24]="WxworkColdStartButton"}(n||(n={}));var o="add_bridge",i="add_deferred_bridge",a="add_field_code_bridge"},618914:function(t,e,r){r.d(e,{B:function(){return c}});var n=r(839461),o=r(100882),i=r(750670),a=r(61654),s=r(116896),l=r(495155),p=function(){function t(){this.imagePlaceholderCache=new Map}return t.prototype.draw=function(t,e){var r,n,o=this.generateDrawingViewOptions(t,e),a=i.PoolNodeFactory.obtain(i.IDrawingView,o),s=this.getDrawingViewPriorityType(e);t.addView(a,s),((null===(r=e.revisionInfo)||void 0===r?void 0:r.hasInsertMarkup)||(null===(n=e.revisionInfo)||void 0===n?void 0:n.hasDeleteMarkup))&&this.drawRevisionMarkup(t,o,s)},t.prototype.drawRevisionMarkup=function(t,e,r){var s=(0,n.__assign)((0,n.__assign)({},e),{placeholderImageSrc:void 0,fillStyle:{},strokeStyle:{type:o.nZ.SOLID,lineWidth:2,lineCap:a.uq.Square,lineJoin:a.Y3.Bevel,fillStyle:{solidFill:{color:i.ColorUtil.revisionColor}}}});if(s.contextState){var p=e.contextState.clipInfo||{x:0,y:0,width:0,height:0},c=(0,l.pxToTwips)(2);s.contextState.clipInfo={x:p.x-c,y:p.y-c,width:p.width,height:p.height}}var u=i.PoolNodeFactory.obtain(i.IDrawingView,s);t.addView(u,r)},t.prototype.generateDrawingViewOptions=function(t,e){var r=i.PropertyImageUtil.getImageProperty(e.property),n=r.rotateDegree,a=r.effectExtent,l=r.imgSrc,p=r.cropTop,c=r.cropRight,u=r.cropBottom,g=r.cropLeft,h=r.width,d=r.height,y=r.containerWidth,f=r.containerHeight,v=(0,i.isFloatingBox)(e)?Number.POSITIVE_INFINITY:s.Lk.getMaxWidthFromLayoutBox(e);if(y>v){var m=v/y;h*=m,d*=m,y=v,f*=m}var P,T=t.getCurrentState(),S=T.docViewType,C=T.isFocusHeaderFooter,b=T.isInHeaderFooter,R=T.contextState,_=T.viewRegion,w=T.offset,x=i.CssUtil.computeHeaderFooterFocusStyles(S,C,b).opacity,I=void 0===x?1:x,D=s.Lk.isPlaceHolder(l);return D&&this.imagePlaceholderCache.set(e.key,l),P=0===d||0===h||D?void 0:s.Lk.getImageThumb(l,s.xo.Pc),{frame:{left:w.x+(y-h)/2,top:w.y+(f-d)/2-_.y,width:h,height:d,flipH:!1,flipV:!1,rotate:n/i.DefaultsUnit.rotate},path:{type:o.wf.RECT},effectExtent:a,fillStyle:{imageFill:{src:null!=P?P:l,alpha:I,rotateWithShape:!0,stretch:{srcRect:{b:u/i.DefaultsUnit.percentage,t:p/i.DefaultsUnit.percentage,l:g/i.DefaultsUnit.percentage,r:c/i.DefaultsUnit.percentage}}}},contextState:R,placeholderImageSrc:D?void 0:this.imagePlaceholderCache.get(e.key),containerWidth:y,containerHeight:f}},t.prototype.getDrawingViewPriorityType=function(t){return t.property&&!t.property.isEmpty(t.property.tKeys.anchor)&&t.property.anchor.behindDoc&&!t.property.anchor.isEmpty(t.property.anchor.tKeys.wrapNone)?i.RenderPriorityConfig.behindTextImage:i.RenderPriorityConfig.inFrontOfTextImage},t}();function c(){return new p}},313262:function(t,e,r){r.d(e,{t:function(){return b},A:function(){return R}});var n=r(87363),o=r.n(n),i=r(839461),a=r(750670),s=r(450057),l=r(814808),p=r(273586),c=r(116896),u=r(495155),g=r(169363),h=r(989094),d=r(174084),y=r(224370),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onMouseDown=function(t){t.preventDefault(),t.stopPropagation()},e.onMouseUp=function(t){t.preventDefault(),t.stopPropagation()},e.onTouchEnd=function(t){e.handleAction(),t.preventDefault(),t.stopPropagation()},e.onClick=function(t){e.handleAction(),t.preventDefault(),t.stopPropagation()},e}return(0,i.__extends)(e,t),e.prototype.handleAction=function(){this.props.onImageCustomAction()},e.prototype.render=function(){return o().createElement("div",{onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onClick:this.onClick,onTouchEnd:this.onTouchEnd,style:(0,i.__assign)({},this.props.styles)})},e}(o().Component),v=r(218581),m=l.default,P=function(t){function e(e){var r=t.call(this,e)||this;return r.initPosition={x:0,y:0},r.imgSrcShow="",r.imgError=!1,r.touchAction=a.TouchAction.NONE,r.retryTimes=0,r.imageSourceType=a.STAddonSourceType.PBDEFAULT,r.onError=function(t){var e,n;if(g.C.loadError(r.editor),u.Logger.error("prepareImage Onload Error: ".concat(t.target.src)),r.retryTimes<1){var o=a.PropertyImageUtil.getImageProperty(r.props.layoutBox.property).imgSrc;return o&&(t.target.src=c.Lk.getAuthCdnUrl(o)),void(r.retryTimes+=1)}r.imgError=!0,null===(n=(e=r.props).onError)||void 0===n||n.call(e),r.forceUpdate()},r.handleCustomAction=function(){if(r.imageSourceType===a.STAddonSourceType.signbar){if(!r.editor.isCopyable())return void m.show({message:(0,v.$t)("addon:permission-denied-tips"),autoClose:!0,duration:3e3,type:"info"});setTimeout((function(){r.handleSignbarCustomAction()}))}},r.editor=r.props.context,r.onError=r.onError.bind(r),r.onLoad=r.onLoad.bind(r),r.state={showLoading:!1,imgLoaded:!1},r}return(0,i.__extends)(e,t),e.prototype.componentDidMount=function(){var t=this;setTimeout((function(){t.state.imgLoaded||t.setState({showLoading:!0})}),100)},e.prototype.shouldComponentUpdate=function(t,e){if(this.state.showLoading!==e.showLoading)return!0;var r=this.props.layoutBox,n=t.layoutBox;if(!r.property||!n.property)return!0;var o=a.PropertyImageUtil.getImageProperty(r.property),i=a.PropertyImageUtil.getImageProperty(n.property);return!(this.isSameProp(o,i)&&this.props.width===t.width&&this.props.height===t.height)},e.prototype.isSameProp=function(t,e){return t.height===e.height&&t.width===e.width&&t.cropBottom===e.cropBottom&&t.cropLeft===e.cropLeft&&t.cropRight===e.cropRight&&t.cropTop===e.cropTop&&t.rotateDegree===e.rotateDegree&&t.imgSrc===e.imgSrc&&t.anchorId===e.anchorId},e.prototype.onLoad=function(t){var e=t.target,r=this.props.layoutBox,n=a.PropertyImageUtil.getImageProperty(r.property);if(!n||0!==n.height&&0!==n.width)this.props.layoutBox.property.anchorId||this.props.context&&c.Lk.imageSizeInit(this.editor,new a.ImageSizeInitNotification(0,0,this.props.layoutBox.getRange()));else{var o=e.naturalHeight,i=e.naturalWidth,s=this.props.layoutBox.getRange(),l=4096,p=4096;i>o?i>l&&(o*=l/i,i=l):o>p&&(i*=p/o,o=p),this.props.context&&c.Lk.imageSizeInit(this.editor,new a.ImageSizeInitNotification((0,u.pxToTwips)(o),(0,u.pxToTwips)(i),s))}g.C.loadSuccess(this.editor),this.setState({showLoading:!1,imgLoaded:!0})},e.prototype.getImageSize=function(){var t=this.props.layoutBox,e=a.PropertyImageUtil.getImageProperty(t.property),r=(0,a.isFloatingBox)(t)?Number.POSITIVE_INFINITY:c.Lk.getMaxWidthFromLayoutBox(t);if((0,h.lb)(r)[e.sourceType])return(0,h.lb)((0,u.twipsToPx)(r))[e.sourceType];var n=Math.min(1,r/e.containerWidth);return{originWidth:(0,u.twipsToPx)(e.originWidth*n)||0,originHeight:(0,u.twipsToPx)(e.originHeight*n)||0,marginLeft:(0,u.twipsToPx)(e.croppedX*n)||0,marginTop:(0,u.twipsToPx)(e.croppedY*n)||0}},e.prototype.getImageVisibility=function(){var t=this.props.layoutBox;return(0,a.isLayoutBoxLite)(t)?"visible":a.PropertyImageUtil.shouldUseCanvasRender(t.property)?"hidden":"visible"},e.prototype.prepareDataBeforeRender=function(){var t=this.props.layoutBox,e=a.PropertyImageUtil.getImageProperty(t.property),r=e.height,n=e.width,o=e.imgSrc,i=c.Lk.isPlaceHolder(o);if(0===r||0===n||i)this.imgSrcShow=o;else{var s=c.xo.Pc;this.imgSrcShow=c.Lk.getImageThumb(o,s)}},e.prototype.getVerticalAlign=function(){return this.editor.docEnv.renderType===a.RenderType.Lite?"baseline":"top"},e.prototype.getAddonImageStyle=function(t){var e=a.PropertyImageUtil.getImageProperty(this.props.layoutBox.property).sourceType,r=this.editor.isEditable(),n="1"===(0,d.pm)(window.location.search).ocr,o=(0,h.X9)({isEditable:r,isOcr:n})[e],i=(0,h.Ew)(e,t.originWidth),s=i.imageUrl,l=i.customActionButtonRect;return{imgSrc:null!=s?s:c.Lk.getAuthCdnUrl(this.imgSrcShow),sourceType:e,cursorType:o,customActionButtonRect:l}},e.prototype.hideImage=function(){var t,e=this.props.layoutBox;return!!c.Lk.isPlaceHolder(this.imgSrcShow)&&!(!(0,a.isContainerBoxLite)(e)||!(0,a.isTableCellLite)(null===(t=e.parentBox)||void 0===t?void 0:t.parentBox))},e.prototype.handleSignbarCustomAction=function(){var t,e,r,n,o,s;return(0,i.__awaiter)(this,void 0,void 0,(function(){var l;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return[4,y.DocAddonBridge.getMallAddonByTopicId("1hbwxggc8igcbbthd5qnwtjyea")];case 1:return(null==(l=i.sent())?void 0:l.marketingItems.length)>0&&(y.DocAddonBridge.openAddon({addonId:null===(t=null==l?void 0:l.marketingItems[0])||void 0===t?void 0:t.itemId,marketId:null===(e=null==l?void 0:l.marketingItems[0])||void 0===e?void 0:e.marketingItemId}),a.ReportHelper.tdwReport({opername:"doc_addon",module:"addon_list",action:"clk_addon",ver6:null!==(n=null===(r=null==l?void 0:l.items[0])||void 0===r?void 0:r.id)&&void 0!==n?n:"",ver7:null!==(s=null===(o=null==l?void 0:l.items[0])||void 0===o?void 0:o.name)&&void 0!==s?s:"",ver9:"doc_sign_component",ver11:1,file_type:"doc"})),[2]}}))}))},e.prototype.render=function(){this.prepareDataBeforeRender();var t=this.props.layoutBox,e=a.PropertyImageUtil.getImageProperty(t.property),r=this.getImageSize(),n=this.getImageVisibility(),s=this.getAddonImageStyle(r),l=s.sourceType,u=s.cursorType,g=s.imgSrc,h=s.customActionButtonRect,d=c.Lk.getUniqueAnchorId(this.props.layoutBox);this.imageSourceType=l;var y=(0,a.isFloatingBox)(t)?"wrap":"inline",m="melo-".concat(y,"-image");return""===g||this.imgError?o().createElement(p.a,{id:d,tipsType:p.q.Image,height:r.originWidth,width:r.originHeight}):o().createElement(o().Fragment,null,!g.startsWith("data:")&&this.state.showLoading&&o().createElement("img",{draggable:!1,src:(0,a.generateLoadingSvg)({width:r.originWidth,height:r.originHeight,loadingText:(0,v.$t)("加载中...")}),style:{visibility:n,cursor:u,verticalAlign:this.getVerticalAlign(),width:r.originWidth,height:r.originHeight,marginTop:r.marginTop,marginLeft:r.marginLeft,userSelect:"none",pointerEvents:"none",display:this.hideImage()?"none":"inline",position:"absolute",zIndex:-1}}),o().createElement("img",{crossOrigin:"anonymous",draggable:!1,className:m,id:d,src:g,style:{visibility:n,cursor:u,verticalAlign:this.getVerticalAlign(),width:r.originWidth,height:r.originHeight,marginTop:r.marginTop,marginLeft:r.marginLeft,userSelect:"none",pointerEvents:"none",display:this.hideImage()?"none":"inline"},"data-cls":["".concat(c.Ds.cropBottom,":").concat(e.cropBottom),"".concat(c.Ds.cropTop,":").concat(e.cropTop),"".concat(c.Ds.cropLeft,":").concat(e.cropLeft),"".concat(c.Ds.cropRight,":").concat(e.cropRight),"".concat(c.Ds.rotateDegree,":").concat(e.rotateDegree),"".concat(c.Ds.originHeight,":").concat(r.originHeight),"".concat(c.Ds.originWidth,":").concat(r.originWidth),"".concat(c.Ds.sourceType,":").concat(e.sourceType)].join(" "),onError:this.onError,onLoad:this.onLoad}),h?o().createElement(f,{styles:(0,i.__assign)({display:"block",position:"absolute"},h),onImageCustomAction:this.handleCustomAction}):"")},e}(o().Component),T=r(577050),S=r(652576),C=function(t){function e(e){var r=t.call(this,e)||this;return r.canShowImage=!0,r.respondEventTimer=null,r.initPosition={x:0,y:0},r.isTouchStartToEnd=!0,r.onContextMenu=function(t){t.stopPropagation(),u.PlatformUtil.isTencentDocsIPadApp()&&t.stopPropagation()},r.onMouseDown=function(t){t.stopPropagation(),u.PlatformUtil.isTencentDocsIPadApp()&&t.preventDefault();var e=a.PropertyImageUtil.getImageProperty(r.props.layoutBox.property).imgSrc;c.Lk.isPlaceHolder(e)||r.props.containerFocus.onFocus(r.props.layoutBox,{isLeftMouse:2!==t.button})},r.onMouseUp=function(t){t.stopPropagation(),t.preventDefault();var e=a.PropertyImageUtil.getImageProperty(r.props.layoutBox.property).imgSrc;c.Lk.isPlaceHolder(e)||0===t.button||r.props.containerFocus.onFocus(r.props.layoutBox,{isLeftMouse:!0})},r.onTouchStart=function(t){t.stopPropagation(),t&&t.changedTouches&&t.changedTouches.length>0&&(r.initPosition={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}),r.isTouchStartToEnd=!0,r.isLongPress=!1,r.longPressTimer=setTimeout((function(){r.isLongPress=!0}),500)},r.onTouchMove=function(t){r.initPosition&&r.initPosition.x&&r.initPosition.y&&t&&t.changedTouches&&(Math.abs(t.changedTouches[0].clientX-r.initPosition.x)>10||Math.abs(t.changedTouches[0].clientY-r.initPosition.y)>10)&&(r.isTouchStartToEnd=!1)},r.onTouchEnd=function(t){var e=(0,S.iq)(t,r.lastTouchInfo);if(r.lastTouchInfo={target:t.target,time:Date.now()},t.cancelable&&t.preventDefault(),t.stopPropagation(),r.isTouchStartToEnd){var n=a.PropertyImageUtil.getImageProperty(r.props.layoutBox.property).imgSrc;c.Lk.isPlaceHolder(n)||r.props.containerFocus.onFocus(r.props.layoutBox,{isDoubleClick:e,isLeftMouse:!0,isSingleClick:!e,isLongPress:r.isLongPress})}r.isLongPress||(r.longPressTimer&&clearTimeout(r.longPressTimer),r.longPressTimer=null)},r.onClick=function(t){t.stopPropagation(),t.preventDefault();var e=a.PropertyImageUtil.getImageProperty(r.props.layoutBox.property).imgSrc;c.Lk.isPlaceHolder(e)||r.props.containerFocus.onFocus(r.props.layoutBox,{isSingleClick:!0})},r.onDoubleClick=function(){var t=a.PropertyImageUtil.getImageProperty(r.props.layoutBox.property).imgSrc;c.Lk.isPlaceHolder(t)||r.props.containerFocus.onFocus(r.props.layoutBox,{isDoubleClick:!0})},r.onWheel=function(t){if(!(Math.abs(t.deltaY)>Math.abs(t.deltaX))||t.shiftKey){if(!r.respondEventTimer){if(r.root){r.setState({respondEvent:!1});var e=(0,T.s)(r.root,2);e&&(e.style.pointerEvents="none")}r.respondEventTimer=(0,u.debounce)((function(){if(r.root){r.setState({respondEvent:!0});var t=(0,T.s)(r.root,2);t&&(t.style.pointerEvents="all")}r.respondEventTimer=null}),300)}r.respondEventTimer()}},r.editor=r.props.context,r.onClick=r.onClick.bind(r),r.onDoubleClick=r.onDoubleClick.bind(r),r.onMouseUp=r.onMouseUp.bind(r),r.onMouseDown=r.onMouseDown.bind(r),r.onTouchStart=r.onTouchStart.bind(r),r.onTouchEnd=r.onTouchEnd.bind(r),r.onTouchMove=r.onTouchMove.bind(r),r.state={imgError:!1},r.lastTouchInfo={time:0,target:null},r}return(0,i.__extends)(e,t),e.prototype.getRectSize=function(){var t=this.props.layoutBox,e=a.PropertyImageUtil.getImageProperty(t.property),r=(0,a.isFloatingBox)(t)?Number.POSITIVE_INFINITY:Math.max(c.Lk.getMaxWidthFromLayoutBox(t),28),n=e.sourceType===a.STAddonSourceType.signbar;e.containerWidth=n?r:e.containerWidth,e.width=n?r:e.width;var o=Math.min(1,r/e.containerWidth),i=e.height*o,s=e.width*o,l=a.Defaults.containerMargin,p=l.left,u=l.top,g=l.right;return{left:p,top:u,right:g,width:s,height:i,containerWidth:(e.containerWidth+p+g)*o,containerHeight:(e.containerHeight+u)*o}},e.prototype.getScale=function(t,e){return e/t},e.prototype.getVerticalAlign=function(){return this.editor.docEnv.renderType===a.RenderType.Lite?"baseline":"top"},e.prototype.getPosition=function(){return this.editor.docEnv.renderType===a.RenderType.Lite?"relative":"absolute"},e.prototype.getPageMargin=function(t){var e,r,n,o,i,s,l,p=t.getAncestorOf(a.BoxKind.Page);return{pageWidth:null!==(e=null==p?void 0:p.totalWidth)&&void 0!==e?e:1/0,marginRight:null!==(o=null===(n=null===(r=null==p?void 0:p.edge)||void 0===r?void 0:r.padding)||void 0===n?void 0:n.right)&&void 0!==o?o:0,marginBottom:null!==(l=null===(s=null===(i=null==p?void 0:p.edge)||void 0===i?void 0:i.padding)||void 0===s?void 0:s.bottom)&&void 0!==l?l:0}},e.prototype.getFillStyle=function(t){var e=t.property;if((null==e?void 0:e.drawing.addonSource)===a.STAddonSourceType.signbar)return{};var r=e.drawing.graphic.graphicData.pic.spPr,n={backgroundColor:""},o={borderColor:"",borderWidth:0,borderStyle:"solid"};return!r.isEmpty(r.tKeys.solidFill)&&r.solidFill.egColorChoice.Choice instanceof a.PropertyFactory.getPropertyClass(a.PropertyType.CTSRgbColor)&&(n.backgroundColor="#".concat(r.solidFill.egColorChoice.Choice.val)),r.isEmpty(r.tKeys.ln)||(o.borderWidth=(0,u.emuToPx)(r.ln.w),r.ln.egLineFillProperties.solidFill.egColorChoice.Choice instanceof a.PropertyFactory.getPropertyClass(a.PropertyType.CTSRgbColor)&&(o.borderColor="#".concat(r.ln.egLineFillProperties.solidFill.egColorChoice.Choice.val))),(0,i.__assign)((0,i.__assign)({},n),o)},e.prototype.render=function(){var t=this,e=this.props.layoutBox,r=a.PropertyImageUtil.getImageProperty(e.property),n=r.sourceType,s=r.imgSrc,l=r.rotateDegree;c.Lk.isPlaceHolder(s)?(this.canShowImage=!1,s&&s.indexOf("blob:https")>=0&&(this.canShowImage=!0)):this.canShowImage=!0;var p=this.editor.isEditable(),g=this.getRectSize(),y=g.left,f=g.top,v=g.right,m=g.width,T=g.height,S=g.containerHeight,C=g.containerWidth,b=this.editor.docEnv.renderType===a.RenderType.Lite?{marginLeft:(0,u.twipsToPx)(y),marginTop:(0,u.twipsToPx)(f),marginRight:(0,u.twipsToPx)(v)}:{},R=c.Lk.getRotateStyle(l,{originWidth:(0,u.twipsToPx)(m),originHeight:(0,u.twipsToPx)(T),marginTop:0,marginLeft:0}),_=this.getFillStyle(e),w="1"===(0,d.pm)(window.location.search).ocr,x=(0,h.X9)({isEditable:p,isOcr:w})[n],I={position:this.getPosition(),display:"inline-block",overflow:"hidden",fontSize:"0px",verticalAlign:this.getVerticalAlign(),lineHeight:1,width:m,height:T};this.props.context.fire(new a.ImageUpdateNotification(e.property.anchorId));var D=!1===this.state.respondEvent?"none":"all",F=o().createElement("span",{className:"melo-inline-block image-wrapper ".concat(h.b3[n||a.STAddonSourceType.PBDEFAULT]," ").concat(this.canShowImage?"":" img-load-background"," ").concat(p?" image-cursor":""),style:(0,i.__assign)((0,i.__assign)((0,i.__assign)((0,i.__assign)((0,i.__assign)((0,i.__assign)({},this.editor.docEnv.renderType!==a.RenderType.Lite?I:{}),R),_),b),{pointerEvents:D,cursor:x,overflow:"hidden"}),this.shouldTransparencyImageWrapper()?{opacity:0}:{}),ref:this.editor.docEnv.renderType!==a.RenderType.Lite?this.setRootRef:null,onClick:this.onClick,onTouchEnd:this.onTouchEnd,onTouchMove:this.onTouchMove,onTouchStart:this.onTouchStart,onContextMenu:this.onContextMenu,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onDoubleClick:this.onDoubleClick,onWheel:this.onWheel},o().createElement(P,{layoutBox:this.props.layoutBox,context:this.props.context,containerFocus:this.props.containerFocus,width:m,height:T,onError:function(){return t.setState({imgError:!0})}}));return(0,a.isContainerBoxLite)(e)?o().createElement("span",{style:(0,i.__assign)((0,i.__assign)({},I),{width:(0,u.twipsToPx)(C),height:(0,u.twipsToPx)(S)}),ref:this.setRootRef},F):F},e.prototype.shouldTransparencyImageWrapper=function(){var t=this.props.layoutBox;return!this.state.imgError&&!(0,a.isLayoutBoxLite)(t)&&!!a.PropertyImageUtil.shouldUseCanvasRender(t.property)},e}(s.w);function b(){return function(t,e,r){return o().createElement(C,{context:r,layoutBox:t,containerFocus:e})}}function R(){return function(t,e,r){return o().createElement(C,{context:r,layoutBox:t,containerFocus:e})}}},695185:function(t,e,r){r.d(e,{O:function(){return p}});var n=r(100882),o=r(750670),i=r(87363),a=r.n(i),s=function(t){var e=t.mathBox,r=t.containerFocus,n=(0,i.useCallback)((function(t){t.stopPropagation(),t.preventDefault();var n=null==r?void 0:r.getContext();n instanceof o.MeloEditor&&!n.state.getRestrictEdit().checkPermissionRangeByGcpRange(null==e?void 0:e.getRange())||r.onFocus(e,{isSingleClick:!0})}),[e,r]),s=(0,i.useCallback)((function(t){t.preventDefault()}),[]),l=(0,i.useCallback)((function(t){t.stopPropagation(),t.preventDefault()}),[]);return a().createElement("div",{id:"math-".concat(e.uuid),style:{width:"100%",height:"100%"},onClick:n,onMouseDown:s,onMouseUp:l})},l=function(){function t(){}return t.prototype.draw=function(t,e){if((0,o.isMathBox)(e)){var r=this.generateDrawingViewOptions(t,e),n=o.PoolNodeFactory.obtain(o.IDrawingView,r);t.addView(n,o.RenderPriorityConfig.mainText);var i=r.frame,l=i.width,p=i.height,c=o.PoolNodeFactory.obtain(o.IComponentView,"math-".concat(e.uuid),(0,o.makeFrame)(0,0,l,p),a().createElement(s,{mathBox:e,containerFocus:t.containerFocus}));t.addView(c)}},t.prototype.generateDrawingViewOptions=function(t,e){var r=e.totalBoxSize,i=r.width,a=r.height,s=t.getCurrentState(),l=s.docViewType,p=s.isFocusHeaderFooter,c=s.isInHeaderFooter,u=s.contextState,g=s.viewRegion,h=s.offset,d=o.CssUtil.computeHeaderFooterFocusStyles(l,p,c).opacity,y=void 0===d?1:d,f="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(e.svg));return{frame:{left:h.x,top:h.y-g.y,width:i,height:a,flipH:!1,flipV:!1,rotate:0},path:{type:n.wf.RECT},fillStyle:{imageFill:{src:f,alpha:y,rotateWithShape:!0,stretch:{srcRect:{b:0,t:0,l:0,r:0}}}},contextState:u}},t}();function p(){return new l}},273586:function(t,e,r){r.d(e,{a:function(){return m},q:function(){return n}});var n,o=r(839461),i=r(87363),a=r.n(i),s="14px",l="16px",p="108px",c="tdocs-place-holder-on-failure",u="tdocs-img-center",g="tdocs-no-tips",h="tdocs-tips-center",d=r(384819),y=r(394306),f=r(445441),v=r(218581);!function(t){t.Image="image",t.Content="content",t.ThirdPartyContent="third_party_content"}(n||(n={}));var m=function(t){function e(e){var r=t.call(this,e)||this;r.tips=new Map([[n.Image,{message:(0,v.$t)("图片加载失败，请稍后再试。"),src:d.Z}],[n.Content,{message:(0,v.$t)("内容加载失败，请稍后再试。"),src:y.Z}],[n.ThirdPartyContent,{message:(0,v.$t)("第三方内容加载失败，请稍后再试。"),src:f.Z}]]);var o=e.tipsType||n.Content;return r.imgSrc=r.tips.get(o).src,r.tipsMsg=r.tips.get(o).message,r.hasTips=r.isLargeImg(e.height,e.width,r.tipsMsg),r}return(0,o.__extends)(e,t),e.prototype.isLargeImg=function(t,e,r){var n=parseFloat(s),o=parseFloat(l),i=this.calcTextWidth(r,n,o);return t>=parseFloat(p)&&e>=i},e.prototype.calcTextWidth=function(t,e,r){return t.length*e+2*r},e.prototype.render=function(){return a().createElement("div",{id:this.props.id,className:c},a().createElement("img",{src:this.imgSrc,className:u}),a().createElement("div",{className:this.hasTips?h:g},this.tipsMsg))},e}(a().Component)},577050:function(t,e,r){function n(t,e){for(var r=t,n=e;n>0&&null!==r;){if(n-=1,!r.parentElement)return null;r=r.parentElement}return r}r.d(e,{s:function(){return n}})},34715:function(t,e,r){r.d(e,{o:function(){return L}});var n,o=r(839461),i=r(87363),a=r.n(i),s=r(750670),l=r(996965),p=r(826973),c=r(187846),u=r(252783),g=r(68883),h=r(695591),d=r(740587),y=function(){function t(){this.fieldCodeRenderMap=new Map,this.bridgeKeyMap=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.getRegisteredDecorator=function(t){return this.fieldCodeRenderMap.get(t)},t.prototype.getRegisteredBridgeKey=function(t){return this.bridgeKeyMap.get(t)},t.prototype.registerDecorator=function(t,e,r){this.fieldCodeRenderMap.set(t,e),r&&this.bridgeKeyMap.set(t,r)},t.prototype.removeDecorator=function(t){this.fieldCodeRenderMap.delete(t),this.bridgeKeyMap.delete(t)},t}(),f=r(371741),v=r(849678),m=r(974238),P=r(495155),T=r(197781),S=r(336338),C=r(593214),b=function(){function t(t){var e=this;this.fieldConfigService=t,this.editorMouseEnterMap=new Map,this.initEventListener=function(t){t.on(s.HiddenEditorNotificationType.ON_INPUT,(function(r){return e.handleInput(t,r)}),e),t.on(s.MouseNotificationType.MOUSE_EVENT,(function(r){return e.handleMouseEvent(t,r)}),e),t.on(s.TouchNotificationType.TOUCH_EVENT,(function(r){return e.handleTouchEvent(t,r)}),e),t.on(s.StateNotification.DeleteFieldContainer,(function(r){return e.handleDeleteFieldContainer(t,r)}),e),t.on(s.RenderNotificationTypes.CONTEXT_MENU_EVENT,(function(){return e.fieldFloatToolbarService.hideFloatToolbar(t)}),e),t.on(s.ClipboardNotificationType.ON_PASTE,(function(r){return e.handlePaste(t,r)}),e),t.on(s.RenderNotificationTypes.PAGE_MOUSE_EVENT,(function(r){return e.handlePageMouseEvent(t,r)}),e)},this.removeEventListener=function(t){t.removeListener(s.HiddenEditorNotificationType.ON_INPUT,e),t.removeListener(s.MouseNotificationType.MOUSE_EVENT,e),t.removeListener(s.TouchNotificationType.TOUCH_EVENT,e),t.removeListener(s.StateNotification.DeleteFieldContainer,e),t.removeListener(s.RenderNotificationTypes.CONTEXT_MENU_EVENT,e),t.removeListener(s.ClipboardNotificationType.ON_PASTE,e),e.editorMouseEnterMap.delete(t.uuid)},this.handleInput=function(t,r){var n;(null===(n=r.data)||void 0===n?void 0:n.length)&&t&&!t.service.getSelection().isSelectionAtCodeblock()&&e.fieldConfigService.getAllListByInteractiveConfigKey("onInput").map((function(t){return t(r.data)}))},this.handleMouseEvent=function(t,r){var n;if(r.mouseAction===s.MouseAction.CLICK&&e.clickHitPoint){var o=null===(n=t.createRangeFinder())||void 0===n?void 0:n.findHitViewPoint(t.getDocumentBox(),{x:0,y:0},e.clickHitPoint,!1,!1,!0),i=null==o?void 0:o.leafBox;i&&e.handleClick(t,r.event,i,e.clickHitPoint),e.clickHitPoint=null}},this.getHookConfig=function(t){var r=t.fieldCode,n=r.name,o=r.switches,i=null==o?void 0:o[s.FieldCommonSwitchesName.subtype];return e.fieldConfigService.getFieldHookConfig(n,i)},this.handlePageMouseEvent=function(t,r){var n=r.hitPoint,o=r.event.type;n&&("mousemove"!==o?"mouseup"!==o||(e.clickHitPoint=n):e.handleThrottleMouseMove(t,n))},this.handleThrottleMouseMove=(0,P.throttle)((function(t,r){var n,o,i,a,p=null===(n=t.createRangeFinder())||void 0===n?void 0:n.findHitViewPoint(t.getDocumentBox(),{x:0,y:0},r,!1,!1,!0),c=null==p?void 0:p.gcp,u=null==p?void 0:p.leafBox,g=e.editorMouseEnterMap.get(t.uuid),h=void 0===c?void 0:new s.GCPRange(c,0),d=h&&e.fieldSearchService.getFieldByRange(t,h)[0],y=t.getViewRangeFromGcpRange(null!==(o=null==d?void 0:d.fieldRange)&&void 0!==o?o:s.GCPRange.invalidRange()),f=d&&(0,C.V)(t,r,y);if(e.handleMouseEnterFieldInfo(t,g,f,d),f&&d&&e.hasRestrictEditPermission(t,d.fieldRange)){var v=e.getHookConfig(d);(0,l.k)(v.isHighlightOnHover,!1,d)&&(null===(i=v.onHighlight)||void 0===i||i.call(v,t,d)),u&&(null===(a=v.onMouseEnter)||void 0===a||a.call(v,{editor:t,layoutBox:e.getLocationBox(u,d),fieldInfo:d})),e.editorMouseEnterMap.set(t.uuid,d)}}),100),this.handleTouchEvent=function(t,r){var n,o;if(r.touchAction===s.TouchAction.TOUCH){var i=null===(o=null!==(n=r.viewRange)&&void 0!==n?n:t.viewSelection.getViewRange())||void 0===o?void 0:o.start.leafBox;e.handleClick(t,r.event,i,r.hitPoint)}},this.handleClick=function(t,r,n,i){var a,l,p,c,u,g,h=e.fieldSearchService.getFieldByBox(n,t),d=[s.FieldDisplayLayoutTypeChar.Inline,s.FieldDisplayLayoutTypeChar.Text].includes(null!==(l=null===(a=null==h?void 0:h.fieldCode.switches)||void 0===a?void 0:a[s.FieldCommonSwitchesName.displayLayoutType])&&void 0!==l?l:"");if(h&&d&&e.hasRestrictEditPermission(t,h.fieldRange)){var y=t.getViewRangeFromGcpRange(h.fieldRange);if(!i||(0,C.V)(t,i,y)){var f=n,v=!0;do{var m=h.fieldCode,P=m.name,T=m.switches,S=null==T?void 0:T[s.FieldCommonSwitchesName.subtype],b={editor:t,layoutBox:e.getLocationBox(f,h),name:P,subtype:S,fieldInfo:h},R=(0,o.__assign)((0,o.__assign)({},b),{event:r});(v=!(null===(c=(p=e.fieldConfigService.getFieldHookConfig(P,S)).onClick)||void 0===c?void 0:c.call(p,R)))&&h.nestingLevel>1?f=(null==(h=(0,o.__read)(e.fieldSearchService.getFieldByRange(t,h.fieldRange,h.nestingLevel-1),1)[0])?void 0:h.fieldRange)&&(null===(g=null===(u=t.getViewRangeFromGcpRange(h.fieldRange))||void 0===u?void 0:u.start)||void 0===g?void 0:g.leafBox):h=null}while(v&&h&&f)}}},this.handleDeleteFieldContainer=function(t,r){var n;r.fieldCodes.length>0&&(e.fieldFloatToolbarService.hideFloatToolbar(t),null===(n=t.surface)||void 0===n||n.requestFocus())},this.handlePaste=function(t,r){var n,o,i=r.type,a=r.pasteData,l=(null!=a?a:{}).pasteDelta;i!==s.ClipboardNotificationType.ON_PASTE||!l||(null===(o=null===(n=r.pasteData)||void 0===n?void 0:n.pasteDeltaExtraInfo)||void 0===o?void 0:o.isFromInternal)||S.cm||e.fieldConfigService.getAllListByInteractiveConfigKey("onPaste").map((function(t){return t(l)}))},this.handleInteractive=function(t,r,n){var i,a,s=r.name,l=r.subtype,p=(0,o.__assign)((0,o.__assign)({},r),{event:n});["onMouseLeave"].includes(t)&&(p=r.editor),null===(a=(i=e.fieldConfigService.getFieldHookConfig(s,l))[t])||void 0===a||a.call(i,p)},this.fieldSearchService=new m.Z,this.fieldFloatToolbarService=new T.Z}return t.prototype.hasRestrictEditPermission=function(t,e){return!((null==t?void 0:t.state)&&!t.state.getRestrictEdit().checkPermissionRangeByGcpRange(e))},t.prototype.handleMouseEnterFieldInfo=function(t,e,r,n){var o,i;if(e&&(!r||n&&r&&!e.fieldRange.contains(n.fieldRange))){var a=this.getHookConfig(e);(0,l.k)(null==a?void 0:a.isHighlightOnHover,!1,e)&&(null===(o=null==a?void 0:a.onCancelHighlight)||void 0===o||o.call(a,t,e)),null===(i=null==a?void 0:a.onMouseLeave)||void 0===i||i.call(a,t),this.editorMouseEnterMap.delete(t.uuid)}},t.prototype.getLocationBox=function(t,e){return e.fieldCode.switches[s.FieldCommonSwitchesName.displayLayoutType]===s.FieldDisplayLayoutTypeChar.Inline?this.getOuterFieldBox(t):t},t.prototype.getOuterFieldBox=function(t){for(var e=t;e&&!(0,s.isFieldBox)(e);)e=e.parentBox;return e||t},t}();!function(t){t.BACKSPACE="backspace"}(n||(n={}));var R=r(285416);function _(t,e){var r=new m.Z;return function(n,i,a){var l=0,p=-1,c=[],u=[],g=void 0;n.forEachOp((function(r,i,h){var d,y,f,v,m;if(0!==l&&p<=i&&s.OperationUtil.moveOffset(r,l),c.length>0)return u.push(i),r.param.text===s.PlaceholderChar.FieldBegin&&c.push(i),void(r.param.text===s.PlaceholderChar.FieldEnd&&(c.pop(),c.length||u.push(i+1,i+2)));var P=function(t,e){var r=t[e],n=s.OperationUtil.getNextOperationByCondition(t,e,(function(t){return t instanceof s.InsertOperation})).index;return-1!==n&&t[n].param.text===s.PlaceholderChar.FieldSeparate&&r instanceof s.InsertOperation?n:null}(h,i);if(null!==P){var T=r.param.text,S=(new R.Z).decodeFieldCode(T);if(S){var C=S.name,b=S.switches,_=null==b?void 0:b[s.FieldCommonSwitchesName.subtype],w=null!==(y=null===(d=(g=t.getFieldHookConfig(C,_)).onPasteDeltaFilter)||void 0===d?void 0:d.call(g,S,a))&&void 0!==y?y:function(t,e,r){var n,i,a=!1,s=null!==(i=null===(n=r.targetRange)||void 0===n?void 0:n.begin())&&void 0!==i?i:t.selection.gcpRange.begin(),l=(0,o.__read)(t.service.getDocument().getRange(s,s,{fixRange:!1}).getFieldRanges(),1)[0];return l&&l.fieldRange.begin()!==s&&(a=!0),{isFilter:a}}(e,0,a),x=w.isFilter,I=w.toastContent;if(x){for(var D=i;D>-1&&(u.push(D),h[D].param.text!==s.PlaceholderChar.FieldBegin);)D-=1;return c.push(D),void((null==I?void 0:I.length)&&!(null===(f=a.toastContent)||void 0===f?void 0:f.includes(I))&&(a.toastContent=(null!==(v=a.toastContent)&&void 0!==v?v:[]).concat(I)))}var F=(null!==(m=g.onPasteDelta)&&void 0!==m?m:{}).fieldCode;if(F){var E=s.OperationUtil.getOffset(r);r=F(S,r,n);var M=s.OperationUtil.getOffset(r)-E;if(0!==M){p=P;for(var L=i+1;L<p;L++){var A=h[L];if(A.param.range){var B=A.param.range.clone();B.len+=M,B.gcpBegin+=l,A.param.range=B}}l+=M}}}}})),u.length&&n.opFilter((function(t,e){return!u.includes(e)}));var h=e.selection.gcpRange,d=r.getFieldByPoint(e,h.begin());if(d&&d.fieldResult.range.contains(h.begin()))for(var y=d.nestingLevel,f=[],v=0,m=n.operations;m[v];){var P=n.operations[v];if(P.param.text!==s.PlaceholderChar.FieldEnd)P.param.text===s.PlaceholderChar.FieldBegin?f.push(v):P instanceof s.ModifyFieldOperation&&(P.param.property.nestingLevel=y+f.length),v+=1;else{for(v+=1;m[v];){if((P=m[v])instanceof s.ModifyFieldOperation){P.param.property.nestingLevel=y+f.length;break}v+=1}f.pop(),v+=1}}return n.correctCurrentRange(),{delta:n,extraInfo:a}}}function w(t,e){return function(r,n,o,i,a,l){return t.getAllListByInteractiveConfigKey("pasteNodeProcessor").reduce((function(t,r){return r.map((function(r){var n=r.priority,o=void 0===n?s.PasteNodeProcessorPriority.normal:n,i=r.processor;o===e&&t.push(i)})),t}),[]).some((function(t){return t(r,n,o,i,a,l)}))}}var x=r(786945);function I(t){return function(e,r){var n,o=(0,s.makeEmptyCopyData)();if(!e.fieldInfo)return o;var i=e.fieldInfo,a=i.fieldCode,l=i.fieldResult,p=i.fieldRange;if(!a)return o;var c=a.name,u=a.switches,g=null==u?void 0:u[s.FieldCommonSwitchesName.subtype],h=t.getFieldHookConfig(c,g).onCopyParser;if(!h){var d=x.Cy.getInstance().getRegisteredParser(c);if(d)return d(e,r);var y=null===(n=e.getResultNode)||void 0===n?void 0:n.call(e,{});if(y){var f="".concat((0,P.escapeHTML)(y.getTextContent()));return{html:f,plain:f,refText:f}}return o}return h({fieldCode:a,fieldResult:l,fieldRange:p,isBegin:!!e.isBegin,childNode:e.getBeginChild(),emptyResult:o},r)}}var D="field-container---JmR6",F=function(){function t(t,e,r,n){this.fieldRenderService=t,this.getFieldByBox=e,this.editor=r,this.bridge=n}return t.prototype.getOverlayStyle=function(t){var e,r=null===(e=t.parentBox)||void 0===e?void 0:e.parentBox;(0,s.isLineBox)(r)&&(r=r.parentBox);var n={};return r&&r.firstChild instanceof s.ListLineBox&&r.firstChild.listMark&&r.property.numPr.numId.val&&r.property.taskPr.taskState===s.STTaskState.done&&(n={opacity:.3,textDecoration:"line-through",textDecorationColor:"black"}),n},t.prototype.draw=function(t,e){var r,n,o;if((0,s.isFieldBox)(e)&&!e.hidden){var i=this.getOverlayStyle(e),a=s.FieldUtil.getComplexFieldSubType(null===(r=e.fieldInfo)||void 0===r?void 0:r.fieldCode.switches)||e.subType,l=this.getFieldByBox(e,this.editor);if(l){var p=null!==(o=null===(n=this.fieldRenderService.getDecoratorAndBridge(this.editor,a))||void 0===n?void 0:n.bridgeKey)&&void 0!==o?o:y.getInstance().getRegisteredBridgeKey(a),c=p&&this.bridge?{instance:this.bridge,bridgeKey:p}:void 0,u=this.fieldRenderService.getDrawCallback(a);null==u||u({editor:this.editor,ctx:t,box:e,cssStyle:i,fieldInfo:l,bridge:c})}}},t}();function E(t){var e=t.layoutBox,r=t.editor,n=t.name,o=t.subtype,s=t.fieldInfo,p=t.containerRender,u=t.handleInteractive,g=(0,i.useMemo)((function(){var e,r=(0,l.k)(p.className,[],t);return"".concat(D," ").concat(null!==(e=null==r?void 0:r.reduce((function(t,e){return"".concat(t," ").concat(e)}),""))&&void 0!==e?e:"")}),[p.className,t]),h={editor:r,layoutBox:e,name:n,subtype:o,fieldInfo:s},d=(0,i.createRef)();(0,i.useEffect)((function(){return d.current&&(e.__node__&&(e.__node__.__vm__=null),d.current.__vm__&&(d.current.__vm__.__node__=null),d.current.__vm__=e,d.current.__type__=e.constructor.name,e.__node__=d.current),function(){e.__node__=null}}));var y=(0,i.useMemo)((function(){var t=(0,c.Xn)(e),r=t.width,n=t.height;return{width:r?"".concat(r,"px"):"",height:n?"".concat(n,"px"):""}}),[e]),f="addonIframe"===o;return a().createElement("div",{ref:d,style:f?{}:y,className:f?"":g,onTouchStart:function(t){return u("onTouchStart",h,t)},onTouchMove:function(t){return u("onTouchMove",h,t)},onTouchEnd:function(t){return u("onTouchEnd",h,t)},onMouseEnter:function(t){return u("onMouseEnter",h,t)},onMouseLeave:function(t){return u("onMouseLeave",h,t)},onClick:function(t){return u("onClick",h,t)},onWheel:function(t){return u("onWheel",h,t)},onFocus:function(t){return u("onFocus",h,t)},onBlur:function(t){return u("onBlur",h,t)}},t.children)}var M=function(){function t(t,e,r){this.fieldRenderService=t,this.editor=e,this.handleInteractive=r}return t.prototype.draw=function(t,e){if((0,s.isFieldContainerBox)(e)){var r={layoutBox:e,editor:this.editor,context:this.editor,containerFocus:t.containerFocus},n=this.fieldRenderService.getFieldContainerInfo(r);if(n){var i=n.key,l=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},n),r),{handleInteractive:this.handleInteractive}),p=(0,s.makeFrame)(0,0,e.totalWidth,e.totalHeight),u=(0,c.Vo)(t,e),g=s.PoolNodeFactory.obtain(s.IComponentView,i,p,a().createElement(E,(0,o.__assign)({},l)),u);t.addView(g,s.RenderPriorityType.UpperDefault,{independentRender:e.independentRender})}}},t}(),L=function(){function t(){var t=this;this.containerRenderMap=new Map,this.textRenderMap=new Map,this.editorBridgeMap=new Map,this.editorMap=new Map,this.upsertRenderConfig=function(e){var r=e.name,n=e.subtype,o=e.render,i=null!=n?n:r;return o?"containerRenderConfig"in o?(t.upsertTextRenderConfig(i,o.textRenderConfig),void t.upsertContainerRenderConfig(o.containerRenderConfig,r,n)):void("children"in o?t.upsertContainerRenderConfig(o,r,n):t.upsertTextRenderConfig(i,o)):(t.textRenderMap.delete(i),void t.containerRenderMap.delete(t.encodeKey(r,n)))},this.removeEditor=function(e){t.editorMap.delete(e.uuid)},this.fieldConfigService=v.P.getInstance(),this.fieldInteractiveService=new b(this.fieldConfigService),this.fieldConfigService.addUpsertConfigCallback("fieldRenderService",this.upsertRenderConfig),this.fieldSearchService=new m.Z}return t.prototype.upsertTextRenderConfig=function(t,e){this.textRenderMap.delete(t),this.textRenderMap.set(t,e)},t.prototype.encodeKey=function(t,e){return e?"".concat(t,"-").concat(e):t},t.prototype.upsertContainerRenderConfig=function(t,e,r){var n=this.encodeKey(e,r);this.containerRenderMap.delete(n),this.containerRenderMap.set(n,t)},t.prototype.initializeField=function(t,e){var r,o=this;void 0===e&&(e=!1);var i=t.uuid,a=(null!==(r=this.editorMap.get(i))&&void 0!==r?r:{}).callback;if(a)return a;var p=e?this.registerBridge(t):void 0,u=this.initializeFieldReact(t,p,!0),g=this.initializeFieldCanvas(t,p,!0),h=this.initializeFieldContainer(t,!0),d=function(t,e){var r;return(r={})[n.BACKSPACE]=function(r,n){var o=r.onSelection().range();if(!o.len){var i=(0,c.s0)(r,o.begin()),a=t.getFieldByPoint(r,i);if(a&&a.fieldRange.end()-1===i){var p=a.fieldCode,u=p.name,g=p.switches,h=null==g?void 0:g[s.FieldCommonSwitchesName.subtype],d=e.getFieldHookConfig(u,h);if((0,l.k)(null==d?void 0:d.isHighlightOnBackspace,!1,a))return void r.fire(new s.FieldCodeNotification(s.FieldCodeNotificationType.Delete,a,(function(){var t;return null===(t=d.onHighlight)||void 0===t?void 0:t.call(d,r,a)})))}}n()},r}(this.fieldSearchService,this.fieldConfigService);setTimeout((function(){t.registerPlugin(d),t.clipboardManager.addCopyModelParser(s.LayoutInputNodeType.FieldCode,I(o.fieldConfigService)),t.clipboardManager.addCopyModelParser(s.LayoutInputNodeType.FieldContainer,I(o.fieldConfigService)),t.clipboardManager.addPasteDeltaProcessor(_(o.fieldConfigService,t)),t.clipboardManager.addPasteNodeProcessor(w(o.fieldConfigService,s.PasteNodeProcessorPriority.normal)),t.clipboardManager.addPasteNodeProcessor(w(o.fieldConfigService,s.PasteNodeProcessorPriority.high),s.PasteNodeProcessorPriority.high)}),400),this.fieldInteractiveService.initEventListener(t);var y=function(){o.removeEditor.bind(t),u(),g(),h(),t.unRegisterPlugin(d),o.fieldInteractiveService.removeEventListener(t)};return this.editorMap.set(i,{editor:t,callback:y}),y},t.prototype.initializeFieldReact=function(t,e,r){var n,o=this;void 0===r&&(r=!1);var i=t.uuid,a=(null!==(n=this.editorMap.get(i))&&void 0!==n?n:{}).callback;if(!r&&a)return a;var l=this.getFieldDecorator(t,e);t.addDecorator(s.DecoratorTypes.LineFragment,l),t.addContentDecorator(s.BoxKind.FieldCodeLite,s.Region.Content,(0,c._r)(l)),t.addStyleDecorator(s.BoxKind.FieldCodeLite,(0,c.YQ)(l));var p=function(){return o.removeEditor.bind(t)};return this.editorMap.set(i,{editor:t,callback:p}),p},t.prototype.initializeFieldCanvas=function(t,e,r){var n,o=this;void 0===r&&(r=!1);var i=t.uuid,a=(null!==(n=this.editorMap.get(i))&&void 0!==n?n:{}).callback;if(!r&&a)return a;t.modelWrapperMgr.add(s.LayoutInputNodeType.FieldCode,(function(e){return o.getFieldModelWrapper(t,e)})),t.addExtendRenderer(s.ExtendRendererTypes.TextLineFragment,new F(this,this.fieldSearchService.getFieldByBox.bind(this.fieldSearchService),t,e));var l=function(){o.removeEditor.bind(t),t.modelWrapperMgr.remove(s.LayoutInputNodeType.FieldCode)};return this.editorMap.set(i,{editor:t,callback:l}),l},t.prototype.initializeFieldContainer=function(t,e){var r,n,o=this;void 0===e&&(e=!1);var i=t.uuid,a=(null!==(r=this.editorMap.get(i))&&void 0!==r?r:{}).callback;if(!e&&a)return a;(null===(n=t.docEnv)||void 0===n?void 0:n.renderType)===s.RenderType.Canvas?t.addExtendRenderer(s.ExtendRendererTypes.LeafContainer,new M(this,t,this.fieldInteractiveService.handleInteractive.bind(this.fieldInteractiveService))):null==t||t.addContainerRender(s.FieldType,(function(e,r,n){return o.getContainerRender(e,r,n,t)}));var l=function(){return o.removeEditor.bind(t)};return this.editorMap.set(i,{editor:t,callback:l}),l},t.prototype.getFieldContainerInfo=function(t){var e=t.layoutBox,r=t.containerFocus,n=t.editor,o=t.context,i=this.fieldSearchService.getFieldByBox(e,n);if(!i)return null;var a=i.fieldCode,l=a.name,p=a.switches,u=null==p?void 0:p[s.FieldCommonSwitchesName.subtype],g=this.encodeKey(l,u),h=this.containerRenderMap.get(g);if(!h)return null;var d=(0,c.Ie)(n,e,i),y=h.children({layoutBox:e,containerFocus:r,editor:n,context:o,fieldInfo:i,key:d});if(!y)return null;var f="element"in y?y.element:y,v="element"in y?y.elementKey:d;return{children:f,key:"".concat(g,"-").concat(v),fieldInfo:i,name:l,subtype:u,containerRender:h}},t.prototype.getContainerRender=function(t,e,r,n){var i={layoutBox:t,editor:n,context:r,containerFocus:e},s=this.getFieldContainerInfo(i);if(!s)return null;var l=s.key,p=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},s),i),{handleInteractive:this.fieldInteractiveService.handleInteractive});return a().createElement(E,(0,o.__assign)({},p,{key:l}))},t.prototype.getDrawCallback=function(t){var e;return null===(e=this.textRenderMap.get(t))||void 0===e?void 0:e.draw},t.prototype.getFieldModelWrapper=function(t,e){var r,n,o,i,a=e.fieldCode,l=e.layoutType,p=a.name,c=a.switches,g=null!==(r=null==c?void 0:c[s.FieldCommonSwitchesName.subtype])&&void 0!==r?r:p,h=p===s.FieldName.HYPERLINK&&l===s.FieldLayoutType.Text?u.m7.NormalLink:g,d=null!==(i=null===(o=null===(n=this.textRenderMap.get(h))||void 0===n?void 0:n.modelWrapper)||void 0===o?void 0:o.call(n,t))&&void 0!==i?i:f.Q.getInstance().get(h);return d?d(e):{}},t.prototype.getFieldDecorator=function(t,e){var r=this;return function(n,o){var i,l=r.fieldSearchService.getFieldByBox(o,t);if(l){var p=l.fieldCode,c=p.name,u=p.switches,g=(null==u?void 0:u[s.FieldCommonSwitchesName.subtype])||c,h=y.getInstance(),f=null!==(i=r.getDecoratorAndBridge(t,g))&&void 0!==i?i:{decorator:h.getRegisteredDecorator(g),bridgeKey:h.getRegisteredBridgeKey(g)},v=f.decorator,m=f.bridgeKey;if(v)return v({children:n,box:o,fieldInfo:l,bridge:m&&e?{instance:e,bridgeKey:m}:void 0})}return{component:a().createElement(d.x,{editor:t,layoutBox:o,fieldInfo:l,key:"field-trigger-".concat(o.uuid)},n),overrideStyle:{}}}},t.prototype.registerBridge=function(t){var e,r=new h.k;return t.registerPlugin(((e={})[g.W0]=function(t,e,n,o){r.addClient(n,o)},e)),this.editorBridgeMap.set(t.uuid,r),r},t.prototype.getEditorBridge=function(t){return this.editorBridgeMap.get(t)},t.prototype.getDecoratorAndBridge=function(t,e){var r,n=null===(r=this.textRenderMap.get(e))||void 0===r?void 0:r.decorator;if(n)return{decorator:n.decoratorCallback(t),bridgeKey:n.bridgeKey}},t=(0,o.__decorate)([(0,p.t)(),(0,o.__metadata)("design:paramtypes",[])],t)}()},788765:function(t,e,r){r.d(e,{Q:function(){return _}});var n,o=r(839461),i=r(826973),a=r(750670),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.getOriginalRectSize=function(){return{measure:0,extent:this.node.isHidden?0:this.node.getProperty().embedCommentHeight}},e}(a.RectBoundBoxEnv),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),Object.defineProperty(e.prototype,"property",{get:function(){return this.modelProperty},set:function(t){this.modelProperty=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){var t,e;return null!==(e=null===(t=this.property)||void 0===t?void 0:t.id)&&void 0!==e?e:this.uuid},enumerable:!1,configurable:!0}),e}(a.LeafContainerBox),p=r(565384),c=function(t,e,r,n,o){if((0,a.isCommentRefChar)(o.charCodeAt(0))){var i=t.dataStream.getStoryStream().getStoryInfoFromGcp(r.begin());if((null==i?void 0:i.storyProp.storyType)!==a.STStoryType.textboxContent){var s=t.dataStream.getAnnotationStream().createCommentIterator(r);if(s.getRange().contains(r.begin())&&s.getProperty())return new p.s(t,r,a.LayoutInputNodeType.LeafContainer,void 0,n)}}return null},u={uniqueTypeId:p.f,nodeCreator:c,BoxEnv:s,Box:l},g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.getSvg=function(){return this.node.getSvg()},e.prototype.getOriginalRectSize=function(){return this.node.getSvgRectSize()},e}(a.RectBoundBoxEnv),h=function(t){function e(e){var r=t.call(this,e)||this;return r.enableSelectionOverlay=!0,r.svg=e.getSvg(),r}return(0,o.__extends)(e,t),e}(a.LeafContainerBox),d=r(259356),y=r(45972),f=r(218581),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),Object.defineProperty(e.prototype,"isFixedRatio",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniqueTypeId",{get:function(){return a.MATH_UNIQUE_TYPE_ID},enumerable:!1,configurable:!0}),e.prototype.getProperty=function(){return this.nodeProperty||(this.nodeProperty=this.context.dataStream.getMathStream().createMathIterator({limitRange:this.range,nestingLevel:1}).getProperty()),this.nodeProperty},e.prototype.getSvg=function(){return(0,a.generateLoadingSvg)({width:20.765*105,height:5.291*105,loadingText:"".concat((0,f.$t)("math:loading-formula"),"..."),loadingTextFontSize:"215px",borderWidth:0,withEncodeAndDataPrefix:!1})},e.prototype.getSvgRectSize=function(){return{measure:20.765*105,extent:5.291*105}},e}(a.LeafContainerNode),m=function(){function t(){this.asyncLayoutModuleLoader=void 0,this.asyncLayoutModule=void 0}var e;return t.prototype.getMathNode=function(t){var e=t.context,r=t.range,n=t.nodeType,o=t.parent,i=t.offsets;return new(this.getMathCtor())(e,r,n,o,i)},t.prototype.getMathCtor=function(){var t,e;return(null===(t=this.asyncLayoutModule)||void 0===t?void 0:t.MathNode)?null===(e=this.asyncLayoutModule)||void 0===e?void 0:e.MathNode:(this.loadAsyncLayoutModule(),v)},t.prototype.loadAsyncLayoutModule=function(){return(0,o.__awaiter)(this,void 0,Promise,(function(){var t=this;return(0,o.__generator)(this,(function(e){return void 0===this.asyncLayoutModuleLoader&&(this.asyncLayoutModuleLoader=new Promise((function(e){t.firstLoadAsyncLayoutModule(e)}))),[2,this.asyncLayoutModuleLoader]}))}))},t.prototype.firstLoadAsyncLayoutModule=function(t){return(0,o.__awaiter)(this,void 0,Promise,(function(){var e,n;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,r.e(2155).then(r.bind(r,852155))];case 1:return e=o.sent(),t(e),this.asyncLayoutModule=e,n=this.collectMathRanges(),this.triggerReflow(n),[2]}}))}))},t.prototype.collectMathRanges=function(){var t,e=this.contextService.context.editor;if(!(e instanceof a.MeloEditor))return[];var r=e.state.getDataStream(),n=null===(t=r.getStoryStream().getMainStoryInfo())||void 0===t?void 0:t.contentRange;return n?r.getMathStream().getMathRanges(n):[]},t.prototype.triggerReflow=function(t){var e=this.contextService.context.editor;if(e instanceof a.MeloEditor){var r=new a.ModelDirtyRange(t),n=new Map;n.set(a.StoryID.MainDocId,r),e.fire(new a.AsyncLayoutModuleFinishedNotification(n))}},(0,o.__decorate)([(0,d.tB)(),(0,o.__metadata)("design:type","function"==typeof(e=void 0!==y.O&&y.O)?e:Object)],t.prototype,"contextService",void 0),t}(),P=(n=void 0,function(){return n||(n=new m)}),T=function(t,e,r,n,o,i){var s,l=o.charCodeAt(0);if((0,a.isMathChar)(l)){for(var p=e;null!==p&&!(p instanceof a.ParagraphNode);)p=null!==(s=null==p?void 0:p.parent)&&void 0!==s?s:null;if(null===p)return null;if(p.getProperty().isOMathPara)return i.seek(p.getGCPRange().end()-1),P().getMathNode({context:t,range:p.getGCPRange(),nodeType:a.LayoutInputNodeType.LeafContainer,parent:e,offsets:n});var c=t.dataStream.getMathStream().getMathInfo(r.begin(),1);if(c)return i.seek(c.range.end()-1),P().getMathNode({context:t,range:c.range,nodeType:a.LayoutInputNodeType.LeafContainer,parent:e,offsets:n})}return null},S={uniqueTypeId:a.MATH_UNIQUE_TYPE_ID,nodeCreator:T,BoxEnv:g,Box:h},C={uniqueTypeId:p.f,nodeCreator:c,propertyGetter:function(t){var e=t.getProperty(),r=new(a.PropertyFactory.getPropertyClass(a.PropertyType.DrawingProperty));return e?(r.inlineKeyword.extent.cy=e.embedCommentHeight,r.inlineKeyword.graphic.graphicData.wsp.txbx.id=e.id,r.anchorId=e.id,r.isCommentRef=!0,r):r}},b=r(495155),R={uniqueTypeId:a.MATH_UNIQUE_TYPE_ID,nodeCreator:T,enableSelectionOverlay:!0,propertyGetter:function(t){var e=new(a.PropertyFactory.getPropertyClass(a.PropertyType.DrawingProperty)),r=t.getSvg(),n=t.getSvgRectSize();return e.drawing.extent.cx=(0,b.twipsToEmu)(n.measure),e.drawing.extent.cy=(0,b.twipsToEmu)(n.extent),e.drawing.graphic.graphicData.pic.blipFill.blip.embed="data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent(r)),e}},_=function(){function t(){}return t.prototype.applyExtension=function(t){t.isRenderLiteType()?(t.addLayoutExtension(a.ExtensionNodeType.LeafContainer,C),t.addLayoutExtension(a.ExtensionNodeType.LeafContainer,R)):(t.addLayoutExtension(a.ExtensionNodeType.LeafContainer,u),t.addLayoutExtension(a.ExtensionNodeType.LeafContainer,S))},t=(0,o.__decorate)([(0,i.t)()],t)}()},652576:function(t,e,r){r.d(e,{IV:function(){return n},Qw:function(){return i},iq:function(){return o}});var n=function(){var t,e,r,n;return!(null===(e=null===(t=window.clientVars)||void 0===t?void 0:t.userInfo)||void 0===e?void 0:e.corpId)&&!(null===(n=null===(r=null===window||void 0===window?void 0:window.basicClientVars)||void 0===r?void 0:r.userInfo)||void 0===n?void 0:n.corpId)},o=function(t,e){var r=!1,n=Date.now();return e.time&&n-e.time<=300&&t.target===e.target&&(r=!0),r};function i(){var t=document.createElement("input");t.setAttribute("type","text"),t.setAttribute("style","position: fixed; top: -100px; left: -100px;"),document.body.appendChild(t),t.focus(),setTimeout((function(){document.body.removeChild(t)}),3e4)}},951778:function(t,e,r){r.d(e,{cr:function(){return Re},Xs:function(){return ko},A8:function(){return os},Mr:function(){return ri},en:function(){return oi},Wc:function(){return Ue},bg:function(){return mr},PJ:function(){return vr},bs:function(){return ye},l_:function(){return Mr},go:function(){return Dt},iQ:function(){return Br},f$:function(){return Be},WZ:function(){return Mn},Ah:function(){return $},X8:function(){return ut},_J:function(){return V},Uy:function(){return Wt},Hm:function(){return We},Rh:function(){return tt},Gb:function(){return Ae},vQ:function(){return ve},d5:function(){return fe},e$:function(){return me},x2:function(){return ke},KU:function(){return pt},r$:function(){return Ge},uY:function(){return Ne},dh:function(){return vt},yH:function(){return dt},cL:function(){return Vt},pp:function(){return Kt},xR:function(){return Yt},Bf:function(){return ct},g9:function(){return Zt},k8:function(){return qt},NH:function(){return Se},Gv:function(){return Ce},NM:function(){return Oe}});var n=r(656459),o=r(470828),i=r(839461),a=r(732762),s=r.n(a),l=r(450046),p=r(48739),c=r(573595),u=r(60538),g=r(305945),h=r(723841),d=[p.PlaceholderChar.StoryBreak,p.PlaceholderChar.SubStoryBegin,p.PlaceholderChar.SubStoryEnd,p.PlaceholderChar.TableStart,p.PlaceholderChar.TableEnd,p.PlaceholderChar.TableRowBreak,p.PlaceholderChar.TableCellBreak,p.PlaceholderChar.PageBreak],y=new RegExp(d.join("|"),"g"),f=function(){function t(){}return t.getNodeType=function(t){if(t instanceof HTMLElement){if(this.isSingleTable(t))return c.Zr3.Table;if(t.querySelector("table"))return c.Zr3.Mix}return c.Zr3.Text},t.isSingleTable=function(t){for(var e=t;e;){if(null!==e.nextSibling)return!1;if(e instanceof HTMLTableElement)return!0;e=e.childNodes[0]}return!1},t.pastePlainText=function(t,e,r,n){if(0!==r.length){var o=null!=n?n:e.delta();o.setCommandType(p.Type.DocPaste),e.deleteText(e.selection.validDeleteRange(),o);var i=r.replace(y,"");if(0!==i.length){for(var a=this.splitParaText(i),s=0;s<a.length-1;s++)h.Gh.insertText(o.currentRange().begin(),a[s],new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),o),h.Gh.insertParagraph(o.currentRange().begin(),p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),o);a[a.length-1]&&h.Gh.insertText(o.currentRange().begin(),a[a.length-1],new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),o),e.applyDelta(o)}}},t.getPasteTargetStyle=function(t,e){var r,n=null!=e?e:t.getSelection().range(),o=t.getSelection().getParaRange(n.gcpBegin);return r=o&&o.gcpBegin!==n.gcpBegin?new p.GCPRange(n.gcpBegin-1,0):new p.GCPRange(n.gcpBegin,0),{paraStyle:(0,i.__read)(t.getDocument().getParaStyleAtRange(r),1)[0],spanStyle:(0,i.__read)(t.getDocument().getTextStyleAtRange(r),1)[0]}},t.addExtraAttribute=function(t,e,r){var n=u.$w.getAttr(t,r);n&&e.set(r,n)},t.splitParaText=function(t){var e=new RegExp("".concat(p.PlaceholderChar.ParagraphReturn,"|").concat(p.PlaceholderChar.SectionBreak,"|").concat(p.PlaceholderChar.ParagraphBreak),"g");return t.split(e).map((function(t){return(0,p.getPrintableText)(t)}))},t}(),v=function(t,e){var r,n;try{for(var o=(0,i.__values)(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(t.has(s)&&t.get(s)){var l=t.get(s);t.set("font-family",l);break}}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return t},m=["font-size","mso-bidi-font-size","letter-spacing","mso-fareast-font-family","mso-bidi-font-family","mso-hansi-font-family","mso-ascii-font-family","mso-font-width","font-family","color","bold","italic","underline","strikethrough","link","background","mso-highlight","background-color","font-style","font-weight","text-decoration","text-decoration-line"],P=function(t,e){t&&(-1!==t.indexOf("underline")&&(e.u.val=p.STUnderline.single),-1!==t.indexOf("line-through")&&(e.strike.val=!0))},T=["font-family","mso-fareast-font-family","mso-bidi-font-family","mso-hansi-font-family","mso-ascii-font-family"],S=function(t,e){return!(!t.has(e)||!t.get(e))},C=function(t,e){if(S(e,"font-size")){var r=e.get("font-size");/rem$/.test(r)?t.sz.val=p.Defaults.fontSize:t.sz.val=Math.round((0,o.pL)((0,o.eZ)(r)))||20}S(e,"color")&&(t.color.val=e.get("color")),function(t,e){var r=e.get("data-font-family");r&&"default"!==r&&(t.fontFamily=e.get("data-font-family")),!r&&S(e,"font-family")&&(t.fontFamily=e.get("font-family"))}(t,e),t.i.val=S(e,"italic")&&"true"===e.get("italic"),t.u.val=S(e,"underline")&&"true"===e.get("underline")?p.STUnderline.single:p.STUnderline.none,t.strike.val=!1},b=function(t,e){e.vertAlign.val="sub"!==t?"super"!==t?p.STVerticalAlignRun.baseline:p.STVerticalAlignRun.superscript:p.STVerticalAlignRun.subscript};function R(t){t=v(t,T);var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));return C(e,t),t.forEach((function(t,r){if(r&&t)switch(o.m7.trim(r)){case"color":e.color.val=p.PropertyColorUtil.parseSTHexColor(t);break;case"letter-spacing":e.spacing.val=(0,o.pL)((0,o.op)(t,0));break;case"mso-font-width":e.w.val=Number(t.replace("%",""));break;case"bold":"true"===t&&(e.b.val=!0);break;case"font-weight":("bold"===t||"bolder"===t||parseInt(t)>=550)&&(e.b.val=!0);break;case"strikethrough":e.strike.val="true"===t;break;case"text-decoration":case"text-decoration-line":P(t,e);break;case"background":case"mso-highlight":case"background-color":e.shd.val=p.STShd.clear,e.shd.color="auto",e.shd.fill=p.PropertyColorUtil.parseSTHexColor(t);break;case"font-style":e.i.val=!0===e.i.val?e.i.val:"italic"===t;break;case"superscript":e.vertAlign.val="true"===t?p.STVerticalAlignRun.superscript:p.STVerticalAlignRun.baseline;break;case"subscript":e.vertAlign.val="true"===t?p.STVerticalAlignRun.subscript:p.STVerticalAlignRun.baseline;break;case"vertical-align":b(t,e)}})),e}var _=function(t,e,r,n,i){if(!u.$w.isTextNode(t))return!1;if(!function(t,e){return!(t.parentNode&&"p"!==t.parentNode.nodeName.toLowerCase()&&"span"!==t.parentNode.nodeName.toLowerCase()&&e.isPasteFromMsoTable&&"  "===t.textContent||t.parentNode&&"body"===t.parentNode.nodeName.toLowerCase()&&o.wV.isChrome()&&t instanceof Text&&t.previousElementSibling&&"MsoListParagraph"===u.$w.getProp(t.previousElementSibling,"className"))}(t,i))return!1;var a=u.$w.getValue(t);if(a){var s=R(e);i.isInTable&&(a=a.replace(new RegExp("".concat(p.PlaceholderChar.PageBreak),"g"),""));for(var l=f.splitParaText(a),c=0;c<l.length-1;c++)h.Gh.insertText(r.currentRange().end(),l[c],s,r),h.Gh.insertParagraph(r.currentRange().end(),p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),r);l[l.length-1]&&h.Gh.insertText(r.currentRange().end(),l[l.length-1],s,r)}return!0},w="mso-endnote-id",x="mso-footnote-id",I="MsoEndnoteText",D="MsoFootnoteText";function F(t){var e=u.$w.getTagName(t).toLowerCase(),r=u.$w.getStyleMap(t);return Boolean("a"===e&&(r.get(w)||r.get(x)))}function E(t,e){if("p"!==u.$w.getTagName(t).toLowerCase())return!1;var r=Array.from(t.classList);return e===c.wK_.ENDNOTE&&r.includes(I)||e===c.wK_.FOOTNOTE&&r.includes(D)}function M(t,e,r,n,o){var i,a=function(t){for(var e=t.parentElement;e&&!F(e);)e=e.parentElement;if(!e)return null;var r=u.$w.getStyleMap(e);return r.get(w)||r.get(x)?r.get(w)?{msoNoteId:r.get(w),type:c.wK_.ENDNOTE}:{msoNoteId:r.get(x),type:c.wK_.FOOTNOTE}:null}(t);if(a){var s=a.msoNoteId,l=a.type,g=null===(i=o.noteIdMap.get(s))||void 0===i?void 0:i.refId;if(g){var d=n.getNote().getBuiltInStyleProp(r,l),y=R(e);if(d&&(y.rStyle.val=d.styleId),function(t,e){for(var r=t.parentElement;r&&!E(r,e);)r=r.parentElement;return!!r}(t,l))return y.placeholderType=l===c.wK_.ENDNOTE?p.STRunPlaceholderType.endnoteRef:p.STRunPlaceholderType.footnoteRef,void h.Gh.insertNoteRefInSubStory(r.currentRange().end(),r,l,y);h.Gh.insertNoteRef(r.currentRange().end(),g,r,l,y)}}}function L(t){return t.nodeType===Node.COMMENT_NODE&&("[if !supportEndnotes]"===t.data||"[if !supportFootnotes]"===t.data)}function A(t,e){for(var r=u.$w.getChildNodeNum(t),n=e+1;n<r;){var o=u.$w.getChildNode(t,n);if((null==o?void 0:o.nodeType)===Node.COMMENT_NODE&&"[endif]"===o.data)return n+1;n+=1}return-1}var B=function(){function t(){}return t.getRoot=function(t){for(var e=t;null==e?void 0:e.parentNode;)e=e.parentNode;return e},t.parseStyleContext=function(t){if(!this._styleContext){var e=this.getRoot(t);e&&e.head&&(this._styleContext=e.head.innerHTML)}return this._styleContext},t.parseInternalStyle=function(t,e){var r,n=new Map,o=this.parseStyleContext(t);try{var i,a=new RegExp(e.reg,"g");(i=a.exec(o))&&((null===(r=i[e.hasClassName?1:2])||void 0===r?void 0:r.split(/;\s*/))||[]).forEach((function(t){var e=t.split(":");e[0]&&e[1]&&n.set(e[0].trim(),e[1].trim())}))}catch(t){return n}return n},t.generateRegString=function(t,e){void 0===t&&(t=""),void 0===e&&(e="");var r=t.toLowerCase();return{reg:e?"".concat(r,"\\.").concat(e,"[^{]*{([^}]+)}"):"".concat(r,"(\\s*)(?!\\.){([^}]+)}"),hasClassName:Boolean(e)}},t.getInternalStyle=function(t,e,r){if(void 0===e&&(e=u.$w.getTagName(t).toLowerCase()),void 0===r&&(r=u.$w.getProp(t,"className")||""),this._cacheInternalStyle&&this._cacheInternalStyle.has("".concat(e).concat(r))&&this._cacheInternalStyle.get("".concat(e).concat(r)))return this._cacheInternalStyle.get("".concat(e).concat(r));var n=this.parseInternalStyle(t,this.generateRegString(e,r));return n?(this._cacheInternalStyle.set("".concat(e).concat(r),n),n):new Map},t.inlineStyleReset=function(){this._styleContext="",this._cacheInternalStyle=new Map},t._styleContext="",t._cacheInternalStyle=new Map,t}(),N=function(){function t(){}return t.generateInitStyle=function(e){var r=this;if(u.$w.isElementNode(e)){var n=window.getComputedStyle(e),o=new Map;return t.initStyle.forEach((function(t){var e=n[t];e&&o.set(r.toLine(t),e)})),o}return new Map},t.getSelfStyle=function(e){var r=t.splitCombineStyle(B.getInternalStyle(e)),n=t.splitCombineStyle(u.$w.getStyleMap(e));return new Map((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(r),!1),(0,i.__read)(n),!1))},t.splitCombineStyle=function(e){var r=new Map(e);return this.combineStyle.forEach((function(n){if(e.has(n)&&e.get(n)){var o=e.get(n);r.delete(n);var i=t.splitCombineCssAttri(o);i&&"0px"!==o&&(r.set("".concat(n,"-top"),i.get("top")),r.set("".concat(n,"-right"),i.get("right")),r.set("".concat(n,"-bottom"),i.get("bottom")),r.set("".concat(n,"-left"),i.get("left")))}})),r},t.splitCombineCssAttri=function(t){var e,r,n;if(!t)return null;var o=t.split(" "),a=(0,i.__read)([0,0,0,0],4),s=a[0],l=a[1],p=a[2],c=a[3];switch(o.length){case 2:s=(e=(0,i.__read)([0,1,0,1],4))[0],l=e[1],p=e[2],c=e[3];break;case 3:s=(r=(0,i.__read)([0,1,2,1],4))[0],l=r[1],p=r[2],c=r[3];break;case 4:s=(n=(0,i.__read)([0,1,2,3],4))[0],l=n[1],p=n[2],c=n[3]}var u=new Map;return u.set("top",o[s]),u.set("right",o[l]),u.set("bottom",o[p]),u.set("left",o[c]),u},t.toLine=function(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()},t.combineStyle=["margin","padding","border"],t.initStyle=["lineHeight","color"],t.COVER=1,t.MERGE=2,t}(),O=["text-align","line-height","margin","margin-top","margin-bottom"];function k(t,e){!function(t,e){"exactly"===t.get("mso-line-height-rule")&&(e.spacing.lineRule=p.STLineSpacingRule.exact),e.spacing.lineRule||(e.spacing.lineRule=p.STLineSpacingRule.auto)}(t,e),function(t,e){var r=t.get("line-height"),n=Number(r);if(r){if(isNaN(n)||(e.spacing.line=n*p.DefaultsUnit.autoLineRule),r.includes("%")&&(e.spacing.line=Number(r.replace("%",""))/100*p.DefaultsUnit.autoLineRule),r.includes("pt")&&(e.spacing.line=(0,o.pL)(Number(r.replace("pt","")))),r.includes("px")){var i=p.Defaults.fontSizeStable,a=t.get("font-size");(null==a?void 0:a.includes("px"))?i=(0,o.Ej)(Number(a.replace("px","")))||p.Defaults.fontSizeStable:(null==a?void 0:a.includes("pt"))&&(i=(0,o.pL)(Number(a.replace("pt","")))||p.Defaults.fontSizeStable),e.spacing.line=(0,o.Ej)(Number(r.replace("px","")))/i*p.DefaultsUnit.autoLineRule}e.spacing.line||(e.spacing.line=p.DefaultsUnit.autoLineRule)}else e.spacing.line=p.DefaultsUnit.autoLineRule}(t,e)}function G(t,e){if(t.has("layout-grid-mode")&&"char"===t.get("layout-grid-mode")?e.snapToGrid.val=!1:e.snapToGrid.val=!0,t.has("mso-para-margin-left")&&t.get("mso-para-margin-left")&&t.get("mso-para-margin-left").indexOf("gd")>0){var r=Number(t.get("mso-para-margin-left").replace("gd",""));e.ind.leftChars=r*p.DefaultsUnit.indentChars}if(t.has("mso-para-margin-right")&&t.get("mso-para-margin-right")&&t.get("mso-para-margin-right").indexOf("gd")>0){var n=Number(t.get("mso-para-margin-right").replace("gd",""));e.ind.rightChars=n*p.DefaultsUnit.indentChars}if(t.has("margin-left")&&t.get("margin-left")){var i=(0,o.pL)((0,o.op)(t.get("margin-left"),0));e.ind.left=i}if(t.has("margin-right")&&t.get("margin-right")){var a=(0,o.pL)((0,o.op)(t.get("margin-right"),0));e.ind.right=a}!function(t,e){if(t.has("mso-char-indent-count")&&t.get("mso-char-indent-count")){var r=Number(t.get("mso-char-indent-count"));r>0?e.ind.firstLineChars=r*p.DefaultsUnit.indentChars:e.ind.hangingChars=r*p.DefaultsUnit.indentChars}if(t.has("text-indent")&&t.get("text-indent")){var n=(0,o.pL)((0,o.op)(t.get("text-indent"),0));n>0?e.ind.firstLine=Math.abs(n):e.ind.hanging=Math.abs(n)}}(t,e)}function H(t,e){var r=new Map([["solid",p.STBorder.thick],["dotted",p.STBorder.dotted],["dash-small-gap",p.STBorder.dashSmallGap],["dashed",p.STBorder.dashed],["dot-dash",p.STBorder.dotDash],["double",p.STBorder.double],["triple",p.STBorder.triple],["thin-thick-small-gap",p.STBorder.thinThickSmallGap],["thick-thin-small-gap",p.STBorder.thickThinSmallGap],["thin-thick-thin-small-gap",p.STBorder.thinThickThinSmallGap],["thin-thick-medium-gap",p.STBorder.thinThickMediumGap],["thick-thin-medium-gap",p.STBorder.thickThinMediumGap],["thin-thick-thin-medium-gap",p.STBorder.thinThickThinMediumGap],["thin-thick-large-gap",p.STBorder.thinThickLargeGap],["thick-thin-large-gap",p.STBorder.thickThinLargeGap],["thin-thick-thin-large-gap",p.STBorder.thinThickThinLargeGap],["wave",p.STBorder.wave],["double-wave",p.STBorder.doubleWave],["dash-dot-stroked",p.STBorder.dashDotStroked],["three-d-emboss",p.STBorder.threeDEmboss],["three-d-engrave",p.STBorder.threeDEngrave],["outset",p.STBorder.outset],["inset",p.STBorder.inset],["dot-dot-dash",p.STBorder.dotDotDash]]),n=new Map([["solid",1],["dotted",1],["dash-small-gap",1],["dashed",1],["dot-dash",1],["double",3],["triple",5],["thin-thick-small-gap",1.5],["thick-thin-small-gap",1.5],["thin-thick-thin-small-gap",2],["thin-thick-medium-gap",2],["thick-thin-medium-gap",2],["thin-thick-thin-medium-gap",3],["thin-thick-large-gap",1.75],["thick-thin-large-gap",1.75],["thin-thick-thin-large-gap",3],["wave",4],["double-wave",6.7],["dash-dot-stroked",1],["three-d-emboss",2],["three-d-engrave",2],["outset",1],["inset",1],["dot-dot-dash",2]]);[{key:"bottom",value:["border-bottom","mso-border-bottom-alt"]}].forEach((function(a){a.value.forEach((function(s){if(t.has(s)){var l=t.get(s);if(l&&"none"!==l){var c=l.split(" "),u=(0,i.__read)(function(t,e){var r=[],n=t.find((function(t){return!!e.has(t)}));r.push(n);var o=t.find((function(t){return"auto"!==p.PropertyColorUtil.parseSTHexColor(t)}));r.push(o?p.PropertyColorUtil.parseHexColor(o):void 0);var i=t.find((function(t){return!(!/pt$/.test(t)&&!/px$/.test(t))}));return r.push(i),r}(c,r),3),g=u[0],h=u[1],d=u[2];g&&r.get(g)?e.pBdr[a.key].val=r.get(g):e.pBdr[a.key].val=p.STBorder.thick,h&&"windowtext"!==h&&(e.pBdr[a.key].color=h),d&&(e.pBdr[a.key].sz=8*function(t){var e;return t/(null!==(e=n.get(null!=g?g:"solid"))&&void 0!==e?e:1)}((y=(0,o.op)(d,1),Math.round(8*y)/8)))}}var y}))}))}var W={middot:p.STTabTlc.middleDot,dashed:p.STTabTlc.hyphen,dotted:p.STTabTlc.dot,lined:p.STTabTlc.underscore},U={left:p.STTabJc.left,right:p.STTabJc.right,center:p.STTabJc.center,decimal:p.STTabJc.decimal,bar:p.STTabJc.bar};function V(t,e,r){var n=N.splitCombineStyle(t),a=null!=r?r:new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));return H(t,a),function(t,e){if(t.has("text-align")&&t.get("text-align")){var r=t.get("text-align");-1!==(null==r?void 0:r.indexOf("left"))?e.jc.val=p.STJcWml.left:-1!==(null==r?void 0:r.indexOf("center"))?e.jc.val=p.STJcWml.center:-1!==(null==r?void 0:r.indexOf("right"))?e.jc.val=p.STJcWml.right:-1!==(null==r?void 0:r.indexOf("justify"))&&(t.has("text-justify")&&"distribute-all-lines"===t.get("text-justify")?e.jc.val=p.STJcWml.distribute:e.jc.val=p.STJcWml.both)}}(n,a),k(n,a),G(n,a),function(t,e){t.has("mso-para-margin-top")&&t.get("mso-para-margin-top")&&t.get("mso-para-margin-top").indexOf("gd")>0&&(e.spacing.before=(0,o.pL)((0,o.tM)(Number(t.get("mso-para-margin-top").replace("gd",""))))),t.has("mso-para-margin-bottom")&&t.get("mso-para-margin-bottom")&&t.get("mso-para-margin-bottom").indexOf("gd")>0&&(e.spacing.after=(0,o.pL)((0,o.tM)(Number(t.get("mso-para-margin-bottom").replace("gd",""))))),t.has("margin-top")&&t.get("margin-top")&&(e.spacing.before=(0,o.pL)((0,o.op)(t.get("margin-top"),0))),t.has("margin-bottom")&&t.get("margin-bottom")&&(e.spacing.after=(0,o.pL)((0,o.op)(t.get("margin-bottom"),0)))}(n,a),function(t,e){var r,n,a=t.get("tab-stops");if(a){var s=a.split(" "),l=[],c=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTabStop));try{for(var u=(0,i.__values)(s),g=u.next();!g.done;g=u.next()){var h=g.value,d=U[h];if(d)c.val=d;else{var y=W[h];if(y)c.leader=y;else{var f=(0,o.pL)((0,o.op)(h,0));f&&(c.val===p.STTabJc.PBDEFAULT&&(c.val=p.STTabJc.left),c.pos=f,l.push(c),c=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTabStop)))}}}}catch(t){r={error:t}}finally{try{g&&!g.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}l.length>0&&e.tabs.tab.setProperties(l)}}(n,a),a}var z,K=function(t,e,r,n,o,i){var a=u.$w.getTagName(t).toLowerCase();if(!["p","div","h1","h2"].includes(a))return!1;var s=!0;(null==t?void 0:t.lastElementChild)&&(s=function(t){return!["p","div","ol","ul","table","br"].includes(t)}(u.$w.getTagName(t.lastElementChild).toLowerCase()));var l=u.$w.getProp(t,"className");if(("h1"===a||"h2"===a)&&!(l=u.$w.getTdocTitle(l)))return!1;var c=function(t,e,r){return r.forEach((function(r){var n=t.get(r),o=e.get(r);!n&&o&&t.set(r,o)})),t}(N.getSelfStyle(t),e,o.validParaAttris),g=V(c),d=function(t,e){if(!t)return null;var r=null;if(/MsoNormal/.exec(t)&&e&&e.has("mso-outline-level")){var n=e.get("mso-outline-level");r="heading ".concat(n)}else/MsoTitle/.exec(t)?r=p.BuiltinStyleName.Title:/MsoSubtitle/.exec(t)?r=p.BuiltinStyleName.Subtitle:/MsoHeading7/.exec(t)?r=p.BuiltinStyleName.Heading7:/MsoHeading8/.exec(t)?r=p.BuiltinStyleName.Heading8:/MsoHeading9/.exec(t)?r=p.BuiltinStyleName.Heading9:/tco-title-title/.exec(t)?r=p.BuiltinStyleName.Title:/tco-title-subtitle/.exec(t)&&(r=p.BuiltinStyleName.Subtitle);return r}(l,c);if(d){var y=n.getDocument().generateStyleProperty(r,String(d));if(!y)throw Error("can not find ".concat(d,"!"));g.pStyle.val=y.styleId}if(i(t,e,r,n,o),"melo-hidden-editor"!==u.$w.getProp(t,"id")&&"inline-block"!==c.get("display")&&"inline"!==c.get("display")&&s){var f=u.$w.getNodeTextContent(t);(function(t,e){return!!e&&(e instanceof window[t]||!!e.ownerDocument&&!!e.ownerDocument.defaultView&&e instanceof e.ownerDocument.defaultView.window[t])})("HTMLElement",t)&&(null==f?void 0:f.replace("".concat(p.PlaceholderChar.ParagraphReturn),""))&&h.Gh.insertParagraph(r.currentRange().end(),p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),g,r)}return!0},j=function(t,e,r,n,o,i){if("br"!==u.$w.getTagName(t).toLowerCase())return!1;i(t,e,r,n,o);var a=V(e);return h.Gh.insertParagraph(r.currentRange().end(),p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),a,r),!0},Y=function(t,e,r,n,a,s){if("span"!==u.$w.getTagName(t).toLowerCase())return!1;var l=N.getSelfStyle(t);return!(!function(t,e,r){var n=t.get("mso-element"),i=p.STFldCharType.PBDEFAULT,a=r.fieldNestingLevel||0;switch(n){case"field-begin":a+=1,i=p.STFldCharType.begin;break;case"field-separator":i=p.STFldCharType.separate;break;case"field-end":i=p.STFldCharType.end;break;default:return!1}var s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),l=new(p.PropertyFactory.getPropertyClass(p.PropertyType.FieldCharProperty));return l.nestingLevel=a,l.fldCharType=i,i===p.STFldCharType.end&&(a-=1),o.Yd.info("PasteField process field placeholder",i,n,a),r.fieldNestingLevel=a,h.Gh.insertFieldChar(e.currentRange().end(),s,l,e),!0}(l,r,a)&&(a.isInTable&&function(t){var e,r,n,o=(null===(e=t.parentElement)||void 0===e?void 0:e.firstChild)===t,i=(null===(r=t.parentElement)||void 0===r?void 0:r.lastChild)===t;return!(!o||!i)&&""===(null===(n=null==t?void 0:t.textContent)||void 0===n?void 0:n.trim())}(t)||!function(t){var e=t.classList;if(!e.contains("MsoEndnoteReference")&&!e.contains("MsoFootnoteReference"))return!1;var r=t.parentElement;if(!r)return!0;if("a"!==u.$w.getTagName(r).toLowerCase())return!0;var n=u.$w.getStyleMap(r);return!n.get(w)&&!n.get(x)}(t)&&(function(t){var e=u.$w.getStyleMap(t),r=u.$w.getTagName(t).toLowerCase(),n=e.get("mso-special-character");return("footnote"===n||"endnote"===n)&&"span"===r}(t)?(M(t,e,r,n,a),0):(function(t,e){var r=(0,i.__read)((t.get("mso-tab-count")||"").split(" "),1)[0],n=parseInt(r||"",10);if(n&&n>0){for(var o=0;o<n;o++)h.Gh.insertText(e.currentRange().end(),p.PlaceholderChar.Tab,new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),e);return!0}return!1}(l,r)||function(t,e,r,n,a,s,l){var c=s.get("mso-field-code");if(!c)return!1;var u=c.match(/"([^"]*)/);if(!u)return!1;var g=(a.fieldNestingLevel||0)+1;return h.Gh.insertFieldByRange(u[1],new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),r,(function(r){l(t,e,r,n,(0,i.__assign)((0,i.__assign)({},a),{fieldNestingLevel:g}))}),g),o.Yd.info("PasteField process hyperlink",c,u[1],g),!0}(t,e,r,n,a,l,s)||(f.addExtraAttribute(t,e,"data-font-family"),s(t,e,r,n,a)),0))))},q=function(t,e,r,n,i,a){var s=u.$w.getTagName(t).toLowerCase();if(!s||"#comment"!==s)return!1;var l=t.textContent;if(!l)return!1;var p=l.match(/^\[if\s+([^\]]*)\s*\]>([\s\S]*)<!\[endif\]$/);if(!p)return!1;var c=p[1],g=p[2];return!("supportFields"!==c||!g||(o.Yd.info("PasteComment start parse",c,g,i.fieldNestingLevel),a((new DOMParser).parseFromString(g,"text/html").body,e,r,n,i),o.Yd.info("PasteComment end parse",c,i.fieldNestingLevel),0))},Q=r(911681),X=/\r?\n/g,J=function(){function t(t,e,r){this.pasteNodeProcessors=[],this.context=t,this.state=e,this.service=r,this.initBasicPasteNodeProcessor()}return t.prototype.addPasteNodeProcessor=function(t,e){void 0===e&&(e=c.kd0.normal);for(var r=!1,n={processor:t,priority:e},o=0;o<this.pasteNodeProcessors.length;++o)if(this.pasteNodeProcessors[o].priority<e){this.pasteNodeProcessors.splice(o,0,n),r=!0;break}r||this.pasteNodeProcessors.push(n)},t.prototype.initBasicPasteNodeProcessor=function(){this.addPasteNodeProcessor(_),this.addPasteNodeProcessor(Y),this.addPasteNodeProcessor(K),this.addPasteNodeProcessor(j),this.addPasteNodeProcessor(q)},t.prototype.doPaste=function(t,e,r,i){void 0===r&&(r=!1);var a=f.getNodeType(t),s={dstType:n.ClipboardUtils.getPasteDstType(this.service.getSelection(),e),srcType:a,validTextAttris:m,validParaAttris:O,pasteScene:i,noteIdMap:new Map,subStorys:[],fieldNestingLevel:0},l=h.C1.createLocalDeltaOption(e).buildDelta();l.setCommandType(p.Type.DocPaste);var c=N.generateInitStyle(t);if(r){var u=this.state.followSpanProp(l.currentRange().begin());if(u){var g=Q.vW8.cssPropsToStyle(Q.vW8.computeTextSpanFullStyles(u).cssProperties);g&&Object.keys(g).forEach((function(t){Q.vW8.isDefaultCss(t,g[t])||c.set(o.m7.camelToChain(t),g[t])}))}}if(this.processPasteNode(t,c,l,this.service,s),s.fieldNestingLevel){o.Yd.error("[FIELD PASTE ERROR] 缺少域结束符",s.fieldNestingLevel);var d=new(p.PropertyFactory.getPropertyClass(p.PropertyType.FieldCharProperty));d.fldCharType=p.STFldCharType.end;for(var y=s.fieldNestingLevel;y>0;y--)h.Gh.insertFieldChar(l.currentRange().end(),p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),d,l)}var v=this.sortMainAndSubStoryOps(l,s.subStorys,e);return B.inlineStyleReset(),v},t.prototype.processPasteNode=function(t,e,r,n,o){var a,s;if(t){N.getSelfStyle(t).forEach((function(t,r){e.set(r,t)}));var l=!1;try{for(var p=(0,i.__values)(this.pasteNodeProcessors),c=p.next();!c.done&&!(l=c.value.processor(t,e,r,n,o,this.processPasteChildNode.bind(this)));c=p.next());}catch(t){a={error:t}}finally{try{c&&!c.done&&(s=p.return)&&s.call(p)}finally{if(a)throw a.error}}l||function(t,e,r,n,o,i){var a=u.$w.getTagName(t).toLowerCase();!a||"style"===a||"img"===a||"table"===a||"meta"===a||"title"===a||L(t)||i(t,e,r,n,o)}(t,e,r,n,o,this.processPasteChildNode.bind(this))}},t.prototype.processPasteChildNode=function(t,e,r,n,o){for(var i=u.$w.getChildNodeNum(t),a=0;a<i;){var s=u.$w.getChildNode(t,a);if(s){if(u.$w.isTextNode(s)){var l=s.nodeValue||"",p=t.parentElement&&u.$w.getStyleMap(t.parentElement)||new Map;""===l.replace("&nbsp;"," ").trim()&&"Ignore"===p.get("mso-list")&&(s.nodeValue=""),X.test(l)&&(s.nodeValue=this.handleLineBreak(l,e))}if(L(s)){var c=A(t,a);if(-1!==c){a=c;continue}}this.processPasteNode(s,new Map(e),r,n,o)}a+=1}return!0},t.prototype.sortMainAndSubStoryOps=function(t,e,r){var n=this,o=h.C1.createLocalDeltaOption(r).buildDelta();o.setCommandType(p.Type.DocPaste);var a=new Map,s={operationDataList:this.mapOp2OpData(t.operations),storyRange:r},l=this.state.dataEngine.getDataStream().getStoryStream(),c=(0,i.__spreadArray)([s],(0,i.__read)(e.map((function(t){return{operationDataList:n.mapOp2OpData(t.storyOps),storyRange:new p.GCPRange(l.getStoryLastPos(t.storyType),0)}}))),!1).sort((function(t,e){return t.storyRange.end()-e.storyRange.end()})),u=0;return c.forEach((function(t){var e=t.storyRange,r=t.operationDataList;o.moveTo(new p.GCPRange(e.gcpBegin+u,e.len)),g.Co.transOperationDataToDelta(o,r,n.state.context,a,!0),u=o.currentRange().end()-e.gcpBegin})),o},t.prototype.mapOp2OpData=function(t){var e=this.state.dataEngine;return t.map((function(t){return{operationType:t.operationType,param:t.param,propertyType:g.Co.getPropertyType(t),builtinStyleName:g.Co.getStyleName(e,t)}}))},t.prototype.handleLineBreak=function(t,e){var r=e.get("white-space")||"";return["pre","pre-wrap","pre-line","break-spaces"].includes(r)?t:t.replace(X," ").trim()},t}(),Z=function(){function t(t,e){this.context=t,this.state=e}return t.prototype.transformInternalDataToPasteData=function(t,e){if(!t)return{success:!1,delta:null,isFromOtherPad:!1};var r=JSON.parse(t);if(!r)return{success:!1,delta:null,isFromOtherPad:!1};var n=h.C1.createLocalDeltaOption(e).buildDelta();n.setCommandType(p.Type.DocPaste);var i=r.subStory,a=r.mainStory;this.state.context.run("tranOperationDataToDelta",n,this.state.getStoryStream(),this.context,a,i,e,!0);var s=!1,l=this.context.docEnv.uniqueId,c=r.srcGlobalPadId;return l&&(s=c!==l),0===n.operations.length?{success:!1,delta:null,isFromOtherPad:s,srcPadId:c}:(o.Yd.info(p.Type.DocPaste,"paste range [".concat(e.begin(),", ").concat(n.currentRange().end(),"]!")),{success:!0,delta:n,isFromOtherPad:s,srcPadId:c})},t}();function $(t,e){return e.some((function(e){return e.contains(t)}))}function tt(t){var e,r,n=[],o=1;return t.forEachOp((function(t){if(h.NC.isTableStartCharOp(t)&&(1===o&&((e=new p.GCPRange).gcpBegin=t.param.range.gcpBegin),o+=1),h.NC.isTableEndCharOp(t)){if(1!=(o-=1)||!e)return;e.len=t.param.range.end()-(null==e?void 0:e.gcpBegin)+1,e&&n.push(e.clone()),e=void 0}var i=h.NC.isCodeBlock(t)||h.NC.isLightBlock(t)||h.NC.isTextFrame(t);i&&h.NC.isSubStoryBeginOp(t)&&((r=new p.GCPRange).gcpBegin=t.param.range.gcpBegin),i&&h.NC.isSubStoryEndOp(t)&&(r.len=t.param.range.end()-r.gcpBegin,r&&n.push(r),r=void 0)})),n}!function(t){t[t.headingWithListInfo=0]="headingWithListInfo",t[t.headingWithoutListInfo=1]="headingWithoutListInfo",t[t.mainWithListInfo=2]="mainWithListInfo",t[t.mainWithoutListInfo=3]="mainWithoutListInfo"}(z||(z={}));var et=[[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!0,!1]],rt=function(t){return t instanceof h.IZ},nt=function(t){return t instanceof h.Ks},ot=function(t){return rt(t)&&t.param.text===p.PlaceholderChar.ParagraphReturn},it="normalLink";function at(t,e,r){var n=rt(t)&&-1!==[p.PlaceholderChar.TableStart].indexOf(t.param.text),o=rt(t)&&-1!==[p.PlaceholderChar.FieldBegin].indexOf(t.param.text)&&!function(t,e,r){var n,o=h.Yy.getNextOperationByCondition(r,e+1,(function(t){return t instanceof h.IZ})).operation;return!!o&&-1!=="".concat(null===(n=o.param)||void 0===n?void 0:n.text).indexOf(it)}(0,e,r);return n||o}function st(t,e){var r=function(t,e){var r=t.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParagraphProperty(e);return!r.isEmpty(r.tKeys.outlineLvl)&&r.outlineLvl.val!==p.STOutlineLvl.LevelNone}(e,t),n=function(t){return!(t.isEmpty(t.tKeys.numPr)||t.numPr.isEmpty(t.numPr.tKeys.numId)||t.numPr.isEmpty(t.numPr.tKeys.ilvl))}(t);return r?n?z.headingWithListInfo:z.headingWithoutListInfo:n?z.mainWithListInfo:z.mainWithoutListInfo}var lt,pt=function(t,e,r){var n,o,a=e.getContentRange().gcpBegin,s=t.getTextStream().readText(a,r-a),l=0;try{for(var c=(0,i.__values)(s),u=c.next();!u.done;u=c.next())u.value===p.PlaceholderChar.Tab&&(l+=1)}catch(t){n={error:t}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}return l},ct=function(t,e){var r=t.getTextStream().createParagraphIterator();r.seek(e);var n=r.getContentRange().gcpBegin,o=pt(t,r,e);return!!o&&o===e-n};function ut(t){t.ind.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.left),t.ind.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.leftChars),t.ind.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.right),t.ind.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.rightChars),t.ind.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.hangingChars),t.ind.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.hanging),t.ind.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.firstLine),t.ind.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.firstLineChars)}var gt=((lt={})[p.ListType.Bullet]=function(t,e,r){var n=r.numPr,o=n.numId,i=n.ilvl,a=t.param.property;a.numPr.numId=o,a.numPr.ilvl=i},lt[p.ListType.Task]=function(t,e,r){var n=r.numPr,o=n.numId,i=n.ilvl,a=t.param.property;a.numPr.numId=o,a.numPr.ilvl=i,a.taskPr.taskState=r.taskPr.taskState},lt[p.ListType.Numbered]=function(t,e,r){var n=r.numPr,o=n.numId,i=n.ilvl,a=t.param.property;a.numPr.numId=o,a.numPr.ilvl=i},lt);function ht(t){if(!nt(t))return!1;var e=t.param.property;return!(e.isEmpty(e.tKeys.numPr)||e.numPr.isEmpty(e.numPr.tKeys.numId)||e.numPr.isEmpty(e.numPr.tKeys.ilvl))}function dt(t){return t.some(ht)}function yt(t,e,r,n,o,i){var a=st(i,r),s=tt(t);t.forEachOp((function(l,p){if(l instanceof h.Ks){var c=l.param,u=c.property,g=c.range,d=st(u,r),y=function(t,e,r){if(h.NC.isSubStoryBeginCharOp(e)||h.NC.isSubStoryEndCharOp(e))return!0;for(var n=r;n>=0;n--){var o=t[n];if(h.NC.isSubStoryBeginCharOp(o)||h.NC.isSubStoryEndCharOp(o)){if(h.NC.isSubStoryEndCharOp(o))return!1;if(h.NC.isSubStoryBeginCharOp(o))return!0}}return!1}(t.operations,l,p);if(y)return;if($(g,s))return;f=a,et[d][f]&&!o&&n&&(ut(u),gt[n.listType](l,e,n)),function(t,e){!e.isEmpty(e.tKeys.blockQuote)&&e.blockQuote&&(t.blockQuote=e.blockQuote)}(u,i)}var f}))}function ft(t,e,r,n){var o,a,s=function(t){var e,r,n=!1,o=[];try{for(var a=(0,i.__values)(t),s=a.next();!s.done;s=a.next()){var l=s.value;h.NC.isSubStoryBeginCharOp(l)&&(n=!0),n||o.push(l),h.NC.isSubStoryEndCharOp(l)&&(n=!1)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o}(t.operations),l=s.findIndex((function(t){return ot(t)})),p=-1!==s.findIndex((function(t,e,r){return at(t,e,r)})),c=n.targetRange?r.isRangeBeginAtParaStart(n.targetRange):e.getSelection().isSelectionCollapseAtParaStart(),u=null!==(a=null===(o=null==n?void 0:n.targetRange)||void 0===o?void 0:o.gcpBegin)&&void 0!==a?a:e.getSelection().range().gcpBegin;return!(-1===l&&!p||c||ct(r,u))}function vt(t,e,r,n){var o=f.getPasteTargetStyle(e,n.targetRange).paraStyle,a=r.dataEngine.getDataManager().getNumberingManager();if(o){var s=dt(t.operations);!function(t,e,r,n,o,a,s){var l,c,u=function(t,e){return t.isListParagraph(e)||e.blockQuote}(a,o);if(ft(t,e,r,s)&&(u||n)){e.getSelection().insertParagraphBefore(s.targetRange);try{for(var g=(0,i.__values)(t.operations),d=g.next();!d.done;d=g.next()){var y=d.value;h.Yy.moveOffset(y,1)}}catch(t){l={error:t}}finally{try{d&&!d.done&&(c=g.return)&&c.call(g)}finally{if(l)throw l.error}}var f=s.targetRange;f&&(s.targetRange=new p.GCPRange(f.gcpBegin+1,f.len))}}(t,e,r,s,o,a,n);var l=e.getSelection().range(),c=e.getSelection().getParaRange(l.gcpBegin);yt(t,e,r,a.getListInfoFromGcpRange(c),s,o)}}var mt=function(t,e,r,n){if(n.pasteScene!==c.KGc.TableDrag){var o=e.getSelection().validDeleteRange();if(h.Yy.isStartTable(t.operations)){Dt.isParaBeforeTable=!0;var i=f.getPasteTargetStyle(e,n.targetRange).paraStyle,a=h.Gh.getInsertParagraphOp(o.end(),null!=i?i:new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)));a&&t.insertOperations(a,0)}}return vt(t,e,r,n),t},Pt=r(814808),Tt=Pt.Snackbar,St=function(){function t(t,e,r){this.dstProcessors=new Map,this.deltaProcessors=[],this.preProcessors=[],this.context=t,this.state=e,this.service=r,this.initBasicProcessor()}return t.prototype.initBasicProcessor=function(){this.addPasteDstProcessor(c.Ze1.Doc,mt)},t.prototype.addPastePreProcessor=function(t,e){void 0===e&&(e=c.cms.Normal);for(var r=!1,n={processor:t,priority:e},o=0;o<this.preProcessors.length;++o)if(this.preProcessors[o].priority<e){this.preProcessors.splice(o,0,n),r=!0;break}r||this.preProcessors.push(n)},t.prototype.addPasteDstProcessor=function(t,e){this.dstProcessors.set(t,e)},t.prototype.addPasteDeltaProcessor=function(t,e){void 0===e&&(e=c.cms.Normal);for(var r=!1,n={processor:t,priority:e},o=0;o<this.deltaProcessors.length;++o)if(this.deltaProcessors[o].priority<e){this.deltaProcessors.splice(o,0,n),r=!0;break}r||this.deltaProcessors.push(n)},t.prototype.doProcessPaste=function(t,e){var r=this.doPreProcess(t,e);if(r)if(r=this.doProcessDst(r,e)){if(r=this.doProcessDelta(r,e))return r.setCommandType(p.Type.DocPaste),void 0!==e.isFromInternal&&r.setMutOption({fromExternalInput:!e.isFromInternal}),this.state.applyDelta(r),this.doExtraProcessAfterPaste(r),r;o.Yd.info("doProcessPaste delta (doProcessDelta) is null")}else o.Yd.info("doProcessPaste delta (doProcessDst) is null");else o.Yd.info("doPreProcess delta is null")},t.prototype.doExtraProcessAfterPaste=function(t){var e=!1,r=!1;t.forEachOp((function(t){t instanceof h.NT&&(r=!0),t instanceof h.y&&(e=!0)}));var n=this.service.getNote();r&&n.insertNoteSeparator(c.wK_.ENDNOTE),e&&n.insertNoteSeparator(c.wK_.FOOTNOTE)},t.prototype.doProcessDst=function(t,e){var r=n.ClipboardUtils.getPasteDstType(this.service.getSelection(),e.targetRange),o=this.dstProcessors.get(r);return o?o(t,this.service,this.state,e):null},t.prototype.doPreProcess=function(t,e){var r,n,o=t,a=e;try{for(var s=(0,i.__values)(this.preProcessors),l=s.next();!l.done;l=s.next()){var p=l.value.processor(o,this.service,e);if(!p)return null;o="delta"in p?p.delta:p,a="delta"in p?p.extraInfo:a}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o},t.prototype.doProcessDelta=function(t,e){var r,n,o,a=t,s=e;try{for(var l=(0,i.__values)(this.deltaProcessors),p=l.next();!p.done;p=l.next()){var c=p.value.processor(a,this.service,e);if(!c)return null;a="delta"in c?c.delta:c,s="delta"in c?c.extraInfo:s}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}if(null===(o=s.toastContent)||void 0===o?void 0:o.length){var u=s.toastContent.join(""),g=window.$t("paste:paste-toast-prefix");Tt.show({message:"".concat(g).concat(u),duration:2e3,autoClose:!0})}return a},t}(),Ct=r(94130),bt=new RegExp(" || |᠎|\ufeff|[ - ]| |​|\u2028|\u2029| | |　","g"),Rt=new RegExp("<iframe.*?>.*?<\\/iframe.*?>","gi"),_t=1024;function wt(t,e){if(void 0===e&&(e=51200),t.length>=e)o.Yd.info("printLongLog over size ".concat(t.length));else try{var r=encodeURIComponent(t);o.Yd.info("printLongLog start, total chunk count ".concat(Math.ceil(r.length/_t)));for(var n=0;n<r.length;n+=_t)o.Yd.info(r.slice(n,n+_t));o.Yd.info("printLongLog end")}catch(t){o.Yd.info("printLongLog error",t)}}var xt=Pt.default,It=window.$t,Dt=function(){function t(t,e,r,n){var o=this;this.checkIfNeedInnerData=function(t){return u.cm?t===c.jiO.LocalData:!o.dataType||t===o.dataType},this.context=t,this.state=e,this.service=r,this.customClipboard=n,this.pasteProcessorManager=new J(t,e,r),this.internalDataTransformer=new Z(t,e),this.pasteDataProcessor=new St(t,e,r)}var e,r,a,g;return t.prototype.paste=function(){},t.prototype.doPastePlainText=function(t){return this.doPaste("",t,"",!1,void 0,c.KGc.PastePlainText)},t.prototype.setInnerDataType=function(t){this.dataType=t},t.prototype.doPaste=function(t,e,r,i,a,s,l){var g;void 0===i&&(i=!1),void 0===s&&(s=c.KGc.Paste);var d=!0===(null==l?void 0:l.isFromDirectCall),y=!0===(null==l?void 0:l.isKeepTargetStyle),v=function(t){var e=t.replace(bt," ");return e.replace(Rt,"")}(t),m=Date.now();if(this.checkPermissionRange()){var P,T=!(v||!e);if(v){var S=this.getPasteInnerData(v,e);S&&(r=S)}(P=e.length)>15e3?u.kQ.zzsStatus({attributeId:u.GI.PASTE_LENGTH_OVER_15000,status:u.eG.SUCCESS}):P>1e4?u.kQ.zzsStatus({attributeId:u.GI.PASTE_LENGTH_OVER_10000,status:u.eG.SUCCESS}):P>5e3?u.kQ.zzsStatus({attributeId:u.GI.PASTE_LENGTH_OVER_5000,status:u.eG.SUCCESS}):P>2500?u.kQ.zzsStatus({attributeId:u.GI.PASTE_LENGTH_OVER_2500,status:u.eG.SUCCESS}):u.kQ.zzsStatus({attributeId:u.GI.PASTE_LENGTH_LESS_2500,status:u.eG.SUCCESS});var C=null!=a?a:this.state.selection.validDeleteRange();this.applyDelPasteRange(C);var b,R,_=new p.GCPRange(C.begin(),0),w=this.service.getSelection();w.setRange(_.gcpBegin,_.end());var x=0,I=n.ClipboardUtils.getPasteDstType(w,_),D=f.getPasteTargetStyle(this.service,_),F=this.internalDataTransformer.transformInternalDataToPasteData(r,_),E=!1;F.success&&F.delta?I!==c.Ze1.Doc&&F.delta.operations.some((function(t){return t instanceof h.z1}))||![c.Ze1.Doc,c.Ze1.Table,c.Ze1.Cell].includes(I)&&F.delta.operations.some((function(t){return t instanceof h.dJ}))?(T=!0,E=!1):E=!0:(I===c.Ze1.Codeblock&&(T=!0),E=!1);var M=w.getSdtSelection(),L=M.getHitSdt(_);if((null==M?void 0:M.getActiveSdts(_,L)[0])&&F.success&&F.delta){var A=F.delta.operations.some((function(t){return!!(h.NC.isCodeBlock(t)||h.NC.isLightBlock(t)||h.NC.isInsertNoteRefOp(t)||h.NC.isTableStartCharOp(t)||h.NC.isTableEndCharOp(t))}));M.isInline(_,L)&&A&&(T=!0,E=!1)}if(E)o.Yd.log("[Paste] use inner Data"),R=(g=this.handleInnerPasteData(F,I,s,_)).pasteDeltaExtraInfo,x=g.srcContentType,b=g.pasteDelta;else{o.Yd.log("[Paste] use html parser");var B=null,N=void 0;try{if(T)(N=document.createElement("span")).innerText=e;else{var O=(new DOMParser).parseFromString(v,"text/html");N=O.body,B=this.transformHtml2Document(N,O.head)}var k=this.pasteProcessorManager.doPaste(N,_,T,s);R={isFromInternal:!1,clipboardType:c.Y61.Paste,pasteScene:s,targetRange:_},x=h.Yy.getContentType(k),b=this.pasteDataProcessor.doProcessPaste(k,R),wt(N?N.innerHTML:v,15360)}catch(t){o.Yd.error("Html parse error: ".concat(t),T),wt(N?N.innerHTML:v),u.kQ.captureException(u.GI.HTML_PARSE_ERROR,{extra:{error:t}},t)}finally{B&&B.remove()}}u.kQ.zzsValue(u.GI.PASTE_DATA_USE_TIME,(Date.now()-m)/1e3);var G={plain:e,html:v,isPlainText:T,pasteDelta:b,pasteDeltaExtraInfo:R,pasteDstType:i?void 0:I,pasteTargetStyle:D,srcContentType:x,isFromDirectCall:d,isKeepTargetStyle:y};this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE,G),!1),this.customClipboard.setPasteType(c.Y61.Copy)}},t.prototype.pasteInnerData=function(t){var e=this.state.selection.validDeleteRange(),r=this.internalDataTransformer.transformInternalDataToPasteData(t,e);r.success&&r.delta&&this.pasteDataProcessor.doProcessPaste(r.delta,{isFromOtherPad:r.isFromOtherPad,isFromInternal:!0,clipboardType:c.Y61.Cut})},t.prototype.pasteCustomInnerData=function(t){var e=t.data,r=t.targetRange,n=t.pasteScene;if(this.context.isEditable()){var o=null!=e?e:this.customClipboard.getSelectionInnerData();if(o){var i=o.html,a=o.plain,s=o.innerData;s instanceof Object?this.doPaste(i,a,JSON.stringify(s),!0,r,n):this.doPaste(i,a,s,!0,r,n)}}},t.prototype.getPasteInnerData=function(t,e){var r=null,i=null,a=(new DOMParser).parseFromString(t,"text/html").querySelector("[tdoc-data-src]");if(a&&(r=u.$w.getAttr(a,"tdoc-data-src"),i=u.$w.getAttr(a,n.INNER_DATA_TYPE)),!r||!this.checkIfNeedInnerData(i))return"";if(a&&r&&r.length>0){var l=u.$w.getAttr(a,"data-version"),p=u.$w.getAttr(a,"data-hash"),c=(e||"").replace(h.Xr,""),g=p===s().hash(c);if(l===n.DATA_VERSION&&g)return o.Yd.info("getPasteInnerData, innerData: ".concat(r)),r}return""},t.prototype.transformHtml2Document=function(t,e){var r=document.createElement("iframe");return r.name="pasteTemplate",r.style.position="absolute",r.style.top="99999px",r.style.left="99999px",document.body.appendChild(r),window.frames.pasteTemplate.document.body=t,(null==e?void 0:e.childNodes)&&e.childNodes.length>0&&Array.from(e.childNodes).forEach((function(t){window.frames.pasteTemplate.document.head.appendChild(t)})),r},t.prototype.applyDelPasteRange=function(t){var e=null!=t?t:this.service.getSelection().validDeleteRange();if(!e.isEmpty()){var r=h.C1.createLocalDeltaOption(e).buildDelta();r.setCommandType(p.Type.DocDeleteText),this.state.deleteText(e,r),this.state.applyDelta(r)}},t.prototype.handleInnerPasteData=function(t,e,r,n){var o,i={isFromOtherPad:t.isFromOtherPad,isFromInternal:!0,srcPadId:t.srcPadId,targetRange:n,clipboardType:t.isFromOtherPad?c.Y61.Copy:this.customClipboard.getPasteType(),pasteScene:r},a=0;if(t.delta)if(a=h.Yy.getContentType(t.delta),e===c.Ze1.HeaderFooter||e===c.Ze1.NoteContent){var s=t.delta.operations.length,l=h.Yy.filterPlugins(t.delta);l.operations.length<s&&(s=l.operations.length,It&&this.showPasteUnsupported(It("扩展插件"))),e===c.Ze1.NoteContent&&(l=h.Yy.filterTable(l)).operations.length<s&&(s=l.operations.length,It&&this.showPasteUnsupported(It("表格"))),o=this.pasteDataProcessor.doProcessPaste(l,i)}else o=this.pasteDataProcessor.doProcessPaste(t.delta,i);return{pasteDeltaExtraInfo:i,srcContentType:a,pasteDelta:o}},t.prototype.addPasteNodeProcessor=function(t,e){void 0===e&&(e=c.kd0.normal),this.pasteProcessorManager.addPasteNodeProcessor(t,e)},t.prototype.addPasteDstProcessor=function(t,e){this.pasteDataProcessor.addPasteDstProcessor(t,e)},t.prototype.addPasteDeltaProcessor=function(t,e){void 0===e&&(e=c.cms.Normal),this.pasteDataProcessor.addPasteDeltaProcessor(t,e)},t.prototype.addPastePreProcessor=function(t,e){void 0===e&&(e=c.cms.Normal),this.pasteDataProcessor.addPastePreProcessor(t,e)},t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.checkPermissionRange=function(){var t,e;return!this.context.service.getPermissionRange().checkPermissionRange()||this.context instanceof Ct.zq&&!(null===(e=null===(t=this.context)||void 0===t?void 0:t.state)||void 0===e?void 0:e.getRestrictEdit().checkPermissionRange())?(this.context.fire(new n.BeforeClipboardActionNotification(!1),!1),!1):(this.context.fire(new n.BeforeClipboardActionNotification(!0),!1),!0)},t.prototype.showPasteUnsupported=function(t){It&&xt.show({message:It("当前位置暂不支持粘贴{{content}}",{content:t}),type:"info",autoClose:!0})},t.isParaBeforeTable=!1,t=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==c.Qwc&&c.Qwc)?e:Object,"function"==typeof(r=void 0!==l.ZM&&l.ZM)?r:Object,"function"==typeof(a=void 0!==c.vHF&&c.vHF)?a:Object,"function"==typeof(g=void 0!==n.CustomClipboard&&n.CustomClipboard)?g:Object])],t)}(),Ft=r(275094),Et=r.n(Ft),Mt=(function(t){function e(e,r,a,s){var l=t.call(this,e,r,a,s)||this;return l.attached=!1,l.pasteData=function(){return(0,i.__awaiter)(l,void 0,void 0,(function(){var t,e,r;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Et().invoke("readSystemClipboard",{})];case 1:return 0===(t=i.sent()).length?(o.Yd.info("readMiNiSystemClipboard success with plain, plain.length = 0"),[2]):((e=this.customClipboard.isCopyByInternal(t))?(r=this.customClipboard.getData().innerData,this.doPaste(e,t,r)):this.doPaste("",t,""),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE)),[3,3]);case 2:return i.sent(),[3,3];case 3:return[2]}}))}))},l}var r,a,s,p;(0,i.__extends)(e,t),e.prototype.attach=function(){this.attached||(this.attached=!0)},e.prototype.detach=function(){this.attached=!1},e.prototype.paste=function(){return this.pasteData()},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vHF&&c.vHF)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(Dt),function(t){function e(e,r,n,o){return t.call(this,e,r,n,o)||this}var r,o,a,s;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.paste=function(){var t=this.customClipboard.getData(),e=t.html,r=t.plain,n=t.innerData;this.doPaste(e,r,n)},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(o=void 0!==l.ZM&&l.ZM)?o:Object,"function"==typeof(a=void 0!==c.vHF&&c.vHF)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Dt),function(t){function e(e,r,n,o){var i=t.call(this,e,r,n,o)||this;return i.attached=!1,i.onPasteByEvent=function(t){var e;i.paste(),null===(e=null==t?void 0:t.preventDefault)||void 0===e||e.call(t)},i}var r,a,s,p;(0,i.__extends)(e,t),e.prototype.attach=function(){if(this.attached)o.Yd.warn("paste has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("paste",this.onPasteByEvent),this.attached=!0):o.Yd.error("PasteByMqq attach surfaceDom is null")}},e.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("paste",this.onPasteByEvent):o.Yd.error("PasteByMqq detach surfaceDom is null"),this.attached=!1},e.prototype.paste=function(){var t=this,e=window.top.mqq;if(e&&"0"!==e.clientVersion)e.invoke("docx","readSystemClipboard",{},(function(e,r){if(r){var n=r.plain,o=void 0===n?"":n,i=r.html,a=void 0===i?"":i,s=t.customClipboard.isCopyByInternal(o,a);if(s){var l=t.customClipboard.getData().innerData;t.doPaste(s,o,l)}else t.doPaste(a,o,"")}else{var p=t.customClipboard.getData();a=p.html,o=p.plain,l=p.innerData,t.doPaste(a,o,l)}}));else{var r=this.customClipboard.getData(),n=r.html,o=r.plain,i=r.innerData;this.doPaste(n,o,i)}},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vHF&&c.vHF)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(Dt),function(t){function e(e,r,a,s){var l=t.call(this,e,r,a,s)||this;return l.attached=!1,l.isEditFeatureLoaded=!1,l.onPasteByEvent=function(t){return(0,i.__awaiter)(l,void 0,void 0,(function(){var e,r,a,s,l,p;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(!this.context.isEditable())return[2];if(!(null===(l=this.context.surface)||void 0===l?void 0:l.isFocusing()))return[2];if(e="",r="",t){s=this.getPasteData(t),e=s.html,r=s.plain,o.Yd.info("onPasteByEvent: html.length:".concat(e.length,", plain.length: ").concat(r.length,", plain: ").concat(r));try{if(this.context.run("paste_plugin",e,r,t))return[2]}catch(t){o.Yd.error(t)}if((a=this.getBlob(t))&&(""===e||n.ClipboardUtils.isOutImageHtml(e)||n.ClipboardUtils.isPasteNativeImageToWeb(e)))return n.ClipboardUtils.insertImageByPaste(a,this.context),[2]}return null===(p=null==t?void 0:t.preventDefault)||void 0===p||p.call(t),[4,this.waitFeatureEditLoaded()];case 1:return i.sent(),this.doPaste(e,r,""),[2]}}))}))},h.kn.once(h.wq.FEATURE_LOADED,(function(){l.isEditFeatureLoaded=!0})),l}var r,a,s,p;return(0,i.__extends)(e,t),e.prototype.attach=function(){if(this.attached)o.Yd.warn("paste has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("paste",this.onPasteByEvent),this.attached=!0):o.Yd.error("PasteByWeb attach surfaceDom is null")}},e.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("paste",this.onPasteByEvent):o.Yd.error("PasteByWeb detach surfaceDom is null"),this.attached=!1},e.prototype.paste=function(){if(this.context.isEditable()){var t=this.customClipboard.getData(),e=t.html,r=t.plain,n=t.innerData;this.doPaste(e,r,n)}},e.prototype.isBugSafariForErrorCode=function(){return!(!o.wV.isSafari()||!o.wV.isMac())&&navigator.userAgent.toLocaleLowerCase().indexOf("version/13.1")>-1},e.prototype.getPasteData=function(t){var e,r="",n="";if(o.wV.isIE()?e=window.clipboardData:t&&(e=t.clipboardData),!e)return{html:r,plain:n};if(o.wV.isIE())n=e.getData("Text"),(i=this.customClipboard.isCopyByInternal(n))&&(r=i);else if(this.isBugSafariForErrorCode()){var i;n=e.getData("Text"),r=(i=this.customClipboard.isCopyByInternal(n))||e.getData("text/html")}else o.wV.isTencentDocsPC()?(r=external.getClipboardData("text/html"),n=e.getData("text/plain")):(r=e.getData("text/html"),n=e.getData("text/plain"));return{html:r,plain:n}},e.prototype.clipboardMayHasImage=function(t){if(!(null==t?void 0:t.clipboardData))return!1;for(var e=t.clipboardData.items||t.clipboardData.files||[],r=0;r<e.length;r++)if(e[r].type.startsWith("image/"))return!0;return!1},e.prototype.getBlob=function(t){var e,r,n,o;if(this.clipboardMayHasImage(t)){for(var i=t.clipboardData.items||t.clipboardData.files||[],a=[],s=0;s<i.length;s++)if(i[s].type.startsWith("image/")&&!i[s].type.startsWith("image/svg+xml")){var l=(null===(r=(e=i[s]).getAsFile)||void 0===r?void 0:r.call(e))||(null===(o=(n=i[s]).slice)||void 0===o?void 0:o.call(n));l&&a.push(l)}return a.length>0?a:void 0}t.clipboardData&&this.context.run("paste_files",t.clipboardData.items)},e.prototype.waitFeatureEditLoaded=function(){return this.isEditFeatureLoaded?Promise.resolve():new Promise((function(t){h.kn.once(h.wq.FEATURE_LOADED,t)}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vHF&&c.vHF)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(Dt)),Lt=(function(t){function e(e,r,n,o){return t.call(this,e,r,n,o)||this}var a,s,p,u;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.paste=function(){var t;return(0,i.__awaiter)(this,void 0,void 0,(function(){var e,a=this;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return[4,r.e(8567).then(r.t.bind(r,338567,23))];case 1:return e=i.sent(),null===(t=null==e?void 0:e.default)||void 0===t||t.callNative("DocsWebViewPlugin","GetClipboard",void 0,(function(t){if(t.code&&1===t.code){o.Yd.info("PasteByWemeet|paste resp succ");var e=t.data,r=a.customClipboard.isCopyByInternal(e);if(r){var i=a.customClipboard.getData().innerData;a.doPaste(r,e,i)}else a.doPaste("",e,"");a.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE))}else{o.Yd.info("PasteByWemeet|paste resp fail");var s=a.customClipboard.getData(),l=s.html;e=s.plain,i=s.innerData,a.doPaste(l,e,i)}})),[2]}}))}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(a=void 0!==c.Qwc&&c.Qwc)?a:Object,"function"==typeof(s=void 0!==l.ZM&&l.ZM)?s:Object,"function"==typeof(p=void 0!==c.vHF&&c.vHF)?p:Object,"function"==typeof(u=void 0!==n.CustomClipboard&&n.CustomClipboard)?u:Object])],e)}(Dt),function(t){function e(e,r,o,i){var a=t.call(this,e,r,o,i)||this;return a.weworkReadApi=function(){return n.tdocsCopyPaste.isSupportRead?n.tdocsCopyPaste.read():(0,n.readWeworkClipboard)()},a}var r,a,s,p;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.paste=function(){var t=this;return this.weworkReadApi().then((function(e){o.Yd.info("paste by wework, get paste Data: ".concat(e));var r=e.plain,i=e.html||t.customClipboard.isCopyByInternal(r);if(i){var a=t.customClipboard.getData().innerData;t.doPaste(i,r,a)}else t.doPaste("",r,"");t.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE))})).catch((function(){var e=t.customClipboard.getData(),r=e.html,n=e.plain,o=e.innerData;t.doPaste(r,n,o)}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vHF&&c.vHF)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(Dt),function(t){function e(e,r,n,o){return t.call(this,e,r,n,o)||this}var r,o,a,s;return(0,i.__extends)(e,t),e.prototype.paste=function(){var t=this;return(0,n.readWXRTFClipboard)().then((function(e){var r=e.html,o=e.plain;if(t.customClipboard.isCopyByInternal(o)){var i=t.customClipboard.getData().innerData;t.doPaste(r,o,i)}else t.doPaste(r,o,"");u.kQ.tdwReport({opername:"doc_word_editor",module:"copy_paste",action:"wx_read_rich_text"}),t.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE))})).catch((function(){u.kQ.idkeyReport(u.bP.WECHAT_COPYPASTE_FAILED)}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(o=void 0!==l.ZM&&l.ZM)?o:Object,"function"==typeof(a=void 0!==c.vHF&&c.vHF)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Dt)),At=(function(t){function e(e,r,n,o){return t.call(this,e,r,n,o)||this}var r,a,s,p;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.read=function(){var t=this;try{o.Yd.info("window.browser.file",window.browser.file),window.browser.file.getClipboardData((function(e){o.Yd.info("paste getClipboardData",e);var r=e.plain,n=e.html;t.doPaste(n,r,"")}),(function(){o.Yd.info("getClipboardData fail")}),{})}catch(t){o.Yd.info("paste getClipboardData failed",t)}},e.prototype.paste=function(){return(0,i.__awaiter)(this,void 0,void 0,(function(){var t;return(0,i.__generator)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,n.loadQQBrowserJSSDK)()];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),o.Yd.error("loadQQBrowserJSSDK failed",t),[3,3];case 3:return[2,this.read()]}}))}))},e.prototype.b64ToUTF8=function(t){return decodeURIComponent(escape(window.atob(t)))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vHF&&c.vHF)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(Dt),function(t){function e(e,r,n,o){return t.call(this,e,r,n,o)||this}var r,a,s,p;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.read=function(){var t,e=this;try{null===(t=window.fb)||void 0===t||t.getClipboardData().then((function(t){o.Yd.info("paste getClipboardData",t);var r=t;o.Yd.info("getClipboardData from fb",r),e.pasteData(r)})).catch((function(){return""}))}catch(t){o.Yd.info("paste getClipboardData failed",t)}},e.prototype.pasteData=function(t){var e=this.customClipboard.isCopyByInternal(t);if(e){var r=this.customClipboard.getData().innerData;o.Yd.info("paste with internal data",e),this.doPaste(e,t,r)}else this.doPaste("",t,"")},e.prototype.paste=function(){return this.read()},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vHF&&c.vHF)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(Dt),function(t){function e(e,r,n,o){var i=t.call(this,e,r,n,o)||this;return i.attached=!1,i.onVisibilityChange=function(){var t=document.visibilityState;"hidden"===i.visibilityState&&"visible"===t&&(window.setTimeout((function(){i.getCopyDataFromServer()}),1500),window.setTimeout((function(){i.getCopyDataFromServer()}),3500)),i.visibilityState=t},i.getCopyDataFromServer(),i.visibilityState=document.visibilityState||"visible",i}var r,a,s,p;return(0,i.__extends)(e,t),e.prototype.attach=function(){this.attached||(document.addEventListener("visibilitychange",this.onVisibilityChange),this.attached=!0)},e.prototype.detach=function(){document.removeEventListener("visibilitychange",this.onVisibilityChange),this.attached=!1},e.prototype.paste=function(){var t=this.customClipboard.getData(),e=t.plain,r=t.html,o=t.innerData;this.doPaste(r,e,o),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE))},e.prototype.getCopyDataFromServer=function(){var t=this;(0,n.readWeDriveMiniClipboard)().then((function(e){var r=e.plain;t.customClipboard.setData("",r)})).catch((function(t){console.error("paste error: ",t),o.Yd.error("paste in wedrive mini failed: ".concat(JSON.stringify(t)))}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.vHF),(0,i.__param)(3,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vHF&&c.vHF)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(Dt)),Bt=function(t){var e,r=t.factory;(0,n.isSupportWeDriveMini)()?e=At:(0,n.isSupportWXRTF)()?e=Lt:(navigator.userAgent.indexOf("FBMP"),e=Mt),o.Yd.info("paste injector use class: ".concat(e.name));var i=r.inject(c.MNE,(0,u.vM)(e));i&&i.attach(),i instanceof Dt&&r.inject(c.FMt,i)},Nt=r(164354),Ot=r.n(Nt);function kt(t,e){var r=t.getDocument().getParaStyleAtRange(e,!0),n=(0,i.__read)(r,1)[0];return n?n.outlineLvl.val:p.STOutlineLvl.LevelNone}function Gt(t,e){var r=t.dataEngine.getDataManager().getStyleSheetManager(),n=t.dataEngine.getDataStream().getTextStream().createParagraphIterator();n.seek(e.gcpBegin);var o=n.getProperty();return null===o?null:r.mergeStyleParagraphProperty(o).ind}function Ht(t,e){var r=(0,i.__spreadArray)([],(0,i.__read)(new Set(e.map((function(e){var r=e.range,n=e.outlineLevel;return null!=n?n:kt(t,r)})))),!1);r.sort();for(var n=new Map,o=0;o<r.length;o++){var a=r[o];a>=p.STOutlineLvl.LevelNone||n.set(a,Math.min(o,p.Defaults.listLevelLimit))}return n}function Wt(t,e,r){var n=e.dataEngine.getDataStream().getTextStream().createParagraphIterator(),o=t.map((function(t){var e=t.position,r=t.outlineLevel,o=t.skipCompareLevel;return n.seek(e),{range:n.getRange(),outlineLevel:r,skipCompareLevel:o}})),i=Ht(r,o),a=[];return o.forEach((function(t){var e=t.range,n=t.outlineLevel,o=t.skipCompareLevel,s=null!=n?n:kt(r,e),l=i.get(s);"number"!=typeof l||o||a.push({range:e,level:l})})),{diffListParas:a,outlineLevelMap:i}}function Ut(t){var e,r,n,o,a=t.headingNumberingGroup,s=t.state,l=t.editor,p=(0,i.__spreadArray)([],(0,i.__read)(new Set(a.map((function(t){return t.findResult.listId})))),!1);if(1!==p.length)return a;var c=p[0];if(null===c){var u=Ht(l.service,a.map((function(t){return{range:t.range}})));try{for(var g=(0,i.__values)(a),h=g.next();!h.done;h=g.next()){var d=h.value,y=kt(l.service,d.range);d.findResult.level=u.get(y)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(r=g.return)&&r.call(g)}finally{if(e)throw e.error}}return a}var f=s.dataEngine.getDataManager().getNumberingManager().getWholeListByListId(c),v=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(a.map((function(t){return{position:t.range.end()-1}}))),!1),(0,i.__read)(f.filter((function(t){return!t.isVirtual})).map((function(t){return{position:t.gcp-1}}))),!1),m=Wt(v,l.state,l.service),P=m.diffListParas,T=m.outlineLevelMap;try{for(var S=(0,i.__values)(a),C=S.next();!C.done;C=S.next())d=C.value,y=kt(l.service,d.range),d.findResult.level=T.get(y)}catch(t){n={error:t}}finally{try{C&&!C.done&&(o=S.return)&&o.call(S)}finally{if(n)throw n.error}}return P.length?P.map((function(t){var e=t.level,r=t.range;return{range:r,findResult:{level:e,listId:c,paragraphIndent:Gt(s,r),text:s.getDataStream().getTextStream().readText(r.begin(),r.length())}}})):a}function Vt(t,e){return kt(t,e)<p.STOutlineLvl.LevelNone}function zt(t,e){var r=t.mergeStyleParagraphProperty(e,null);return!r.isEmpty(e.tKeys.outlineLvl)&&r.outlineLvl.val!==p.STOutlineLvl.LevelNone}function Kt(t,e){var r=(0,i.__read)(t.getDocument().getParaStyleAtRange(e,!0),1)[0];return!(r.isEmpty(r.tKeys.numPr)||r.numPr.isEmpty(r.numPr.tKeys.numId)||r.numPr.isEmpty(r.numPr.tKeys.ilvl)||r.isNumPrCleaned())}function jt(t,e){var r=(0,i.__read)(t.getDocument().getParaStyleAtRange(e,!0),1)[0];return!r.isEmpty(r.tKeys.numPr)&&!r.numPr.isEmpty(r.numPr.tKeys.numId)}function Yt(t){return!(!t||t.isEmpty(t.tKeys.numPr)||t.numPr.isEmpty(t.numPr.tKeys.numId)||t.numPr.isEmpty(t.numPr.tKeys.ilvl))}function qt(t,e){var r,n,o;if(!Yt(t)||!e)return!1;var i=p.ListUtils.getAbstractNumType(e,t.numPr.numId.val);return(null===(o=null===(n=null===(r=null==i?void 0:i.lvl)||void 0===r?void 0:r.getProperty("0"))||void 0===n?void 0:n.numFmt)||void 0===o?void 0:o.val)===p.STNumberFormat.task}function Qt(t,e,r,n){var o=t.service.getDocument(),a=e.getDataStream(),s=o.getParaStyleAtRange(r,!0),l=(0,i.__read)(s,1)[0],c=l instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)&&l.isPlaceholder,u=a.getTextStream().createParagraphIterator(r).getRange();if(c){var g=e.dataEngine.getDataStream().getTextStream().charCodeAt(u.end()-1);return n?n.includes(g):(0,p.isTableChar)(g)}return!1}function Xt(t,e,r){var n=t.service.getDocument(),o=e.getDataStream().getTextStream(),a=e.getDataStream().getStoryStream(),s=e.getDataStream().getTableStream(),l=a.getSubStoryInfoFromGcp(r.gcpBegin);if(!l)return!1;var c=o.createParagraphIterator(l.contentRange);c.seek(r.gcpBegin);do{var u=c.getRange(),g=(0,i.__read)(n.getParaStyleAtRange(u,!0),1)[0],h=g instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)&&g.isPlaceholder,d=o.createParagraphIterator(u).getRange();if(h&&e.dataEngine.getDataStream().getTextStream().charCodeAt(d.end()-1)===p.PlaceholderCharCode.TableStart){var y=s.getTableInfo(d.gcpBegin).range;return r.end()<=y.end()}}while(c.prev());return!1}function Jt(t,e){var r=t.getDataStream().getTableStream().createTableIterator();do{if(r.getRange().equal(e))return!0}while(r.next());return!1}function Zt(t,e,r){var n=t.service.getDocument(),o=e.getDataStream().getTextStream().createParagraphIterator(r).getRange(),i=n.getRange(o.begin(),o.end()).getParagraphFormat().getQuote();return i&&i!==c.JjT.Undefined}function $t(t,e){if(!e)return!0;var r=Math.min(t.length,e.length),n=e.slice(0,r).map((function(t){return[t.listFormat,t.listText]})),o=t.slice(0,r).map((function(t){return[t.listFormat,t.listText]}));return Ot()(n,o)}function te(t,e,r,n){if(t.blockQuote!==e.blockQuote)return!1;if(!r||!n)return!1;var o=Math.min(r.length,n.length),i=n.slice(0,o).map((function(t){return{format:t.numFmt.val,text:t.lvlText.val}})),a=r.slice(0,o).map((function(t){return{format:t.numFmt.val,text:t.lvlText.val}}));return Ot()(i,a)}function ee(t,e){var r=[p.PlaceholderChar.Space,p.PlaceholderChar.Tab];return e.readText(t.gcpBegin,t.len).split("").every((function(t){return r.includes(t)}))}var re,ne=function(){function t(t,e){this.editor=t,this.state=e}return Object.defineProperty(t.prototype,"textStream",{get:function(){return this.state.getDataStream().getTextStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getDataStream().getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"editorDocument",{get:function(){return this.editor.service.getDocument()},enumerable:!1,configurable:!0}),t.prototype.splitRangeWhen2Heading=function(t){var e=this.state,r=this.editor,n=new Set,o=[];return Jt(e,t)||Xt(r,e,t)?this.splitRangeWhen2HeadingInTable(t,n,o):this.splitRangeWhen2HeadingInNormal(t,n,o),{rangesNeedToFindResult:o,listIdsNeedAutoAdjust:n}},t.prototype.splitRangeWhen2Normal=function(t){var e=this.state,r=this.editor,n=new Set,o=[];return Jt(e,t)||Xt(r,e,t)?this.splitRangeWhen2NormalInTable(t,n,o):this.splitRangeWhen2NormalInNormal(t,n,o),{rangesNeedToFindResult:o,listIdsNeedAutoAdjust:n}},t.prototype.splitRangeWhen2HeadingInTable=function(t,e,r){var n=this,o=this.editor,i=this.state;h.Yy.splitCellRange(this.tableStream,t,(function(t){var a=n.textStream.createParagraphIterator(t),s=[];do{var l=a.getRange();if(!Qt(o,i,l,[p.PlaceholderCharCode.TableCellBreak])){var c=Vt(o.service,l),u=n.editorDocument.getListInfoFromGcpRange(l);u&&(c?e.add(u.listId):s.push(l))}}while(a.next());return s.length&&r.push(s),!0}))},t.prototype.splitRangeWhen2HeadingInNormal=function(t,e,r){var n=this.editor,o=this.state,i=this.textStream.createParagraphIterator(t),a=[];do{var s=i.getRange();if(Qt(n,o,s,[p.PlaceholderCharCode.TableStart])){var l=this.tableStream.getTableInfo(s.gcpBegin).range;this.splitRangeWhen2HeadingInTable(l,e,r),i.seek(l.end()-1)}else{var c=Vt(n.service,s),u=this.editorDocument.getListInfoFromGcpRange(s);u&&(c?e.add(u.listId):a.push(s))}}while(i.next());a.length&&r.push(a)},t.prototype.splitRangeWhen2NormalInTable=function(t,e,r){var n=this,o=this.editor,i=this.state;h.Yy.splitCellRange(this.tableStream,t,(function(t){var a=n.textStream.createParagraphIterator(t),s=[],l=[],c=!1;do{var u=a.getRange();if(!Qt(o,i,u,[p.PlaceholderCharCode.TableCellBreak])){var g=Zt(o,i,u);g&&!c&&(c=!0,l=[]),!g&&c&&(c=!1,l.length&&(r.push(l),l=[]));var h=Vt(o.service,u),d=n.editorDocument.getListInfoFromGcpRange(u);d&&h&&(e.add(d.listId),g?l.push(u):s.push(u))}}while(a.next());return s.length&&r.push(s),c&&l.length&&r.push(l),!0}))},t.prototype.splitRangeWhen2NormalInNormal=function(t,e,r){var n=this.editor,o=this.state,i=this.textStream.createParagraphIterator(t),a=[],s=[],l=!1;do{var c=i.getRange();if(Qt(n,o,c,[p.PlaceholderCharCode.TableStart])){var u=this.tableStream.getTableInfo(c.gcpBegin).range;this.splitRangeWhen2NormalInTable(u,e,r),i.seek(u.end()-1)}else{var g=Zt(n,o,c);g&&!l&&(l=!0,s=[]),!g&&l&&(l=!1,s.length&&(r.push(s),s=[]));var h=Vt(n.service,c),d=this.editorDocument.getListInfoFromGcpRange(c);d&&h&&(e.add(d.listId),(g?s:a).push(c))}}while(i.next());a.length&&r.push(a),l&&s.length&&r.push(s)},t}(),oe=r(127039);!function(t){t.NORMAL="NORMAL",t.NORMAL_QUOTE_PART="NORMAL_QUOTE_PART",t.NORMAL_QUOTE_ALL="NORMAL_QUOTE_ALL",t.TABLE_NORMAL="TABLE_NORMAL",t.TABLE_QUOTE_PART="TABLE_QUOTE_PART",t.TABLE_QUOTE_ALL="TABLE_QUOTE_ALL"}(re||(re={}));var ie="NOT_IN_A_CELL",ae=function(){function t(t,e){this.editor=t,this.state=e,this.buffNormalRanges=[],this.buffQuoteRanges=[],this.currCellId=ie,this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.shouldFilterTable=function(t){return t===re.NORMAL},this.filterTable=function(t){return t!==re.TABLE_NORMAL&&t!==re.TABLE_QUOTE_ALL&&t!==re.TABLE_QUOTE_PART}}return Object.defineProperty(t.prototype,"textStream",{get:function(){return this.state.getDataStream().getTextStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getDataStream().getTableStream()},enumerable:!1,configurable:!0}),t.prototype.splitRange=function(t){var e=this.editor,r=this.state;return this.resetInitial(),Jt(r,t)||Xt(e,r,t)?this.handleSplitRangeInTable(t):this.handleSplitRange(t),this.buff2Result(),this.result},t.prototype.handleSplitRange=function(t){var e=this.editor,r=this.state,n=this.textStream.createParagraphIterator(t);do{var o=n.getRange();if(Qt(e,r,o,[p.PlaceholderCharCode.TableStart])){this.currQuote2Buff(this.currCellId);var i=this.tableStream.getTableInfo(o.gcpBegin).range;this.handleSplitRangeInTable(i),n.seek(i.end()-1),this.resetState2Normal()}else this.handleQuote(o,!1)||this.currBuffNormalRange.ranges.push(o)}while(n.next());this.currQuote2Buff(this.currCellId),this.currNormal2Buff()},t.prototype.handleSplitRangeInTable=function(t){var e=this,r=this.editor,n=this.state;h.Yy.splitCellRange(this.tableStream,t,(function(t){e.resetState2Cell();var o=e.textStream.createParagraphIterator(t);do{var i=o.getRange();Qt(r,n,i,[p.PlaceholderCharCode.TableCellBreak])||e.handleQuote(i,!0)||e.currBuffCellNormalRange.ranges.push(i)}while(o.next());return e.currQuote2Buff(e.currCellId),e.currCellNormal2Buff(e.currCellId),!0})),this.currQuote2Buff(this.currCellId),this.currCellNormal2Buff(this.currCellId)},t.prototype.handleQuote=function(t,e){var r=this.editor,n=this.state;return!!Zt(r,n,t)&&(this.currBuffQuoteRange.rangeType=e?re.TABLE_QUOTE_PART:re.NORMAL_QUOTE_PART,function(t,e,r){var n=t.service.getDocument(),o=e.getDataStream().getTextStream(),i=e.getDataStream().getStoryStream().getSubStoryInfoFromGcp(r.gcpBegin);if(!i)return!1;var a=o.createParagraphIterator(i.contentRange);if(a.seek(r.gcpBegin),!Zt(t,e,r))return!1;if(!a.hasPrev())return!0;a.prev();var s=a.getRange();if(Qt(t,e,s))return!0;var l=n.getRange(s.begin(),s.end()).getParagraphFormat().getQuote();return!(l&&l!==c.JjT.Undefined)}(r,n,t)&&(!this.isQuoteStartFind&&this.isQuoteEndFind&&(this.currQuote2Buff(this.currCellId),this.isQuoteStartFind=!1,this.isQuoteEndFind=!1),this.isQuoteStartFind=!0),function(t,e,r){var n=t.service.getDocument(),o=e.getDataStream().getTextStream(),i=e.getDataStream().getStoryStream().getSubStoryInfoFromGcp(r.gcpBegin);if(!i)return!1;var a=o.createParagraphIterator(i.contentRange);if(a.seek(r.gcpBegin),!Zt(t,e,r))return!1;if(!a.hasNext())return!0;a.next();var s=a.getRange();if(Qt(t,e,s))return!0;var l=n.getRange(s.begin(),s.end()).getParagraphFormat().getQuote();return!(l&&l!==c.JjT.Undefined)}(r,n,t)&&(this.isQuoteEndFind=!0),this.currBuffQuoteRange.ranges.push(t),this.isQuoteStartFind&&this.isQuoteEndFind&&(this.currBuffQuoteRange.rangeType=e?re.TABLE_QUOTE_ALL:re.NORMAL_QUOTE_ALL,this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.currQuote2Buff(this.currCellId)),!0)},t.prototype.resetInitial=function(){this.result={normal:[],heading:[]},this.buffNormalRanges=[],this.buffQuoteRanges=[],this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.currCellId=ie,this.resetCurrBuffNormalRange(),this.resetCurrBuffQuoteRange(ie),this.resetCurrBuffCellNormalRange(ie)},t.prototype.resetState2Normal=function(){this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.currCellId=ie,this.resetCurrBuffQuoteRange(ie)},t.prototype.resetState2Cell=function(){this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.currCellId=(0,oe.Z)(),this.resetCurrBuffQuoteRange(this.currCellId),this.resetCurrBuffCellNormalRange(this.currCellId)},t.prototype.resetCurrBuffNormalRange=function(){this.currBuffNormalRange={ranges:[],rangeType:re.NORMAL,cellId:ie}},t.prototype.resetCurrBuffQuoteRange=function(t){this.currBuffQuoteRange={ranges:[],rangeType:t===ie?re.NORMAL_QUOTE_PART:re.TABLE_QUOTE_PART,cellId:t}},t.prototype.resetCurrBuffCellNormalRange=function(t){this.currBuffCellNormalRange={ranges:[],rangeType:re.TABLE_NORMAL,cellId:t}},t.prototype.buff2Result=function(){var t,e,r,n,o,a,s=this;try{for(var l=(0,i.__values)(this.buffNormalRanges),p=l.next();!p.done;p=l.next()){var c=p.value,u=[],g=[];try{for(var h=(r=void 0,(0,i.__values)(c.ranges)),d=h.next();!d.done;d=h.next()){var y=d.value;Vt(this.editor.service,y)?(this.pushRanges2Result(u,c,!1),g.push(y),u=[]):u.push(y)}}catch(t){r={error:t}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}this.pushRanges2Result(u,c,!1),this.pushRanges2Result(g,c,!0)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}var f=function(t){var e,r,n=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(v.result.normal),!1),(0,i.__read)(v.result.heading),!1);if(t.rangeType===re.NORMAL_QUOTE_ALL&&n.some((function(t){return t.rangeType===re.NORMAL})))return"continue";if(t.rangeType===re.TABLE_QUOTE_ALL){var o=n.some((function(e){var r=e.rangeType,n=e.cellId;return r===re.TABLE_NORMAL&&t.cellId===n}));if(o)return"continue"}var a=[],s=[];try{for(var l=(e=void 0,(0,i.__values)(t.ranges)),p=l.next();!p.done;p=l.next()){var c=p.value;Vt(v.editor.service,c)?(v.pushRanges2Result(a,t,!1),s.push(c),a=[]):a.push(c)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}v.pushRanges2Result(a,t,!1),v.pushRanges2Result(s,t,!0)},v=this;try{for(var m=(0,i.__values)(this.buffQuoteRanges),P=m.next();!P.done;P=m.next())f(c=P.value)}catch(t){o={error:t}}finally{try{P&&!P.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.result.normal),!1),(0,i.__read)(this.result.heading),!1).some((function(t){var e=t.rangeType;return s.shouldFilterTable(e)}))&&(this.result={normal:this.result.normal.filter((function(t){var e=t.rangeType;return s.filterTable(e)})),heading:this.result.heading.filter((function(t){var e=t.rangeType;return s.filterTable(e)}))})},t.prototype.pushRanges2Result=function(t,e,r){t.length&&(r?this.result.heading:this.result.normal).push({ranges:t,rangeType:e.rangeType,cellId:e.cellId})},t.prototype.currNormal2Buff=function(){this.currBuffNormalRange.ranges.length?(this.buffNormalRanges.push(this.currBuffNormalRange),this.resetCurrBuffNormalRange()):this.resetCurrBuffNormalRange()},t.prototype.currQuote2Buff=function(t){this.currBuffQuoteRange.ranges.length?(this.buffQuoteRanges.push(this.currBuffQuoteRange),this.resetCurrBuffQuoteRange(t)):this.resetCurrBuffQuoteRange(t)},t.prototype.currCellNormal2Buff=function(t){this.currBuffCellNormalRange.ranges.length?(this.buffNormalRanges.push(this.currBuffCellNormalRange),this.resetCurrBuffCellNormalRange(t)):this.resetCurrBuffCellNormalRange(t)},t}();function se(t,e){if(t.matchInfo.isMultiLevelRecognize)return!1;var r=t.matchInfo.listMatchInfos.some((function(t){var r=t.order,n=t.possibleLevels.includes(0);return e?0===r&&n:0!==r&&n}));return r}function le(t){return t.order+t.start-1}function pe(t){var e=t.listInfo,r=t.editor,n=t.state,o=t.textStream,a=function(t,e,r){var n,o;try{for(var a=(0,i.__values)(e.service.getDocument().getParagraphs()),s=a.next();!s.done;s=a.next()){var l=s.value;if(t.paraId===l.getParaId()){var p=l.getRange();return{range:p,paragraphIndent:Gt(r,p)}}}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return null}(e,r,n),s=a?a.range:null;return{level:e.listLevel,listId:e.listId,paragraphIndent:a?a.paragraphIndent:null,text:s?o.readText(s.gcpBegin,s.len):""}}function ce(t){var e=t.recognizeRange,r=t.recognizeLevel,n=t.findListInfo,o=t.editor,i=t.isHeading,a=t.isMultiMaxLevelMatch,s=n.listLevel,l=n.outlineLvl;return(!i||i&&!a||kt(o.service,e)===l.val)&&r===s}function ue(t){var e=t.findListInfo,r=t.isHeading,n=t.listMatchInfo,o=t.recognizeRange,i=t.editor,a=e.listLevel,s=e.outlineLvl,l=e.isVirtual,p=n.possibleLevels;if(!r)return p.includes(a);var c=kt(i.service,o);return p.includes(a)&&(!!l||c===s.val)}function ge(t,e,r,n){return void 0===n&&(n=!1),n?t===e:r?t-1===e:t+1===e}var he,de,ye=function(){function t(){}return t.hasSetIndent=function(t){return!t.isEmpty(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.left)&&t.left>0||!t.isEmpty(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.leftChars)&&t.leftChars>0||!t.isEmpty(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.firstLine)&&t.firstLine>0||!t.isEmpty(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd).tKeys.firstLineChars)&&t.firstLineChars>0},t.getParaStartTabCount=function(t,e){var r,n,o=e.readText(t.gcpBegin,t.len),a=0;try{for(var s=(0,i.__values)(o),l=s.next();!l.done&&l.value===p.PlaceholderChar.Tab;l=s.next())a+=1}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return a},t.getFinalNumericalLeftIndent=function(t,e,r,n,o,i){var a,s=null!==(a=n.getListInfoFromGcpRange(e))&&void 0!==a?a:t,l=this.getParaStartTabCount(e,r)*p.Defaults.tabCharsCount*p.Defaults.fontSize;if(s.isEmpty(s.tKeys.ind))return l;var c=s.ind;l+=c.leftChars?c.leftChars*p.Defaults.fontSize/p.DefaultsUnit.indentChars:c.left-c.hanging;var u=c.firstLineChars?this.convertSpecialIndentFromCharToNum(c.firstLineChars,s,e,r,o):c.firstLine,g=c.hangingChars?this.convertSpecialIndentFromCharToNum(c.hangingChars,s,e,r,o):c.hanging,h=i.ignoreFirstLine,d=i.ignoreHanging;return u&&!h&&(l+=u),g&&!d&&(l+=g),l},t.convertRelativeIndentToListLevel=function(t,e){var r=t/p.Defaults.fontSize;if(r<this.minRelativeCharsIndent)return e;var n=Math.floor(r/this.maxRelativeCharsIndent);return e+n+(r-n*this.maxRelativeCharsIndent<this.minRelativeCharsIndent?0:1)},t.getListLevelFromIndent=function(t,e,r,n,o){var i=r.createParagraphIterator();i.seek(e.gcpBegin);var a=0,s=i.getProperty();if(!s)return a;if(!(s=n.mergeStyleParaPropWithGcp(s,e.gcpBegin)))return a;var l=this.getFinalNumericalLeftIndent(s,e,r,o,n,{ignoreHanging:!0,ignoreFirstLine:!1}),p=this.lastParaLevelInfoMap.get(t);if(p){var c=p.indent,u=p.level;(a=this.convertRelativeIndentToListLevel(l-c,u))===u&&this.lastParaLevelInfoMap.set(t,{indent:l,level:u})}else this.lastParaLevelInfoMap.set(t,{indent:l,level:a});return a},t.getNewLeftIndentAfterModify=function(e,r,n,o,i,a,s){var l=!s;return t.getFinalNumericalLeftIndent(e,r,n,o,i,{ignoreHanging:l,ignoreFirstLine:!0})+(a?1:-1)*p.Defaults.tabCharsCount*p.Defaults.fontSize},t.initializeIndentInfo=function(t,e){var r=e.getLevelType(t,0);if(r){var n=r.pPr.ind,o=n.left,i=n.hanging;this.lastParaLevelInfoMap.set(t,{indent:o-i,level:0})}},t.clearLevelCache=function(){this.lastParaLevelInfoMap.clear()},t.convertSpecialIndentFromCharToNum=function(t,e,r,n,o){var i,a=n.createRunIterator(r);a.seek(r.gcpBegin);var s=null!==(i=a.getProperty())&&void 0!==i?i:new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));return o.mergeStyleRunPropWithGcp(s,e,r.gcpBegin).sz.val*t/p.DefaultsUnit.indentChars},t.lastParaLevelInfoMap=new Map,t.minRelativeCharsIndent=1,t.maxRelativeCharsIndent=2,t}(),fe=function(t){var e=[];return t.lvl.forEach((function(t){e.push(t.clone())})),e.length>0&&p.ListUtils.isTaskFormat(e[0].numFmt.val)?[e[0]]:e.sort((function(t,e){return t.ilvl-e.ilvl}))},ve=function(t,e){var r=e.getAbstractNumType(t);return r?fe(r):null},me=function(t,e,r){var n=p.Defaults.tabCharsCount;e||(n*=-1);var o=t.every((function(t){var e=t.pPr.ind,o=e.left,i=e.leftChars,a=e.hanging,s=0;return s=i>0?(i+n*p.DefaultsUnit.indentChars)/p.DefaultsUnit.indentChars*p.Defaults.fontSize:n*p.Defaults.fontSize+o-a,r(s)===s}));return o?t.map((function(t){var e=t,r=e.pPr.ind,o=r.left,i=r.leftChars;return i>0?e.pPr.ind.leftChars=i+n:e.pPr.ind.left=n*p.Defaults.fontSize+o,e})):null},Pe=function(t,e,r,n,o){var a=[],s=(0,i.__read)(e,1)[0];if(!s)return a;var l=s.listFormat,c=p.ListUtils.isTaskFormat(l)||p.ListUtils.isBulletFormat(l),u=function(t,e,r,n,o,i){var a,s=n.createParagraphIterator(t);s.seek(t.gcpBegin);var l=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTLvlWml)),c=s.getProperty();if(!c)return l;if(!(c=o.mergeStyleParaPropWithGcp(c,t.gcpBegin)))return l;var u=ye.getFinalNumericalLeftIndent(c,t,n,i,o,{ignoreHanging:!0,ignoreFirstLine:!1});return l.ilvl=0,l.pPr.ind.hanging=null!==(a=e.listHangingIndent)&&void 0!==a?a:p.Defaults.listDefaultHanging,l.pPr.ind.left=u+l.pPr.ind.hanging,l.start.val=1,l.lvlJc.val=p.STJcWml.left,l.numFmt.val=e.listFormat,l.lvlText.val=e.listText,r&&p.ListUtils.setSpanFont(l.rPr,"wingdings"),l}(t,s,c,r,n,o);return p.ListUtils.isTaskFormat(l)?a.push(u):e.slice(1).forEach((function(t,e){var r=function(t,e,r,n,o){var i,a;void 0===o&&(o=!1);var s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTLvlWml));s.ilvl=n,s.start.val=1,s.lvlJc.val=p.STJcWml.left,s.numFmt.val=t.listFormat,s.lvlText.val=t.listText;var l=null!==(i=t.listHangingIndent)&&void 0!==i?i:p.Defaults.listDefaultHanging;return s.pPr.ind.hanging=l,t.listLeftIndent&&(s.pPr.ind.left=r.pPr.ind.left-r.pPr.ind.hanging+t.listLeftIndent-(null!==(a=e.listLeftIndent)&&void 0!==a?a:0)+l),o&&p.ListUtils.setSpanFont(s.rPr,"wingdings"),s}(t,s,u,e+1,c);a.push(r)})),p.ListUtils.completeListTemplateParagraphs(u,a,p.Defaults.listLevelLimit),a},Te=function(t,e){var r,n,o=t.clone(),i=o.pPr.ind.left-o.pPr.ind.hanging;return o.numFmt.val=e.listFormat,o.lvlText.val=e.listText,o.pPr.ind.hanging=null!==(r=e.listHangingIndent)&&void 0!==r?r:p.Defaults.listDefaultHanging,o.pPr.ind.left=(null!==(n=e.listLeftIndent)&&void 0!==n?n:i)+o.pPr.ind.hanging,["","wingdings"].includes(o.rPr.rFonts.eastAsia)&&(p.ListUtils.isBulletFormat(o.numFmt.val)?p.ListUtils.setSpanFont(o.rPr,"wingdings"):p.ListUtils.setSpanFont(o.rPr,"")),o},Se=function(t,e){var r=p.ListUtils.getPeriodListStyleset(e);return 1===e.length&&e[0].listFormat===p.STNumberFormat.task?[Te(t[0],e[0])]:t.reduce((function(t,e){var n=r[e.ilvl%r.length],o=Te(e,n);return t.push(o),t}),[])},Ce=function(t,e){var r=[];return t.forEach((function(t){var n=t.listLevel,o=t.start,i=e.findIndex((function(t){return t.ilvl===n})),a=e[i];if(a&&a.start.val!==o){var s=function(t,e){var r=t.clone();return r.start.val=e,r}(a,o);r.push(s),e.splice(i,1)}})),r.push.apply(r,(0,i.__spreadArray)([],(0,i.__read)(e),!1)),r.sort((function(t,e){return t.ilvl-e.ilvl})),r},be=function(t,e){return new RegExp("^\t*(".concat(t,")([").concat(e,"])( )*"))},Re={BulletCircle:[{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Circle},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.HollowCircle},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Square}],BulletArrow:[{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Arrow},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.HollowCircle},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Square}],BulletHook:[{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Hook},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Circle},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Diamond}],BulletHollowCircle:[{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.HollowCircle},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Square},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Diamond}],BulletStar:[{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Star},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Arrow},{listFormat:p.STNumberFormat.bullet,listText:p.BulletText.Square}],NumberDecimal:[{listFormat:p.STNumberFormat.decimal,listText:"%1."},{listFormat:p.STNumberFormat.lowerLetter,listText:"%2."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%3."},{listFormat:p.STNumberFormat.decimal,listText:"%4."},{listFormat:p.STNumberFormat.lowerLetter,listText:"%5."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%6."},{listFormat:p.STNumberFormat.decimal,listText:"%7."},{listFormat:p.STNumberFormat.lowerLetter,listText:"%8."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%9."}],NumberLevelDecimal:[{listFormat:p.STNumberFormat.decimal,listText:"%1.",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.decimal,listText:"%1.%2.",listHangingIndent:Math.floor(p.Defaults.listDefaultHanging+.8*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%1.%2.%3.",listHangingIndent:Math.floor(p.Defaults.listDefaultHanging+1.6*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%1.%2.%3.%4.",listHangingIndent:Math.floor(p.Defaults.listDefaultHanging+2.4*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%1.%2.%3.%4.%5.",listHangingIndent:Math.floor(p.Defaults.listDefaultHanging+3.2*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%1.%2.%3.%4.%5.%6.",listHangingIndent:Math.floor(p.Defaults.listDefaultHanging+4*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%1.%2.%3.%4.%5.%6.%7.",listHangingIndent:Math.floor(p.Defaults.listDefaultHanging+4.8*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%1.%2.%3.%4.%5.%6.%7.%8.",listHangingIndent:Math.floor(p.Defaults.listDefaultHanging+5.6*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%1.%2.%3.%4.%5.%6.%7.%8.%9.",listHangingIndent:Math.floor(p.Defaults.listDefaultHanging+6.4*p.Defaults.fontSizeStable)}],NumberIdeographicComma:[{listFormat:p.STNumberFormat.decimal,listText:"%1、"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%2)"},{listFormat:p.STNumberFormat.lowerRoman,listText:"%3)"},{listFormat:p.STNumberFormat.decimal,listText:"%4、"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%5)"},{listFormat:p.STNumberFormat.lowerRoman,listText:"%6)"},{listFormat:p.STNumberFormat.decimal,listText:"%7、"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%8)"},{listFormat:p.STNumberFormat.lowerRoman,listText:"%9)"}],NumberSingleParentheses:[{listFormat:p.STNumberFormat.decimal,listText:"%1)"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%2)"},{listFormat:p.STNumberFormat.lowerRoman,listText:"%3)"},{listFormat:p.STNumberFormat.decimal,listText:"%4)"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%5)"},{listFormat:p.STNumberFormat.lowerRoman,listText:"%6)"},{listFormat:p.STNumberFormat.decimal,listText:"%7)"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%8)"},{listFormat:p.STNumberFormat.lowerRoman,listText:"%9)"}],NumberParentheses:[{listFormat:p.STNumberFormat.decimal,listText:"(%1)"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%2."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%3."},{listFormat:p.STNumberFormat.decimal,listText:"(%4)"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%5."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%6."},{listFormat:p.STNumberFormat.decimal,listText:"(%7)"},{listFormat:p.STNumberFormat.lowerLetter,listText:"%8."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%9."}],NumberChinese:[{listFormat:p.STNumberFormat.chineseCountingThousand,listText:"%1、",listHangingIndent:Math.floor(p.Defaults.mediumListFontNum*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%2、",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.lowerLetter,listText:"%3)",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.chineseCountingThousand,listText:"%4、",listHangingIndent:Math.floor(p.Defaults.mediumListFontNum*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%5、",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.lowerLetter,listText:"%6)",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.chineseCountingThousand,listText:"%7、",listHangingIndent:Math.floor(p.Defaults.mediumListFontNum*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%8、",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.lowerLetter,listText:"%9)",listHangingIndent:p.Defaults.listDefaultHanging}],NumberChineseParentheses:[{listFormat:p.STNumberFormat.chineseCountingThousand,listText:"（%1）",listHangingIndent:Math.floor(p.Defaults.bigListFontNum*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%2、",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.lowerLetter,listText:"%3)",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.chineseCountingThousand,listText:"（%4）",listHangingIndent:Math.floor(p.Defaults.bigListFontNum*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%5、",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.lowerLetter,listText:"%6)",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.chineseCountingThousand,listText:"（%7）",listHangingIndent:Math.floor(p.Defaults.bigListFontNum*p.Defaults.fontSizeStable)},{listFormat:p.STNumberFormat.decimal,listText:"%8、",listHangingIndent:p.Defaults.listDefaultHanging},{listFormat:p.STNumberFormat.lowerLetter,listText:"%9)",listHangingIndent:p.Defaults.listDefaultHanging}],NumberUpperLetter:[{listFormat:p.STNumberFormat.upperLetter,listText:"%1."},{listFormat:p.STNumberFormat.lowerLetter,listText:"%2."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%3."},{listFormat:p.STNumberFormat.upperLetter,listText:"%4."},{listFormat:p.STNumberFormat.lowerLetter,listText:"%5."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%6."},{listFormat:p.STNumberFormat.upperLetter,listText:"%7."},{listFormat:p.STNumberFormat.lowerLetter,listText:"%8."},{listFormat:p.STNumberFormat.lowerRoman,listText:"%9."}],TaskList:[{listFormat:p.STNumberFormat.task,listText:p.TaskText.Todo}]},_e=[Re.NumberDecimal,Re.NumberLevelDecimal,Re.NumberIdeographicComma,Re.NumberSingleParentheses,Re.NumberParentheses,Re.NumberChinese,Re.NumberChineseParentheses,Re.NumberUpperLetter],we=[{prefix:"",suffix:".",indentFactor:.5},{prefix:"",suffix:"、",indentFactor:1},{prefix:"",suffix:")",indentFactor:.5},{prefix:"(",suffix:")",indentFactor:.5},{prefix:"（",suffix:"）",indentFactor:1}],xe=we.map((function(t){return t.suffix})).join(""),Ie=((he={})[p.STNumberFormat.decimal]=[/^([1-9]\d{0,3})(\.)(\u0020*)(?!\d)/,be("[1-9]\\d{0,3}",xe.replace(".",""))],he[p.STNumberFormat.lowerLetter]=[be("[a-z][a-z]?",xe)],he[p.STNumberFormat.upperLetter]=[be("[A-Z][A-Z]?",xe)],he[p.STNumberFormat.lowerRoman]=[be("i[xv]|v?i{0,3}",xe)],he[p.STNumberFormat.upperRoman]=[be("I[XV]|V?I{0,3}",xe)],he[p.STNumberFormat.chineseCountingThousand]=[be("([一二三四五六七八九]?十)?[一二三四五六七八九]?",xe)],he),De=/^\t*(([1-9]\d{0,3}\.){2,})(\u0020)*(?!\d)/,Fe=3,Ee=((de={})[p.STNumberFormat.decimal]="1",de[p.STNumberFormat.lowerLetter]="a",de[p.STNumberFormat.lowerRoman]="i",de[p.STNumberFormat.chineseCountingThousand]="一",de[p.STNumberFormat.upperLetter]="A",de[p.STNumberFormat.upperRoman]="I",de),Me=[p.ListUtils.getDefaultBulletListText(1),p.ListUtils.getDefaultBulletListText(2)],Le=[p.ListUtils.getDefaultNumberListStyle(1),p.ListUtils.getDefaultNumberListStyle(2)];function Ae(t){if(t.length>0){var e=(0,i.__read)(t,1)[0];if(p.ListUtils.isTaskFormat(e.listFormat))return"task";var r=[];if(p.ListUtils.isBulletFormat(e.listFormat))for(var n=0;n<Fe;++n)r.push(t[n]?t[n].listText:Me[n-1]);else{var o=t.length>=Fe?t:(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(t),!1),(0,i.__read)(Le),!1),a=o.map((function(t){return Ee[t.listFormat]||"1"})),s=function(t){o[t]&&o[t].listText&&r.push(o[t].listText.replace(/%([1-9])/g,(function(){return a[t]||""})))};for(n=0;n<Fe;++n)s(n)}return r.join(" ")}return""}new Map(Object.values(Re).map((function(t){return[Ae(t),t]}))),Re.BulletCircle,Re.NumberDecimal,Re.TaskList;var Be=function(){function t(){}return t.getImageInfo=function(t){var e,r,n,o,i;return null===(i=null===(o=null===(n=null===(r=null===(e=t.drawing.graphic)||void 0===e?void 0:e.graphicData)||void 0===r?void 0:r.pic)||void 0===n?void 0:n.blipFill)||void 0===o?void 0:o.blip)||void 0===i?void 0:i.embed},t.createClearRunProperty=function(){var t=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));return t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.b),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.sz),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.u),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.strike),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.i),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.spacing),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.vertAlign),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.rFonts),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.color),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.shd),t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.w),t},t.createStoryPropertyFromType=function(t){var e=null;switch(t){case p.STStoryType.headerContent:e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.HeaderStoryProperty));break;case p.STStoryType.footerContent:e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.FooterStoryProperty));break;case p.STStoryType.footnoteContent:e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.FootnoteStoryProperty));break;case p.STStoryType.endnoteContent:e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.EndnoteStoryProperty));break;case p.STStoryType.commentContent:e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CommentStoryProperty));break;case p.STStoryType.textboxContent:e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty));break;default:o.Yd.warn("story类型错误！")}return e},t.isTextFrame=function(t,e){var r=e.drawing.graphic.graphicData.wsp,n=t.getStoryStream().getSubStoryInfoFromId(r.txbx.contentId,p.STStoryType.textboxContent);return(null==n?void 0:n.subStoryProp)instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty)},t.isStoryOperation=function(t){return t instanceof h.di||(t instanceof h.jb?t.param.property.isPlaceholder:t instanceof h.IZ&&[p.PlaceholderChar.SubStoryBegin,p.PlaceholderChar.SubStoryEnd].includes(t.param.text))},t.isStoryEndBreak=function(t){return t instanceof h.IZ&&t.param.text===p.PlaceholderChar.SubStoryEnd},t.isStoryStartBreak=function(t){return t instanceof h.IZ&&t.param.text===p.PlaceholderChar.SubStoryBegin},t.isTableSeperate=function(t){return[p.PlaceholderChar.TableCellBreak,p.PlaceholderChar.TableRowBreak,p.PlaceholderChar.TableStart,p.PlaceholderChar.TableEnd].includes(t)},t.generateStyleProperty=function(t,e,r){var n=e.getStylePropertyFromName(r);if(!n){var o=e.packBuiltinStyleProperty(r);o&&(n=o.styleProp,h.Gh.setSettingProperty(o.stylesProp,p.ModifyType.styles,t))}return n},t.adjustColor=function(t){if(!/(^[0-9A-F]{6}$)|(^[0-9a-f]{6}$)/i.test(t))return t;var e=t.slice(0,2),r=t.slice(2,4),n=t.slice(4,6),o=(0,i.__read)([e,r,n].map((function(t){return function(t){return 255===t?t-Math.round(5*Math.random()):0===t?t+Math.round(5*Math.random()):t}(function(t){return Math.max(Math.min(t,255),0)}((e=t,parseInt(e,16)+Math.round(10*Math.random()-5)))).toString(16).padStart(2,"0");var e})),3),a=o[0],s=o[1],l=o[2];return"".concat(a).concat(s).concat(l)},t.isTableEnd=function(t,e){var r=e.getTableStream().getTableInfo(t);return!!r&&r.range.end()-1===t},t.shouldInsertParaBeforeTable=function(e,r){var n=new zn(r);return!r.isRangeBeginAtParaStart(new p.GCPRange(e,0))||e===n.storyRange().begin()||t.isTableEnd(e-1,r)},t.shouldInsertParaBeforeSdt=function(t,e){var r=new zn(e),n=null==r?void 0:r.getSdtSelection().getHitSdt(new p.GCPRange(t-1,0));return!(!(null==n?void 0:n.property.isBlock)||(null==n?void 0:n.range.end())!==t)},t.defaultCp=-1,t.blod=!0,t}(),Ne=function(t,e){var r=e.getStoryStream().getSubStoryInfoFromGcp(t.gcpBegin);if(!r)throw Error("invalid gcp range for list operation");return t.end()>r.range.end()?r.range.intersectRange(t):t},Oe=function(t,e){var r=[];return h.Yy.splitCellRange(e.getTableStream(),t,(function(t){var n=e.getTextStream().createParagraphIterator(t),o=e.getTextStream().createRunIterator();do{var i=n.getRange();o.seek(i.end()-1);var a=e.getTextStream().readText(i.begin(),1);a&&!Be.isTableSeperate(a)&&r.push(i)}while(n.next());return!0})),r},ke=function(t){return t.reduce((function(t,e){return[Math.min(t[0],e.listLevel),Math.max(t[1],e.listLevel)]}),[Number.POSITIVE_INFINITY,-1])},Ge=function(t,e){return Math.max(0,Math.min(t,e-1))},He=function(t,e,r){if(r===p.ListType.Task)return 1;var n=ve(t,e);return n&&n.length?n[n.length-1].ilvl+1:p.Defaults.listLevelLimit},We=function(t,e){return t===p.ListType.Numbered?e?Re.NumberLevelDecimal:Re.NumberDecimal:t===p.ListType.Bullet?Re.BulletCircle:Re.TaskList},Ue=function(){function t(){}return t.init=function(){this.initListOrderParserMap(),this.initListMarkStyleSetMap(_e),this.initAvailableListCharacterConfig(),this.initListDelimiterMap()},t.getListMatchInfo=function(t){if(!(t.length<2))return this.checkIsMultiLevel(t)?this.getMultiLevelListMatchInfo(t):this.getSingleLevelListMatchInfo(t)},t.getListOrderForSingleLevelFromMatchInfo=function(t){if(!t.isMultiLevelRecognize){var e=t.listMatchInfos.map((function(t){return t.order}));return(0,i.__spreadArray)([],(0,i.__read)(new Set(e)),!1)}},t.getListStylesFromMatchInfo=function(t,e){var r;if(!t.isMultiLevelRecognize)return e&&t.listMatchInfos.some((function(t){return t.listStyles===Re.NumberLevelDecimal}))?Re.NumberLevelDecimal:null===(r=t.listMatchInfos.find((function(t){return t.possibleLevels.includes(0)})))||void 0===r?void 0:r.listStyles},t.initListOrderParserMap=function(){this.listOrderParserMap.set(p.STNumberFormat.decimal,u.vg),this.listOrderParserMap.set(p.STNumberFormat.lowerLetter,u.xi),this.listOrderParserMap.set(p.STNumberFormat.upperLetter,u.vJ),this.listOrderParserMap.set(p.STNumberFormat.lowerRoman,u.V_),this.listOrderParserMap.set(p.STNumberFormat.upperRoman,u.Lz),this.listOrderParserMap.set(p.STNumberFormat.chineseCountingThousand,u.j9)},t.initListMarkStyleSetMap=function(t){var e=this;t.forEach((function(t){t.forEach((function(r){var n=r.listFormat,o=r.listText,i=e.getListMarkInfoFromListText(o);if(i){var a=i.prefix,s=i.suffix,l="".concat(n,"_").concat(a,"_").concat(s);e.listMarkStyleSetMap.has(l)?e.listMarkStyleSetMap.get(l).add(t):e.listMarkStyleSetMap.set(l,new Set([t]))}}))}))},t.initAvailableListCharacterConfig=function(){this.initCharacterConfig("0123456789",p.STNumberFormat.decimal),this.initCharacterConfig("abcdefghijklmnopqrstuvwxyz",p.STNumberFormat.lowerLetter),this.initCharacterConfig("ABCDEFGHIJKLMNOPQRSTUVWXYZ",p.STNumberFormat.upperLetter),this.initCharacterConfig("ivx",p.STNumberFormat.lowerRoman),this.initCharacterConfig("IVX",p.STNumberFormat.upperRoman),this.initCharacterConfig("一二三四五六七八九十",p.STNumberFormat.chineseCountingThousand)},t.initListDelimiterMap=function(){var t=this;we.forEach((function(e){var r=e.prefix,n=e.suffix;t.listDelimiterMap.has(r)?t.listDelimiterMap.get(r).push(n):t.listDelimiterMap.set(r,[n])}))},t.getSingleLevelListMatchInfo=function(t){var e=this,r=[],n="",o=t.trimStart(),a="",s=(0,i.__read)(o,2),l=s[0],p=s[1],c=this.listCharacterConfigMap.get(l);if(c||(n=l,o=o.slice(1),c=this.listCharacterConfigMap.get(p)),c)return c.forEach((function(t){var s,l,p,c,u=t.format,g=t.matchRegExpList;try{for(var h=(0,i.__values)(g),d=h.next();!d.done;d=h.next()){var y=d.value,f=o.match(y);if(f){var v=(0,i.__read)(f,2),m=v[0],P=v[1],T=f[f.length-2];a="".concat(n).concat(m);var S="".concat(u,"_").concat(n,"_").concat(T),C=e.listMarkStyleSetMap.get(S),b=e.getListOrder(u,P);if(C&&"number"==typeof b)try{for(var R=(p=void 0,(0,i.__values)(C.values())),_=R.next();!_.done;_=R.next()){var w=_.value,x=e.getPossibleLevels(u,n,T,w);r.push({listStyles:w,possibleLevels:x,order:b})}}catch(t){p={error:t}}finally{try{_&&!_.done&&(c=R.return)&&c.call(R)}finally{if(p)throw p.error}}}}}catch(t){s={error:t}}finally{try{d&&!d.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}})),{isMultiLevelRecognize:!1,fullText:a,listMatchInfos:r}},t.getMultiLevelListMatchInfo=function(t){var e=this,r=t.match(De),n=(0,i.__read)(r,2),o=n[0],a=n[1],s=[];return a.slice(0,-1).split(".").forEach((function(t,r){var n=e.getListOrder(p.STNumberFormat.decimal,t);"number"==typeof n&&s.push({order:n,level:r})})),{listStyles:Re.NumberLevelDecimal,fullText:o,isMultiLevelRecognize:!0,orderAndLevel:s}},t.getPossibleLevels=function(t,e,r,n){var o=this,i=[];return n.forEach((function(n,a){var s=n.listFormat,l=n.listText,p=o.getListMarkInfoFromListText(l);if(p){var c=p.prefix,u=p.suffix;e===c&&r===u&&t===s&&i.push(a)}})),i},t.initCharacterConfig=function(t,e){var r=this,n={format:e,matchRegExpList:Ie[e]};t.split("").forEach((function(t){r.listCharacterConfigMap.has(t)?r.listCharacterConfigMap.get(t).push(n):r.listCharacterConfigMap.set(t,[n])}))},t.checkIsMultiLevel=function(t){return De.test(t)},t.getListOrder=function(t,e){var r=this.listOrderParserMap.get(t);return null==r?void 0:r(e)},t.getListMarkInfoFromListText=function(t){if(!/(%\d\.){2,}/.test(t)){var e="",r=(0,i.__read)(t,1)[0];return"%"!==r&&(e=r),{prefix:e,suffix:t[t.length-1]}}},t.listDelimiterMap=new Map,t.listOrderParserMap=new Map,t.listCharacterConfigMap=new Map,t.listMarkStyleSetMap=new Map,t}(),Ve=0;function ze(t){var e=t.listId,r=t.listDeltaHandler,n=t.contextRanges,o=t.listIdsNeedAutoAdjust,a=t.delta,s=t.extraAdjustRangeMap;o.add(e);var l=s.get(e)||[];l.push.apply(l,(0,i.__spreadArray)([],(0,i.__read)(n),!1)),s.set(e,l),r.setListPropsInRanges(e,n.map((function(t){return{range:t,level:Ve}})),a)}function Ke(t){var e,r,n=t.listDeltaHandler,o=t.contextRanges,a=t.listIdsNeedAutoAdjust,s=t.delta,l=t.extraAdjustRangeMap,c=null!==(r=null===(e=t.editorDocument.getListInfoFromGcpRange(o[0]))||void 0===e?void 0:e.listType)&&void 0!==r?r:p.ListType.Numbered,u=n.setListWithCreateInfo(o[0],{listType:c,listId:null,level:Ve},!0,s).listId;o.slice(1).forEach((function(t){return n.setListWithCreateInfo(t,{listType:c,listId:u,level:Ve},!0,s)})),a.add(u),l.set(u,(0,i.__spreadArray)([],(0,i.__read)(o),!1))}function je(t,e,r,n){var o,a,s=t.context,l=s.service,p=l.getDocument(),c=e.pPr.outlineLvl.val,u=new ne(s,t),g=new mr(t,l),h=new vr(s,t),d=new Map,y=u.splitRangeWhen2Heading(n),f=y.rangesNeedToFindResult,v=y.listIdsNeedAutoAdjust;v.forEach((function(t){return d.set(t,[])}));try{for(var m=(0,i.__values)(f),P=m.next();!P.done;P=m.next()){var T=P.value;if(T.length){var S=h.findWhenSetHeading(T).listId,C={listDeltaHandler:g,listIdsNeedAutoAdjust:v,extraAdjustRangeMap:d,delta:r,contextRanges:T,editorDocument:p};S?ze((0,i.__assign)({listId:S},C)):Ke(C)}}}catch(t){o={error:t}}finally{try{P&&!P.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}!function(t){var e,r,n=t.state,o=t.listDeltaHandler,a=t.listIdsNeedAutoAdjust,s=t.extraAdjustRangeMap,l=t.newOutlineLvl,p=t.range,c=t.delta,u=n.context.service,g=n.dataEngine.getDataManager().getNumberingManager(),h=n.dataEngine.getDataStream().getTextStream().createParagraphIterator();try{for(var d=(0,i.__values)(a),y=d.next();!y.done;y=d.next()){var f=y.value,v=g.getWholeListByListId(f).filter((function(t){return!t.isVirtual})),m=s.get(f)||[],P=v.map((function(t){var e=t.gcp;h.seek(e-1);var r=h.getRange();return{position:e-1,outlineLevel:r.intersect(p)?l:kt(u,r)}})),T=m.map((function(t){return{position:t.begin(),outlineLevel:l}})),S=Wt((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(P),!1),(0,i.__read)(T),!1),n,u).diffListParas;o.setListPropsInRanges(f,S,c)}}catch(t){e={error:t}}finally{try{y&&!y.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}}({state:t,listIdsNeedAutoAdjust:v,extraAdjustRangeMap:d,newOutlineLvl:c,listDeltaHandler:g,range:n,delta:r})}function Ye(t){var e=t.editorDocument,r=t.listId,n=t.listDeltaHandler,o=t.contextRanges,i=t.delta,a=t.extraAdjustRangeMap;o.forEach((function(t){var r,n=null===(r=e.getListInfoFromGcpRange(t))||void 0===r?void 0:r.listId;if(n){var o=a.get(n)||[];o.push(t),a.set(n,o)}})),n.setListPropsInRanges(r,o.map((function(t){return{range:t,level:Ve}})),i)}function qe(t){var e,r,n=t.editorDocument,o=t.listDeltaHandler,a=t.contextRanges,s=t.delta,l=t.extraAdjustRangeMap,c=null!==(r=null===(e=n.getListInfoFromGcpRange(a[0]))||void 0===e?void 0:e.listType)&&void 0!==r?r:p.ListType.Numbered,u=o.setListWithCreateInfo(a[0],{listType:c,listId:null,level:Ve},!1,s).listId;a.slice(1).forEach((function(t){return o.setListWithCreateInfo(t,{listType:c,listId:u,level:Ve},!1,s)})),l.forEach((function(t){return t.push.apply(t,(0,i.__spreadArray)([],(0,i.__read)(a),!1))}))}function Qe(t,e,r){var n,o,a=t.context,s=a.service,l=s.getDocument(),p=new ne(a,t),c=new mr(t,s),u=new vr(a,t),g=new Map,h=p.splitRangeWhen2Normal(r),d=h.rangesNeedToFindResult,y=h.listIdsNeedAutoAdjust;y.forEach((function(t){return g.set(t,[])}));try{for(var f=(0,i.__values)(d),v=f.next();!v.done;v=f.next()){var m=v.value;if(m.length){var P=u.findWhenSetNormal(m).listId,T={listDeltaHandler:c,listIdsNeedAutoAdjust:y,extraAdjustRangeMap:g,delta:e,contextRanges:m,editorDocument:l};P?Ye((0,i.__assign)((0,i.__assign)({},T),{listId:P})):qe(T)}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(o=f.return)&&o.call(f)}finally{if(n)throw n.error}}!function(t){var e,r,n,o,a=t.state,s=t.listDeltaHandler,l=t.listIdsNeedAutoAdjust,p=t.extraAdjustRangeMap,c=t.delta,u=a.context,g=a.dataEngine.getDataStream().getTextStream().createParagraphIterator(),h=a.dataEngine.getDataManager().getNumberingManager();try{for(var d=(0,i.__values)(l),y=d.next();!y.done;y=d.next()){var f=y.value,v=h.getWholeListByListId(f).filter((function(t){return!t.isVirtual})).map((function(t){return g.seek(t.gcp-1),g.getRange()})),m=p.get(f),P=[],T=function(t){m.some((function(e){return e.intersect(t)}))||P.push(t)};try{for(var S=(n=void 0,(0,i.__values)(v)),C=S.next();!C.done;C=S.next())T(C.value)}catch(t){n={error:t}}finally{try{C&&!C.done&&(o=S.return)&&o.call(S)}finally{if(n)throw n.error}}var b=Wt(P.map((function(t){return{position:t.gcpBegin}})),a,u.service).diffListParas;s.setListPropsInRanges(f,b,c)}}catch(t){e={error:t}}finally{try{y&&!y.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}}({state:t,listIdsNeedAutoAdjust:y,extraAdjustRangeMap:g,listDeltaHandler:c,delta:e})}function Xe(t,e,r,n){if(e.pPr.outlineLvl.val<p.STOutlineLvl.LevelNone)return je(t,e,r,n);Qe(t,r,n)}function Je(t,e,r,n){if(n)return n.forEach((function(n){return Xe(t,e,r,n)}));var o=r.globalOpts.originRange;Xe(t,e,r,o)}var Ze=function(t,e,r,n){var o,a,s,l;if(t.isValid()&&n){var c=e.context.service,u=e.dataEngine.getDataStream().getTextStream().createParagraphIterator(),g=new mr(e,c),h=e.dataEngine.getDataManager().getNumberingManager(),d=h.getListInfoArrayFromGcpRange(t);d=d.filter((function(e){var r=e.gcp;return u.seek(r-1),t.contains(u.getRange())}));var y=d.filter((function(t){var e=t.outlineLvl;return!t.isVirtual&&e.val<p.STOutlineLvl.LevelNone})),f=new Map;y.forEach((function(t){var e=t.listId,r=t.gcp;u.seek(r-1);var n=u.getRange(),o=f.get(e)||[];o.push(n),f.set(e,o)}));try{for(var v=(0,i.__values)(f),m=v.next();!m.done;m=v.next()){var P=(0,i.__read)(m.value,2),T=P[0],S=P[1],C=h.getWholeListByListId(T).filter((function(t){return!t.isVirtual})).map((function(t){return u.seek(t.gcp-1),u.getRange()})),b=[],R=function(t){S.some((function(e){return e.intersect(t)}))||b.push(t)};try{for(var _=(s=void 0,(0,i.__values)(C)),w=_.next();!w.done;w=_.next())R(w.value)}catch(t){s={error:t}}finally{try{w&&!w.done&&(l=_.return)&&l.call(_)}finally{if(s)throw s.error}}var x=Wt(b.map((function(t){return{position:t.gcpBegin}})),e,c).diffListParas;g.setListPropsInRanges(T,x,r)}}catch(t){o={error:t}}finally{try{m&&!m.done&&(a=v.return)&&a.call(v)}finally{if(o)throw o.error}}}};function $e(t,e,r){var n,o,a,s,l=e.context.service,p=e.dataEngine.getDataManager().getNumberingManager(),c=new mr(e,l),u=new Map,g=e.dataEngine.getDataStream().getTextStream().createParagraphIterator();g.setLimitRange(t);do{var h=g.getRange(),d=Vt(l,h),y=p.getListInfoFromGcpRange(h);d&&y&&((S=u.get(y.listId)||[]).push(h),u.set(y.listId,S))}while(g.next());var f=e.dataEngine.getDataStream().getTextStream().createParagraphIterator();try{for(var v=(0,i.__values)(u),m=v.next();!m.done;m=v.next()){var P=(0,i.__read)(m.value,2),T=P[0],S=P[1],C=p.getWholeListByListId(T).filter((function(t){return!t.isVirtual})).map((function(t){return f.seek(t.gcp-1),f.getRange()})),b=[],R=function(t){S.some((function(e){return e.intersect(t)}))||b.push(t)};try{for(var _=(a=void 0,(0,i.__values)(C)),w=_.next();!w.done;w=_.next())R(w.value)}catch(t){a={error:t}}finally{try{w&&!w.done&&(s=_.return)&&s.call(_)}finally{if(a)throw a.error}}var x=Wt(b.map((function(t){return{position:t.gcpBegin}})),e,l).diffListParas;c.setListPropsInRanges(T,x,r)}}catch(t){n={error:t}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}}function tr(t,e,r,n,o){o?$e(t,e,r):($e(t,e,r),function(t,e,r,n){var o=r.context.service,i=r.dataEngine.getDataManager().getNumberingManager();if(i.isListParagraph(t)){var a=r.dataEngine.getDataManager().getStyleSheetManager();r.dataEngine.getDataStream().getTextStream().createParagraphIterator().setLimitRange(e);var s=t.numPr.numId.val,l=i.getListTypeByListId(s),p=t.numPr.ilvl,c=o.getNumbering().getListStyleset(s),u=new mr(r,o),g=zt(a,t),h=Oe(e,r.dataEngine.getDataStream()),d=u.setListWithCreateInfo(h[0],{listType:l,listId:null,level:p.val,listStyles:c},g,n);h.slice(1).forEach((function(t){return u.setListWithCreateInfo(t,{listType:l,listId:d.listId,level:p.val,listStyles:c},g,n)}))}}(n,t,e,r))}var er=r(229808),rr=r.n(er),nr=function(){function t(t,e){this.editor=t,this.state=e}return Object.defineProperty(t.prototype,"numbering",{get:function(){return this.editor.service.getNumbering()},enumerable:!1,configurable:!0}),t.prototype.findRecognizeFlow=function(t,e){var r=function(t,e){return{level:0,listId:null,paragraphIndent:Gt(e,t),text:e.getDataStream().getTextStream().readText(t.begin(),t.length())}}(t.range,this.state);if(se(t,!0)){var n=e.findRecognizeNext(t);return{isNumbering:!0,findResult:e.isFoundResultValid(n)?n:r}}var o=e.findRecognizePrev(t);if(e.isFoundResultValid(o))return{isNumbering:!0,findResult:o};var i=e.findRecognizeNext(t);return e.isFoundResultValid(i)?{isNumbering:!0,findResult:i}:se(t,!1)?{isNumbering:!0,findResult:r}:{isNumbering:!1,findResult:r}},t}(),or=function(){function t(t,e){var r=this;this.firstLevelChecker=function(t,e){var r=e.listType,n=e.outlineLvl,o=t,i=o.listType,a=o.listLevel,s=o.outlineLvl,l=void 0===n||n>=s.val;return i===r&&0===a&&l},this.otherLevelChecker=function(t,e){var n=e.listType,o=e.listStyles,i=t,a=i.listType,s=i.listId;return a===n&&$t(r.numbering.getListStyleset(s),o)},this.editor=t,this.state=e}return t.prototype.isFoundResultValid=function(t){var e=t.listId;return null!==e&&""!==e},t.prototype.createNotFoundResult=function(){return{level:0,listId:null,paragraphIndent:null,text:""}},Object.defineProperty(t.prototype,"numbering",{get:function(){return this.editor.service.getNumbering()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textStream",{get:function(){return this.state.getDataStream().getTextStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storyStream",{get:function(){return this.state.getDataStream().getStoryStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawingStream",{get:function(){return this.state.getDataStream().getDrawingStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getDataStream().getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"editorDocument",{get:function(){return this.editor.service.getDocument()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styleSheetManager",{get:function(){return this.state.dataEngine.getDataManager().getStyleSheetManager()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numberingManager",{get:function(){return this.state.dataEngine.getDataManager().getNumberingManager()},enumerable:!1,configurable:!0}),t.prototype.getParagraphIndent=function(t){return null===t?null:this.styleSheetManager.mergeStyleParagraphProperty(t).ind},t.prototype.checkEdge=function(t,e){return e?t.hasPrev():t.hasNext()},t.prototype.stepIter=function(t,e){return!!this.checkEdge(t,e)&&(e?t.prev():t.next())},t.prototype.shouldJumpTable=function(t,e,r){if(Qt(this.editor,this.state,e,[r?p.PlaceholderCharCode.TableEnd:p.PlaceholderCharCode.TableStart])){var n=this.tableStream.getTableInfo(e.gcpBegin);if(n){var o=n.range.gcpBegin;return t.seek(r?o:n.range.end()-1),!0}}return!1},t.prototype.shouldBreakTable=function(t,e){return Qt(this.editor,this.state,t,[p.PlaceholderCharCode.TableCellBreak,p.PlaceholderCharCode.TableRowBreak,e?p.PlaceholderCharCode.TableStart:p.PlaceholderCharCode.TableEnd])},t.prototype.decideRecognize=function(t){var e=t.findRecognizeParams;return e.matchInfo.isMultiLevelRecognize?this.decideRecognizeForMulti((0,i.__assign)((0,i.__assign)({},t),{findRecognizeParams:e})):this.decideRecognizeForSingle((0,i.__assign)((0,i.__assign)({},t),{findRecognizeParams:e}))},t.prototype.decideRecognizeForMulti=function(t){var e=t.findRecognizeParams,r=t.findListInfo,n=t.isPrev,o=t.isHeading,i=e.matchInfo,a=i.orderAndLevel,s=i.listStyles,l=r.listId;if(!$t(s,this.numbering.getListStyleset(l)))return this.createNotFoundResult();a.sort((function(t,e){return e.level-t.level}));for(var p=r,c=0;c<a.length;c++){var u=a[c],g=u.order,h=u.level;if(!p)return this.createNotFoundResult();var d=ge(g,le(p),n,0!==c);if(!ce({recognizeRange:e.range,recognizeLevel:h,findListInfo:p,editor:this.editor,isHeading:o,isMultiMaxLevelMatch:0===c})||!d)return this.createNotFoundResult();p=p.parent}return this.getRecognizeMatchResult(r)},t.prototype.decideRecognizeForSingle=function(t){var e,r,n=t.findRecognizeParams,o=t.findListInfo,a=t.isPrev,s=t.isHeading,l=n.matchInfo.listMatchInfos,p=this.numbering.getListStyleset(o.listId),c=l.filter((function(t){return $t(t.listStyles,p)}));if(!c.length)return this.createNotFoundResult();try{for(var u=(0,i.__values)(c),g=u.next();!g.done;g=u.next()){var h=g.value,d=c[0].order,y={findListInfo:o,recognizeRange:n.range,listMatchInfo:h,isHeading:s,isPrev:a},f=0===d?this.decideRecognizeForSingleWhenStartOrder(y):this.decideRecognizeForSingleWhenNotStartOrder(y);if(this.isFoundResultValid(f))return f}}catch(t){e={error:t}}finally{try{g&&!g.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return this.createNotFoundResult()},t.prototype.decideRecognizeForSingleWhenStartOrder=function(t){return function(t){var e=t.findListInfo,r=t.isPrev,n=le(e);return!r&&1===n&&ue(t)}((0,i.__assign)((0,i.__assign)({},t),{editor:this.editor}))?this.getRecognizeMatchResult(t.findListInfo):this.createNotFoundResult()},t.prototype.decideRecognizeForSingleWhenNotStartOrder=function(t){var e=t.findListInfo,r=t.listMatchInfo,n=t.isPrev,o=le(e);return ge(r.order,o,n)&&ue((0,i.__assign)((0,i.__assign)({},t),{editor:this.editor}))?this.getRecognizeMatchResult(e):this.createNotFoundResult()},t.prototype.decideRecognizeInParentChain=function(t){for(var e=t.findListInfo,r=t.isPrev,n=this.getNextInParentChain(e,r);n;){var o=this.decideRecognize((0,i.__assign)((0,i.__assign)({},t),{findListInfo:n}));if(this.isFoundResultValid(o))return o;n=this.getNextInParentChain(n,r)}return this.createNotFoundResult()},t.prototype.getNextInParentChain=function(t,e){var r=this.state.dataEngine.getDataManager().getNumberingManager();return e?t.parent:function(t,e){var r=t.listId,n=t.listLevel,o=t.order,i=e.getWholeListByListId(r);if(0===n)return null;var a=i.filter((function(t){return t.listLevel===n-1&&t.order===o+1}));return a.length?a[0]:null}(t,r)},t.prototype.getRecognizeMatchResult=function(t){var e=this,r=e.state;return pe({listInfo:t,textStream:e.textStream,editor:e.editor,state:r})},t}(),ir=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findForceWithFirstLevel=function(t){return this.findFlow(t,this.firstLevelChecker)},e.prototype.findForceWithOtherLevel=function(t){return this.findFlow(t,this.otherLevelChecker)},e.prototype.findFlow=function(t,e){var r=t.range,n=t.listType,o=t.listStyles,i=t.listLevel,a=this.storyStream.getSubStoryInfoFromGcp(r.gcpBegin);if(!a)return this.createNotFoundResult();var s=this.textStream.createParagraphIterator(a.contentRange);s.seek(r.gcpBegin);var l=kt(this.editor.service,s.getRange());if(!s.hasPrev())return this.createNotFoundResult();for(;s.prev();){var p=s.getRange();if(p.gcpBegin<a.contentRange.gcpBegin||!p.isValid())return this.createNotFoundResult();if(this.shouldBreakTable(p,!0))return this.createNotFoundResult();if(!this.shouldJumpTable(s,p,!0)&&Vt(this.editor.service,p)){var c=this.editorDocument.getListInfoFromGcpRange(p);if(c&&e(c,{listType:n,listStyles:o,outlineLvl:l}))return{level:i,listId:c.listId,paragraphIndent:this.getParagraphIndent(s.getProperty()),text:this.textStream.readText(p.begin(),p.length())}}}return this.createNotFoundResult()},e}(or),ar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findAutoPrev=function(t){return this.findFlow(t,!0)},e.prototype.findAutoNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=t.listStyles,n=t.listType,o=t.selectionRange,i=t.range,a=this.editor,s=this.createNotFoundResult(),l=this.storyStream.getSubStoryInfoFromGcp(i.gcpBegin);if(!l)return s;var p=this.textStream.createParagraphIterator(l.contentRange);if(p.seek(i.gcpBegin),!this.checkEdge(p,e))return s;this.stepIter(p,e);do{var c=p.getRange();if(!c.isValid())return this.createNotFoundResult();if(this.shouldBreakTable(c,e))return this.createNotFoundResult();if(!this.shouldJumpTable(p,c,e)&&Vt(a.service,c)){var u=this.editorDocument.getListInfoFromGcpRange(c);if(u&&!o.contains(c))return this.otherLevelChecker(u,{listType:n,listStyles:r})?{level:0,listId:u.listId,paragraphIndent:this.getParagraphIndent(p.getProperty()),text:this.textStream.readText(c.begin(),c.length())}:s}}while(this.stepIter(p,e));return s},e}(or),sr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findRecognizePrev=function(t){return this.findFlow(t,!0)},e.prototype.findRecognizeNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=t.range,n=this.createNotFoundResult(),o=this.storyStream.getSubStoryInfoFromGcp(r.gcpBegin);if(!o)return n;var i=this.textStream.createParagraphIterator(o.contentRange);if(i.seek(r.gcpBegin),!this.checkEdge(i,e))return n;this.stepIter(i,e);do{var a=i.getRange();if(!a.isValid())return n;if(this.shouldBreakTable(a,!1))return n;if(!this.shouldJumpTable(i,a,!1)&&Vt(this.editor.service,a)){var s=this.editorDocument.getListInfoFromGcpRange(a);if(s){var l={findListInfo:s,findRecognizeParams:t,isPrev:e,isHeading:!0},p=this.decideRecognize(l);return this.isFoundResultValid(p)||0===s.listLevel?p:this.decideRecognizeInParentChain(l)}}}while(this.stepIter(i,e));return n},e}(or),lr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findSetStylePrev=function(t){return this.findFlow(t,!0)},e.prototype.findSetStyleNext=function(t){return this.findFlow(t,!1)},e.prototype.findSetHeading=function(t){var e=this.findSetStylePrev(t[0]);if(this.isFoundResultValid(e))return e;var r=t[t.length-1],n=this.findSetStyleNext(r);if(this.isFoundResultValid(n))return n;var o=r.clone();if(!Vt(this.editor.service,o)){var i=this.editorDocument.getListInfoFromGcpRange(o);if(!i)return this.createNotFoundResult();var a=this.storyStream.getSubStoryInfoFromGcp(o.gcpBegin);if(!a)return this.createNotFoundResult();var s=this.textStream.createParagraphIterator(a.contentRange);return s.seek(o.gcpBegin),{listId:i.listId,paragraphIndent:this.getParagraphIndent(s.getProperty()),text:"setHeading from shorcutmenu"}}return this.createNotFoundResult()},e.prototype.findFlow=function(t,e){var r=this.createNotFoundResult(),n=this.storyStream.getSubStoryInfoFromGcp(t.gcpBegin);if(!n)return r;var o=this.textStream.createParagraphIterator(n.contentRange);if(o.seek(t.gcpBegin),!this.checkEdge(o,e))return r;for(var i=this.editorDocument.getListInfoFromGcpRange(t);this.stepIter(o,e);){var a=o.getRange();if(a.gcpBegin<n.contentRange.gcpBegin||!a.isValid())return r;if(this.shouldBreakTable(a,e))return r;if(!this.shouldJumpTable(o,a,e)&&Vt(this.editor.service,a)){var s=this.editorDocument.getListInfoFromGcpRange(a);if(s)return(null==i?void 0:i.listType)!==s.listType?r:{listId:s.listId,paragraphIndent:this.getParagraphIndent(o.getProperty()),text:this.textStream.readText(a.begin(),a.length())}}}return r},e}(or),pr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findPastePrev=function(t){var e=this.findPastePrevInPasteData(t);return this.isFoundResultValid(e)||e.skipFindPrev?e:this.findPastePrevInDoc(t)},e.prototype.findPasteNext=function(t){var e=t.paraIter,r=t.outlineLevel,n=t.pastePosition,o=t.listTemplate,a=t.paraProp;e.seek(n);for(var s=this.createNotFoundResult();e.hasNext();){e.next();var l=e.getRange(),p=e.getProperty();if(!l.isValid()||!p)return s;if(zt(this.styleSheetManager,p)&&Yt(p)){var c=ve(p.numPr.numId.val,this.numberingManager),u=this.editor.service.getSelection().getFirstListInfoInSelection(l);return c&&u&&r===u.outlineLvl.val&&te(p,a,c,o)?(0,i.__assign)((0,i.__assign)({},s),{listId:u.listId,level:u.listLevel}):s}}return s},e.prototype.findPastePrevInPasteData=function(t){for(var e=t.listTemplate,r=t.paraProp,n=t.outlineLevel,o=t.cachePasteData,a=this.createNotFoundResult(),s=o.length-1;s>=0;s--){var l=o[s],c=l.pasteParaInfo,u=c.outlineLevel,g=c.paraProp,h=l.pasteListInfo;if(u!==p.STOutlineLvl.LevelNone&&h){var d=h.listId,y=h.level;return te(g,r,h.listTemplate,e)?n===u?{listId:d,level:y,paragraphIndent:this.getParagraphIndent(g),text:""}:n>u?{listId:d,level:y+1,paragraphIndent:this.getParagraphIndent(g),text:""}:(0,i.__assign)((0,i.__assign)({},a),{skipFindPrev:!0}):(0,i.__assign)((0,i.__assign)({},a),{skipFindPrev:!0})}}return a},e.prototype.findPastePrevInDoc=function(t){var e=t.paraIter,r=t.pastePosition,n=t.listTemplate,o=t.paraProp,a=t.outlineLevel;e.seek(r);var s=this.createNotFoundResult();do{var l=e.getRange(),p=e.getProperty();if(!l.isValid()||!p)return s;if(Qt(this.editor,this.state,l))return s;if(zt(this.styleSheetManager,p)&&Yt(p)){var c=ve(p.numPr.numId.val,this.numberingManager),u=this.editor.service.getSelection().getFirstListInfoInSelection(l);if(c&&u){var g=u;if(!te(p,o,c,n))return s;for(;g;){var h=g.outlineLvl;if(h.val===a)return(0,i.__assign)((0,i.__assign)({},s),{listId:g.listId,level:g.listLevel,paragraphIndent:this.getParagraphIndent(o)});if(h.val<a)return(0,i.__assign)((0,i.__assign)({},s),{listId:g.listId,level:g.listLevel+1,paragraphIndent:this.getParagraphIndent(o)});g=g.parent}}}}while(e.prev());return s},e}(or),cr=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.headingForceHandler=new ir(e,r),n.headingAutoHandler=new ar(e,r),n.headingRecognizeHandler=new sr(e,r),n.headingSetStyleHandler=new lr(e,r),n.headingPasteHandler=new pr(e,r),n}return(0,i.__extends)(e,t),e.prototype.findAuto=function(t){var e=t.groupRanges,r=t.listStyles,n=t.listType,o=t.selectionRange,i=this.headingAutoHandler.findAutoPrev({selectionRange:o,listStyles:r,listType:n,range:e[0]}),a=function(t){return e.map((function(e){return{range:e,findResult:rr()(t)}}))};return this.headingAutoHandler.isFoundResultValid(i)?{headingNumberingGroup:a(i)}:{headingNumberingGroup:a(this.headingAutoHandler.findAutoNext({selectionRange:o,listStyles:r,listType:n,range:e[e.length-1]}))}},e.prototype.findForce=function(t){return 0===t.listLevel?this.headingForceHandler.findForceWithFirstLevel(t):this.headingForceHandler.findForceWithOtherLevel(t)},e.prototype.findRecognize=function(t){return this.findRecognizeFlow(t,this.headingRecognizeHandler)},e.prototype.findSetHeading=function(t){return this.headingSetStyleHandler.findSetHeading(t)},e.prototype.findPaste=function(t){var e=this.headingPasteHandler.findPastePrev(t);return this.headingPasteHandler.isFoundResultValid(e)?e:this.headingPasteHandler.findPasteNext(t)},e}(nr),ur=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findForceWithFirstLevel=function(t){return this.findFlow(t,this.firstLevelChecker)},e.prototype.findForceWithOtherLevel=function(t){return this.findFlow(t,this.otherLevelChecker)},e.prototype.findFlow=function(t,e){var r=t.range,n=t.listType,o=t.listStyles,i=t.listLevel,a=this.storyStream.getSubStoryInfoFromGcp(r.gcpBegin);if(!a)return this.createNotFoundResult();var s={findRange:a.contentRange,iterStart:r.gcpBegin,listType:n,listStyles:o,listLevel:i,listInfoChecker:e};return this.doFindInStory(s)},e.prototype.doFindInStory=function(t){var e=t.findRange,r=t.iterStart,n=t.listType,o=t.listStyles,i=t.listLevel,a=t.listInfoChecker,s=this.textStream.createParagraphIterator(e);if(s.seek(r),!s.hasPrev())return this.createNotFoundResult();s.prev();do{var l=s.getRange();if(l.gcpBegin<e.gcpBegin||!l.isValid())return this.createNotFoundResult();if(!Vt(this.editor.service,l)){var p=this.editorDocument.getListInfoFromGcpRange(l);if(p&&a(p,{listType:n,listStyles:o}))return{level:i,listId:p.listId,paragraphIndent:this.getParagraphIndent(s.getProperty()),text:this.textStream.readText(l.begin(),l.length())}}}while(s.prev());return this.createNotFoundResult()},e}(or),gr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findAutoPrev=function(t){return this.findFlow(t,!0)},e.prototype.findAutoNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=t.listStyles,n=t.listType,o=t.range,i=t.selectionRange,a=this.editor,s=this.state,l=this.createNotFoundResult(),p=this.storyStream.getSubStoryInfoFromGcp(o.gcpBegin);if(!p)return l;var c=this.textStream.createParagraphIterator(p.contentRange);if(c.seek(o.gcpBegin),!this.checkEdge(c,e))return l;var u=Zt(a,s,o);this.stepIter(c,e);do{var g=c.getRange();if(!g.isValid())return l;if(Vt(a.service,g)||Qt(a,s,g))return l;if(u!==Zt(a,s,g))return l;var h=this.editorDocument.getListInfoFromGcpRange(g),d=this.editorDocument.isParaEmpty(g.gcpBegin);if(!h){if(d)continue;return l}return!this.otherLevelChecker(h,{listType:n,listStyles:r})||i.contains(g)?l:{listId:h.listId,paragraphIndent:this.getParagraphIndent(c.getProperty()),text:this.textStream.readText(g.begin(),g.length())}}while(this.stepIter(c,e));return l},e}(or),hr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findRecognizePrev=function(t){return this.findFlow(t,!0)},e.prototype.findRecognizeNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=t.range,n=this.editor,o=this.state,i=this.createNotFoundResult(),a=this.storyStream.getSubStoryInfoFromGcp(r.gcpBegin);if(!a)return i;var s=this.textStream.createParagraphIterator(a.contentRange);if(s.seek(r.gcpBegin),!this.checkEdge(s,e))return i;var l=Zt(n,o,r);this.stepIter(s,e);do{var p=s.getRange();if(!p.isValid())return i;if(Vt(n.service,p))return i;if(this.shouldBreakTable(p,!1))return i;if(!this.shouldJumpTable(s,p,!1)){var c=Zt(n,o,p);if(l&&!c)return i;if(l||!c){var u=this.editorDocument.getListInfoFromGcpRange(p);if(u){var g={findListInfo:u,findRecognizeParams:t,isPrev:e,isHeading:!1},h=this.decideRecognize(g);return this.isFoundResultValid(h)||0===u.listLevel?h:this.decideRecognizeInParentChain(g)}}}}while(this.stepIter(s,e));return i},e}(or),dr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.findSetStylePrev=function(t){return this.findFlow(t,!0)},e.prototype.findSetStyleNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=this.editor,n=this.state,o=this.createNotFoundResult(),i=this.storyStream.getSubStoryInfoFromGcp(t.gcpBegin);if(!i)return o;var a=this.textStream.createParagraphIterator(i.contentRange);if(a.seek(t.gcpBegin),!this.checkEdge(a,e))return o;var s=Zt(r,n,t);this.stepIter(a,e);var l=this.editorDocument.getListInfoFromGcpRange(t);do{var p=a.getRange();if(!p.isValid()||Vt(r.service,p)||Qt(r,n,p))return o;if(s!==Zt(r,n,p))return o;var c=this.editorDocument.getListInfoFromGcpRange(p),u=this.editorDocument.isParaEmpty(p.gcpBegin);if(!c){if(u)continue;return o}return(null==l?void 0:l.listType)!==c.listType?o:{listId:c.listId,paragraphIndent:this.getParagraphIndent(a.getProperty()),text:this.textStream.readText(p.begin(),p.length())}}while(this.stepIter(a,e));return o},e}(or),yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.isFoundResultValid=function(t){var e=t.listId,r=t.level;return null!==e&&""!==e||!!r},e.prototype.findPastePrev=function(t){var e=this.findPastePrevInPasteData(t);return this.isFoundResultValid(e)||e.skipFindPrev?e:this.findPastePrevInDoc(t)},e.prototype.findPasteNext=function(t){var e=t.paraIter,r=t.pastePosition,n=t.paraProp,o=t.listTemplate,a=this.createNotFoundResult();for(e.seek(r);e.hasNext();){e.next();var s=e.getRange(),l=e.getProperty();if(!s.isValid()||!l)return a;if(!Yt(l)){if(ee(e.getContentRange(),this.textStream))continue;return a}if(zt(this.styleSheetManager,l))return a;var p=ve(l.numPr.numId.val,this.numberingManager),c=this.editor.service.getSelection().getFirstListInfoInSelection(s);return te(l,n,p,o)&&c?(0,i.__assign)((0,i.__assign)({},a),{listId:c.listId}):a}return a},e.prototype.findPastePrevInPasteData=function(t){for(var e=t.paraProp,r=t.listTemplate,n=t.cachePasteData,o=this.createNotFoundResult(),a=n.length-1;a>=0;a--){var s=n[a],l=s.pasteParaInfo,c=l.isEmptyPara,u=l.outlineLevel,g=l.paraProp,h=s.pasteListInfo;if(!h){if(c)continue;return(0,i.__assign)((0,i.__assign)({},o),{skipFindPrev:!0})}if(u!==p.STOutlineLvl.LevelNone)return(0,i.__assign)((0,i.__assign)({},o),{skipFindPrev:!0});var d=h.listId,y=h.topLevel;return te(g,e,h.listTemplate,r)?(0,i.__assign)((0,i.__assign)({},o),{listId:d,level:y}):(0,i.__assign)((0,i.__assign)({},o),{skipFindPrev:!0})}return o},e.prototype.findPastePrevInDoc=function(t){var e=this.createNotFoundResult(),r=t.paraIter,n=t.pastePosition,o=t.paraProp,i=t.listTemplate;r.seek(n);var a=Yt(r.getProperty());do{var s=r.getRange(),l=r.getProperty(),p=ee(r.getContentRange(),this.textStream);if(!s.isValid()||!l||Qt(this.editor,this.state,s))return e;if(!Yt(l)){if(p)continue;return e}var c=this.editor.service.getSelection().getFirstListInfoInSelection(s);if(!c||zt(this.styleSheetManager,l))return e;var u=te(l,o,ve(l.numPr.numId.val,this.numberingManager),i);return a&&(u?(e.level=c.listLevel,e.listId=c.listId,ye.hasSetIndent(c.listParaInd)&&(e.paragraphIndent=c.listParaInd)):e.level=Ge(c.listLevel,i.length)),u&&(e.listId=c.listId),e}while(r.prev());return e},e}(or),fr=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.normalForceHandler=new ur(e,r),n.normalAutoHandler=new gr(e,r),n.normalRecognizeHandler=new hr(e,r),n.normalSetStyleHandler=new dr(e,r),n.normalPasteHandler=new yr(e,r),n}return(0,i.__extends)(e,t),e.prototype.findAuto=function(t){var e=t.groupRanges,r=t.listStyles,n=t.listType,o=t.selectionRange,i=e[0],a=e[e.length-1],s=this.normalAutoHandler.findAutoPrev({selectionRange:o,range:i,listStyles:r,listType:n});return this.normalAutoHandler.isFoundResultValid(s)?{ranges:e,findResult:s}:{ranges:e,findResult:this.normalAutoHandler.findAutoNext({selectionRange:o,range:a,listStyles:r,listType:n})}},e.prototype.findForce=function(t){return 0===t.listLevel?this.normalForceHandler.findForceWithFirstLevel(t):this.normalForceHandler.findForceWithOtherLevel(t)},e.prototype.findRecognize=function(t){return this.findRecognizeFlow(t,this.normalRecognizeHandler)},e.prototype.findSetHeading=function(t){var e=this.normalSetStyleHandler.findSetStylePrev(t[0]);return this.normalSetStyleHandler.isFoundResultValid(e)?e:this.normalSetStyleHandler.findSetStyleNext(t[t.length-1])},e.prototype.findPaste=function(t){var e=this.normalPasteHandler.findPastePrev(t);return this.normalPasteHandler.isFoundResultValid(e)?e:this.normalPasteHandler.findPasteNext(t)},e}(nr),vr=function(){function t(t,e){this.editor=t,this.state=e,this.headingListFinder=new cr(t,e),this.normalListFinder=new fr(t,e),this.listRangeSpliter=new ae(t,e)}return t.prototype.findAuto=function(t){var e,r,n,o,a=t.range,s=t.listStyles,l=t.listType,p={normal:[],heading:[]},c=this.listRangeSpliter.splitRange(a),u=c.normal,g=c.heading;try{for(var h=(0,i.__values)(u),d=h.next();!d.done;d=h.next())if((m=d.value.ranges).length){var y=this.normalListFinder.findAuto({selectionRange:a,groupRanges:m,listType:l,listStyles:s});p.normal.push(y)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}try{for(var f=(0,i.__values)(g),v=f.next();!v.done;v=f.next()){var m;if((m=v.value.ranges).length){var P=Ut({headingNumberingGroup:this.headingListFinder.findAuto({selectionRange:a,groupRanges:m,listType:l,listStyles:s}).headingNumberingGroup,editor:this.editor,state:this.state});p.heading.push(P)}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(o=f.return)&&o.call(f)}finally{if(n)throw n.error}}return p},t.prototype.findForce=function(t){var e=t.range;return Vt(this.editor.service,e)?this.headingListFinder.findForce(t):this.normalListFinder.findForce(t)},t.prototype.findRecognize=function(t){var e=t.range;return Vt(this.editor.service,e)?this.headingListFinder.findRecognize(t):this.normalListFinder.findRecognize(t)},t.prototype.findPaste=function(t){return t.outlineLevel!==p.STOutlineLvl.LevelNone?this.headingListFinder.findPaste(t):this.normalListFinder.findPaste(t)},t.prototype.findWhenSetHeading=function(t){return this.headingListFinder.findSetHeading(t)},t.prototype.findWhenSetNormal=function(t){return this.normalListFinder.findSetHeading(t)},t}(),mr=function(){function t(t,e){this.state=t,this.service=e}return Object.defineProperty(t.prototype,"dataStream",{get:function(){return this.state.getDataStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.service.getSelection()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numberingManager",{get:function(){return this.state.dataEngine.getDataManager().getNumberingManager()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"revisionNumberingManager",{get:function(){return this.state.dataEngine.getDataManager().getRevisionNumberingManager()},enumerable:!1,configurable:!0}),t.prototype.setListInNewGroup=function(t,e,r,n,o){this.insertListTemplates(e,r,n),this.modifyOldListToNewList(t,e,0,n,o,r.length)},t.prototype.modifyListTemplateSpanChange=function(t){},t.prototype.modifyListTemplate=function(t,e,r){this.removeTemplatesById(t,r),this.insertListTemplates(t,e,r)},t.prototype.modifyParagraphsIndent=function(t,e,r){t.forEach((function(t,n){var o=e[n],i=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));i.ind.left=o,i.ind.setNull(i.ind.tKeys.leftChars);var a={range:new p.GCPRange(t.end()-1,1),property:i,mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(a,r)}))},t.prototype.modifyListToNewListStyleSet=function(t,e,r){var n=ve(t,this.numberingManager);if(n){var o=Se(n,e);this.removeTemplatesById(t,r),this.insertListTemplates(t,o,r)}},t.prototype.modifyTaskState=function(t,e){},t.prototype.cancelListInRange=function(t,e,r,n,o){var i=Ne(t,this.dataStream),a=this.dataStream.getTextStream().createParagraphIterator(i);a.seek(i.gcpBegin);var s=0,l=(this.numberingManager.getWholeListByListId(e),[]);do{var p=this.state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParagraphProperty(a.getProperty()),c=a.getRange();jt(this.service,c)&&(this.cancelListPropsInParaRange(c,o,r,n),l.push(p.paraId),s+=1)}while(a.next());this.numberingManager.getWholeListByListId(e).filter((function(t){return!t.isVirtual})).length===s&&this.removeTemplatesById(e,o)},t.prototype.cancelListByListId=function(t,e,r,n){var o=this,i=this.numberingManager.getWholeListByListId(t);if(i.length){var a=this.dataStream.getTextStream().createParagraphIterator();i.forEach((function(t){a.seek(t.gcp-1);var i=a.getRange();o.cancelListPropsInParaRange(i,n,e,r)})),this.removeTemplatesById(t,n)}},t.prototype.setListInAutoFindResult=function(t,e,r,n,o){var a=this,s=t.normal,l=t.heading,p=[];s.forEach((function(t){var s=t.ranges,l=t.findResult,c=(0,i.__read)(s,1)[0],u=l.listId;u||(u=a.createNewListTemplate(c,e,!1,r,n)),ye.initializeIndentInfo(u,a.numberingManager);var g=He(u,a.numberingManager,e);s.forEach((function(t){a.setListPropsInParaRange(t,g,{listId:u,taskStatus:o},r),p.push(t)}))})),l.forEach((function(t){var s=(0,i.__read)(t,1)[0],l=s.range,c=s.findResult.listId,u=c;u||(u=a.createNewListTemplate(l,e,!0,r,n));var g=He(c,a.numberingManager,e);t.forEach((function(t){var e=t.range,n=t.findResult.level;a.setListPropsInParaRange(e,g,{listId:u,listLevel:n,taskStatus:o},r),p.push(e)}))})),this.clearListCache(),this.deleteParaStartTab(p,r)},t.prototype.setListWithCreateInfo=function(t,e,r,n,o){var i=e.listId,a=e.level,s=e.listType,l=e.listStyles,p=e.order,c=i;return c?!this.numberingManager.getWholeListByListId(c).some((function(e){return e.listLevel===a&&(e.gcp<=t.gcpBegin||1===e.start)}))&&this.modifyTemplateStartInRecognizeFind(c,{listLevel:null!=a?a:0,start:(null!=p?p:0)+1},n):c=this.createNewListTemplate(t,s,r,n,l,{listLevel:null!=a?a:0,start:(null!=p?p:0)+1}),this.setListPropsInRanges(c,[{range:t,level:a}],n,o),{listId:c,level:a}},t.prototype.removeTemplatesByIdForRevisionIfNecessary=function(t,e,r){var n=r?this.revisionNumberingManager:this.numberingManager;if(n){var o=this.dataStream.getTextStream().createParagraphIterator(e),i=new Map,a=function(){var t=o.getProperty(),e=r?null==t?void 0:t.readOnly((function(){return t.pPrChange.pPr.numPr.numId.val})):null==t?void 0:t.readOnly((function(){return t.numPr.numId.val}));if(e){var n=i.get(e)||0;i.set(e,n+1)}};do{a()}while(o.next());var s=this.removeTemplatesByIdExecution;i.forEach((function(e,r){(null==n?void 0:n.getListsByListTemplateId(r).length)===e&&s(r,t,n)}))}},t.prototype.modifyTemplateStartInRecognizeFind=function(t,e,r){var n=ve(t,this.numberingManager);if(n){var o=Ce([e],n);this.removeTemplatesById(t,r),this.insertListTemplates(t,o,r)}},t.prototype.deleteParaStartTab=function(t,e){t.sort((function(t,e){return t.gcpBegin-e.gcpBegin}));var r=this.dataStream.getTextStream(),n=0;t.forEach((function(t){var o=ye.getParaStartTabCount(t,r),i=new p.GCPRange(t.begin()-n,o);n+=o,h.Gh.deleteText(i,e)}))},t.prototype.createNewListTemplate=function(t,e,r,n,o,i){var a=Pe(t,null!=o?o:We(e,r),this.dataStream.getTextStream(),this.state.dataEngine.getDataManager().getStyleSheetManager(),this.numberingManager);if(i&&1!==i.start){var s=i.listLevel,l=i.start;a=Ce([{listLevel:s,start:l}],a)}var c=p.ListUtils.createId();return this.insertListTemplates(c,a,n),c},t.prototype.insertListTemplates=function(t,e,r){if(e.length){var n=p.ListUtils.insertLevelsType(new(p.PropertyFactory.getPropertyClass(p.PropertyType.NumberingProperty)),t,e);h.Gh.setSettingProperty(n,p.ModifyType.numbering,r,!1)}},t.prototype.modifyOldListToNewList=function(t,e,r,n,o,i){var a=this,s=this.numberingManager.getWholeListByListId(t);s.sort((function(t,e){return t.gcp-e.gcp}));var l=!0;if(s.length){var c=null!=i?i:He(e,this.numberingManager);s.forEach((function(t){if(!t.isVirtual)if(o&&o(t))l=!1;else{var i=new p.GCPRange(t.gcp-1,1),s=t.listLevel+r;a.setListPropsInParaRange(i,c,{listId:e,listLevel:s},n)}}))}l&&this.removeTemplatesById(t,n)},t.prototype.setListPropsInParaRange=function(t,e,r,n){var o=r.listId,i=r.listLevel,a=r.taskStatus,s=this.state.dataEngine.getDataManager().getStyleSheetManager(),l=Ge(null!=i?i:ye.getListLevelFromIndent(o,t,this.dataStream.getTextStream(),s,this.numberingManager),e),c=this.createListParaProperty(o,l,a);c.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.ind);var u={range:new p.GCPRange(t.end()-1,0),property:c,mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(u,n)},t.prototype.cancelListPropsInParaRange=function(t,e,r,n){var o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),i=this.dataStream.getTextStream().createParagraphIterator(t).getProperty(),a=this.state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParagraphProperty(i||o);o.cleanNumPr((null==i?void 0:i.isNumPrCleaned())&&!a.isNumPrCleaned()),this.convertListIndentToParaIndent(t,o,r,n);var s={range:new p.GCPRange(t.end()-1,1),property:o,mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(s,e)},t.prototype.convertListIndentToParaIndent=function(t,e,r,n){var o=this.numberingManager.getListInfoFromGcpRange(t);if(o){var i=ye.getFinalNumericalLeftIndent(o,t,this.dataStream.getTextStream(),this.numberingManager,this.state.dataEngine.getDataManager().getStyleSheetManager(),{ignoreHanging:r,ignoreFirstLine:n});e.ind.left=i,e.ind.setNull(e.ind.tKeys.leftChars),e.ind.setNull(e.ind.tKeys.hanging),e.ind.setNull(e.ind.tKeys.hangingChars)}},t.prototype.setListPropsInRanges=function(t,e,r,n){var o=this,i=He(t,this.numberingManager);e.forEach((function(e){var a=e.range,s=e.level;o.setListPropsInParaRange(a,i,{listId:t,listLevel:s,taskStatus:n},r)}))},t.prototype.createListParaProperty=function(t,e,r){var n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));return n.numPr.numId.val=t,n.numPr.ilvl.val=e,r&&(n.taskPr.taskState=r),n},t.prototype.removeTemplatesById=function(t,e){this.state.dataEngine.getDataManager().isTrackRevisions||this.removeTemplatesByIdExecution(t,e,this.numberingManager)},t.prototype.removeTemplatesByIdExecution=function(t,e,r){var n=p.ListUtils.removeAbstractNumType(t,r.getNumberingProperty(!0));n&&h.Gh.setSettingProperty(n,p.ModifyType.numbering,e,!1)},t.prototype.clearListCache=function(){ye.clearLevelCache()},t.prototype.createNewDeltaOption=function(t,e){return void 0===e&&(e=!1),h.C1.createLocalDeltaOption(t||this.selection.range(),e)},t}(),Pr=r(393268),Tr=r.n(Pr),Sr=r(179664);function Cr(t,e,r){var n=null;switch(r){case p.IterType.Span:n=t.getSpanProp();var o=t.getParaProp();o&&n&&n instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)&&(n=e.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunProperty(n,o),e.dataEngine.getDataManager().getThemeManager().mergeThemeForRun(n));break;case p.IterType.Paragraph:(n=t.getParaProp())&&n instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)&&(n=e.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParagraphProperty(n));break;case p.IterType.Section:n=t.getSectProp()}return n}function br(t){var e=t.iterType,r=t.callback,n=t.state,o=t.deltaOpt;if(function(t,e){return e===p.IterType.Span&&t.updateSelection&&0===t.originRange.length()}(o,e)){var i=o.originRange.begin(),a=n.currentParaProp(i),s=function(t,e){return t.isRangeBeginAtParaStart(e.originRange)&&t.listMarkerSpanProp}(n,o)?n.listMarkerSpanProp:n.followSpanProp(i);return a&&s&&(s=n.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunProperty(s,a),n.dataEngine.getDataManager().getThemeManager().mergeThemeForRun(s)),r(s,o.originRange)}var l=c.JjT.Undefined,u=function(t){var e=new Map([[p.IterType.Span,p.PropertyType.RunProperty],[p.IterType.Paragraph,p.PropertyType.ParagraphProperty],[p.IterType.Section,p.PropertyType.SectionProperty]]);return p.PropertyFactory.getPropertyClass(e.get(t)||p.PropertyType.RunProperty)}(e),g=n.dataEngine.getDataStream(),d=g.getTableStream(),y=o.originRange,f=n.selection,v=f.gcpRanges,m=f.gcpRange,P=function(t){var o=g.createDataIterator(t),i=Cr(o,n,e);for(i&&i instanceof u&&(l=r(i,o.getRange()));o.next(e);){if((i=Cr(o,n,e))instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)&&i.isPlaceholder){var a=o.getRange().end(),s=g.getTextStream().charCodeAt(a-1);if((0,p.isTableChar)(s))return!0}if(!(i&&i instanceof u&&l===r(i,o.getRange())))return l=c.JjT.Undefined,!1}return!0};return o.originRange.equal(m)?v.forEach(P):h.Yy.splitCellRangeWithIntersect(d,y,P),l}var Rr=function(){function t(t,e){var r=this;this.iterAttributeResultValue=c.JjT.Undefined,this.iterForSection=function(t,e){var n=r._state.dataEngine.getDataStream().getSectionStream().createSectionIterator(e),o=p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty),i=n.getCloneProperty();for(i&&i instanceof o&&(r.iterAttributeResultValue=t(i));n.next();)if(!((i=n.getCloneProperty())&&i instanceof o&&r.iterAttributeResultValue===t(i)))return r.iterAttributeResultValue=c.JjT.Undefined,!1;return!0},this.iterForParagraph=function(t,e,n){var o,i=p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty),a=r._state.dataEngine.getDataStream().getTextStream(),s=a.createParagraphIterator(e),l=r.getPropAndPropClassTypeForParagraph(s,t);if((null==l?void 0:l.propClassType)===i&&(r.iterAttributeResultValue=l.prop),n)return!0;for(;s.next();){if((null==(l=r.getPropAndPropClassTypeForParagraph(s,t))?void 0:l.propClassType)===i&&(null===(o=null==l?void 0:l.extraParaUsedProp)||void 0===o?void 0:o.isPlaceholder)){var u=s.getRange(),g=a.charCodeAt(u.end()-1);if((0,p.isTableChar)(g))return!0}if(!l||l.propClassType!==i||r.iterAttributeResultValue!==l.prop)return r.iterAttributeResultValue=c.JjT.Undefined,!1}return!0},this.iterForSpan=function(t,e){var n=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty),o=r._state.dataEngine.getDataStream().getTextStream(),i=o.createRunIterator(e),a=o.createParagraphIterator(e),s=r.getPropAndPropClassTypeForSpan(i,a,t);for((null==s?void 0:s.propClassType)===n&&(r.iterAttributeResultValue=s.prop);i.next();)if(!(s=r.getPropAndPropClassTypeForSpan(i,a,t))||s.propClassType!==n||r.iterAttributeResultValue!==s.prop)return r.iterAttributeResultValue=c.JjT.Undefined,!1;return!0},this._state=t,this._deltaOpt=e}return t.prototype.setIterAttributeResultValue=function(t){this.iterAttributeResultValue=t},t.prototype.getRange=function(){return this._deltaOpt?this._deltaOpt.originRange.clone():new p.GCPRange},t.prototype.getVisibleRanges=function(){var t;if(this._deltaOpt){var e=this._deltaOpt.originRange.clone(),r=null===(t=this._state)||void 0===t?void 0:t.dataEngine.getDataManager().getRevisionsManager();return(null==r?void 0:r.getRevisionStatusHelper().getVisibleRanges(e))||[e]}return[new p.GCPRange]},t.prototype.applyBlockMultiAttribute=function(t,e,r,n,o){var i=this;if(void 0===o&&(o=p.PropUpdateMode.Merge),this._state&&this._deltaOpt){var a=null!=n?n:this._deltaOpt.buildDelta();r.forEach((function(r){var n=i._state.getDataStream().getStoryStream().getSubStoryInfoFromGcp(r.begin()),s=n&&n.subStoryProp;if(!(n&&n.storyProp.storyType===p.STStoryType.textboxContent&&s instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty)&&s.isCodeBlock))switch(a.moveTo(r),e){case p.IterType.Span:a.setCommandType(p.Type.DocModifyText),a.splitValidRange(i._state.getTableStream(),(function(e){h.Gh.setRunProperty(e,t,a,o)}));break;case p.IterType.Paragraph:a.setCommandType(p.Type.DocModifyParagraph),a.splitValidRange(i._state.getTableStream(),(function(e){var r={range:e,property:t,mode:o};h.Gh.setParagraphProperty(r,a)}));break;case p.IterType.Section:a.setCommandType(p.Type.DocModifySection),h.Gh.setSectionProperty(a.currentRange(),t,a,o)}})),n||this._state.applyDelta(a)}},t.prototype._applyAttribute=function(t,e,r,n,o){if(void 0===r&&(r=p.PropUpdateMode.Merge),this._state&&this._deltaOpt){var i=n||this._deltaOpt.buildDelta(),a=null!=o?o:i.globalOpts.originRange,s=this._state.getDataStream().getStoryStream().getSubStoryInfoFromGcp(a.begin());if(s&&s.storyProp.storyType===p.STStoryType.textboxContent&&s.subStoryProp instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty)&&s.subStoryProp.textBoxType===p.TextFrameType.CodeBlock)return;if(e===p.IterType.Span&&t instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)&&i.globalOpts.updateSelection&&0===i.globalOpts.originRange.length()){if(this._state.isRangeBeginAtParaStart(i.globalOpts.originRange)&&this._state.listMarkerSpanProp)this._state.listMarkerSpanProp.merge(t),this._state.context.fire(new h.Fx(this._state.listMarkerSpanProp),!1);else if(!n){var l=this._state.getTextStream().createParagraphIterator(i.globalOpts.originRange),c=l.getRange(),u=l.getProperty();if(i.globalOpts.originRange.begin()===c.end()-1&&u&&u.numPr.isEmpty()){c.gcpBegin=c.end()-1,c.len=1;var g=this._deltaOpt.buildDelta();g.setCommandType(p.Type.DocModifyText),g.globalOpts.originRange=c.clone(),g.moveTo(c),this._applyAttribute(t,p.IterType.Span,p.PropUpdateMode.Merge,g),c.len=0,g.moveTo(c),this._state.applyDelta(g)}this._state.cusorSpanProp=t}}else{switch(e){case p.IterType.Span:i.setCommandType(p.Type.DocModifyText),i.splitValidRange(this._state.getTableStream(),(function(e){h.Gh.setRunProperty(e,t,i,r)}));break;case p.IterType.Paragraph:i.setCommandType(p.Type.DocModifyParagraph),i.splitValidRange(this._state.getTableStream(),(function(e){var n={range:e,property:t,mode:r};h.Gh.setParagraphProperty(n,i)}),o);break;case p.IterType.Section:i.setCommandType(p.Type.DocModifySection),h.Gh.setSectionProperty(i.currentRange(),t,i,r)}n||this._state.applyDelta(i)}}},t.prototype.iterAttributeByMerge=function(t,e){return this._state&&this._deltaOpt?br({iterType:e,callback:t,state:this._state,deltaOpt:this._deltaOpt}):c.JjT.Undefined},t.prototype.iterAttributeForSection=function(t){if(this.iterAttributeResultValue=c.JjT.Undefined,!this._state||!this._deltaOpt)return this.iterAttributeResultValue;var e=this.iterForSection.bind(this,t);return this.iterLoopInRanges(e),this.iterAttributeResultValue},t.prototype.iterAttributeForParagraph=function(t,e){var r=this;return this.iterAttributeResultValue=c.JjT.Undefined,this._state&&this._deltaOpt&&t.filter((function(t){return!!t})).length?(this.iterLoopInRanges((function(n){return r.iterForParagraph(t,n,e)})),(0,p.cloneBagValueEx)(this.iterAttributeResultValue)):this.iterAttributeResultValue},t.prototype.iterAttributeForSpan=function(t,e){var r=(null!=e?e:{}).iterMethod;if(this.iterAttributeResultValue=c.JjT.Undefined,!this._state||!this._deltaOpt||!t.filter((function(t){return!!t})).length)return this.iterAttributeResultValue;if(this._deltaOpt.updateSelection&&0===this._deltaOpt.originRange.length())return this.iterAttributeForSpanSpecial(t);var n=null!=r?r:this.iterForSpan.bind(this,t);return this.iterLoopInRanges(n),(0,p.cloneBagValueEx)(this.iterAttributeResultValue)},t.prototype.iterAttributeForSpanSpecial=function(t){var e=this._deltaOpt.originRange.begin();if(this._state.isRangeBeginAtParaStart(this._deltaOpt.originRange)&&this._state.listMarkerSpanProp){var r=this._state.currentParaProp(e),n=this._state.listMarkerSpanProp;return r&&n&&(n=this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(n,r,e)),Tr()(n,t)}var o=this._state.currentParaProp(e),i=this._state.followSpanProp(e);return o&&i&&(i=this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(i,o,e)),Tr()(i,t)},t.prototype.iterLoopInRanges=function(t){this._deltaOpt.originRange.equal(this._state.selection.gcpRange)?this._state.selection.gcpRanges.forEach(t):h.Yy.splitCellRangeWithIntersect(this._state.dataEngine.getDataStream().getTableStream(),this._deltaOpt.originRange,t)},t.prototype.getPropAndPropClassTypeForParagraph=function(t,e){var r=this;if(!this._state)return null;var n=t.getProperty(),o={isPlaceholder:null==n?void 0:n.isPlaceholder},i=p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty),a=this.getPropValueFromAttrList(n,e);if(n&&n instanceof i&&(this._state.dataEngine.getDataManager().getStyleSheetManager().traceToParagraphBaseStyle(n,(function(t){var n=r.getPropValueFromAttrList(t,e);return null!==n&&null===a&&(a=n,!0)}),!0),null===a)){var s=this._state.dataEngine.getDataManager().getStyleSheetManager().getDocDefaultsStyle(!0).pPrDefault.pPr;a=Tr()(s,e)}return null===a?null:{prop:a,propClassType:i,extraParaUsedProp:o}},t.prototype.getPropAndPropClassTypeForSpan=function(t,e,r){var n=this;if(!this._state)return null;var o=t.getProperty();e.seek(t.getOperationRange().begin());var i=e.getProperty(),a=p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty),s=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty),l=this.getPropValueFromAttrList(o,r);if(i&&i instanceof a&&o&&o instanceof s&&(this._state.dataEngine.getDataManager().getStyleSheetManager().traceToRunBaseStyle(o,i,(function(t){var e=n.getPropValueFromAttrList(t,r);return null!==e&&null===l&&(l=e,!0)}),!0),null===l)){var c=this._state.dataEngine.getDataManager().getStyleSheetManager().getDocDefaultsStyle(!0).rPrDefault.rPr;l=Tr()(c,r)}return null===l?null:{prop:l,propClassType:s}},t.prototype.getPropValueFromAttrList=function(t,e){var r,n;if(!t)return null;var o=t;try{for(var a=(0,i.__values)(e),s=a.next();!s.done;s=a.next()){var l=s.value;if(!o.has(o.tKeys[l]))return null;o=o[l]}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},t}(),_r=function(){function t(){}return t.getRunIterator=function(t,e){return t.dataEngine.getDataStream().getTextStream().createRunIterator(e)},t.getParagraphIterator=function(t,e){return t.dataEngine.getDataStream().getTextStream().createParagraphIterator(e)},t.getSectionIterator=function(t,e){return t.dataEngine.getDataStream().getSectionStream().createSectionIterator(e)},t.clearIteratorCache=function(){this.sectionIterators.clear(),this.runIterators.clear(),this.paraIterators.clear()},t.runIterators=new Map,t.paraIterators=new Map,t.sectionIterators=new Map,t}(),wr=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys,xr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateFont=function(t,r){return new e(t,r)},e.createEmptyFont=function(){return new e},e.prototype.isValidTextSpan=function(t){if(!this._state)return!1;var e=this._state.getTextStream().readText(t.begin(),t.len);return![p.PlaceholderChar.TableCellBreak,p.PlaceholderChar.TableRowBreak,p.PlaceholderChar.TableStart,p.PlaceholderChar.TableEnd].includes(e)},e.prototype.getAttributes=function(t){if(void 0===t&&(t=!0),this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;for(var e=_r.getRunIterator(this._state,this._deltaOpt.originRange),r=e.getCloneProperty();t&&r&&!this.isValidTextSpan(e.getRange(!0));)e.hasNext()?(e.next(),r=e.getCloneProperty()):r=null;this._lastRange=this._deltaOpt.originRange,this._attribute=r||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))}return this._attribute||(this._attribute=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))),this._attribute},e.prototype.setFont=function(t){this._state?this._applyAttribute(t.getAttributes(),p.IterType.Span,p.PropUpdateMode.Merge,void 0):this.getAttributes().merge(t.getAttributes())},e.prototype.setBold=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));t===c.JjT.Toggle?r.b.val=!0!==this.isBold():r.b.val=t,Array.isArray(e)?this.applyBlockMultiAttribute(r,p.IterType.Span,e,void 0,p.PropUpdateMode.Merge):this._applyAttribute(r,p.IterType.Span,p.PropUpdateMode.Merge,void 0)}else this.getAttributes().b.val=!0===t},e.prototype.isBold=function(){return this._state?this.iterAttributeForSpan([wr.b,p.PropertyFactory.getPropertyClass(p.PropertyType.CTOnOffWml).tKeys.val]):this.getAttributes().b.val},e.prototype.setItalic=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));t===c.JjT.Toggle?r.i.val=!0!==this.isItalic():r.i.val=!!t,Array.isArray(e)?this.applyBlockMultiAttribute(r,p.IterType.Span,e,void 0,p.PropUpdateMode.Merge):this._applyAttribute(r,p.IterType.Span,p.PropUpdateMode.Merge,void 0)}else this.getAttributes().i.val=!!t},e.prototype.isItalic=function(){return this._state?this.iterAttributeForSpan([wr.i,p.PropertyFactory.getPropertyClass(p.PropertyType.CTOnOffWml).tKeys.val]):!!this.getAttributes().i.val},e.prototype.setUnderline=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));t===c.JjT.Toggle?r.u.val=!0!==this.isUnderline()?p.STUnderline.single:p.STUnderline.none:r.u.val=t,Array.isArray(e)?this.applyBlockMultiAttribute(r,p.IterType.Span,e,void 0,p.PropUpdateMode.Merge):this._applyAttribute(r,p.IterType.Span,p.PropUpdateMode.Merge,void 0)}else this.getAttributes().u.val=!0!==this.isUnderline()?p.STUnderline.single:p.STUnderline.none},e.prototype.getUnderline=function(){return this._state?this.iterAttributeForSpan([wr.u,p.PropertyFactory.getPropertyClass(p.PropertyType.CTUnderline).tKeys.val]):this.getAttributes().u.val},e.prototype.isUnderline=function(){var t=this.getUnderline();return t===c.JjT.Undefined?c.JjT.Undefined:t!==p.STUnderline.none&&t!==p.STUnderline.PBDEFAULT},e.prototype.setStrike=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));t===c.JjT.Toggle?r.strike.val=!0!==this.isStrike():r.strike.val=!!t,Array.isArray(e)?this.applyBlockMultiAttribute(r,p.IterType.Span,e,void 0,p.PropUpdateMode.Merge):this._applyAttribute(r,p.IterType.Span,p.PropUpdateMode.Merge,void 0)}else this.getAttributes().strike.val=!!t},e.prototype.isStrike=function(){return this._state?this.iterAttributeForSpan([wr.strike,p.PropertyFactory.getPropertyClass(p.PropertyType.CTOnOffWml).tKeys.val]):!!this.getAttributes().strike.val},e.prototype.setFontSize=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));r.sz.val=t,Array.isArray(e)?this.applyBlockMultiAttribute(r,p.IterType.Span,e,void 0,p.PropUpdateMode.Merge):this._applyAttribute(r,p.IterType.Span)}else this.getAttributes().sz.val=t},e.prototype.getFontSize=function(t){if(void 0===t&&(t=!1),this._state){var e=[wr.sz,p.PropertyFactory.getPropertyClass(p.PropertyType.CTTwipsMeasurePrecise).tKeys.val];return this.iterAttributeForSpan(e,t?{iterMethod:this.iterSmallestFontSizeForSpan.bind(this,e)}:{})}return this.getAttributes().sz.val},e.prototype.iterSmallestFontSizeForSpan=function(t,e){var r=c.JjT.Undefined,n=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty),o=this._state.dataEngine.getDataStream().getTextStream(),i=o.createRunIterator(e),a=o.createParagraphIterator(e),s=this.getPropAndPropClassTypeForSpan(i,a,t);for((null==s?void 0:s.propClassType)===n&&(r=s.prop,this.setIterAttributeResultValue(r));i.next();){if(!(s=this.getPropAndPropClassTypeForSpan(i,a,t))||s.propClassType!==n)return!1;r=Math.min(r,s.prop)}return this.setIterAttributeResultValue(r),!0},e.prototype.setFontFamily=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));e.setFontFamily(t),this._applyAttribute(e,p.IterType.Span,p.PropUpdateMode.Merge,void 0)}else this.getAttributes().setFontFamily(t)},e.prototype.getFontFamily=function(t){if(this._state){var e=this._state;return this.iterAttributeByMerge((function(t,r){return function(t,e,r){var n,o,a;a=0===e.selection.gcpRange.len?e.getDataStream().getTextStream().readText(e.selection.gcpRange.end()-1,1):e.getDataStream().getTextStream().readText(r.intersectRange(e.selection.gcpRange).begin(),r.len);var s,l=new Sr.UnicodeString(a).getAllNoWordWrapSlice(void 0,void 0,{kinsoku:!0,wordWrap:!1}),u=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).getFontFamily(t,"",p.FontSlotType.EastAsia),g=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).getFontFamily(t,"",p.FontSlotType.ASCII),h=!1;try{for(var d=(0,i.__values)(l),y=d.next();!y.done;y=d.next()){var f=y.value.text,v=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).assertFontSlotType(f);if(s&&s!==v){h=!0;break}s=v}}catch(t){n={error:t}}finally{try{y&&!y.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}return h&&u!==g?c.JjT.Undefined:s===p.FontSlotType.EastAsia?u:g}(t,e,r)}),p.IterType.Span)}return this.getAttributes().getRenderFontFamily(t)},e.prototype.setTextColor=function(t,e){var r=function(t,e){var r=p.PropertyFactory.getPropertyClass(p.PropertyType.CTColorWml);t.color.val=e,t.color.setNull(r.tKeys.themeColor),t.color.setNull(r.tKeys.themeShade),t.color.setNull(r.tKeys.themeTint)};if(this._state){var n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));r(n,t),Array.isArray(e)?this.applyBlockMultiAttribute(n,p.IterType.Span,e,void 0,p.PropUpdateMode.Merge):this._applyAttribute(n,p.IterType.Span,p.PropUpdateMode.Merge,void 0)}else r(this.getAttributes(),t)},e.prototype.getTextColor=function(){return this._state?this.iterAttributeByMerge((function(t){return t.color.val}),p.IterType.Span):this.getAttributes().color.val},e.prototype.setTextHighlight=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));r.highlight.val=t,e?this.applyBlockMultiAttribute(r,p.IterType.Span,e,void 0,p.PropUpdateMode.Merge):this._applyAttribute(r,p.IterType.Span)}else this.getAttributes().highlight.val=t},e.prototype.getTextHighlight=function(){return this._state?this.iterAttributeForSpan([wr.highlight,p.PropertyFactory.getPropertyClass(p.PropertyType.CTHighlight).tKeys.val]):this.getAttributes().highlight.val},e.prototype.setTextFillColor=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));r.shd.val=p.STShd.clear,r.shd.color="auto",r.shd.fill=t,r.setNull(r.tKeys.highlight),Array.isArray(e)?this.applyBlockMultiAttribute(r,p.IterType.Span,e,void 0,p.PropUpdateMode.Merge):this._applyAttribute(r,p.IterType.Span,p.PropUpdateMode.Merge,void 0)}else this.getAttributes().shd.val=p.STShd.clear,this.getAttributes().shd.color="auto",this.getAttributes().shd.fill=t,this.getAttributes().setNull(this.getAttributes().tKeys.highlight)},e.prototype.getTextFillColor=function(){return this._state?this.iterAttributeForSpan([wr.shd,p.PropertyFactory.getPropertyClass(p.PropertyType.CTShd).tKeys.fill]):p.PropertyColorUtil.getHexColorFromShd(this.getAttributes().shd)},e.prototype.setLetterSpacing=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));e.spacing.val=t,this._applyAttribute(e,p.IterType.Span)}else this.getAttributes().spacing.val=t},e.prototype.getLetterSpacing=function(){return this._state?this.iterAttributeForSpan([wr.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTTwipsMeasurePrecise).tKeys.val]):this.getAttributes().spacing.val},e.prototype.setFontScaling=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));e.w.val=t,this._applyAttribute(e,p.IterType.Span)}else this.getAttributes().w.val=t},e.prototype.getFontScaling=function(){return this._state?this.iterAttributeForSpan([wr.w,p.PropertyFactory.getPropertyClass(p.PropertyType.CTTextScale).tKeys.val]):this.getAttributes().w.val},e.prototype.setVerticalAlignRun=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));e.vertAlign.val=t,this._applyAttribute(e,p.IterType.Span)}else this.getAttributes().vertAlign.val=t},e.prototype.getVerticalAlignRun=function(){return this._state?this.iterAttributeForSpan([wr.vertAlign,p.PropertyFactory.getPropertyClass(p.PropertyType.CTVerticalAlignRun).tKeys.val]):this.getAttributes().vertAlign.val},e.prototype.getStyleProp=function(){if(this._state){var t=this.iterAttributeForSpan([wr.rStyle,p.PropertyFactory.getPropertyClass(p.PropertyType.CTStringWml).tKeys.val])||c.JjT.Undefined;if(t!==c.JjT.Undefined){var e=this._state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(t);if(e&&e.type===p.STStyleType.character)return e}}return c.JjT.Undefined},e.prototype.getStyleName=function(){var t=this.getStyleProp();return t&&t!==c.JjT.Undefined?t.name.val:c.JjT.Undefined},e.prototype.getStyleShowName=function(){var t=this.getStyleProp();return t?t===c.JjT.Undefined?c.JjT.Undefined:p.StyleSheetManager.getStyleShowName(t):c.JjT.Undefined},e.prototype.setStyle=function(t,e,r){if(t.type===p.STStyleType.character)if(this._state){var n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));n.rStyle.val=t.styleId,Array.isArray(r)?this.applyBlockMultiAttribute(n,p.IterType.Span,r,void 0,p.PropUpdateMode.Merge):this._applyAttribute(n,p.IterType.Span,p.PropUpdateMode.Merge,e)}else this.getAttributes().rStyle.val=t.styleId},e}(Rr),Ir=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n._items=[],n._iterIndex=0,n._initCount=0,n._totalCount=-1,n._iterator=n.createIterator(),n}return(0,i.__extends)(e,t),e.prototype.createIterator=function(){return(0,i.__generator)(this,(function(t){throw new Error("BaseCollection.createIterator must be overrided.")}))},e.prototype.push=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this._totalCount=this._totalCount<0?0:this._totalCount,this._totalCount+=(0,i.__spreadArray)([],(0,i.__read)(e),!1).length,(t=this._items).push.apply(t,(0,i.__spreadArray)([],(0,i.__read)(e),!1))},e.prototype.count=function(){if(this._totalCount>=0)return this._totalCount;for(;!this.goNext(););return this._totalCount},e.prototype.item=function(t){if(!(t<0)){if(this._totalCount>=0)return t<this._items.length?this._items[t]:void 0;do{if(t<this._initCount)break}while(!this.goNext());return this._items[t]}},e.prototype.goNext=function(){var t=this._iterator.next();return t.done?this._totalCount=this._initCount:(this._items[this._initCount]=t.value,this._initCount+=1),t.done},e.prototype.next=function(){var t=this.item(this._iterIndex);return t?(this._iterIndex+=1,{done:!1,value:t}):{done:!0,value:void 0}},e.prototype[Symbol.iterator]=function(){return this._iterIndex=0,this},e}(Rr),Dr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateSpan=function(t,r){return new e(t,r)},e.prototype.getFont=function(){return this._state&&this._deltaOpt?xr.createStateFont(this._state,this._deltaOpt):xr.createEmptyFont()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=_r.getRunIterator(this._state);if(r.seek(t.begin()),r.next()){var n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateSpan(this._state,n)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=_r.getRunIterator(this._state);if(r.seek(t.begin()),r.prev()){var n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateSpan(this._state,n)}}},e}(xr),Fr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateSpans=function(t,r){return new e(t,r)},e.prototype.createIterator=function(t){var e,r,n;return(0,i.__generator)(this,(function(o){switch(o.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];e=this._deltaOpt.originRange,r=_r.getRunIterator(this._state,e),t&&r.seek(t),o.label=1;case 1:return n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),[4,Dr.createStateSpan(this._state,n)];case 2:o.sent(),o.label=3;case 3:if(r.next())return[3,1];o.label=4;case 4:return[2]}}))},e}(Ir),Er=p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys,Mr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateParagraphFormat=function(t,r){return new e(t,r)},e.createEmptyParagraphFormat=function(){return new e},e.prototype.isValidParaProperty=function(t){if(!this._state)return!1;var e=this._state.getTextStream().readText(t.begin(),t.len);return![p.PlaceholderChar.TableCellBreak,p.PlaceholderChar.TableRowBreak,p.PlaceholderChar.TableStart,p.PlaceholderChar.TableEnd].includes(e)},e.prototype.getAttributes=function(t){if(void 0===t&&(t=!0),this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;for(var e=_r.getParagraphIterator(this._state,this._deltaOpt.originRange),r=e.getCloneProperty();t&&r&&!this.isValidParaProperty(e.getRange(!0));)e.hasNext()?(e.next(),r=e.getCloneProperty()):r=null;this._attribute=r||new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))}return this._attribute||(this._attribute=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))),this._attribute},e.prototype.setFormat=function(t,e){this._state?this._applyAttribute(t.getAttributes(),p.IterType.Paragraph,p.PropUpdateMode.Merge,void 0,e):this.getAttributes().merge(t.getAttributes())},e.prototype.setHeadingWithMultiRanges=function(t,e,r){var n=this;this._deltaOpt&&this._state&&t&&e.forEach((function(e){r.moveTo(e),r.splitValidRange(n._state.getTableStream(),(function(t){h.Gh.setRunProperty(t,Be.createClearRunProperty(),r,p.PropUpdateMode.Merge)}));var o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));o.pStyle.val=t.styleId,n._applyAttribute(o,p.IterType.Paragraph,p.PropUpdateMode.Merge,r)}))},e.prototype.getListInfoArray=function(t){var e;if(!this._state)return[];var r=this._state.getTextStream().createParagraphIterator(t),n=[],o=!0;do{var i=r.getRange(),a=null===(e=this._state.dataEngine.getDataManager().getNumberingManager())||void 0===e?void 0:e.getListInfoFromGcpRange(i);if(!a){o=!1;break}n.push(a)}while(r.next()&&o);return o?n:[]},e.prototype.getListInfoCommonHangingIndent=function(t){var e,r,n,o=this.getListInfoArray(t);if(0===o.length)return 0;var a=(null===(n=o[0].listInd)||void 0===n?void 0:n.hanging)||0,s=!0;try{for(var l=(0,i.__values)(o),p=l.next();!p.done;p=l.next())if(a!==p.value.listInd.hanging){s=!1;break}}catch(t){e={error:t}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return s?a:0},e.prototype.getParaId=function(){if(this._state){var t=this.iterAttributeForParagraph([Er.paraId]);return t===c.JjT.Undefined?"":t}return this.getAttributes().paraId},e.prototype.setParagraphAlignment=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.jc.val=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().jc.val=t},e.prototype.setParagraphOMathParaPrAlignment=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.oMathParaPr.jc.val=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().oMathParaPr.jc.val=t},e.prototype.getParagraphAlignment=function(){return this._state?this.iterAttributeForParagraph([Er.jc,p.PropertyFactory.getPropertyClass(p.PropertyType.CTJc).tKeys.val]):this.getAttributes().jc.val},e.prototype.setOutlineLevel=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.outlineLvl.val=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().outlineLvl.val=t},e.prototype.getOutlineLevel=function(){return this._state?this.iterAttributeForParagraph([Er.outlineLvl,p.PropertyFactory.getPropertyClass(p.PropertyType.CTDecimalNumber).tKeys.val]):this.getAttributes().outlineLvl.val},e.prototype.setLineSpacing=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.spacing.line=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().spacing.line=t},e.prototype.setLineSpacingRule=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.spacing.lineRule=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().spacing.lineRule=t;var r="spacing_auto";switch(t){case p.STLineSpacingRule.auto:r="spacing_auto";break;case p.STLineSpacingRule.exact:r="spacing_exact";break;case p.STLineSpacingRule.atLeast:r="spacing_atLeast"}u.kQ.tdwReport({opername:"doc_word_editor",module:"paragraph",action:r})},e.prototype.getLineSpacing=function(){return this._state?this.iterAttributeForParagraph([Er.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTSpacing).tKeys.line]):this.getAttributes().spacing.line},e.prototype.getLineSpacingRule=function(){return this._state?this.iterAttributeForParagraph([Er.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTSpacing).tKeys.lineRule]):this.getAttributes().spacing.lineRule},e.prototype.setSpaceBefore=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.spacing.before=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().spacing.before=t},e.prototype.setLineUnitBefore=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.spacing.beforeLines=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().spacing.beforeLines=t},e.prototype.setSpaceBeforeAuto=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.spacing.beforeAutospacing=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().spacing.beforeAutospacing=t},e.prototype.getSpaceBefore=function(){return this._state?this.iterAttributeForParagraph([Er.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTSpacing).tKeys.before]):this.getAttributes().spacing.before},e.prototype.getLineUnitBefore=function(){return this._state?this.iterAttributeForParagraph([Er.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTSpacing).tKeys.beforeLines]):this.getAttributes().spacing.beforeLines},e.prototype.getSpaceBeforeAuto=function(){return this._state?this.iterAttributeForParagraph([Er.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTSpacing).tKeys.beforeAutospacing]):this.getAttributes().spacing.beforeAutospacing},e.prototype.setSpaceAfter=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.spacing.after=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().spacing.after=t},e.prototype.setLineUnitAfter=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.spacing.afterLines=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().spacing.afterLines=t},e.prototype.setSpaceAfterAuto=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.spacing.afterAutospacing=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().spacing.afterAutospacing=t},e.prototype.getSpaceAfter=function(){return this._state?this.iterAttributeForParagraph([Er.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTSpacing).tKeys.after]):this.getAttributes().spacing.after},e.prototype.getLineUnitAfter=function(){return this._state?this.iterAttributeForParagraph([Er.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTSpacing).tKeys.afterLines]):this.getAttributes().spacing.afterLines},e.prototype.getSpaceAfterAuto=function(){return this._state?this.iterAttributeForParagraph([Er.spacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTSpacing).tKeys.afterAutospacing]):this.getAttributes().spacing.afterAutospacing},e.prototype.setSnapToGrid=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.snapToGrid.val=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().snapToGrid.val=t},e.prototype.isSnapToGrid=function(){return this._state?this.iterAttributeForParagraph([Er.snapToGrid,p.PropertyFactory.getPropertyClass(p.PropertyType.CTOnOffWml).tKeys.val]):this.getAttributes().snapToGrid.val},e.prototype.setAutoSpaceDE=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.autoSpaceDE.val=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().autoSpaceDE.val=t},e.prototype.getAutoSpaceDE=function(){return this._state?this.iterAttributeForParagraph([Er.autoSpaceDE,p.PropertyFactory.getPropertyClass(p.PropertyType.CTOnOffWml).tKeys.val]):this.getAttributes().autoSpaceDE.val},e.prototype.setAutoSpaceDN=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.autoSpaceDN.val=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().autoSpaceDN.val=t},e.prototype.getAutoSpaceDN=function(){return this._state?this.iterAttributeForParagraph([Er.autoSpaceDN,p.PropertyFactory.getPropertyClass(p.PropertyType.CTOnOffWml).tKeys.val]):this.getAttributes().autoSpaceDN.val},e.prototype.setContextualSpacing=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.contextualSpacing.val=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().contextualSpacing.val=t},e.prototype.getContextualSpacing=function(){return this._state?this.iterAttributeForParagraph([Er.contextualSpacing,p.PropertyFactory.getPropertyClass(p.PropertyType.CTOnOffWml).tKeys.val]):this.getAttributes().contextualSpacing.val},e.prototype.setLeftIndent=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r.ind.left=t,this._applyAttribute(r,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().ind.left=t},e.prototype.setLeftCharsIndent=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r.ind.leftChars=t,this._applyAttribute(r,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().ind.leftChars=t},e.prototype.getLeftIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.left}),p.IterType.Paragraph):this.getAttributes().ind.left},e.prototype.getLeftCharsIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.leftChars}),p.IterType.Paragraph):this.getAttributes().ind.leftChars},e.prototype.setRightIndent=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r.ind.right=t,this._applyAttribute(r,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().ind.right=t},e.prototype.setRightCharsIndent=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r.ind.rightChars=t,this._applyAttribute(r,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().ind.rightChars=t},e.prototype.getRightIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.right}),p.IterType.Paragraph):this.getAttributes().ind.right},e.prototype.getRightCharsIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.rightChars}),p.IterType.Paragraph):this.getAttributes().ind.rightChars},e.prototype.setFirstLineIndent=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r.ind.firstLine=t,this._applyAttribute(r,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().ind.firstLine=t},e.prototype.setHangingIndent=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r.ind.hanging=t,this._applyAttribute(r,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().ind.hanging=t},e.prototype.setFirstLineCharsIndent=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r.ind.firstLineChars=t,this._applyAttribute(r,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().ind.firstLineChars=t},e.prototype.setHangingCharsIndent=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r.ind.hangingChars=t,this._applyAttribute(r,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().ind.hangingChars=t},e.prototype.getFirstLineIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.firstLine}),p.IterType.Paragraph):this.getAttributes().ind.firstLine},e.prototype.getHangingIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.hanging}),p.IterType.Paragraph):this.getAttributes().ind.hanging},e.prototype.getFirstLineCharsIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.firstLineChars}),p.IterType.Paragraph):this.getAttributes().ind.firstLineChars},e.prototype.getHangingCharsIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.hangingChars}),p.IterType.Paragraph):this.getAttributes().ind.hangingChars},e.prototype.getStyleProp=function(){if(this._state){var t=this.iterAttributeForParagraph([Er.pStyle,p.PropertyFactory.getPropertyClass(p.PropertyType.CTStringWml).tKeys.val])||c.JjT.Undefined;if(t!==c.JjT.Undefined){var e=this._state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(t);if(e&&e.type===p.STStyleType.paragraph)return e}}return c.JjT.Undefined},e.prototype.getStyleName=function(){var t=this.getStyleProp();return t&&t!==c.JjT.Undefined?t.name.val:c.JjT.Undefined},e.prototype.getStyleShowName=function(){var t=this.getStyleProp();return t?t===c.JjT.Undefined?c.JjT.Undefined:p.StyleSheetManager.getStyleShowName(t):c.JjT.Undefined},e.prototype.setStyle=function(t,e,r){if(t.type===p.STStyleType.paragraph)if(this._state&&this._deltaOpt){var n=e||this._deltaOpt.buildDelta(),o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));o.pStyle.val=t.styleId,Array.isArray(r)&&r.length>0?(this.beforeSetStyle(this._state,n,r),this.applyBlockMultiAttribute(o,p.IterType.Paragraph,r,n,p.PropUpdateMode.Merge)):(this.beforeSetStyle(this._state,n),this._applyAttribute(o,p.IterType.Paragraph,p.PropUpdateMode.Merge,n)),n.setCommandType(p.Type.DocModifyParagraphStyle),e||this._state.applyDelta(n)}else this.getAttributes().pStyle.val=t.styleId},e.prototype.beforeSetStyle=function(t,e,r){var n=this;e.splitValidRange(t.getTableStream(),(function(t){var r={range:t,property:p.PropertyUtil.createClearParagraphProperty(!1),mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(r,e)})),(Array.isArray(r)?r:[this.getRange()]).forEach((function(r){var o=n.getParaRange(t,r.begin()).begin(),i=n.getParaRange(t,r.end()-1).end(),a=new p.GCPRange(o,i-o);e.moveTo(a),e.splitValidRange(t.getTableStream(),(function(t){h.Gh.setRunProperty(t,Be.createClearRunProperty(),e,p.PropUpdateMode.Merge)})),e.moveTo(r)}))},e.prototype.getParaRange=function(t,e){return t.getTextStream().createParagraphIterator(new p.GCPRange(e,0)).getRange()},e.prototype.getListId=function(){return this._state?this.iterAttributeForParagraph([Er.numPr,p.PropertyFactory.getPropertyClass(p.PropertyType.CTNumPr).tKeys.numId,p.PropertyFactory.getPropertyClass(p.PropertyType.CTIdString).tKeys.val]):this.getAttributes().numPr.numId.val},e.prototype.getListLevel=function(){return this._state?this.iterAttributeForParagraph([Er.numPr,p.PropertyFactory.getPropertyClass(p.PropertyType.CTNumPr).tKeys.ilvl,p.PropertyFactory.getPropertyClass(p.PropertyType.CTDecimalNumber).tKeys.val]):this.getAttributes().numPr.ilvl.val},e.prototype.getTaskState=function(){return this._state?this.iterAttributeForParagraph([Er.taskPr,p.PropertyFactory.getPropertyClass(p.PropertyType.CTTaskPr).tKeys.taskState]):this.getAttributes().taskPr.taskState},e.prototype.setTaskState=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.taskPr.taskState=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().taskPr.taskState=t},e.prototype.getBorder=function(){return this._state?this.iterAttributeByMerge((function(t){return t.pBdr}),p.IterType.Paragraph):this.getAttributes().pBdr},e.prototype.setBorder=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.pBdr=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().pBdr=t},e.prototype.getHintType=function(){return this._state?this.iterAttributeForParagraph([Er.hintType]):this.getAttributes().hintType},e.prototype.setHintType=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));e.hintType=t,this._applyAttribute(e,p.IterType.Paragraph)}else this.getAttributes().hintType=t},e.prototype.setQuote=function(t,e){var r=null;if(t&&((r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTPBdr))).left.sz=p.QUOTE_LINE_SZ2PT,r.left.color=p.QUOTE_LINE_COLOR,r.left.val=p.STBorder.single),this._state){var n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));n.blockQuote=t,r?n.pBdr=r:n.setNull(n.tKeys.pBdr),this._applyAttribute(n,p.IterType.Paragraph,p.PropUpdateMode.Merge,e)}else this.getAttributes().blockQuote=t,r?this.getAttributes().pBdr=r:this.getAttributes().setNull(this.getAttributes().tKeys.pBdr)},e.prototype.getQuote=function(){return this._state?this.iterAttributeForParagraph([Er.blockQuote]):this.getAttributes().blockQuote},e.prototype.getTabStops=function(){if(this._state){var t=this.iterAttributeForParagraph([Er.tabs],!0);return t===c.JjT.Undefined?[]:t.tab.getPropertyList()}return this.getAttributes().tabs.tab.getPropertyList()},e.prototype.setTabStops=function(t){var e=t.upsertItems,r=t.deleteItems,n=this.getAttributes(),o=n.tabs.tab,i=new Map;o.forEach((function(t){(null==r?void 0:r.has(t.pos))||i.set(t.pos,t)})),null==e||e.forEach((function(t){i.set(t.pos,t)}));var a=Array.from(i.values()).sort((function(t,e){return t.pos-e.pos}));n.tabs.tab.setProperties(a),this._state&&this._applyAttribute(n,p.IterType.Paragraph)},e}(Rr),Lr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateParagraph=function(t,r){return new e(t,r)},e.prototype.getFormat=function(){return this._state&&this._deltaOpt?Mr.createStateParagraphFormat(this._state,this._deltaOpt):Mr.createEmptyParagraphFormat()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=_r.getParagraphIterator(this._state);if(r.seek(t.begin()),r.next()){var n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateParagraph(this._state,n)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=_r.getParagraphIterator(this._state);if(r.seek(t.begin()),r.prev()){var n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateParagraph(this._state,n)}}},e}(Mr),Ar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateParagraphs=function(t,r){return new e(t,r)},e.prototype.createIterator=function(){var t,e,r;return(0,i.__generator)(this,(function(n){switch(n.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._deltaOpt.originRange,e=_r.getParagraphIterator(this._state,t),n.label=1;case 1:return r=h.C1.createLocalDeltaOption(e.getRange(),this._deltaOpt.updateSelection),[4,Lr.createStateParagraph(this._state,r)];case 2:n.sent(),n.label=3;case 3:if(e.next())return[3,1];n.label=4;case 4:return[2]}}))},e}(Ir),Br=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateSectionFormat=function(t,r){return new e(t,r)},e.createEmptySectionFormat=function(){return new e},e.prototype.getAttributes=function(){if(this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;var t=_r.getSectionIterator(this._state,this._deltaOpt.originRange).getCloneProperty();this._attribute=t||new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty))}return this._attribute||(this._attribute=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty))),this._attribute},e.prototype.setSectionFormat=function(t){if(this._state){var e=t.getAttributes();this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().merge(t.getAttributes())},e.prototype.insertHeaderOrFooter=function(t,e,r,n){if(!this._state)return"";var i=e?p.STStoryType.headerContent:p.STStoryType.footerContent,a=e?this.getHeaderStoryId(t):this.getFooterStoryId(t);if(a!==c.JjT.Undefined&&this._state.getStoryStream().getSubStoryInfoFromId(a,i))return a;var s=o.m7.generateRandomId(),l=n||h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1).buildDelta();l.setCommandType(e?p.Type.DocInsertHeader:p.Type.DocInsertFooter);var u=e?new(p.PropertyFactory.getPropertyClass(p.PropertyType.HeaderStoryProperty)):new(p.PropertyFactory.getPropertyClass(p.PropertyType.FooterStoryProperty));u.id=s;var g=e?"header":"footer",d=Be.generateStyleProperty(l,this._state.dataEngine.getDataManager().getStyleSheetManager(),g),y=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));(null==d?void 0:d.type)===p.STStyleType.paragraph&&(y.pStyle.val=null==d?void 0:d.styleId);var f=this._state.getStoryStream().getStoryLastPos(i);h.Gh.insertSubStory(f,u,p.PlaceholderChar.SubStoryBegin,l,p.PropUpdateMode.Insert),h.Gh.insertParagraph(l.currentRange().end(),new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),y,l),h.Gh.insertSubStory(l.currentRange().end(),u.clone(),p.PlaceholderChar.SubStoryEnd,l,p.PropUpdateMode.Insert);var v=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty)),m=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTHdrFtrRef));return m.type=t,m.id=s,(e?v.headerReference:v.footerReference).appendProperty(m,(0,p.convertSTHdrFtrToStr)(m.type)),l.moveTo(r),this._applyAttribute(v,p.IterType.Section,p.PropUpdateMode.Merge,l),n||this._state.applyDelta(l),s},e.prototype.cleanHeaderOrFooter=function(t,e,r,n){if(this._state){var o=r||(e?this.getHeaderStoryId(t):this.getFooterStoryId(t));if(o&&o!==c.JjT.Undefined){var i=this._state.getStoryStream().getSubStoryInfoFromId(o,e?p.STStoryType.headerContent:p.STStoryType.footerContent);if(i){var a=n||h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1).buildDelta();a.setCommandType(e?p.Type.DocDeleteHeader:p.Type.DocDeleteFooter),h.Gh.deleteText(p.GCPRange.insetBoth(i.contentRange,0,1),a),n||this._state.applyDelta(a)}}}},e.prototype.removeHeaderOrFooter=function(t,e,r,n){if(this._state){var o=e?this.getHeaderStoryId(t):this.getFooterStoryId(t);if(o&&o!==c.JjT.Undefined){var i=this._state.getStoryStream().getSubStoryInfoFromId(o,e?p.STStoryType.headerContent:p.STStoryType.footerContent);i&&this.doRemoveHeaderOrFooter(t,e,null==i?void 0:i.range,r,n)}}},e.prototype.removeEmptyHeaderFooter=function(){if(this._state&&this._deltaOpt){var t=this._deltaOpt.buildDelta(),e=t.currentRange();this.removeEmptyHeaderOrFooter(e,!1,t),this.removeEmptyHeaderOrFooter(e,!0,t),this._state.context.isRestrictProtectOn&&(t.globalOpts.updateSelection=!0),this._state.applyDelta(t)}},e.prototype.getEmptyHeaderOrFooterRange=function(t,e,r){var n=e?this.getHeaderStoryId(t):this.getFooterStoryId(t);if(!n||n===c.JjT.Undefined)return null;var o=r.getStoryStream().getSubStoryInfoFromId(n,e?p.STStoryType.headerContent:p.STStoryType.footerContent);return o&&o.contentRange.length()<=1&&this.isDefaultParagraph(o.contentRange)?o.range:null},e.prototype.isDefaultParagraph=function(t){if(!this._state)return!1;var e=this._state.getTextStream().createParagraphIterator(t).getCloneProperty();return!e||(e.setDefault(e.tKeys.paraId),e.setDefault(e.tKeys.pStyle),!!e.isEmpty())},e.prototype.removeEmptyHeaderOrFooter=function(t,e,r){var n=this;if(this._state&&this._deltaOpt){var o=r||this._deltaOpt.buildDelta(),i=this.getEmptyHeaderOrFooterRange(p.STHdrFtr.default,e,this._state),a=this.getEmptyHeaderOrFooterRange(p.STHdrFtr.first,e,this._state),s=this.getEmptyHeaderOrFooterRange(p.STHdrFtr.even,e,this._state),l=[{range:i,type:p.STHdrFtr.default},{range:a,type:p.STHdrFtr.first},{range:s,type:p.STHdrFtr.even}];(l=l.filter((function(t){return null!==t.range}))).sort((function(t,e){return t.range&&e.range?e.range.begin()-t.range.begin():0})),l.forEach((function(r){n.doRemoveHeaderOrFooter(r.type,e,r.range,t,o)})),r||this._state.applyDelta(o)}},e.prototype.doRemoveHeaderOrFooter=function(t,e,r,n,o){if(this._state){var i=o||h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1).buildDelta();i.setCommandType(e?p.Type.DocDeleteHeader:p.Type.DocDeleteFooter);var a=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e?a.headerReference.removeProperty((0,p.convertSTHdrFtrToStr)(t),!1):a.footerReference.removeProperty((0,p.convertSTHdrFtrToStr)(t),!1),i.moveTo(n),this._applyAttribute(a,p.IterType.Section,p.PropUpdateMode.Merge,i),h.Gh.deleteText(r,i),o||this._state.applyDelta(i)}},e.prototype.getHeaderOrFooterStoryId=function(t,e){return t?this.getHeaderStoryId(e):this.getFooterStoryId(e)},e.prototype.getHeaderStoryId=function(t){return this._state?this.iterAttributeForSection((function(e){var r;return(null===(r=e.headerReference.getProperty((0,p.convertSTHdrFtrToStr)(t)))||void 0===r?void 0:r.id)||""})):c.JjT.Undefined},e.prototype.getFooterStoryId=function(t){return this._state?this.iterAttributeForSection((function(e){var r;return(null===(r=e.footerReference.getProperty((0,p.convertSTHdrFtrToStr)(t)))||void 0===r?void 0:r.id)||""})):c.JjT.Undefined},e.prototype.setPageWidth=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.pgSz.w=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().pgSz.w=t},e.prototype.getPageWidth=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgSz.w})):this.getAttributes().pgSz.w},e.prototype.setPageHeight=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.pgSz.h=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().pgSz.h=t},e.prototype.getPageHeight=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgSz.h})):this.getAttributes().pgSz.h},e.prototype.setMarginTop=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.pgMar.top=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().pgMar.top=t},e.prototype.getMarginTop=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgMar.top})):this.getAttributes().pgMar.top},e.prototype.setMarginRight=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.pgMar.right=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().pgMar.right=t},e.prototype.getMarginRight=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgMar.right})):this.getAttributes().pgMar.right},e.prototype.setMarginBottom=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.pgMar.bottom=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().pgMar.bottom=t},e.prototype.getMarginBottom=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgMar.bottom})):this.getAttributes().pgMar.bottom},e.prototype.setMarginLeft=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.pgMar.left=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().pgMar.left=t},e.prototype.getMarginLeft=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgMar.left})):this.getAttributes().pgMar.left},e.prototype.getContentWidth=function(){var t=this.getPageWidth(),e=this.getMarginLeft(),r=this.getMarginRight();return t===c.JjT.Undefined||e===c.JjT.Undefined||r===c.JjT.Undefined?c.JjT.Undefined:t-e-r},e.prototype.setPageStartAt=function(t){if(this._state&&this._deltaOpt){var e=this._deltaOpt.buildDelta();e.setCommandType(p.Type.DocModifySection),e.globalOpts.updateSelection=!1;var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));r.pgNumType.start=t,h.Gh.setSectionProperty(e.currentRange(),r,e,p.PropUpdateMode.Merge),this._state.applyDelta(e)}},e.prototype.getPageStartAt=function(){if(this._state&&this._deltaOpt){var t=this._state.getDataStream().getSectionStream().createSectionIterator(this._deltaOpt.originRange).getCloneProperty();return(null==t?void 0:t.has(t.tKeys.pgNumType))&&(null==t?void 0:t.pgNumType.has(p.PropertyFactory.getPropertyClass(p.PropertyType.CTPageNumber).tKeys.start))?t.pgNumType.start:p.Defaults.section.pageStartAt}return p.Defaults.section.pageStartAt},e.prototype.getColumnNum=function(){return this._state?this.iterAttributeForSection((function(t){return t.cols.num})):this.getAttributes().cols.num},e.prototype.setColumnNum=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.cols.num=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().cols.num=t},e.prototype.getTitlePg=function(){return this._state?this.iterAttributeForSection((function(t){return t.titlePg.val})):this.getAttributes().titlePg.val},e.prototype.setTitlePg=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.titlePg.val=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().titlePg.val=t},e.prototype.setPageNum=function(t){if(this._state){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));e.pgNumType=t,this._applyAttribute(e,p.IterType.Section)}else this.getAttributes().pgNumType=t},e.prototype.setSectType=function(t,e){if(this._state){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));r.type.val=t,this._applyAttribute(r,p.IterType.Section,void 0,e)}else this.getAttributes().type.val=t},e.prototype.getSectType=function(){return this._state?this.iterAttributeForSection((function(t){return t.type.val})):this.getAttributes().type.val},e}(Rr),Nr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateSection=function(t,r){return new e(t,r)},e.prototype.getSectionFormat=function(){return this._state&&this._deltaOpt?Br.createStateSectionFormat(this._state,this._deltaOpt):Br.createEmptySectionFormat()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=_r.getSectionIterator(this._state);if(r.seek(t.begin()),r.next()){var n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateSection(this._state,n)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=_r.getSectionIterator(this._state);if(r.seek(t.begin()),r.prev()){var n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateSection(this._state,n)}}},e}(Br),Or=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.createStateSections=function(t,r){return new e(t,r)},e.prototype.getSectionFormat=function(){return Br.createStateSectionFormat(this._state,this._deltaOpt)},e.prototype.createIterator=function(){var t,e,r;return(0,i.__generator)(this,(function(n){switch(n.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._deltaOpt.originRange,e=_r.getSectionIterator(this._state,t),n.label=1;case 1:return r=h.C1.createLocalDeltaOption(e.getRange(),this._deltaOpt.updateSelection),[4,Nr.createStateSection(this._state,r)];case 2:n.sent(),n.label=3;case 3:if(e.next())return[3,1];n.label=4;case 4:return[2]}}))},e}(Ir),kr=r(100586),Gr=function(t){function e(e,r,n,o){void 0===o&&(o=null);var i=t.call(this,e,r)||this;return i.drawingProp=n,i.drawingStream=i._state.dataEngine.getDataStream().getDrawingStream(),i.parent=o,i.selector=i.editor.createSelector(),i}return(0,i.__extends)(e,t),e.create=function(t,r,n,o){return void 0===o&&(o=null),new e(t,r,n,o)},Object.defineProperty(e.prototype,"editor",{get:function(){return this._state.context},enumerable:!1,configurable:!0}),e.prototype.getAnchorId=function(){return this.drawingProp.anchorId},e.prototype.getProperty=function(){return this.drawingProp.clone()},e.prototype.getBox=function(){var t,e=null===(t=this._state.context.getViewRangeFromGcpRange(this.getRange()))||void 0===t?void 0:t.start,r=null==e?void 0:e.leafBox;return(0,c.qMb)(r)||(0,c.tJJ)(r)?r:null},e.prototype.getAnchorParagraph=function(){var t=this.getBox();if(!t)return null;var e=t.getAncestorOf(c.uOS.Paragraph);return(0,c.wSK)(e)?e:null},e.prototype.getViewParagraph=function(){var t=p.ShapePropertyBuilder.createBuilder(this.getProperty()).getPosition();return t?this.selector.findHitParagraphBox({x:t.offsetH,y:t.offsetV}):null},e.prototype.getChangedOffsetV=function(t,e){var r=this.getAnchorParagraph(),n=kr.MM.getOffsetPoint(r,c.uOS.Page).y,i=e+(t?(0,o.c$)(n):(0,o.c$)(-n)),a=this.getViewParagraph(),s=this.getRange().begin(),l=this.getRange().begin(),p=!1;if(a&&r!==a&&!t){l=a.getRangeBegin();var u=kr.MM.getOffsetPoint(r,c.uOS.Page).y-kr.MM.getOffsetPoint(a,c.uOS.Page).y;u>0&&(i+=(0,o.c$)(u),p=!0)}return{offsetV:i,sourceGcp:s,destGcp:l,needChange:p}},e.prototype.getDeltaOpt=function(t){var e,r=t.updateSelection,n=void 0===r||r,o=t.needCollab,i=void 0===o||o,a=null===(e=this._deltaOpt)||void 0===e?void 0:e.copy();return a?(a.updateSelection=n,a.needCollab=i,a):null},e}(Rr),Hr=function(t){function e(e,r,n,o){void 0===o&&(o=null);var i=t.call(this,e,r,n,o)||this;return i.parent=o,i._deltaOpt.commandType=p.Type.DocModifyImage,i}return(0,i.__extends)(e,t),e.create=function(t,r,n,o){return void 0===o&&(o=null),new e(t,r,n,o)},Object.defineProperty(e.prototype,"graphicObject",{get:function(){return this.parent,this.drawingProp.drawing.graphic.graphicData.pic},enumerable:!1,configurable:!0}),e.prototype.getProperty=function(){return this.drawingProp.clone()},e.prototype.getWidth=function(){return(0,o._i)(this.drawingProp.drawing.extent.cx)},e.prototype.getHeight=function(){return(0,o._i)(this.drawingProp.drawing.extent.cy)},e.prototype.setHeight=function(t){Number.isNaN(t)&&(t=0);var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty));e.drawing.extent.cy=(0,o.c$)(t),e.drawing.graphic.graphicData.pic.spPr.xfrm.ext.cy=(0,o.c$)(t),this._applyAttribute(e,p.IterType.Span)},e.prototype.setWidth=function(t){Number.isNaN(t)&&(t=0);var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty));e.drawing.extent.cx=(0,o.c$)(t),e.drawing.graphic.graphicData.pic.spPr.xfrm.ext.cx=(0,o.c$)(t),this._applyAttribute(e,p.IterType.Span)},e.prototype.getAnchorId=function(){return this.drawingProp.anchorId},e.prototype.getImageSrc=function(){if(this.drawingProp instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty))return Be.getImageInfo(this.drawingProp)},e.prototype.setImageProperties=function(t,e){void 0===e&&(e=!0);var r=this._deltaOpt.buildDelta();r.setCommandType(p.Type.DocModifyImage),h.Gh.setDrawingProperty(r.currentRange(),t,r,p.PropUpdateMode.Merge),r.setUpdateSelection(!1),r.setNeedCollab(e),this._state.applyDelta(r)},e}(Gr),Wr=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.state=e,n.drawingStream=n.state.dataEngine.getDataStream().getDrawingStream(),n.storyStream=n.state.dataEngine.getDataStream().getStoryStream(),n.textStream=n.state.dataEngine.getDataStream().getTextStream(),n}return(0,i.__extends)(e,t),e.create=function(t,r){return new e(t,r)},e.prototype.createIterator=function(){var t,e,r,n,o;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(this._deltaOpt||(this._deltaOpt=h.C1.createLocalDeltaOption(new p.GCPRange(0,this.textStream.getLength()),!1)),!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getDrawingStream(),e=this._deltaOpt.originRange,r=t.createDrawingIterator(e),i.label=1;case 1:return r.hasNext()?(n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),o=r.getCloneProperty(),r.next(),o instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)?[4,Gr.create(this._state,n,o)]:[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return[2]}}))},e.prototype.getTopRelativeHeight=function(){for(var t=this.drawingStream.createDrawingIterator(),e=0;t.hasNext();){var r=t.getProperty();(null==r?void 0:r.isFloating)&&(e=Math.max(e,r.anchor.relativeHeight)),t.next()}return u.nU.getRelativeHeight(u.nU.getZIndex(e)+1)},e.prototype.getAllCharts=function(){if(!this._state)return[];var t=this._state.dataEngine.getDataStream().getDrawingStream().createDrawingIterator(),e=[];do{var r=t.getCloneProperty();r&&r.drawingType===p.DrawingType.Chart&&e.push(r)}while(t.next());return e},e}(Ir),Ur=function(t){function e(e,r){return t.call(this,e,r)||this}return(0,i.__extends)(e,t),e.createStateInlineShapes=function(t,r){return new e(t,r)},e.prototype.addImage=function(t,e,r,n){if(!(n.length<=0))if(Number.isNaN(e)||Number.isNaN(r))console.error("[InlineShapes] addImage with NaN width height");else{var i=this._coreRange(),a=i.fixToValidReplaceRange(i.gcpRange),s=this._state.followSpanProp(a.begin()),l=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty));l.inlineKeyword.extent.cx=(0,o.c$)(e),l.inlineKeyword.extent.cy=(0,o.c$)(r),l.inlineKeyword.docPr.id=t,l.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cx=l.drawing.extent.cx,l.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cy=l.drawing.extent.cy,l.inlineKeyword.graphic.graphicData.pic.blipFill.blip.embed=n;var c=this._deltaOpt.buildDelta();c.setCommandType(p.Type.DocInsertImage),this.state.deleteText(a,c);var u=c.currentRange().end();this.shouldInsertParaAfterInsertImage(u)&&this.insertEmptyParagraph(c,u,{preventTextTrackChanges:!0}),h.Gh.insertImage(u,l,c,s),this._state.applyDelta(c)}},e.prototype.insertImageStart=function(t,e,r,n){var i=this;Number.isNaN(e)||Number.isNaN(r)?console.error("[InlineShapes] insertImageStart with NaN width height"):this._state.insertResourceStart(t,this._deltaOpt,(function(a,s,l){o.Yd.info("insertImageStart callback, insertGcp: ".concat(s));var c=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty));c.inlineKeyword.extent.cx=Math.round((0,o.c$)(e)),c.inlineKeyword.extent.cy=Math.round((0,o.c$)(r)),c.inlineKeyword.docPr.id=t,c.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cx=Math.round((0,o.c$)(e)),c.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cy=Math.round((0,o.c$)(r)),c.inlineKeyword.graphic.graphicData.pic.blipFill.blip.embed=n,a.setCommandType(p.Type.DocInsertImage),i.shouldInsertParaAfterInsertImage(s)&&i.insertEmptyParagraph(a,s),h.Gh.insertImage(s,c,a,l)}))},e.prototype.insertImageProgress=function(t){this._state.insertResourceProgress(t,this._deltaOpt,(function(t,e,r){if(o.Yd.info("insertImageProgress callback, insertGcp: ".concat(e)),r instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)&&r.drawingType===p.DrawingType.Picture){var n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty));r.merge(n),t.setDrawingProperty(new p.GCPRange(e,1),r,p.PropUpdateMode.Merge)}}))},e.prototype.insertImageFinish=function(t,e){var r,n=this;this._state.insertResourceFinish(t,this._deltaOpt,(function(t){var e,o=null===(e=n._state)||void 0===e?void 0:e.getDrawingStream().createDrawingIterator(t),i=null==o?void 0:o.getCloneProperty();return!!i&&(r=i,!0)}),(function(i,a,s){o.Yd.info("insertImageFinish callback, insertGcp: ".concat(a)),i.setCommandType(p.Type.DocInsertImage);var l=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty));l.inlineKeyword.graphic.graphicData.pic.blipFill.blip.embed=e,l.inlineKeyword.extent.cx=r.drawing.extent.cx,l.inlineKeyword.extent.cy=r.drawing.extent.cy,l.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cx=l.inlineKeyword.extent.cx,l.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cy=l.inlineKeyword.extent.cy,l.inlineKeyword.docPr.id=t,n.shouldInsertParaAfterInsertImage(a)&&n.insertEmptyParagraph(i,a,{preventTextTrackChanges:!0}),h.Gh.insertImage(a,l,i,s)}))},e.prototype.insertCopyImageFinish=function(t,e,r,n){var o=this;setTimeout((function(){o._state.insertCopyImageFinish(t,e,r,n)}),200)},e.prototype.replaceImage=function(t,e,r){var n,o,i,a;if(t!==e&&t!==e-1){var s=this._state.getTextStream().createRunIterator();s.seek(t);var l=s.getCloneProperty();if(null==l?void 0:l.isPlaceholder){var c=r||p.PropertyUtil.findPlaceholderCharProperty(this._state.getDataStream(),t);if(c instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)){var u=((null===(n=this._state)||void 0===n?void 0:n.dataEngine.getDataManager())||{}).isTrackRevisions,g=void 0!==u&&u,d=null!==(i=null===(o=this._state)||void 0===o?void 0:o.getRevisionsManager().rangeIncludeInsRevision(new p.GCPRange(t,1)))&&void 0!==i&&i,y=this.readSingleComment(t+1),f=this._deltaOpt.buildDelta();f.setCommandType(p.Type.DocMoveContent),this.deleteCommentRangeIfNecessary(f,t,y),h.Gh.insertImage(e,c,f,l),this.insertCommentRefIfNecessary(f,e,y);var v=y?2:1,m=t<e?t:t+v;this.deleteOriginImage(f,m,v,y,g,d),this._state.applyDelta(f),null===(a=this._state)||void 0===a||a.context.setRangeTo(new p.GCPRange(e+(e>t?0:v),0))}}}},e.prototype.deleteCommentRangeIfNecessary=function(t,e,r){r&&t.deleteCommentRange(r.commentReferenceProperty.id,new p.GCPRange(e,1))},e.prototype.insertCommentRefIfNecessary=function(t,e,r){r&&h.Gh.insertCommentReference(e+1,new p.GCPRange(e,1),r.commentReferenceProperty,t)},e.prototype.deleteOriginImage=function(t,e,r,n,o,i){o?(h.Gh.deleteText(new p.GCPRange(e,1),t),n&&h.Gh.deleteText(new p.GCPRange(e+(i?0:1),1),t,{preventTextTrackChanges:!0})):h.Gh.deleteText(new p.GCPRange(e,r),t)},e.prototype.readSingleComment=function(t){var e,r=this._state.dataEngine.getDataStream(),n=r.createDataIterator(new p.GCPRange(t)).getRange(p.IterType.Span,!0),o=p.PropertyUtil.findPlaceholderCharProperty(r,n.begin());if(o instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.CommentReferenceProperty)){var i=this._state.dataEngine.getDataStream().getAnnotationStream().getCommentRangeInfoFromId(o.id);if(1===(null===(e=null==i?void 0:i.commentRange)||void 0===e?void 0:e.len))return{commentReferenceProperty:o,commentRefInfo:i}}return null},e.prototype.imagesCount=function(){if(!this._state)return 0;var t=this._state.dataEngine.getDataStream().getDrawingStream().createDrawingIterator(),e=0;do{var r=t.getCloneProperty();r&&!r.drawing.graphic.graphicData.pic.isEmpty()&&(e+=1)}while(t.next());return e},e.prototype.allImages=function(){if(!this._state)return[];var t=this._state.dataEngine.getDataStream().getDrawingStream().createDrawingIterator(),e=[];do{var r=t.getCloneProperty();r&&!r.drawing.graphic.graphicData.pic.isEmpty()&&e.push(p.PropertyImageUtil.getImageProperty(r))}while(t.next());return e},e.prototype._coreRange=function(t){return new l.wA(this._state.dataEngine,t||this._deltaOpt.originRange)},e.prototype.isPicture=function(t){return!t.drawing.graphic.graphicData.isEmpty(p.PropertyFactory.getPropertyClass(p.PropertyType.CTGraphicalObjectData).tKeys.pic)},e.prototype.shouldInsertParaAfterInsertImage=function(t){var e;if(null===(e=this._state)||void 0===e?void 0:e.getDataStream().getTableStream().getTableInfo(t))return!0;var r=this.state.getDataStream().getSdtStream(),n=r.getSdtInfo(t);return!!n&&r.isTableBlockSdt(n)},e.prototype.insertEmptyParagraph=function(t,e,r){h.Gh.insertParagraph(e,p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),t,r)},e.prototype.createIterator=function(){var t,e,r,n,o;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getDrawingStream(),e=this._deltaOpt.originRange,r=t.createDrawingIterator(e),i.label=1;case 1:return r.hasNext()?(n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),o=r.getCloneProperty(),r.next(),o instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)&&this.isPicture(o)?[4,Hr.create(this._state,n,o)]:[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(Wr),Vr=function(){function t(t){this.stylesCache=new Map,this.state=t}return t.create=function(e){return this.instance?this.instance:new t(e)},t.prototype.setStyleProperty=function(t,e,r){var n,o=this.state.dataEngine.getDataManager().getStyleSheetManager(),i=this.stylesCache.get(r);if(i)n=i;else{if(!(n=Be.generateStyleProperty(t,o,r)))return void this.checkIfClearRunPropRStyle(e);this.stylesCache.set(r,n)}if(n.type===p.STStyleType.character&&e instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)){var a=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));a.rStyle.val=n.styleId,e.merge(a)}else if(n.type===p.STStyleType.paragraph&&e instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)){var s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));s.pStyle.val=n.styleId,e.merge(s)}},t.prototype.clear=function(){this.stylesCache.clear()},t.prototype.checkIfClearRunPropRStyle=function(t){t instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)&&(t.rStyle.val="")},t}(),zr=function(t){function e(e,r,n,o){var i=t.call(this,e,r,n)||this;return i.storyStream=i._state.dataEngine.getDataStream().getStoryStream(),i.parent=o,i._deltaOpt.commandType=p.Type.DocModifyCodeBlock,i.styleManager=Vr.create(e),i}return(0,i.__extends)(e,t),e.create=function(t,r,n,o){return void 0===o&&(o=null),new e(t,r,n,o)},Object.defineProperty(e.prototype,"graphicObject",{get:function(){return this.parent,this.drawingProp.drawing.graphic.graphicData.wsp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentId",{get:function(){return this.graphicObject.txbx.contentId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textboxStoryProperty",{get:function(){var t,e=null===(t=this.storyStream.getSubStoryInfoFromId(this.contentId,p.STStoryType.textboxContent))||void 0===t?void 0:t.subStoryProp;return e&&e instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty)?e:null},enumerable:!1,configurable:!0}),e.prototype.setDrawingProperty=function(t,e){if(void 0===e&&(e=p.PropUpdateMode.Merge),this._deltaOpt&&this._state){var r=this._deltaOpt.buildDelta();this.setProperty(r,t,e)}},e.prototype.setTextFrameParaStyle=function(t,e){var r;void 0===e&&(e=!1);var n=this.storyStream.getSubStoryInfoFromId(this.contentId,p.STStoryType.textboxContent);if(n){var o=null===(r=this.getDeltaOpt({updateSelection:!1,needCollab:!1}))||void 0===r?void 0:r.buildDelta();if(!o)return;o.setMutOption({preventFormatTrackChanges:!0}),o.setCommandType(p.Type.DocModifyParagraph);var i=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));this.styleManager.setStyleProperty(o,i,t);var a={range:n.contentRange,property:i,mode:p.PropUpdateMode.Merge};if(h.Gh.setParagraphProperty(a,o),e){var s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));s.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.rStyle),h.Gh.setRunProperty(n.contentRange,s,o,p.PropUpdateMode.Merge)}this._state.applyDelta(o)}},e.prototype.getTextFrameType=function(){var t=this.storyStream.getSubStoryInfoFromId(this.contentId,p.STStoryType.textboxContent);return t&&t.subStoryProp instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty)?t.subStoryProp.textBoxType:p.TextFrameType.TextFrame},e.prototype.getSubStoryInfo=function(){return this.storyStream.getSubStoryInfoFromId(this.contentId)},e.prototype.setProperty=function(t,e,r){this._state&&(t.splitValidRange(this._state.getTableStream(),(function(n){h.Gh.setDrawingProperty(n,e,t,r)})),this._state.applyDelta(t))},e}(Gr),Kr=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.state=e,n.drawingStream=n.state.dataEngine.getDataStream().getDrawingStream(),n.storyStream=n.state.dataEngine.getDataStream().getStoryStream(),n.textStream=n.state.dataEngine.getDataStream().getTextStream(),n.styleManager=Vr.create(n.state),n}return(0,i.__extends)(e,t),e.create=function(t,r){return new e(t,r)},e.prototype.gcpRange=function(){return this.state.selection.gcpRange},e.prototype.deltaOption=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!0),h.C1.createLocalDeltaOption(this.gcpRange(),t,e)},e.prototype.getTextFrame=function(t){var e=this.drawingStream.getDrawingInfoFromContentId(t,!0);return this.getTextFrameByDrawingInfo(e)},e.prototype.getTextFrameByAnchorId=function(t){var e=this.drawingStream.getDrawingInfo(t);return this.getTextFrameByDrawingInfo(e)},e.prototype.getTextFrameByDrawingInfo=function(t){var e,r;if(t){var n=t.property,o=t.range,i=h.C1.createLocalDeltaOption(o,null===(e=this._deltaOpt)||void 0===e?void 0:e.updateSelection,null===(r=this._deltaOpt)||void 0===r?void 0:r.needCollab);return zr.create(this.state,i,n)}},e.prototype.getStoryId=function(t){var e=this.state.dataEngine.getDataStream().getDrawingStream().getDrawingInfo(t);return null==e?void 0:e.property.drawing.graphic.graphicData.wsp.txbx.contentId},e.prototype.getAnchorId=function(t){var e=this.state.dataEngine.getDataStream().getDrawingStream().getDrawingInfoFromContentId(t);return null==e?void 0:e.property.anchorId},e.prototype.setStyleProperty=function(t,e,r){this.styleManager.setStyleProperty(t,e,r)},e.addTextFrameStory=function(t,e,r,n,o,i,a){var s,l,c=t.currentRange(),u=null;a&&r.textboxStoryProperty.isLightBlock&&(u=a.getTextStream().createRunIterator(c).getCloneProperty()),u||(u=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)));var g=null!==(s=r.paraProp)&&void 0!==s?s:new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));n&&(null==i||i.setStyleProperty(t,u,n)),o&&(null==i||i.setStyleProperty(t,g,o));var d=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(u);t.moveTo(new p.GCPRange(e,0));var y=r.content&&r.content.length>0?r.content:p.PlaceholderChar.ParagraphReturn,f=y===p.PlaceholderChar.ParagraphReturn,v=r.textboxStoryProperty;h.Gh.insertSubStory(t.currentRange().end(),v,p.PlaceholderChar.SubStoryBegin,t,p.PropUpdateMode.Insert),null===(l=r.withContent)||void 0===l||l.call(r,t);for(var m=new RegExp("".concat(p.PlaceholderChar.ParagraphReturn,"|").concat(p.PlaceholderChar.ParagraphBreak),"g"),P=y[y.length-1].match(m),T=y.split(m),S=P?T.length-1:T.length,C=0;C<S;C++){var b=T[C%S];b&&h.Gh.insertText(t.currentRange().end(),b,u,t,{preventTextTrackChanges:f}),h.Gh.insertParagraph(t.currentRange().end(),d,g,t,{preventTextTrackChanges:f})}h.Gh.insertSubStory(t.currentRange().end(),v,p.PlaceholderChar.SubStoryEnd,t,p.PropUpdateMode.Insert),t.moveTo(c)},e.inputTextframe=function(t,r,n){var i,a,s=n.range(),l=null===(i=n.getShapes().item(0))||void 0===i?void 0:i.getProperty(),c=t.getStoryStream().getSubStoryInfoFromId(null!==(a=null==l?void 0:l.contentId)&&void 0!==a?a:"");if(c)n.setRange(c.contentRange.end(),c.contentRange.end()),n.setText(r);else{var u=h.C1.createLocalDeltaOption(s,!0).buildDelta(),g=o.m7.generateRandomId(),d={content:r,storyType:p.STStoryType.textboxContent,textboxStoryProperty:(0,p.createDefaultTextframeStoryProperty)(g)},y=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty));(null==l?void 0:l.isFloating)?y.anchor.graphic.graphicData.wsp.txbx.contentId=g:y.inlineKeyword.graphic.graphicData.wsp.txbx.contentId=g,h.Gh.setDrawingProperty(s,y,u,p.PropUpdateMode.Merge);var f=t.getStoryStream().getStoryLastPos(p.STStoryType.textboxContent);e.addTextFrameStory(u,f,d),u.moveTo(new p.GCPRange(f+1+r.length,0)),t.applyDelta(u)}},e.prototype.addTextFrame=function(t,r){var n,o=r.selection,i=r.textFrameProp,a=r.spanStyle,s=r.paraStyle,l=r.range,c=null===(n=r.updateSelection)||void 0===n||n,u=this.deltaOption(c).buildDelta();u.setCommandType(p.Type.DocInsertCodeBlock);var g=t.storyType;e.addTextFrameStory(u,this.storyStream.getStoryLastPos(g),t,a,s,this.styleManager,this.state);var d=l||this.gcpRange();if(this.truncateWithRange(u,d,o),this.handleInsertDrawingProperty(i),h.Gh.insertDrawing(u.currentRange().end(),i,u),this.shouldInsertAfterTextFrame(o)&&h.Gh.insertParagraph(u.currentRange().end(),p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),u),this.shouldInsertAfterTextFrameAgain(o)&&h.Gh.insertParagraph(u.currentRange().end(),p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),u),this.state.applyDelta(u),this.styleManager.clear(),c){var y=t.textboxStoryProperty,f=this.storyStream.getSubStoryInfoFromId(y.id,g);if(f){var v=new p.GCPRange(f.contentRange.begin(),0);this.state.setRangeTo(v,{forceFocus:!0,scrollToView:h.hF.None})}}},e.prototype.handleInsertDrawingProperty=function(t){t.drawing.graphic.graphicData.wsp.cNvSpPr.txBox=!0,t.isFloating&&!t.anchor.relativeHeight&&this.state.context.constraintSpace&&(t.anchor.relativeHeight=this.getTopRelativeHeight())},e.prototype.truncateWithRange=function(t,e,r){var n=this.state.getTextStream().createParagraphIterator(e).getCloneProperty();n||(n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)));var o=this.state.getTextStream().createRunIterator(e).getCloneProperty();t.moveTo(e),h.Gh.deleteText(e,t),this.shouldInsertBeforeTextFrame(r)&&h.Gh.insertParagraph(t.currentRange().end(),o||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),n,t)},e.prototype.addPasteTextFrameStory=function(t,r,n,o){var i=this,a=t.currentRange().end(),s=this.storyStream.getStoryLastPos(p.STStoryType.textboxContent),l=this.getOffsetWhenAddPasteTextFrameStory(t);r.forEach((function(r){var a=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange()).buildDelta();e.addTextFrameStory(a,s,r,n,o,i.styleManager),a.operations.length>0&&a.operations.forEach((function(e,r){t.insertOperation(e.clone(),l+r,!1)}))})),t.moveTo(new p.GCPRange(a,0))},e.prototype.getOffsetWhenAddPasteTextFrameStory=function(t){var e=0;return t.someOp((function(t,r,n){if(!Be.isStoryOperation(t)){if(0===r)return!0;var o=n[r-3];if(Be.isStoryEndBreak(o))return e=r,!0}return!1})),e},e.prototype.updateTextFrameDrawingProperty=function(t,e,r){var n;void 0===r&&(r=!0);var o=null===(n=this.drawingStream.getDrawingInfo(t))||void 0===n?void 0:n.range;if(o){var i=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1).buildDelta();i.setCommandType(p.Type.DocModifyShape),h.Gh.setDrawingProperty(o,e,i,p.PropUpdateMode.Merge),i.setNeedCollab(r),this.state.applyDelta(i)}},e.prototype.updateTextFrameSubStoryProperty=function(t,e){var r=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1).buildDelta();r.setCommandType(p.Type.DocModifyCodeBlock);var n=this.drawingStream.createDrawingIterator();if(n.seek(t.begin()),n.getRange().contains(t)){var o=n.getCloneProperty(),i=null==o?void 0:o.drawing.graphic.graphicData.wsp.txbx.contentId;if(i){var a=this.storyStream.getSubStoryInfoFromId(i,p.STStoryType.textboxContent);if(a){var s={range:new p.GCPRange(a.range.end()-1,1),property:e,mode:p.PropUpdateMode.Merge};h.Gh.setSubStoryProperty(s,r),this.state.applyDelta(r)}}}},e.prototype.removeTextFrame=function(t){var e=this.drawingStream.getDrawingInfoFromContentId(t);if(e&&this.storyStream.getSubStoryInfoFromId(t,p.STStoryType.textboxContent)){var r=this.deltaOption().buildDelta();r.setCommandType(p.Type.DocDeleteCodeBlock),this.state.deleteText(e.range,r),this.state.applyDelta(r)}},e.prototype.getTextFrameSubStoryRange=function(t){if(this.drawingStream.getDrawingInfoFromContentId(t)){var e=this.storyStream.getSubStoryInfoFromId(t,p.STStoryType.textboxContent);if(e)return e.range}},e.prototype.getTextFrameDrawingRange=function(t){var e=this.drawingStream.getDrawingInfoFromContentId(t);if(e)return e.range},e.prototype.getTextframeFromContentGCP=function(t){var e=this.storyStream.getSubStoryInfoFromGcp(t);if(e){var r=e.subStoryProp.id;return this.getTextFrame(r)}},e.prototype.findPrevTextFrame=function(t){if(t.isEmpty()){var e=this.storyStream.createStoryIterator(t).getProperty();return e&&e.storyType===p.STStoryType.mainDocument?this.findPrevCharacter(t.begin(),!0):null}return null},e.prototype.findPrevCharacter=function(t,e){void 0===e&&(e=!1);var r=new p.GCPRange(t,0),n=l._l.previousTextBreak(this.state.getTextStream(),r.begin()),o=this.state.getTextStream().createRunIterator(new p.GCPRange(n,0)),i=o.getCloneProperty(),a=o.getRange();if(i){if(i.isPlaceholder){var s=p.PropertyUtil.findPlaceholderCharProperty(this.state.getDataStream(),a.begin());if(s instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)&&!this.state.getRevisionsManager().isAllContentRevisionHidden(a)){var c=s.drawing.graphic.graphicData.wsp.txbx.contentId,u=this.storyStream.getSubStoryInfoFromId(c,p.STStoryType.textboxContent);if((null==u?void 0:u.subStoryProp)instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty))return s}}if(e&&i.isPlaceholder)return this.findPrevCharacter(n)}return null},e.prototype.replaceTextframe=function(t,e,r){if(t!==e&&t!==e-1&&this._state&&this._deltaOpt){var n=this._state.getTextStream().createRunIterator();n.seek(t);var o=n.getCloneProperty();if(null==o?void 0:o.isPlaceholder){var i=null!=r?r:p.PropertyUtil.findPlaceholderCharProperty(this._state.getDataStream(),t);if(i instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)){var a=this._deltaOpt.buildDelta();a.globalOpts.updateSelection=!0,a.setCommandType(p.Type.DocMoveContent),h.Gh.deleteText(new p.GCPRange(t,1),a),h.Gh.insertDrawing(t<e?e-1:e,i,a),a.moveTo(p.GCPRange.insetBoth(a.currentRange(),-1,0)),this._state.applyDelta(a)}}}},e.prototype.isTextframe=function(t){return t.drawingType===p.DrawingType.WordprocessingShape},e.prototype.shouldInsertBeforeTextFrame=function(t){return!1},e.prototype.shouldInsertAfterTextFrame=function(t){return t.isSelectionEndAtStoryEnd(!1)&&t.storyType()===p.STStoryType.mainDocument},e.prototype.shouldInsertAfterTextFrameAgain=function(t){return!1},e.prototype.createIterator=function(){var t,e,r,n,o;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(this._deltaOpt||(this._deltaOpt=h.C1.createLocalDeltaOption(new p.GCPRange(0,this.textStream.getLength()),!1)),!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getDrawingStream(),e=this._deltaOpt.originRange,r=t.createDrawingIterator(e),i.label=1;case 1:return r.hasNext()?(n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),o=r.getCloneProperty(),r.next(),o instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)&&this.isTextframe(o)?[4,zr.create(this._state,n,o)]:[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(Wr),jr=function(t){function e(e,r,n,o){var i=t.call(this,e,r,n,o)||this;return i._deltaOpt.commandType=p.Type.DocModifyCodeBlock,i}return(0,i.__extends)(e,t),e.create=function(t,r,n,o){return void 0===o&&(o=null),new e(t,r,n,o)},e.prototype.highlightCodeblockRunStyle=function(t,e,r){var n,o=this,i=this.storyStream.getSubStoryInfoFromId(t,p.STStoryType.textboxContent);if(i){var a=null===(n=this.getDeltaOpt({updateSelection:!1,needCollab:!1}))||void 0===n?void 0:n.buildDelta();if(!a)return;a.setCommandType(p.Type.DocModifyText),e.forEach((function(t){var e=t.length,n=i.contentRange.begin()+r+t.start,s=new p.GCPRange(n,e),l=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));l.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.rFonts),o.styleManager.setStyleProperty(a,l,t.styleName),h.Gh.setRunProperty(s,l,a,p.PropUpdateMode.Merge)})),this._state.applyDelta(a)}},e}(zr),Yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.create=function(t,r){return new e(t,r)},e.prototype.getCodeblock=function(t){var e,r;if(!this.isCodeblock(t))return null;var n=this.drawingStream.getDrawingInfoFromContentId(t,!0);if(!n)return null;var o=n.property,i=n.range,a=h.C1.createLocalDeltaOption(i,null===(e=this._deltaOpt)||void 0===e?void 0:e.updateSelection,null===(r=this._deltaOpt)||void 0===r?void 0:r.needCollab);return jr.create(this.state,a,o)},e.prototype.isCodeblock=function(t){var e,r=null===(e=this.storyStream.getSubStoryInfoFromId(t,p.STStoryType.textboxContent))||void 0===e?void 0:e.subStoryProp;return!!(r&&r instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty))&&r.isCodeBlock},e.prototype.createDefaultCodeblockProperty=function(t,e){var r=e.getRange(0,0).getSectionFormat().getContentWidth();return(0,p.createDefaultCodeblockProperty)(t,r)},e.prototype.highlightCodeblockRunStyle=function(t,e,r){var n=this.getCodeblock(t);null==n||n.highlightCodeblockRunStyle(t,e,r)},e.prototype.shouldInsertBeforeTextFrame=function(t){var e=t.getParaRangeFromSelection(!0),r=this.state.getTextStream().readText(e.begin(),this.gcpRange().begin()-e.begin()),n=t.relationToSelectAndPara(!0,!0,!0),o=0===this.gcpRange().len&&r.startsWith("```")&&r.endsWith(" "),i=n||o,a=t.storyRange().begin(),s=t.isSelectionBeginAtStoryBegin(),l=o&&a===e.begin();return!i||i&&(s||l)},e.prototype.shouldInsertAfterTextFrame=function(t){var e=t.relationToSelectAndPara(!1,!1,!1,!1),r=!e,n=e&&t.isSelectionEndAtStoryEnd(!1);return r||n},e.prototype.shouldInsertAfterTextFrameAgain=function(t){return t.isSelectionEndAtStoryEnd(!0)},e.prototype.createIterator=function(){var t,e,r,n,o,a;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(this._deltaOpt||(this._deltaOpt=h.C1.createLocalDeltaOption(new p.GCPRange(0,this.textStream.getLength()),!1)),!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getDrawingStream(),e=this._deltaOpt.originRange,r=t.createDrawingIterator(e),i.label=1;case 1:return r.hasNext()?(n=h.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),o=r.getCloneProperty(),r.next(),o instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)&&(a=this.getStoryId(o.anchorId))&&this.isCodeblock(a)?[4,jr.create(this._state,n,o)]:[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(Kr),qr=function(t){function e(e,r,n){var o=t.call(this,e,r)||this;return o.pluginProp=n,o}return(0,i.__extends)(e,t),e.prototype.getAttributes=function(){return this.pluginProp},e.createStateInlinePlugin=function(t,r,n){return new e(t,r,n)},e}(Rr),Qr=function(t){function e(e,r){return t.call(this,e,r)||this}return(0,i.__extends)(e,t),e.createStateInlinePlugins=function(t,r){return new e(t,r)},e.prototype._coreRange=function(t){return new l.wA(this._state.dataEngine,t||this._deltaOpt.originRange)},e.prototype.createIterator=function(){var t,e,r,n,o,a,s,l,c,u,g,d;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getFieldStream(),e=this._deltaOpt.originRange,r=t.createFieldIterator({limitRange:e}),i.label=1;case 1:return(n=r.getRange()).isValid()?(o=t.getDecodedFieldInfo(n.begin()))?(a=h.C1.createLocalDeltaOption(o.fieldRange,this._deltaOpt.updateSelection),s=r.getProperty(),l=o.fieldCode,c=l.name,u=l.instructions,g=l.switches,d=p.FieldUtil.encodeFieldCode(c,u,g),s&&p.FieldCodeManager.getInstance().isContainerField(d)?[4,qr.createStateInlinePlugin(this._state,a,s)]:[3,3]):[3,3]:[3,4];case 2:i.sent(),i.label=3;case 3:if(r.hasNext()&&r.next())return[3,1];i.label=4;case 4:return[2]}}))},e.prototype.insertPlugin=function(t,e){e.insertField(t.fieldCode,t.fieldResult,{})},e.prototype._insertPluginWithProperty=function(t){var e=this._coreRange().fixToValidReplaceRange(this._coreRange().gcpRange),r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty))(this._state.followSpanProp(e.begin()));t.merge(r);var n=this._deltaOpt.buildDelta();n.setCommandType(p.Type.DocInsertPlugin),h.Gh.deleteText(e,n),h.Gh.insertDrawing(n.currentRange().end(),t,n),this._state.applyDelta(n)},e.prototype.insertPluginFromGCP=function(t){var e=this._coreRange().fixToValidReplaceRange(this._coreRange().gcpRange),r=this._state.followSpanProp(e.end()),n=this._deltaOpt.buildDelta();h.Gh.insertField(t.fieldCode,t.fieldResult,r,n),this._state.applyDelta(n)},e.prototype.insertPluginStart=function(t,e,r,n,o){},e.prototype.insertPluginFinish=function(t,e,r){},e.prototype.insertPluginCancel=function(t){this._state.insertResourceCancel(t)},e.prototype._setPluginInfo=function(t,e,r,n,o){},e.prototype.movePlugin=function(t,e){var r,n,o,i=t,a=e,s=null===(r=this._state)||void 0===r?void 0:r.getFieldStream().getDecodedFieldInfo(i),l=null==s?void 0:s.fieldRange,c=null===(n=null==s?void 0:s.fieldResult)||void 0===n?void 0:n.range;if(i!==a&&l&&c&&s&&!s.hasNestField){var u=this._deltaOpt.buildDelta();u.setCommandType(p.Type.DocMoveContent);var g=null===(o=this._state)||void 0===o?void 0:o.getTextStream().readText(c.gcpBegin,c.len);h.Gh.deleteText(l,u),i<a?u.moveTo(new p.GCPRange(a-l.len,0)):u.moveTo(new p.GCPRange(a,0));var d=s.fieldCode,y=d.name,f=d.instructions,v=d.switches,m=p.FieldUtil.encodeFieldCode(y,f,v);h.Gh.insertField(m,g,new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),u),this._state.applyDelta(u)}},e}(Ir),Xr=function(){function t(t,e,r){this.nestingLevel=e,this.range=r,this.state=t}return Object.defineProperty(t.prototype,"dataStream",{get:function(){return this.state.dataEngine.getDataStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRaw",{get:function(){return!this.range.isValid()},enumerable:!1,configurable:!0}),t.prototype.getRange=function(){return this.range},t.prototype.beforeCreateOperation=function(t){this.beforeHooks||(this.beforeHooks=[]),this.beforeHooks.push(t)},t.prototype.afterCreateOperation=function(t){this.afterHooks||(this.afterHooks=[]),this.afterHooks.push(t)},t.prototype.invokeAfterCreateHook=function(t,e){var r,n;if(this.afterHooks)try{for(var o=(0,i.__values)(this.afterHooks),a=o.next();!a.done;a=o.next())(0,a.value)(t,e)}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},t.prototype.invokeBeforeCreateHook=function(t,e){var r,n;if(this.beforeHooks)try{for(var o=(0,i.__values)(this.beforeHooks),a=o.next();!a.done;a=o.next())(0,a.value)(t,e)}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},t}();function Jr(t,e){for(var r=t.length-1;r>=0;r--)e(t[r],r)}function Zr(t){t.setNull(t.tKeys.numPr),t.setNull(t.tKeys.taskPr)}function $r(t){t.setDefault(t.tKeys.pPrChange)}var tn=r(930563),en=function(t){function e(e){var r=t.call(this,e.state,e.nestingLevel,e.range)||this;return r.gridSpan=0,r.gridIndex=0,r.isLackParagraph=!0,r.dirtyProperties={},r.cellProperty=e.cellProperty,r.parent=e.row,r.paraProperty=e.paraProperty,r.interval=e.interval,r.contentRange=e.contentRange||p.GCPRange.emptyRange(),r.runProperty=e.runProperty,r}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"actionManager",{get:function(){return this.parent.parent.getTableActionManager()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return p.TablePropertyUtil.getWidth(this.cellProperty.tcW)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this.getCurrentIndex()},enumerable:!1,configurable:!0}),e.createTableCell=function(t){return new e((0,i.__assign)({range:p.GCPRange.invalidRange()},t))},e.prototype.getContentRange=function(){return this.contentRange},e.prototype.nextCell=function(){var t=this.parent.cells.indexOf(this);return t+1>=0?this.parent.cells[t+1]:null},e.prototype.prevCell=function(){var t=this.parent.cells.indexOf(this);return t-1>=0?this.parent.cells[t-1]:null},e.prototype.getCaretStart=function(){return new p.GCPRange(this.range.begin(),1)},e.prototype.getCaretEnd=function(){return new p.GCPRange(this.range.end()-1,1)},e.prototype.deletePlaceholder=function(){this.deleteRange(new p.GCPRange(this.range.end()-1,1),!0)},e.prototype.getValidRangeOnRestrictEdit=function(t){if(!t||!t.isValid())return t;if(this.state.context instanceof tn.z&&!this.state.context.isRestrictProtectOn)return t;var e=this.state.dataEngine.getDataStream().getTableStream().getRowInfo(t.begin());if(e){var r=this.state.getDataStream().getSdtStream().findDeepestRowSdtByRange(e.range),n=this.state.getDataStream().getSdtStream().findShallowestRowSdtByRange(e.range);if(r&&n&&n.property.nestingLevel<=1)return r.contentRange.intersectRange(t)}return t},e.prototype.deleteContent=function(){this.isRaw||this.deleteRange(p.GCPRange.insetBoth(this.contentRange,0,1))},e.prototype.deleteCell=function(){this.deleteRange(this.range,!0),this.parent.cells.splice(this.getCurrentIndex(),1)},e.prototype.deleteRange=function(t,e){var r=this.getValidRangeOnRestrictEdit(t);this.actionManager.createDeleteAction(this,{range:r,preventTextTrackChanges:e})},e.prototype.insertLeft=function(t,e){var r=this.getCurrentIndex();this.parent.cells.splice(r,0,t),t.parent=this.parent,this.isRaw||t.insertTo((0,i.__assign)({gcp:this.range.begin()},e||{}))},e.prototype.insertRight=function(t,e){var r=this.getCurrentIndex();this.parent.cells.splice(r+1,0,t),t.parent=this.parent,this.isRaw||t.insertTo((0,i.__assign)({gcp:this.range.end()},e||{}))},e.prototype.getVMergeCells=function(){var t,e,r=[this];if(this.getProperty().vMerge.val!==p.STMerge.restart)return r;for(var n=this.parent,o=n.parent.rows,a=o.indexOf(n)+1;a<o.length;a++){var s=!1;try{for(var l=(t=void 0,(0,i.__values)(o[a].cells)),c=l.next();!c.done;c=l.next()){var u=c.value;if(u.interval.isEqual(this.interval)&&u.getProperty().vMerge.val===p.STMerge.continue){s=!0,r.push(u);break}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}if(!s)break}return r},e.prototype.setProperty=function(t){this.isRaw?this.cellProperty.assign(t):(this.dirtyProperties.cell?this.dirtyProperties.cell.property.assign(t):(this.dirtyProperties.cell={property:t,mode:p.PropUpdateMode.Merge},this.cellProperty=this.cellProperty.clone()),this.cellProperty.assign(t),this.actionManager.createModifyAction(this))},e.prototype.isEmpty=function(){return 2===this.range.len},e.prototype.hasSdtInCell=function(t){return!(!t||!t.getRange().isValid())&&this.state.getDataStream().getSdtStream().collectSdtInContainedRange(t.getRange()).length>0},e.prototype.splitCell=function(t,r){for(var n=t-1,o=[this],i=this.cellProperty.clone(),a=this.hasSdtInCell(this)?[]:this.collectParagraph(),s=Math.floor(a.length/t),l=a.length%t,c=0,u=n;u>0;u--){var g=e.createTableCell({state:this.state,cellProperty:new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))(i),paraProperty:(null==r?void 0:r.paragraph)||new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(this.paraProperty),row:this.parent,runProperty:(null==r?void 0:r.run)||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(this.runProperty),nestingLevel:this.nestingLevel}),h=s*u+Math.min(l,u)-1;s>0||u<l?(g.disableAppendDefaultPara(),this.parent.cells.splice(this.index,0,g),g.insertTo({gcp:a[h].end(),preventTextTrackChanges:!0}),o.splice(c,0,g),c+=1):(this.insertRight(g,{preventTextTrackChanges:!0}),o.splice(c+1,0,g))}return this.averageWidth(o,this.width),o},e.prototype.averageWidth=function(t,e){for(var r=Math.floor(e/t.length),n=e-r*(t.length-1),o=0;o<t.length-1;o++)t[o].setWidth(r);t[t.length-1].setWidth(n)},e.prototype.splitToGridUnit=function(t){this.gridSpan||this.parent.updateCellSpan();var r=Math.max(null!=t?t:this.gridIndex,this.gridIndex+1);if(!(r<this.gridIndex||r>=this.gridIndex+this.gridSpan)&&1!==this.gridSpan){var n=this.parent.parent.grid,o=r-this.gridIndex;this.setWidth(n.getWidth(this.gridIndex,o));for(var i=this.gridSpan-o-1;i>=0;i--){var a=e.createTableCell({state:this.state,cellProperty:new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))(this.cellProperty),paraProperty:new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(this.paraProperty),row:this.parent,nestingLevel:this.nestingLevel});a.setWidth(n.getWidth(r+i,1)),this.insertRight(a,{preventTextTrackChanges:!0})}}},e.prototype.setWidth=function(t){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));e.tcW.w=t,e.tcW.type=p.STTblWidth.dxa,this.setProperty(e)},e.prototype.setGrid=function(t,e){this.gridIndex=t,this.gridSpan=e},e.prototype.getGridSpan=function(){return 0===this.gridSpan&&this.parent.updateCellSpan(),this.gridSpan},e.prototype.getProperty=function(){return this.cellProperty},e.prototype.getParagraphProperty=function(){return this.paraProperty},e.prototype.isMainVMergeCell=function(){return this.cellProperty.vMerge.val===p.STMerge.restart},e.prototype.isLastVMergeCell=function(){var t,e;if(!this.isVMergedCell())return!1;var r=this.parent,n=r.parent.rows,o=n.indexOf(r);if(o===n.length-1)return!0;try{for(var a=(0,i.__values)(n[o+1].cells),s=a.next();!s.done;s=a.next()){var l=s.value;if(l.interval.isEqual(this.interval)&&l.isVMergedCell())return!1}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return!0},e.prototype.isVMergedCell=function(){return this.cellProperty.vMerge.val===p.STMerge.continue},e.prototype.clone=function(){return this.cloneBase()},e.prototype.cloneDeep=function(){var t=this.cloneBase();if(this.isRaw)return t;var e=h.Me.collectDataToOps({dataEngine:this.state.dataEngine,range:this.contentRange});return t.afterCreateOperation((function(t,r){var n,o,a=h.Yy.moveOps(e,t);try{for(var s=(0,i.__values)(a),l=s.next();!l.done;l=s.next()){var p=l.value;r.addOperation(p)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}})),t.disableAppendDefaultPara(),t},e.prototype.insertTo=function(t){this.isRaw&&this.actionManager.createInsertAction(this,t)},e.prototype.clearVMerge=function(){var t=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty).tKeys.vMerge),this.setProperty(t)},e.prototype.setToMerged=function(){var t=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));t.vMerge.val=p.STMerge.continue,this.setProperty(t)},e.prototype.unVMerge=function(){this.isMainVMergeCell()&&Jr(this.getVMergeCells(),(function(t){t.clearVMerge()}))},e.prototype.prevCellOfMergedGroup=function(){var t;if(!this.isVMergedCell())return null;var e=null===(t=this.parent.prevRow())||void 0===t?void 0:t.getIntervalEqualCell(this.interval);return e&&(e.isMainVMergeCell()||e.isVMergedCell())?e:null},e.prototype.nextCellOfMergedGroup=function(){var t;if(!this.isVMergedCell()&&!this.isMainVMergeCell())return null;var e=null===(t=this.parent.nextRow())||void 0===t?void 0:t.getIntervalEqualCell(this.interval);return(null==e?void 0:e.isVMergedCell())?e:null},e.prototype.coverProperty=function(t){this.cellProperty=t,this.isRaw||(this.dirtyProperties.cell={property:t,mode:p.PropUpdateMode.Cover}),this.actionManager.createModifyAction(this)},e.prototype.disableAppendDefaultPara=function(){this.isLackParagraph=!1},e.prototype.getMainCell=function(){var t;if(!this.isVMergedCell())return null;var e=this.parent.parent,r=e.mergedMapping.getMainCell(this.parent.index,this.interval.begin);return r&&(null===(t=e.rows[r.rowIndex])||void 0===t?void 0:t.findCellFromCol(r.colBegin))||null},e.prototype.coverParagraph=function(t){this.paraProperty=t.paragraph,this.runProperty=t.run,this.isRaw||(this.dirtyProperties.paragraph={mode:p.PropUpdateMode.Cover,property:t.paragraph},t.run&&(this.dirtyProperties.run={mode:p.PropUpdateMode.Cover,property:t.run}))},e.prototype.applyInsert=function(t,e){if(h.Gh.insertTableCell(t.gcp,this.cellProperty,e),this.isLackParagraph){var r=this.paraProperty.isPlaceholder?new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)):this.paraProperty;Zr(r),$r(r);var n=this.runProperty||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));(a=n).setDefault(a.tKeys.rPrChange);var o=this.parent.getProperty(),i=o.readOnly((function(){return o.ins}));h.Gh.insertParagraph(t.gcp,n,r,e,{preventTextTrackChanges:t.preventTextTrackChanges||!i})}var a},e.prototype.applyModify=function(t){this.dirtyProperties.paragraph&&h.Gh.setParagraphProperty((0,i.__assign)((0,i.__assign)({},this.dirtyProperties.paragraph),{range:this.contentRange}),t),this.dirtyProperties.run&&h.Gh.setRunProperty(this.contentRange,this.dirtyProperties.run.property,t,this.dirtyProperties.run.mode),this.dirtyProperties.cell&&(this.dirtyProperties.cell.property.nestingLevel=this.nestingLevel,h.Gh.setTableCellProperty((0,i.__assign)((0,i.__assign)({},this.dirtyProperties.cell),{range:this.range}),t))},e.prototype.getGridIndex=function(){return this.gridIndex},e.prototype.getFollowParaStyle=function(){var t=this.dataStream.getTextStream().createParagraphIterator();t.seek(this.range.begin());var e=this.dataStream.getTextStream().createRunIterator();return e.seek(this.range.begin()),{paragraph:t.getCloneProperty()||new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),run:e.getCloneProperty()||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))}},e.prototype.collectParagraph=function(){if(this.isRaw||this.hasNestingTable())return[];for(var t=this.dataStream.getTextStream().createParagraphIterator(this.contentRange),e=[];t.hasNext();)e.push(t.getRange(!0)),t.next();return e},e.prototype.hasNestingTable=function(){return this.tableStream.createTableIterator({limitRange:this.contentRange,nestingLevel:this.nestingLevel+1}).hasNext()},e.prototype.getCurrentIndex=function(){return this.parent.cells.indexOf(this)},e.prototype.cloneBase=function(){var t=e.createTableCell({state:this.state,cellProperty:new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))(this.cellProperty),paraProperty:new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(this.paraProperty),runProperty:new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(this.getRunProperty()),row:this.parent,nestingLevel:this.nestingLevel});return t.parent=this.parent,t},e.prototype.getRunProperty=function(){if(this.isRaw||this.runProperty)return this.runProperty;var t=this.dataStream.getTextStream().createRunIterator();t.seek(this.contentRange.end()-1);var e=t.getProperty();return e&&(this.runProperty=e),this.runProperty},e}(Xr),rn=function(t){function e(e,r){var n=t.call(this,e,r.property.nestingLevel,r.range)||this;return n.cacheCells=[],n.hasInit=!1,n.stageProperty=null,n.beforeSpan=0,n.property=r.property,n}return(0,i.__extends)(e,t),e.createTableRow=function(t,r){return new e(t,(0,i.__assign)({range:p.GCPRange.invalidRange(),contentRange:p.GCPRange.invalidRange()},r))},Object.defineProperty(e.prototype,"index",{get:function(){return this.parent.rows.indexOf(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.property.trHeight.val},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cells",{get:function(){return this.hasInit||this.initCells(),this.cacheCells},set:function(t){this.hasInit=!0,this.cacheCells=t},enumerable:!1,configurable:!0}),e.prototype.prevRow=function(){var t=this.parent.rows.indexOf(this);return t-1>=0?this.parent.rows[t-1]:null},e.prototype.nextRow=function(){var t=this.parent.rows.indexOf(this);return t+1<this.parent.rows.length?this.parent.rows[t+1]:null},e.prototype.firstCell=function(){return this.cells[0]},e.prototype.lastCell=function(){return this.cells[this.cells.length-1]},e.prototype.getIntervalContainCells=function(t){var e,r,n=[];try{for(var o=(0,i.__values)(this.cells),a=o.next();!a.done;a=o.next()){var s=a.value;t.isContain(s.interval)&&n.push(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n},e.prototype.getIntervalIntersectCells=function(t){var e,r,n=[];try{for(var o=(0,i.__values)(this.cells),a=o.next();!a.done;a=o.next()){var s=a.value;t.isIntersect(s.interval)&&n.push(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n},e.prototype.getIntervalEqualCell=function(t){var e,r;try{for(var n=(0,i.__values)(this.cells),o=n.next();!o.done;o=n.next()){var a=o.value;if(a.interval.isEqual(t))return a}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return null},e.prototype.insertBefore=function(t){var e=this.parent.rows.indexOf(this);this.parent.rows.splice(e,0,t),this.isRaw||t.insertTo(this.range.begin())},e.prototype.insertAfter=function(t){var e=this.parent.rows.indexOf(this);this.parent.rows.splice(e+1,0,t),this.isRaw||t.insertTo(this.range.end())},e.prototype.getProperty=function(){return this.property},e.prototype.getPropertyWithoutRevision=function(){var t=this.getProperty().clone();return t.delete(t.tKeys.ins),t.delete(t.tKeys.del),t},e.prototype.appendCell=function(t){return this.cells.push(t),t.parent=this,t},e.prototype.hasRevision=function(){var t=this.getProperty();return!!t.readOnly((function(){return t.ins}))||!!t.readOnly((function(){return t.del}))||!1},e.prototype.deleteRow=function(){this.fixMergedGroupWhenDelete(),this.parent.rows.splice(this.index,1),this.parent.getTableActionManager().createDeleteAction(this,{range:this.range})},e.prototype.deletePlaceholder=function(){this.parent.getTableActionManager().createDeleteAction(this,{range:new p.GCPRange(this.range.end()-1,1)})},e.prototype.isEqualToContent=function(t){return this.cells.length===t.length},e.prototype.getGrids=function(){var t=[],e=this.property.wBefore.w;return e&&t.push(Number(e)),t.concat(this.cells.map((function(t){return t.width})))},e.prototype.clone=function(){return this.cloneBase((function(t){return t.clone()}))},e.prototype.cloneDeep=function(){return this.cloneBase((function(t){return t.cloneDeep()}))},e.prototype.setHeight=function(t){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableRowProperty));e.trHeight.val=t,this.setProperty(e)},e.prototype.setMainCellToNormal=function(){Jr(this.cells,(function(t){t.isMainVMergeCell()&&t.clearVMerge()}))},e.prototype.setMergedCellToNormal=function(){Jr(this.cells,(function(t){t.isVMergedCell()&&t.clearVMerge()}))},e.prototype.setMainCellToBeMerged=function(){Jr(this.cells,(function(t){t.isMainVMergeCell()&&t.setToMerged()}))},e.prototype.findCellFromCol=function(t){return this.cells.find((function(e){return e.interval.begin===t}))||null},e.prototype.insertTo=function(t){this.isRaw&&(this.parent.getTableActionManager().createInsertAction(this,{gcp:t}),Jr(this.cells,(function(e){e.insertTo({gcp:t})})))},e.prototype.updateCellInterval=function(){var t,e,r=p.TablePropertyUtil.getWidth(this.property.wBefore);try{for(var n=(0,i.__values)(this.cells),o=n.next();!o.done;o=n.next()){var a=o.value;a.interval=(0,p.createColumnInterval)(r,r+a.width),r+=a.width}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e.prototype.updateCellSpan=function(){var t=this;this.beforeSpan=this.parent.grid.getSpan(0,p.TablePropertyUtil.getWidth(this.property.wBefore));var e=this.beforeSpan;this.cells.forEach((function(r){var n=t.parent.grid.getSpan(e,r.width);n&&(r.setGrid(e,n),e+=n)}))},e.prototype.updateCellWidth=function(){var t,e,r=this.parent.grid.getWidth(0,this.beforeSpan);r&&this.setBeforeWidth(r);var n=this.beforeSpan;try{for(var o=(0,i.__values)(this.cells),a=o.next();!a.done;a=o.next()){var s=a.value,l=s.getGridSpan(),p=this.parent.grid.getWidth(n,l);s.setWidth(p),n+=l}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},e.prototype.applyInsert=function(t,e){h.Gh.insertTableRow(t.gcp,this.getPropertyWithoutRevision(),e)},e.prototype.applyModify=function(t){this.stageProperty&&(this.stageProperty.nestingLevel=this.nestingLevel,h.Gh.setTableRowProperty({property:this.stageProperty,mode:p.PropUpdateMode.Merge,range:this.range},t))},e.prototype.setBeforeWidth=function(t){var e=this.createProperty();e.wBefore.w=t,e.wBefore.type=p.STTblWidth.dxa,this.setProperty(e)},e.prototype.setProperty=function(t){this.isRaw?this.property.assign(t):(this.stageProperty||(this.property=this.property.clone(),this.stageProperty=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableRowProperty))),this.property.assign(t),this.stageProperty.assign(t),this.parent.getTableActionManager().createModifyAction(this))},e.prototype.createProperty=function(){return new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableRowProperty))},e.prototype.initCells=function(){var t,e,r=this.tableStream.getCellsOfRowRange(this.range,this.nestingLevel);if(r){try{for(var n=(0,i.__values)(r.cells),o=n.next();!o.done;o=n.next()){var a=o.value,s=this.dataStream.getTextStream().createParagraphIterator();s.seek(a.contentRange.end()-1);var l=s.getProperty();if(l){var p={state:this.state,range:a.range,cellProperty:a.property,paraProperty:l,row:this,nestingLevel:this.nestingLevel,interval:a.interval,contentRange:a.contentRange},c=en.createTableCell(p);c.parent=this,this.cacheCells.push(c)}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.hasInit=!0}},e.prototype.fixMergedGroupWhenDelete=function(){Jr(this.cells,(function(t){if(t.isMainVMergeCell())t.unVMerge();else{var e=t.prevCellOfMergedGroup();t.isVMergedCell()&&(null==e?void 0:e.isMainVMergeCell())&&!t.nextCellOfMergedGroup()&&(null==e||e.clearVMerge())}}))},e.prototype.cloneBase=function(t){var r=e.createTableRow(this.state,{property:this.property});return r.cells=this.cells.map((function(e){var n=t(e);return n.parent=r,n})),r.parent=this.parent,r},e}(Xr),nn=function(){function t(t){this.tableActionQueue=[],this.state=t}return t.prototype.createInsertAction=function(t,e){var r={insert:e};this.tableActionQueue.push({payload:t,action:r})},t.prototype.createModifyAction=function(t){this.tableActionQueue.push({payload:t,action:{modify:{}}})},t.prototype.createDeleteAction=function(t,e){var r={delete:e};this.tableActionQueue.push({payload:t,action:r})},t.prototype.consumeActionsToDelta=function(t,e){var r,n,o,a,s=e?this.getTableOrderedActionQueue(e):this.getNormalActionQueue();try{for(var l=(0,i.__values)(s),p=l.next();!p.done;p=l.next()){var c=p.value,u=c.payload,g=c.action,h=null!==(a=null===(o=g.insert)||void 0===o?void 0:o.gcp)&&void 0!==a?a:u.getRange().begin();u.invokeBeforeCreateHook(h,t),this.applyDirtyModel(u,g,t),u.invokeAfterCreateHook(h,t)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}this.clearActions()},t.prototype.clearActions=function(){this.tableActionQueue=[]},t.prototype.applyDirtyModel=function(t,e,r){e.insert?t.applyInsert(e.insert,r):(e.modify&&t.applyModify(r),e.delete&&l.s$.deleteTextForTable(e.delete.range,this.state,r,{preventTextTrackChanges:e.delete.preventTextTrackChanges}))},t.prototype.getNormalActionQueue=function(){var t,e,r=[],n=[];try{for(var o=(0,i.__values)(this.tableActionQueue),a=o.next();!a.done;a=o.next()){var s=a.value,l=s.action;(null==l?void 0:l.modify)&&!l.delete?r.push(s):n.push(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return r.concat(n)},t.prototype.getTableOrderedActionQueue=function(t){var e,r,n,o,a,s,l,p,c=[],u=new Array(t.rows.length),g=t.rows.map((function(t){return new Array(t.cells.length)})),h=[];try{for(var d=(0,i.__values)(this.tableActionQueue),y=d.next();!y.done;y=d.next()){var f=(F=y.value).payload,v=F.action;if(f instanceof on)c.push(F);else if(f instanceof rn)u[m=f.index]?Object.assign(u[m].action,v):u[m]=F;else if(f instanceof en){var m=f.parent.index,P=f.index;g[m][P]?Object.assign(g[m][P].action,v):g[m][P]=F}}}catch(t){e={error:t}}finally{try{y&&!y.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}try{for(var T=(0,i.__values)(c),S=T.next();!S.done;S=T.next())(F=S.value)&&h.push(F)}catch(t){n={error:t}}finally{try{S&&!S.done&&(o=T.return)&&o.call(T)}finally{if(n)throw n.error}}try{for(var C=(0,i.__values)(g.reverse().entries()),b=C.next();!b.done;b=C.next()){var R=(0,i.__read)(b.value,2),_=R[0],w=R[1],x=u[m=g.length-_-1];x&&h.push(x);try{for(var I=(l=void 0,(0,i.__values)(w.reverse())),D=I.next();!D.done;D=I.next()){var F;(F=D.value)&&h.push(F)}}catch(t){l={error:t}}finally{try{D&&!D.done&&(p=I.return)&&p.call(I)}finally{if(l)throw l.error}}}}catch(t){a={error:t}}finally{try{b&&!b.done&&(s=C.return)&&s.call(C)}finally{if(a)throw a.error}}return h},t}(),on=function(t){function e(e,r){var n=t.call(this,e,r.property.nestingLevel,r.range)||this;return n.hasInit=!1,n.cacheRows=[],n.stageProperty=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableProperty)),n.property=r.property,n.mergedMapping=n.dataStream.getTableStream().getMergedMapping(n.range.begin(),n.nestingLevel),n.grid=n.dataStream.getTableStream().getGridManager(n.range.begin(),n.nestingLevel),n.info=r,n.tableActionManager=new nn(n.state),n}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"contentRange",{get:function(){return this.info.contentRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this.hasInit||this.initTableRows(),this.cacheRows},set:function(t){this.hasInit=!0,this.cacheRows=t},enumerable:!1,configurable:!0}),e.createTable=function(t,r,n){var o=t.getTableStream(),i=r instanceof p.GCPRange?r.begin():r,a=o.getTableInfo(i,n);return a?(a.property=a.property.clone(),new e(t,a)):null},Object.defineProperty(e.prototype,"width",{get:function(){return this.grid.totalWidth},enumerable:!1,configurable:!0}),e.prototype.getContentRange=function(){return this.contentRange},e.prototype.getCell=function(t){var e,r,n=this.getRow(t);if(!n)return null;try{for(var o=(0,i.__values)(n.cells),a=o.next();!a.done;a=o.next()){var s=a.value;if(s.getRange().contains(t))return s}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return null},e.prototype.getRow=function(t){var e,r;try{for(var n=(0,i.__values)(this.rows),o=n.next();!o.done;o=n.next()){var a=o.value;if(a.getRange().contains(t))return a}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return null},e.prototype.getNestingLevel=function(){return this.nestingLevel},e.prototype.intersectCellRange=function(t){var e=[];return this.rows.forEach((function(r){if(t.isIntersect(r.getRange())){var n=[];r.cells.forEach((function(e){t.isContain(e.getRange())&&n.push(e)})),n.length>0&&e.push(n)}})),e},e.prototype.columnCells=function(t){return this.rows.map((function(e){var r=e.getIntervalIntersectCells(t);return r.length>0?r:[e.cells[e.cells.length-1]]}))},e.prototype.strictColumnCells=function(t){return this.rows.map((function(e){return e.getIntervalIntersectCells(t)}))},e.prototype.firstRow=function(){return 0===this.rows.length?null:this.rows[0]},e.prototype.lastRow=function(){return 0===this.rows.length?null:this.rows[this.rows.length-1]},e.prototype.appendRow=function(t){this.rows.push(t),this.isRaw||t.insertTo(this.contentRange.end())},e.prototype.setProperty=function(t){this.property.assign(t),this.isRaw||(this.stageProperty.assign(t),this.tableActionManager.createModifyAction(this))},e.prototype.getProperty=function(){return this.property},e.prototype.deleteTable=function(){var t,e=null!==(t=this.state.selection.getCoreRange().fixToSdtRange(this.range))&&void 0!==t?t:this.range;this.tableActionManager.createDeleteAction(this,{range:e})},e.prototype.scaleX=function(t){this.updateCellSpanFromWidth(),this.grid.scale(t),this.updateCellWidthFromSpan()},e.prototype.toDelta=function(t){return 0===this.rows.length&&(this.tableActionManager.clearActions(),this.deleteTable()),this.getTableActionManager().consumeActionsToDelta(t),this.commandType&&t.setCommandType(this.commandType),t},e.prototype.toDeltaWithSort=function(t){return this.getTableActionManager().consumeActionsToDelta(t,this),this.commandType&&t.setCommandType(this.commandType),t},e.prototype.getRange=function(){return this.range},e.prototype.getTableActionManager=function(){return this.tableActionManager},e.prototype.fixMergedStructure=function(){this.updateCellInterval(),this.updateCellMerged(this.buildMergedMapping().getErrorCells())},e.prototype.updateCellInterval=function(){var t,e;try{for(var r=(0,i.__values)(this.rows),n=r.next();!n.done;n=r.next())n.value.updateCellInterval()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e.prototype.setCommandType=function(t){this.commandType=t},e.prototype.applyInsert=function(){throw new Error("暂时不支持插入表格")},e.prototype.applyModify=function(t){this.isRaw||(this.stageProperty.nestingLevel=this.nestingLevel,h.Gh.setTableProperty({range:this.range,property:this.stageProperty,mode:p.PropUpdateMode.Merge},t))},e.prototype.updateCellMerged=function(t){var e,r,n;try{for(var o=(0,i.__values)(t),a=o.next();!a.done;a=o.next()){var s=a.value,l=s.rowIndex,p=s.colBegin,c=null===(n=this.rows[l])||void 0===n?void 0:n.findCellFromCol(p);c&&c.clearVMerge()}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}},e.prototype.buildMergedMapping=function(){var t,e,r,n,o=new p.MergedMapping;try{for(var a=(0,i.__values)(this.rows),s=a.next();!s.done;s=a.next()){var l=s.value;try{for(var c=(r=void 0,(0,i.__values)(l.cells)),u=c.next();!u.done;u=c.next()){var g=u.value;g.isMainVMergeCell()?o.addRestartItem(g.interval):g.isVMergedCell()&&o.addContinueItem(g.interval)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}o.nextRow()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return o},e.prototype.initTableRows=function(){for(var t=this.tableStream.createRowIterator({limitRange:this.contentRange,nestingLevel:this.nestingLevel});t.hasNext();){var e=rn.createTableRow(this.state,{range:t.getRange(!0),contentRange:t.getContentRange(!0),property:t.getCloneProperty()});e.parent=this,this.cacheRows.push(e),t.next()}this.hasInit=!0},e.prototype.updateCellSpanFromWidth=function(){var t,e;try{for(var r=(0,i.__values)(this.rows),n=r.next();!n.done;n=r.next())n.value.updateCellSpan()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e.prototype.updateCellWidthFromSpan=function(){var t,e;try{for(var r=(0,i.__values)(this.rows),n=r.next();!n.done;n=r.next())n.value.updateCellWidth()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e}(Xr),an=function(){function t(t,e,r){this.table=t,this.deltaOpt=e,this.state=r}return Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),t.prototype.createUpdateDelta=function(){var t=this.deltaOpt.buildDelta();return this.table.toDelta(t),t},t.prototype.applyTableUpdate=function(t){void 0===t&&(t=this.createUpdateDelta()),this.state.applyDelta(t)},t.prototype.applyTableStructureUpdate=function(){var t=this.createUpdateDelta();this.applyTableUpdate(t)},t.prototype.forEachCell=function(t,e){0!==t.length&&function(t,e){0!==t.length&&(Array.isArray(t[0])?function(t,e){for(var r=t.length-1;r>=0;r--)for(var n=t[r].length-1;n>=0;n--)e(t[r][n])}(t,e):Jr(t,e))}(t,e)},t.prototype.cellParent=function(t){return t.parent},t.prototype.rowParent=function(t){return t.parent},t.prototype.isEntireTable=function(t){var e=this.table.getRange(),r=p.GCPRange.inset(e,1);return t.equal(e)||t.equal(r)},t.prototype.setCommandType=function(t){this.table.setCommandType(t)},t.prototype.deleteForEntireTable=function(t){return!!this.isEntireTable(t)&&(this.table.deleteTable(),this.setCommandType(p.Type.DocDeleteTable),this.applyTableUpdate(),!0)},t}(),sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.getCellProperty=function(t){var e=this.tableStream.getCellInfo(t);return e?this.state.dataEngine.getDataManager().getStyleSheetManager().mergeTableCellPropWithGcp(e.property,this.table.getProperty(),t):null},Object.defineProperty(e.prototype,"tableSelectArea",{get:function(){return this.state.selection.tableSelectionArea},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstCellRange",{get:function(){return this.tableSelectArea.cellRanges[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beginCell",{get:function(){var t=this.tableSelectArea.isInnerCell()?this.tableSelectArea.selectedRange.begin():this.firstCellRange.begin,e=this.table.getRange();return this.table.getCell(t===e.begin()?t+1:t)},enumerable:!1,configurable:!0}),e.prototype.createUpdateDelta=function(){var t=this.deltaOpt.buildDelta();return this.table.toDelta(t),t},e.prototype.applyTableUpdate=function(t){void 0===t&&(t=this.createUpdateDelta()),this.state.applyDelta(t)},e.prototype.applyTableStructureUpdate=function(t){void 0===t&&(t=this.createUpdateDelta()),this.applyTableUpdate(t)},e.prototype.isSelectTable=function(){return this.tableSelectArea.isWholeTable()},e.prototype.keepSelectionUpdate=function(){var t=this.createUpdateDelta();t.moveTo(this.state.selection.gcpRange),this.applyTableUpdate(t)},e.prototype.deleteIfSelectTable=function(){return!!this.isSelectTable()&&(this.table.deleteTable(),this.applyTableUpdate(),!0)},e.prototype.selectedCells=function(){if(this.tableSelectArea.isInnerCell()){var t=this.table.getCell(this.tableSelectArea.selectedRange.begin());if(t)return[[t]]}if(this.firstCellRange){var e=this.table.intersectCellRange(this.firstCellRange);if(e)return e}return[]},e.prototype.setCommandType=function(t){this.table.setCommandType(t)},e.prototype.forEachSelectCell=function(t){var e=this.selectedCells();this.forEachCell(e,t)},e}(an),ln=function(){function t(){this.horizontalIntervals=[],this.cellRowInterval=[],this.topLineIndex=Number.MAX_SAFE_INTEGER,this.bottomLineIndex=Number.MIN_SAFE_INTEGER}return Object.defineProperty(t.prototype,"horizontalInterval",{get:function(){return this.horizontalIntervals[this.horizontalIntervals.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowInterval",{get:function(){return{topIndex:this.cellRowInterval[0][0].topIndex,bottomIndex:this.cellRowInterval[this.cellRowInterval.length-1][0].bottomIndex}},enumerable:!1,configurable:!0}),t.prototype.appendRowIndex=function(t){this.topLineIndex=Math.min(t,this.topLineIndex),this.bottomLineIndex=Math.max(t,this.bottomLineIndex)},t.prototype.addHorizontalInterval=function(t,e){this.horizontalIntervals[t]?this.horizontalIntervals[t]=this.horizontalIntervals[t].union(e):this.horizontalIntervals[t]=e},t.prototype.addCellRowInterval=function(t,e){this.cellRowInterval[t]||(this.cellRowInterval[t]=[]),this.cellRowInterval[t].push(e)},t.prototype.isMatchRect=function(){return this.checkAllHorizontalIntervalIsEqual()&&this.checkAllRowIntervalIsEqual()},t.prototype.checkAllHorizontalIntervalIsEqual=function(){for(var t=this.horizontalIntervals[this.horizontalIntervals.length-1],e=this.topLineIndex;e<=this.bottomLineIndex;e++){var r=this.horizontalIntervals[e];if(!r)return!1;if(!r.isEqual(t))return!1}return!0},t.prototype.checkAllRowIntervalIsEqual=function(){var t=this.cellRowInterval[0],e=this.cellRowInterval[this.cellRowInterval.length-1],r=t[0].topIndex,n=e[0].bottomIndex;return t.every((function(t){return t.topIndex===r}))&&e.every((function(t){return t.bottomIndex===n}))},t}(),pn=function(t){function e(e,r,n,o){var i=t.call(this,e,r,n)||this;return i.cells=o,i.mergedMapping=e.mergedMapping,i}return(0,i.__extends)(e,t),e.create=function(t,r,n){var o=n.selection.tableSelectionArea;if(!o||!o.isInnerTable())return null;var i=o.cellRanges[0],a=t.intersectCellRange(i);return 0===a.length||e.isSingleCell(a)?null:new e(t,r,n,a)},e.isSingleCell=function(t){var e=[];return t.forEach((function(t){t.forEach((function(t){t.getProperty().vMerge.val!==p.STMerge.continue&&e.push(t)}))})),1===e.length},Object.defineProperty(e.prototype,"mainCell",{get:function(){return this.cells[0][0]},enumerable:!1,configurable:!0}),e.prototype.merge=function(){var t=this;if(this.isAllowMerge()){this.setCommandType(p.Type.DocMergeCells);var e=this.mergeVerticalGroup(),r=e.copyCells,n=e.increaseHeight,o=e.hasMergeGroup;o||this.updateMainRowHeight(this.mainCell.parent,n);var i=this.mergeMainRowCells(r,o),a=this.cells[0][0].getRange().begin();i.moveTo(new p.GCPRange(a)),this.state.setRetainComment(!0),this.applyTableUpdate(i),setTimeout((function(){t.state.setRetainComment(!1)}),100)}},e.prototype.updateMergeCells=function(t,e){for(var r,n,o=[],a=t.topIndex,s=t.bottomIndex,l=this.table.rows,p=a;p<=s;p++){var c=[];try{for(var u=(r=void 0,(0,i.__values)(l[p].cells)),g=u.next();!g.done;g=u.next()){var h=g.value;if(e.isLess(h.interval))break;e.isContain(h.interval)&&c.push(h)}}catch(t){r={error:t}}finally{try{g&&!g.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}o.push(c)}this.cells=o},e.prototype.isAllowMerge=function(){for(var t,e,r=new ln,n=0;n<this.cells.length;n++){var o=this.cells[n][0].parent.index;if(this.cells[n][0].parent.hasRevision())return!1;r.appendRowIndex(o);try{for(var a=(t=void 0,(0,i.__values)(this.cells[n])),s=a.next();!s.done;s=a.next()){var l=s.value;r.addHorizontalInterval(o,l.interval),this.expandVerticalInterval(l,o,n,r)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}}var p=r.isMatchRect();return p&&this.updateMergeCells(r.rowInterval,r.horizontalInterval),p},e.prototype.expandVerticalInterval=function(t,e,r,n){var o=t.getProperty().vMerge;if(o&&o.val!==p.STMerge.PBDEFAULT){var i=o.val===p.STMerge.restart?1:-1,a=this.getVMergedCount(e,t.interval,o.val),s=e+i*a,l=Math.min(s,e),c=Math.max(s,e);n.addCellRowInterval(r,{topIndex:l,bottomIndex:c});for(var u=1;u<=a;u++)n.addHorizontalInterval(e+i*u,t.interval)}else n.addCellRowInterval(r,{topIndex:e,bottomIndex:e})},e.prototype.getVMergedCount=function(t,e,r){if(r===p.STMerge.restart)return this.mergedMapping.getMergedCount(t,e.begin)||0;if(r===p.STMerge.continue){var n=this.mergedMapping.getMainCell(t,e.begin);if(n)return t-n.rowIndex}return 0},e.prototype.mergeVerticalGroup=function(){for(var t=[],e=0,r=!1,n=function(n){var a=0;Jr(o.cells[n],(function(e){e.isEmpty()||t.push(e),a+=e.width,e.setToMerged()}));var s=o.cells[n][0].parent;if(o.isMergedRow(s))e+=s.height,s.deleteRow();else{r=!0;var l=(0,i.__spreadArray)([],(0,i.__read)(o.cells[n]),!1),c=l.pop(),u=o.mainCell.getProperty().clone();u.tcW.w=a,u.tcW.type=p.STTblWidth.dxa,u.vMerge.val=p.STMerge.continue,c.coverProperty(u),c.deleteContent(),Jr(l,(function(t){return t.deleteCell()}))}},o=this,a=this.cells.length-1;a>0;a--)n(a);return{copyCells:t,increaseHeight:e,hasMergeGroup:r}},e.prototype.isMergedRow=function(t){return t.cells.every((function(t){return t.isVMergedCell()}))},e.prototype.mergeMainRowCells=function(t,e){var r,n,o=(0,i.__spreadArray)([],(0,i.__read)(this.cells[0]),!1),a=o.pop(),s=a.width;try{for(var l=(0,i.__values)(o),c=l.next();!c.done;c=l.next())s+=c.value.width}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}var u=this.mainCell.getProperty().clone();e?u.vMerge.val=p.STMerge.restart:u.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty).tKeys.vMerge),u.tcW.w=s,u.tcW.type=p.STTblWidth.dxa,a.coverProperty(u);var g=this.createUpdateDelta();return this.insertMergedContent(a.getRange().end()-1,t,g),a.isEmpty()&&(t.length>0||!this.isEmptyCells(o))&&a.deleteRange(new p.GCPRange(a.getContentRange().end()-1,1)),this.forEachCell(o,(function(t){t.isEmpty()?t.deleteCell():t.deletePlaceholder()})),this.table.getTableActionManager().consumeActionsToDelta(g),g},e.prototype.isEmptyCells=function(t){return t.every((function(t){return t.isEmpty()}))},e.prototype.updateMainRowHeight=function(t,e){e<=0||t.setHeight(t.height+e)},e.prototype.insertMergedContent=function(t,e,r){var n,o,a,s;try{for(var l=(0,i.__values)(e),p=l.next();!p.done;p=l.next()){var c=p.value.getContentRange(),u=h.Me.collectDataToOps({dataEngine:this.state.dataEngine,range:c,collectComment:!0});try{for(var g=(a=void 0,(0,i.__values)(u)),d=g.next();!d.done;d=g.next()){var y=d.value;h.Yy.moveOffset(y,t-c.begin()),r.addOperation(y)}}catch(t){a={error:t}}finally{try{d&&!d.done&&(s=g.return)&&s.call(g)}finally{if(a)throw a.error}}}}catch(t){n={error:t}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}},e}(sn),cn=function(){function t(t){this.cells=t}return t.prototype.setInsideVBorder=function(t){for(var e=0;e<this.cells.length-1;e++)for(var r=0;r<this.cells[e].length;r++)this.setBottomBorder(e,r,t)},t.prototype.setInsideHBorder=function(t){for(var e=0;e<this.cells.length;e++)for(var r=0;r<this.cells[e].length-1;r++)this.setRightBorder(e,r,t)},t.prototype.setRightBorder=function(t,e,r){var n,o,i=null===(n=this.cells[t])||void 0===n?void 0:n[e];if(i){var a=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));r?a.tcBorders.right=r:a.tcBorders.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.right),i.setProperty(a)}var s=null===(o=this.cells[t])||void 0===o?void 0:o[e+1];s&&(a=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty)),r?a.tcBorders.left=r:a.tcBorders.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.left),s.setProperty(a))},t.prototype.setBottomBorder=function(t,e,r){var n,o,i=null===(n=this.cells[t])||void 0===n?void 0:n[e];if(i){var a=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));r?a.tcBorders.bottom=r:a.tcBorders.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.bottom),i.setProperty(a)}var s=null===(o=this.cells[t+1])||void 0===o?void 0:o[e];s&&(a=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty)),r?a.tcBorders.top=r:a.tcBorders.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.top),s.setProperty(a))},t}(),un=function(t){function e(e,r,n,o){var i=t.call(this,e,r,n)||this;return i.vMergeGroup=null,i.cell=o,i}return(0,i.__extends)(e,t),e.create=function(t,r,n){var o=n.selection.tableSelectionArea;if(!o)return null;var i=o.selectedRange.begin(),a=t.getCell(i);return a?new e(t,r,n,a):null},e.prototype.isAllowSplit=function(){return!this.cell.parent.hasRevision()},e.prototype.split=function(t,e){if(1!==t||1!==e){var r=this.splitMainCell(t,e);this.formatBorder(r),this.setCommandType(p.Type.DocSplitCells);var n=this.createUpdateDelta();n.moveTo(new p.GCPRange(this.cell.getRange().begin())),this.applyTableStructureUpdate(n)}},e.prototype.getVMergeCount=function(){return this.getVMergeGroup().length},e.prototype.formatBorder=function(t){var e=new cn(t),r=this.cell.getProperty().tcBorders;e.setInsideHBorder(r.has(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.left)?r.left.clone():null),e.setInsideVBorder(r.has(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.top)?r.top.clone():null)},e.prototype.getVMergeGroup=function(){return this.vMergeGroup||(this.vMergeGroup=this.cell.getVMergeCells()),this.vMergeGroup},e.prototype.hasMergeGroup=function(){return this.cell.getGridSpan()>1||this.cell.isMainVMergeCell()},e.prototype.splitMainCell=function(t,e){return this.cell.getProperty().vMerge.val===p.STMerge.restart?this.unMergeVerticalGroup(t,e):this.insertRowToSplit(t,e)},e.prototype.unMergeVerticalGroup=function(t,e){for(var r=this.getVMergeGroup(),n=Math.floor(r.length/t),o=1===n,i=this.cell.getFollowParaStyle(),a=[],s=r.length-1;s>=0;s--){var l=r[s];if(s%n==0){var c=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))(this.cell.getProperty());c.vMerge.val=p.STMerge.restart,o?c.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty).tKeys.vMerge):c.vMerge.val=p.STMerge.restart,l.setProperty(c),l!==this.cell&&(Zr(i.paragraph),$r(i.paragraph),l.coverParagraph(i))}a.unshift(l.splitCell(e,i))}return a},e.prototype.insertRowToSplit=function(t,e){var r=this.cell.getFollowParaStyle();if(1===t)return[this.cell.splitCell(e,r)];var n=t-1,o=this.cellParent(this.cell),a=this.cell.index,s=(0,i.__spreadArray)([],(0,i.__read)(o.cells),!1);s.splice(a,1),this.setVMerge(s,p.STMerge.restart);var l=this.insertPadRow(n,e,a);return l.unshift(this.cell.splitCell(e,r)),l},e.prototype.insertPadRow=function(t,e,r){var n=this.cellParent(this.cell),o=n.height/(t+1),a=o>0;a&&n.setHeight(o);for(var s=[],l=0;l<t;l++){var c=n.clone();a&&c.setHeight(o);var u=(0,i.__spreadArray)([],(0,i.__read)(c.cells),!1);u.splice(r,1),this.setVMerge(u,p.STMerge.continue);var g=c.cells[r];g.coverParagraph(this.cell.getFollowParaStyle()),s.unshift(g.splitCell(e)),n.insertAfter(c)}return s},e.prototype.setVMerge=function(t,e){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));r.vMerge.val=e,this.forEachCell(t,(function(t){t.setProperty(r)}))},e}(sn);function gn(t,e){var r=e?e.clone():new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTBorderWml));return r.color=t.color,r.val=t.val,r.sz=t.sz,r.space=t.space,r}function hn(t,e){if(t.isEmpty())return!1;var r=function(t,e){var r=e?e.clone():new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTBorderWml));return t.color&&(r.color=t.color),t.val&&(r.val=t.val),t.sz&&(r.sz=t.sz),t.space&&(r.space=t.space),r}(e,t),n=!!e.reverse,o=t.equalTo(r);return o&&!n||!o&&n}function dn(t,e){var r=e.mergeStyleTableProperty(t.parent.parent.getProperty()).tblPr.tblBorders,n=t.getProperty().tcBorders.clone();return(0,p.shouldMergeTableBorder)(n,p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.top)&&(n.top=t.parent.prevRow()?r.insideH:r.top),(0,p.shouldMergeTableBorder)(n,p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.bottom)&&(n.bottom=t.parent.nextRow()?r.insideH:r.bottom),(0,p.shouldMergeTableBorder)(n,p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.left)&&(n.left=t.prevCell()?r.insideV:r.left),(0,p.shouldMergeTableBorder)(n,p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcBorders).tKeys.right)&&(n.right=t.nextCell()?r.insideV:r.right),n}var yn,fn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.getBorderType=function(t){return this.tableSelectArea.isInnerTable()||this.tableSelectArea.isInnerCell()?this.getCellBorder(t):p.WdBorderType.None},e.prototype.getCellBorder=function(t){var e=this,r=p.WdBorderType.Total,n=this.getCells(),o=n.length>1,i=!1;n.forEach((function(o,a){o.length>1&&(i=!0),o.forEach((function(i,s){var l=e.cellRelateToSelection(a,n),c=e.cellRelateToSelection(s,o),u=dn(i,e.state.dataEngine.getDataManager().getStyleSheetManager());r=e.filterFirstRowBorderType(r,u,t,l),r=e.filterLastRowBorderType(r,u,t,l),r=e.filterMiddleRowBorderType(r,u,t,l),r=e.filterFirstColBorderType(r,u,t,c),r=e.filterLastColBorderType(r,u,t,c),r=e.filterMiddleColBorderType(r,u,t,c),hn(i.getProperty().tcBorders.tr2bl,t)||(r=(0,p.excludeBorderType)(r,p.WdBorderType.DiagonalUp)),hn(i.getProperty().tcBorders.tl2br,t)||(r=(0,p.excludeBorderType)(r,p.WdBorderType.DiagonalDown))}))}));var a=!1;return o&&(0,p.matchBorderType)(r,p.WdBorderType.Horizontal)&&(a=!0),i&&(0,p.matchBorderType)(r,p.WdBorderType.Vertical)&&(a=!0),a||(r=(0,p.excludeBorderType)(r,p.WdBorderType.Horizontal,p.WdBorderType.Vertical)),r},e.prototype.setBorder=function(t,e){var r=this,n=this.state.selection.gcpRange;if(this.tableSelectArea.isWholeTable())this.clearCellBorder(this.getCells()),this.setTableBorder(t,e);else if(this.tableSelectArea.isInnerTable()||this.tableSelectArea.isInnerCell()){var o=this.getCells();o.forEach((function(n,i){r.setLRNearCellBorder(n,t,e);var a=r.cellRelateToSelection(i,o);r.setUDNearCellBorder(t,n,e,a),n.forEach((function(o,i){var s,l=r.cellRelateToSelection(i,n);r.setFirstRowCellBorder(t,o,e,a),r.setLastRowCellBorder(t,o,e,a),r.setMiddleRowCellBorder(t,o,e,a),r.setFirstColCellBorder(t,o,e,l),r.setLastColCellBorder(t,o,e,l),r.setMiddleColCellBorder(t,o,e,l),(0,p.matchBorderType)(t,p.WdBorderType.DiagonalUp)&&((s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))).tcBorders.tr2bl=gn(e),o.setProperty(s)),(0,p.matchBorderType)(t,p.WdBorderType.DiagonalDown)&&((s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))).tcBorders.tl2br=gn(e),o.setProperty(s))}))}))}this.setCommandType(p.Type.DocModifyTableStyle);var i=this.createUpdateDelta();i.moveTo(n),this.applyTableUpdate(i)},e.prototype.cellRelateToSelection=function(t,e){var r=!1,n=!1,o=!1;return 0===t&&(r=!0),t===e.length-1&&(o=!0),r||o||(n=!0),{isBegin:r,isMiddle:n,isEnd:o}},e.prototype.filterFirstRowBorderType=function(t,e,r,n){if(!n.isBegin)return t;var o=t,i=e.top,a=e.bottom;return hn(i,r)||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Top)),hn(a,r)||n.isEnd||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Horizontal)),o},e.prototype.filterMiddleRowBorderType=function(t,e,r,n){if(!n.isMiddle)return t;var o=t,i=e.top,a=e.bottom;return hn(i,r)&&hn(a,r)||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Horizontal)),o},e.prototype.filterLastRowBorderType=function(t,e,r,n){if(!n.isEnd)return t;var o=t,i=e.top,a=e.bottom;return hn(i,r)||n.isBegin||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Horizontal)),hn(a,r)||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Bottom)),o},e.prototype.filterFirstColBorderType=function(t,e,r,n){if(!n.isBegin)return t;var o=t,i=e.left,a=e.right;return hn(i,r)||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Left)),hn(a,r)||n.isEnd||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Vertical)),o},e.prototype.filterMiddleColBorderType=function(t,e,r,n){if(!n.isMiddle)return t;var o=t,i=e.left,a=e.right;return(0,p.matchBorderType)(t,p.WdBorderType.Vertical)?(hn(i,r)&&hn(a,r)||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Vertical)),o):o},e.prototype.filterLastColBorderType=function(t,e,r,n){if(!n.isEnd)return t;var o=t,i=e.left,a=e.right;return hn(i,r)||n.isBegin||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Vertical)),hn(a,r)||(o=(0,p.excludeBorderType)(o,p.WdBorderType.Right)),o},e.prototype.clearCellBorder=function(t){var e=p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty);t.forEach((function(t){t.forEach((function(t){var r=new e;r.setNull(e.tKeys.tcBorders),t.setProperty(r)}))}))},e.prototype.setTableBorder=function(t,e){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableProperty));(0,p.matchBorderType)(t,p.WdBorderType.Left)&&(r.tblPr.tblBorders.left=gn(e)),(0,p.matchBorderType)(t,p.WdBorderType.Right)&&(r.tblPr.tblBorders.right=gn(e)),(0,p.matchBorderType)(t,p.WdBorderType.Top)&&(r.tblPr.tblBorders.top=gn(e)),(0,p.matchBorderType)(t,p.WdBorderType.Bottom)&&(r.tblPr.tblBorders.bottom=gn(e)),(0,p.matchBorderType)(t,p.WdBorderType.Horizontal)&&(r.tblPr.tblBorders.insideH=gn(e)),(0,p.matchBorderType)(t,p.WdBorderType.Vertical)&&(r.tblPr.tblBorders.insideV=gn(e)),this.table.setProperty(r)},e.prototype.setFirstRowCellBorder=function(t,e,r,n){if(n.isBegin){var o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));(0,p.matchBorderType)(t,p.WdBorderType.Horizontal)&&!n.isEnd&&(o.tcBorders.bottom=gn(r)),(0,p.matchBorderType)(t,p.WdBorderType.Top)&&(o.tcBorders.top=gn(r)),e.setProperty(o)}},e.prototype.setMiddleRowCellBorder=function(t,e,r,n){if(n.isMiddle){var o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));(0,p.matchBorderType)(t,p.WdBorderType.Horizontal)&&(o.tcBorders.top=gn(r),o.tcBorders.bottom=gn(r),e.setProperty(o))}},e.prototype.setLastRowCellBorder=function(t,e,r,n){if(n.isEnd){var o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));(0,p.matchBorderType)(t,p.WdBorderType.Horizontal)&&!n.isBegin&&(o.tcBorders.top=gn(r)),(0,p.matchBorderType)(t,p.WdBorderType.Bottom)&&(o.tcBorders.bottom=gn(r)),e.setProperty(o)}},e.prototype.setFirstColCellBorder=function(t,e,r,n){if(n.isBegin){var o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));(0,p.matchBorderType)(t,p.WdBorderType.Vertical)&&!n.isEnd&&(o.tcBorders.right=gn(r)),(0,p.matchBorderType)(t,p.WdBorderType.Left)&&(o.tcBorders.left=gn(r)),e.setProperty(o)}},e.prototype.setMiddleColCellBorder=function(t,e,r,n){if(n.isMiddle){var o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));(0,p.matchBorderType)(t,p.WdBorderType.Vertical)&&(o.tcBorders.right=gn(r),o.tcBorders.left=gn(r),e.setProperty(o))}},e.prototype.setLastColCellBorder=function(t,e,r,n){if(n.isEnd){var o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));(0,p.matchBorderType)(t,p.WdBorderType.Vertical)&&!n.isBegin&&(o.tcBorders.left=gn(r)),(0,p.matchBorderType)(t,p.WdBorderType.Right)&&(o.tcBorders.right=gn(r)),e.setProperty(o)}},e.prototype.setLRNearCellBorder=function(t,e,r){var n,o=t[0].prevCell(),i=t[t.length-1].nextCell();o&&(0,p.matchBorderType)(e,p.WdBorderType.Left)&&((n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))).tcBorders.right=gn(r),o.setProperty(n)),i&&(0,p.matchBorderType)(e,p.WdBorderType.Right)&&((n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))).tcBorders.left=gn(r),i.setProperty(n))},e.prototype.setUDNearCellBorder=function(t,e,r,n){n.isMiddle||(this.setUpperCellBorder(t,e,r,n),this.setBelowCellBorder(t,e,r,n))},e.prototype.setUpperCellBorder=function(t,e,r,n){if(n.isBegin&&(0,p.matchBorderType)(t,p.WdBorderType.Top)){var o=this.getOuterEqualIntervalCell(e,!0),i=null==o?void 0:o.cells;null==i||i.forEach((function(t){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));e.tcBorders.bottom=gn(r),t.setProperty(e)}))}},e.prototype.setBelowCellBorder=function(t,e,r,n){if(n.isEnd&&(0,p.matchBorderType)(t,p.WdBorderType.Bottom)){var o=this.getOuterEqualIntervalCell(e,!1),i=null==o?void 0:o.cells;null==i||i.forEach((function(t){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));e.tcBorders.top=gn(r),t.setProperty(e)}))}},e.prototype.getOuterEqualIntervalCell=function(t,e){var r=this.getCellsInterval(t);if(!r)return null;var n=e?t[0].parent.prevRow():t[0].parent.nextRow();if(!n)return null;var o=n.getIntervalContainCells(r);if(!o)return null;var i=this.getCellsInterval(o);return i&&r.isEqual(i)?{cells:o,interval:i}:null},e.prototype.getCells=function(){if(this.tableSelectArea.isInnerCell()){var t=this.table.getCell(this.tableSelectArea.selectedRange.begin());return t?[[t]]:[]}return this.tableSelectArea.isCrossTable()?[[]]:this.table.intersectCellRange(this.tableSelectArea.cellRanges[0])},e.prototype.getCellsInterval=function(t){if(!t)return null;if(!t[0])return null;var e=t[0].interval;return t.slice(1).forEach((function(t){e=e.union(t.interval)})),e},e}(sn),vn=function(t,e,r){void 0===r&&(r=1);var n=t.getTableStream().getCellInfo(e,r);return n?function(t,e){var r=p.TablePropertyUtil.getWidth(e.property.tcW),n=t.getTableStream().getTableInfo(e.range.begin(),e.property.nestingLevel);if(!n)return r;var i=p.TablePropertyUtil.resolveMar(t.dataEngine.getDataManager().getStyleSheetManager().mergeStyleTableProperty(n.property),e.property);return r-(i.left.w+i.right.w)-2*(0,o.Ej)(1)}(t,n):function(t,e){var r=t.followSectProp(e);return r.pgSz.w-r.pgMar.left-r.pgMar.right-(0,o.Ej)(1)}(t,e)},mn=((yn={})[p.STJcTable.left]=p.STXAlign.left,yn[p.STJcTable.start]=p.STXAlign.left,yn[p.STJcTable.center]=p.STXAlign.center,yn[p.STJcTable.right]=p.STXAlign.right,yn[p.STJcTable.end]=p.STXAlign.right,yn),Pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.increaseRightSideColWidth=function(t,e){var r,n,o=this.table,a=null==o?void 0:o.getCell(t);if(a&&o){var s=o.columnCells(a.interval);try{for(var l=(0,i.__values)(s),c=l.next();!c.done;c=l.next()){var u=c.value,g=u[u.length-1];g.setWidth(g.width+e)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}this.setCommandType(p.Type.DocModifyTableColumnWidth),this.applyTableStructureUpdate()}},e.prototype.setColsWidth=function(t){for(var e,r,n,o=0;o<t.length;o++)try{for(var a=(e=void 0,(0,i.__values)(this.table.rows)),s=a.next();!s.done;s=a.next())null===(n=s.value.cells[o])||void 0===n||n.setWidth(t[o])}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}this.table.fixMergedStructure(),this.setCommandType(p.Type.DocModifyTableColumnWidth),this.applyTableStructureUpdate()},e.prototype.insertColsLeft=function(t,e){var r=this,n=this.locateTargetColCells(t);if(n){var o=n.map((function(t){return t[0]}));this.fitWidth(o[0].width*e);var i=o[0].getProperty().tcW;this.forEachCell(o,(function(t){for(var n=0;n<e;n++){var o=t.clone();o.setProperty(r.createWidthProperty(i)),t.insertLeft(o)}})),this.table.fixMergedStructure(),this.setCommandType(p.Type.DocInsertTableColumn),this.applyTableStructureUpdate()}},e.prototype.insertColsRight=function(t,e){var r=this,n=this.locateTargetColCells(t);if(n){var o=n.map((function(t){return t[t.length-1]}));this.fitWidth(o[0].width*e);var i=o[0].getProperty().tcW;this.forEachCell(o,(function(t){for(var n=0;n<e;n++){var o=t.clone();o.setProperty(r.createWidthProperty(i)),t.insertRight(o)}})),this.table.fixMergedStructure(),this.setCommandType(p.Type.DocInsertTableColumn),this.applyTableStructureUpdate()}},e.prototype.removeCols=function(t){if(!this.deleteForEntireTable(t)){var e=this.selectedInterval(t);if(e){var r=this.table.strictColumnCells(e);r&&(this.removeCells(r),this.table.fixMergedStructure(),this.setCommandType(p.Type.DocDeleteTableColumn),this.applyTableStructureUpdate())}}},e.prototype.moveColsTo=function(t,e){var r=this.table;if(!r)return!1;var n=r.columnCells(t);if(n.length!==e.length)return!1;for(var o=function(t){var r=e[t],o=n[t],i=o.map((function(t){return t.getRange().len})),a=o.map((function(t){return t.cloneDeep()})),s=function(){for(var t=r,e=0;e<a.length;e++)a[e].insertTo({gcp:t}),t+=i[e]},l=function(){for(var t;o.length;)null===(t=o.pop())||void 0===t||t.deleteCell()};o[0].getRange().gcpBegin>r?(l(),s()):(s(),l())},i=e.length-1;i>=0;i--)o(i);return this.setCommandType(p.Type.DocMoveTableColumn),this.applyTableStructureUpdate(),!0},e.prototype.averageColWidths=function(t){var e,r,n=this,o=this.table,i=null===(e=this.state.selection.tableSelectionArea)||void 0===e?void 0:e.cellRanges;if(Array.isArray(i)&&i.length>0&&!t){var a=i[0].getRanges()[0],s=null===(r=this.state.getTableStream().getCellsOfRowRange(a,o.getNestingLevel()))||void 0===r?void 0:r.cells;if(!s||0===s.length)return;var l=s[0].interval.union(s[s.length-1].interval);o.rows.forEach((function(t){var e=t.getIntervalIntersectCells(l),r=e.reduce((function(t,e){return t+e.width}),0),o=Math.floor(r/e.length);n.averageCellsWidth(e,o,r)}))}else o.rows.forEach((function(t){var e=t.cells;if(e&&0!==e.length){var r=e.reduce((function(t,e){return t+e.width}),0),o=Math.floor(r/e.length);n.averageCellsWidth(e,o,r)}}));this.setCommandType(p.Type.DocAverageTableColumnWidth),this.table.fixMergedStructure(),this.applyTableStructureUpdate()},e.prototype.averageCellsWidth=function(t,e,r){var n=t.length-1;t.forEach((function(t,o){if(o===n){var i=r-e*n;t.setWidth(i)}else t.setWidth(e)}))},e.prototype.removeCells=function(t){Jr(t,(function(t){if(0!==t.length){var e=t[0].parent;e.cells.length!==t.length?Jr(t,(function(t){return null==t?void 0:t.deleteCell()})):e.deleteRow()}}))},e.prototype.fitWidth=function(t){var e=vn(this.state,this.table.getRange().begin()),r=this.table.width,n=r+t;n<e||r>e||this.table.scaleX(e/n)},e.prototype.locateTargetColCells=function(t){var e=this.selectedInterval(t);return e?this.table.columnCells(e):null},e.prototype.selectedInterval=function(t){var e=this.tableStream.getCellInterval(t.begin(),this.table.getNestingLevel()),r=Math.max(t.begin(),t.end()-1),n=this.tableStream.getCellInterval(r,this.table.getNestingLevel());return e&&n?e.union(n):null},e.prototype.createWidthProperty=function(t){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));return e.tcW=t,e},e}(an),Tn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.setBackgroundColor=function(t){var e=this;this.forEachSelectCell((function(r){r.setProperty(e.createColorProperty(t))})),this.setCommandType(p.Type.DocModifyTableStyle),this.keepSelectionUpdate()},e.prototype.setTableStyleTheme=function(t){var e=this.table.getProperty().clone(),r=e.tblPr.tblStyle,n=this.state.dataEngine.getDataManager().getStyleSheetManager(),o=n.getStylePropertyFromId(r.val),i=this.createUpdateDelta(),a=Be.generateStyleProperty(i,n,t);(null==a?void 0:a.type)===p.STStyleType.table&&(this.clearTablePropBeforeSetTheme(e),this.clearCellsPropBeforeSetTheme(),(null==o?void 0:o.name.val)!==t&&(e.tblPr.tblStyle.val=a.styleId,e.tblPr.tblLook.firstRow=!0,e.tblPr.tblLook.firstColumn=!0,e.tblPr.tblLook.noHBand=!1),this.table.setProperty(e),this.setCommandType(p.Type.DocModifyTable),this.table.toDelta(i),i.moveTo(this.state.selection.gcpRange),this.applyTableUpdate(i))},e.prototype.setVerticalAlign=function(t){var e=this;this.forEachSelectCell((function(r){r.setProperty(e.createVAlignProperty(t))})),this.setCommandType(p.Type.DocModifyTableStyle),this.keepSelectionUpdate()},e.prototype.getVerticalAlign=function(){var t;if(this.beginCell){var e=this.getCellProperty(null===(t=this.beginCell)||void 0===t?void 0:t.getRange().begin()),r=p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty);if(null==e?void 0:e.has(r.tKeys.vAlign))return e.vAlign.val}return p.STVerticalJc.top},e.prototype.clearContent=function(){this.forEachSelectCell((function(t){t.deleteContent()})),this.setCommandType(p.Type.DocDeleteText),this.applyTableUpdate()},e.prototype.clearFirstCellContent=function(){this.beginCell&&(this.beginCell.deleteContent(),this.setCommandType(p.Type.DocDeleteText),this.applyTableUpdate())},e.prototype.createColorProperty=function(t){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));return e.shd.val=p.STShd.clear,e.shd.color="auto",e.shd.fill=t,e},e.prototype.createVAlignProperty=function(t){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));return e.vAlign.val=t,e},e.prototype.clearTablePropBeforeSetTheme=function(t){t.tblPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPrBase).tKeys.tblInd),t.tblPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPrBase).tKeys.tblBorders),t.tblPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPrBase).tKeys.shd),t.tblPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPrBase).tKeys.tblCellMar)},e.prototype.clearCellsPropBeforeSetTheme=function(){var t,e,r,n;try{for(var o=(0,i.__values)(this.table.rows),a=o.next();!a.done;a=o.next()){var s=a.value;try{for(var l=(r=void 0,(0,i.__values)(s.cells)),c=l.next();!c.done;c=l.next()){var u=c.value,g=u.getProperty().clone();g.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcPrBase).tKeys.tcBorders),g.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcPrBase).tKeys.shd),g.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcPrBase).tKeys.tcMar),g.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTcPrBase).tKeys.vAlign),u.setProperty(g)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},e}(sn),Sn=function(){function t(t,e){var r;this.insertOptions={preventTextTrackChanges:!0},this.state=t,this.selection=this.state.context.service.getSelection();var n=this.state.selection;this.delta=e.buildDelta(),this.coreRange=n.getCoreRange(),this.nestingLevel=((null===(r=this.state.getTableStream().getCellInfo(n.gcpRange.begin()))||void 0===r?void 0:r.property.nestingLevel)||0)+1}return t.prototype.insert=function(t,e){this.delBeforeInsertTable(),this.doInsert(t,e)},t.prototype.delBeforeInsertTable=function(){this.originRange=this.adjustSelectRange(),this.generateProp(),this.selection.getRange().delete(this.originRange),this.insertGcp=this.originRange.begin(),this.selection.setRange(this.insertGcp,this.insertGcp)},t.prototype.adjustSelectRange=function(){var t=this.state.selection.gcpRange;return this.shouldRemainParaAfterTable(t)||(t.len+=1),this.coreRange.fixToValidDeleteRange(t)},t.prototype.generateProp=function(){this.cellFollowProp=this.originRange.isEmpty()?this.genCellFollowParaProp(this.coreRange.gcpRange.begin()):{};var t=this.coreRange.isParaEnd(this.originRange.end());this.nextParaProp=t?this.state.followParaProp(this.originRange.begin()):void 0},t.prototype.doInsert=function(t,e){this.checkToInsertParagraph();var r=this.insertTable(e,t);this.followSelectBeginPara(),this.applyDelta(r)},t.prototype.checkToInsertParagraph=function(){var t=this.insertGcp;if(Be.shouldInsertParaBeforeTable(t,this.state)){var e=this.genCurrentFollowParaProp(t),r=e.paraBreakSpan,n=e.paraProp;this.filterAttributeOfFollowPara(n),h.Gh.insertParagraph(t,r,n,this.delta,this.insertOptions),this.insertGcp+=1}},t.prototype.genCurrentFollowParaProp=function(t){return{paraProp:new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(this.state.currentParaProp(t)),paraBreakSpan:new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(this.state.followSpanProp(t))}},t.prototype.applyDelta=function(t){this.delta.setCommandType(p.Type.DocInsertTable),this.state.applyDelta(this.delta),this.state.setRangeTo(new p.GCPRange(t+1,0)),this.state.cusorSpanProp=null},t.prototype.followSelectBeginPara=function(){if(this.nextParaProp){if(this.state.getRevisionsManager().isTrackRevisions)return;var t={range:new p.GCPRange(this.delta.currentRange().end(),1),property:this.nextParaProp.paraProp,mode:p.PropUpdateMode.Insert};h.Gh.setParagraphProperty(t,this.delta)}},t.prototype.insertTable=function(t,e){var r=this.insertGcp,n=this.createTableProp(t),o=n.tableProp,i=n.colWidth,a=this.createRowProp(),s=this.createCellProp(i),l=s.cellProp,c=s.runProp,u=s.paraProp,g=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableProperty));g.nestingLevel=this.nestingLevel,h.Gh.insertTableStart(r,this.delta,g);for(var d=0;d<e;d++){for(var y=0;y<t;y++)u.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.pBdr),h.Gh.insertParagraph(this.delta.currentRange().end(),c,new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(u),this.delta),h.Gh.insertTableCell(this.delta.currentRange().end(),l,this.delta);h.Gh.insertTableRow(this.delta.currentRange().end(),a,this.delta)}return h.Gh.insertTableEnd(this.delta.currentRange().end(),o,this.delta),r},t.prototype.createRowProp=function(){var t=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableRowProperty));return t.nestingLevel=this.nestingLevel,t},t.prototype.createCellProp=function(t){var e=this.genTableCellProp(this.cellFollowProp.paraProp,this.cellFollowProp.paraBreakSpan);return e.cellProp.tcW.w=t,e.cellProp.tcW.type=p.STTblWidth.dxa,e.cellProp.nestingLevel=this.nestingLevel,e},t.prototype.shouldRemainParaAfterTable=function(t){if(t.isEmpty())return!0;var e=this.state.context.service,r=e.getSelection(),n=r.relationToSelectAndPara(!1,!1,!1,!1),o=r.getParaRangeFromSelection(!1),i=Boolean(this.state.getTableStream().getTableInfo(o.end()));return!n||n&&(r.isSelectionEndAtStoryEnd(!1)||i||this.hasBottomBorder(o,e))},t.prototype.hasBottomBorder=function(t,e){var r=e.getDocument().getRange(t.begin(),t.end()).getParagraphFormat().getBorder();return r!==c.JjT.Undefined&&!r.bottom.isEmpty()},t.prototype.getTableContentWidth=function(){return vn(this.state,this.originRange.begin(),Math.max(this.nestingLevel-1,1))},t.prototype.createTableProp=function(t){var e=this.getTableContentWidth(),r=(0,o.Ej)(Math.floor((0,o.FJ)(e/t))),n=this.getDefaultStyle(),i=p.TablePropertyUtil.createTableProperty();return i.tblPr.nestingLevel=this.nestingLevel,n&&(i.tblPr.tblStyle.val=n),{tableProp:i,colWidth:r}},t.prototype.getDefaultStyle=function(){var t=Be.generateStyleProperty(this.delta,this.state.dataEngine.getDataManager().getStyleSheetManager(),p.Defaults.defaultTableStyleName);return(null==t?void 0:t.type)===p.STStyleType.table?t.styleId:null},t.prototype.genTableCellProp=function(t,e){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));return o.nestingLevel=this.nestingLevel,t&&(n.merge(t),[p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.pStyle,p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.outlineLvl,p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.ind].forEach((function(t){n.setDefault(t)}))),e&&r.merge(e),{cellProp:o,runProp:r,paraProp:n}},t.prototype.genCellFollowParaProp=function(t){var e=this.genFollowParaProp(t,[p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.pStyle,p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.outlineLvl,p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.ind,p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.numPr]);return this.filterAttributeOfFollowPara(e.paraProp),e},t.prototype.genFollowParaProp=function(t,e){var r=this.state.followParaProp(t);return e.forEach((function(t){r.paraProp.setDefault(t)})),r},t.prototype.filterAttributeOfFollowPara=function(t){t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.pBdr)},t}(),Cn=function(t,e,r,n){var o=t.getCellInfo(e,r);if(!o)return null;for(var i=o;i;)if((null==(i=t.getCellInfo(n(i),r))?void 0:i.property)&&i.property.vMerge.val!==p.STMerge.continue)return i;return null},bn=function(t,e,r){return Cn(t.tableStream,e,r,(function(e){return t.revisionManager.getRevisionStatusHelper().skipHiddenForTable(e.range.end()+1,!1)}))},Rn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.insertRowsAbove=function(t,e){var r=this.locateRow(t.begin());if(r){var n=r.clone();n.setMainCellToNormal();for(var o=0;o<e;o++)r.insertBefore(n.clone());this.setCommandType(p.Type.DocInsertTableRow),this.applyTableUpdate(),this.moveToCell(r.cells[0].getRange().begin())}},e.prototype.insertRowsBelow=function(t,e){var r=Math.max(t.begin(),t.end()-1),n=this.locateRow(r);if(n){var o=n.clone();n.cells.forEach((function(t,e){t.isLastVMergeCell()&&o.cells[e].clearVMerge()})),o.setMainCellToBeMerged();for(var i=0;i<e;i++)n.insertAfter(o.clone());this.setCommandType(p.Type.DocInsertTableRow),this.applyTableUpdate(),this.moveToCell(n.getRange().end())}},e.prototype.canCleanOnRestrictEdit=function(t){if(!t)return!0;if(this.state.context instanceof tn.z&&!this.state.context.isRestrictProtectOn)return!0;var e=this.state.dataEngine.getDataStream().getTableStream().getRowInfo(t.begin());if(e){var r=this.state.getDataStream().getSdtStream().findShallowestRowSdtByRange(e.range);if(r&&r.property.nestingLevel<=1&&t.equal(e.range))return!1}return!0},e.prototype.removeRows=function(t){if(this.canCleanOnRestrictEdit(t)&&!this.deleteForEntireTable(t)){var e=this.locateRows(t);e&&(Jr(e,(function(t){t.deleteRow()})),this.setCommandType(p.Type.DocDeleteTableRow),this.applyTableStructureUpdate())}},e.prototype.moveRowsTo=function(t,e){if(!this.table)return!1;var r=this.locateRows(t);if(!r)return!1;var n=r.map((function(t){return t.cloneDeep()})),o=function(){for(var t=n.length-1;t>=0;t--)n[t].insertTo(e)},i=function(){Jr(r,(function(t){t.deleteRow()}))};t.begin()>e?(i(),o()):(o(),i()),this.setCommandType(p.Type.DocMoveTableRow),this.applyTableStructureUpdate()},e.prototype.getCellsCountOfFirstSelectedRow=function(){var t,e=null===(t=this.state.selection.tableSelectionArea)||void 0===t?void 0:t.begin;if(!e)return 0;var r=this.locateRow(e);return r?r.cells.length:0},e.prototype.locateRow=function(t){var e=this.table.getRange();return e.begin()===t?this.table.firstRow():e.end()-1===t?this.table.lastRow():this.table.getRow(t)},e.prototype.locateRows=function(t){var e=this.table.rows.filter((function(e){return e.getRange().intersect(t)}));return e.length>0?e:null},e.prototype.moveToCell=function(t){this.state.setRangeTo(new p.GCPRange(this.getValidCellGcp(t)))},e.prototype.getValidCellGcp=function(t){var e,r=this.table.getNestingLevel(),n=this.tableStream.getCellInfo(t,r);return n&&n.property.vMerge.val===p.STMerge.continue&&(null===(e=bn({tableStream:this.tableStream,revisionManager:this.state.getRevisionsManager()},t,r))||void 0===e?void 0:e.range.begin())||t},e}(an),_n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.setTableHorizonAlignment=function(t){var e=this.table.getProperty().clone();t===p.STJcTable.left&&(e.tblPr.tblInd.w=0),e.tblPr.jc.val=t,e.tblPr.has(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPrBase).tKeys.tblpPr)&&t!==p.STJcTable.PBDEFAULT&&(e.tblPr.tblpPr.tblpXSpec=mn[t]),this.table.setProperty(e),this.setCommandType(p.Type.DocModifyTable);var r=this.state.selection.gcpRange,n=this.createUpdateDelta();n.moveTo(r),this.applyTableUpdate(n)},e.prototype.getTableHorizonAlignment=function(){return this.table.getProperty().tblPr.jc.val},e}(an),wn=function(){function t(t){var e=this;this.state=t,this.beginCursorOfTable=function(t){var r=t.contentRange.begin()+1;r=e.skipTableHiddenContent(r,!0);var n=e.tableStream.getCellInfo(r);return n?new p.GCPRange(n.contentRange.begin()):null},this.endCursorOfTable=function(t){var r=t.contentRange.end()-3;r=e.skipTableHiddenContent(r,!1);var n=e.tableStream.getCellInfo(r);return n?new p.GCPRange(n.contentRange.end()-1):null}}return Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableSelectArea",{get:function(){return this.state.selection.tableSelectionArea},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedRange",{get:function(){return this.state.selection.gcpRange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCursor",{get:function(){return 0===this.selectedRange.len},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nestingLevel",{get:function(){var t;return(null===(t=this.tableSelectArea)||void 0===t?void 0:t.nestingLevel)||0},enumerable:!1,configurable:!0}),t.prototype.isInFirstCell=function(){var t;return!!(null===(t=this.tableSelectArea)||void 0===t?void 0:t.isInnerCell())&&!this.prevValidCell(this.tableSelectArea.selectedRange.begin())},t.prototype.isInLastCell=function(){return!(!this.tableSelectArea||!this.tableSelectArea.isInnerCell()||this.nextValidCell(this.tableSelectArea.selectedRange.begin()))},t.prototype.selectFirstCellContent=function(){var t=this.getFirstCellOfSelection();t&&this.setRangeTo(this.cellContentRange(t))},t.prototype.toNextCell=function(){var t=this.nextValidCell(this.selectedRange.begin());t&&this.setRangeTo(this.cellContentRange(t))},t.prototype.getNextCellRange=function(){var t=this.nextValidCell(this.selectedRange.len?this.selectedRange.end()-1:this.selectedRange.end());return t?t.range:null},t.prototype.toPrevCell=function(){var t=this.prevValidCell(this.selectedRange.begin());t&&this.state.setRangeTo(this.cellContentRange(t))},t.prototype.getPrevCellRange=function(){var t=this.prevValidCell(this.selectedRange.begin());return t?t.range:null},t.prototype.selectCurrentTable=function(){if(this.tableSelectArea){var t=this.tableStream.getTableInfo(this.tableSelectArea.begin,this.tableSelectArea.nestingLevel);t&&this.selectTable(t)}},t.prototype.attemptForwardToTable=function(){var t=this.selectedRange.begin()+1;return this.attemptToTable(t,this.beginCursorOfTable)},t.prototype.attemptBackwardToTable=function(){var t=this.selectedRange.end()-1;return!(t<0)&&this.attemptToTable(t,this.endCursorOfTable)},t.prototype.isCursorInCellBegin=function(){if(!this.isCursor)return!1;var t=this.getSelectionCell(this.selectedRange.begin());return(null==t?void 0:t.range.begin())===this.selectedRange.begin()},t.prototype.attemptSelectTableBeforeCursor=function(){if(!this.isCursor)return!1;var t=this.decrease(this.selectedRange.begin()),e=this.tableStream.getTableInfo(t,this.nestingLevel+1);return t+1===(null==e?void 0:e.range.end())&&this.selectTable(e)},t.prototype.attemptMoveCursorPrev=function(){if(!this.tableSelectArea||this.tableSelectArea.isCrossTable())return!!this.isCursor&&this.attemptBackwardToTable();if(this.tableSelectArea.isInnerTable())return!!(t=this.getSelectionCell(this.tableSelectArea.begin))&&(this.state.setRangeTo(new p.GCPRange(t.range.begin())),!0);if(this.isCursorInCellBegin()){var t,e=this.selectedRange.begin();return(t=this.prevValidCell(e))?this.state.setRangeTo(new p.GCPRange(t.contentRange.end()-1)):this.moveCursorOutOfTable(e,!1),!0}return!1},t.prototype.attemptMoveCursorNext=function(){if(!this.tableSelectArea||this.tableSelectArea.isCrossTable())return!!this.isCursor&&this.attemptForwardToTable();if(this.tableSelectArea.isInnerTable()||this.isCursorInCellEnd()){var t=this.nextValidCell(this.tableSelectArea.end+1);return t?this.state.setRangeTo(new p.GCPRange(t.range.begin())):this.moveCursorOutOfTable(this.selectedRange.begin(),!0),!0}return!1},t.prototype.selectTable=function(t){return this.state.setRangeTo(t.range,{scrollToView:h.hF.None}),!0},t.prototype.cellContentRange=function(t){return p.GCPRange.insetBoth(t.contentRange,0,1)},t.prototype.moveCursorOutOfTable=function(t,e){void 0===e&&(e=!0);var r=this.tableStream.getTableInfo(t);if(r){var n=e?r.range.end():(0,p.offsetPlaceholders)(this.state.getTextStream(),r.range.begin(),[p.PlaceholderChar.TableStart],-1);n<0||this.setRangeTo(n,{shouldSkipHiddenContent:!0,isForward:e})}},t.prototype.isCursorInCellEnd=function(){if(!this.isCursor)return!1;var t=this.getSelectionCell(this.selectedRange.begin());return!!t&&t.contentRange.end()-1===this.selectedRange.begin()},t.prototype.nextValidCell=function(t){return bn({tableStream:this.tableStream,revisionManager:this.state.getRevisionsManager()},t,this.nestingLevel)},t.prototype.prevValidCell=function(t){return function(t,e,r){return Cn(t.tableStream,e,r,(function(e){return t.revisionManager.getRevisionStatusHelper().skipHiddenForTable(e.range.begin()-2,!0)}))}({tableStream:this.tableStream,revisionManager:this.state.getRevisionsManager()},t,this.nestingLevel)},t.prototype.decrease=function(t){return Math.max(t-1,0)},t.prototype.attemptToTable=function(t,e){var r=this.tableStream.getTableInfo(t);if(!r)return!1;var n=e(r);return!!n&&(this.state.setRangeTo(n),!0)},t.prototype.getFirstCellOfSelection=function(){if(this.tableSelectArea)return this.tableStream.getNearestNextCell(this.tableSelectArea.begin,this.nestingLevel)},t.prototype.getSelectionCell=function(t){return this.tableSelectArea?this.tableStream.getCellInfo(t,this.tableSelectArea.nestingLevel):null},t.prototype.skipTableHiddenContent=function(t,e){return this.state.getRevisionsManager().getRevisionStatusHelper().skipHiddenForTable(t,!e)},t.prototype.setRangeTo=function(t,e){if(!(null==e?void 0:e.shouldSkipHiddenContent)){var r=void 0;return r="number"==typeof t?new p.GCPRange(t):t,void this.state.setRangeTo(r)}var n;if("number"==typeof t){var o=this.skipTableHiddenContent(t,null==e?void 0:e.isForward);n=new p.GCPRange(o)}else o=this.skipTableHiddenContent(t.begin(),null==e?void 0:e.isForward),n=new p.GCPRange(o);this.state.setRangeTo(n)},t}(),xn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.isTableWrapText=function(){return this.table.getProperty().isWrapText},e.prototype.setVerticalAnchorPageType=function(t){var e=this.table.getProperty().clone();e.tblPr.tblpPr.vertAnchor=p.STVAnchor.page,e.tblPr.tblpPr.tblpY=t.y,e.tblPr.tblpPr.tblpXSpec===p.STXAlign.PBDEFAULT&&(e.tblPr.tblpPr.horzAnchor=p.STHAnchor.page,e.tblPr.tblpPr.tblpX=t.x),this.table.setProperty(e),this.setCommandType(p.Type.DocModifyTable),this.recoverSelectionAndApplyDelta()},e.prototype.setVerticalAnchorTextType=function(){var t=this.table.getProperty().clone();t.tblPr.tblpPr.vertAnchor=p.STVAnchor.text,t.tblPr.tblpPr.tblpY=p.Defaults.tableTextWrap.tblpY,t.tblPr.tblpPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPPr).tKeys.tblpYSpec);var e=t.tblPr.jc.val;e!==p.STJcTable.PBDEFAULT&&(t.tblPr.tblpPr.tblpXSpec=mn[e]),this.table.setProperty(t),this.setCommandType(p.Type.DocModifyTable),this.recoverSelectionAndApplyDelta()},e.prototype.getVerticalAnchorType=function(){return this.table.getProperty().tblPr.tblpPr.vertAnchor},e.prototype.setInlineWrapType=function(){var t=this.table.getProperty().clone();t.tblPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPrBase).tKeys.tblpPr),this.table.setProperty(t),this.setCommandType(p.Type.DocModifyTable),this.recoverSelectionAndApplyDelta()},e.prototype.setSquareWrapType=function(){var t=this.table.getProperty().clone(),e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPPr));e.vertAnchor=p.STVAnchor.text,e.horzAnchor=p.STHAnchor.text,e.leftFromText=p.Defaults.tableTextWrap.leftFromText,e.rightFromText=p.Defaults.tableTextWrap.rightFromText,t.tblPr.tblpPr=e,t.tblPr.jc.val!==p.STJcTable.PBDEFAULT?e.tblpXSpec=mn[t.tblPr.jc.val]:(e.tblpXSpec=p.STXAlign.left,t.tblPr.jc.val=p.STJcTable.left),this.table.setProperty(t),this.setCommandType(p.Type.DocModifyTable),this.recoverSelectionAndApplyDelta()},e.prototype.recoverSelectionAndApplyDelta=function(){var t=this.state.selection.gcpRange,e=this.createUpdateDelta();e.moveTo(t),this.applyTableUpdate(e)},e}(sn),In=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.tableSelectArea=n._state.selection.tableSelectionArea,n.table=n.createSelectedTable(),n.table&&(n.columnService=new Pn(n.table,r,n._state),n.formatService=new Tn(n.table,r,n._state),n.rowService=new Rn(n.table,r,n._state),n.splitService=un.create(n.table,r,n._state),n.borderService=new fn(n.table,r,n._state),n.tableAlignService=new _n(n.table,r,n._state),n.tableWrapTextService=new xn(n.table,r,n._state)),n.controlSelectService=new wn(n._state),n}return(0,i.__extends)(e,t),e.create=function(t,r){return new e(t,r)},Object.defineProperty(e.prototype,"insertColCount",{get:function(){var t,e;return(null===(e=null===(t=this.tableSelectArea)||void 0===t?void 0:t.cellRanges[0])||void 0===e?void 0:e.colCount)||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"insertRowCount",{get:function(){var t,e;return(null===(e=null===(t=this.tableSelectArea)||void 0===t?void 0:t.cellRanges[0])||void 0===e?void 0:e.rowCount)||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mergeService",{get:function(){return this.table?(this.cacheMergeService||(this.cacheMergeService=pn.create(this.table,this._deltaOpt,this._state)),this.cacheMergeService):null},enumerable:!1,configurable:!0}),e.prototype.insertTable=function(t,e){new Sn(this._state,this._deltaOpt).insert(t,e)},e.prototype.insertColsLeft=function(t){var e;this.isLocatedInSingleTable()&&(null===(e=this.columnService)||void 0===e||e.insertColsLeft(this.tableSelectArea.selectedRange,t))},e.prototype.insertColsRight=function(t){var e;this.isLocatedInSingleTable()&&(null===(e=this.columnService)||void 0===e||e.insertColsRight(this.tableSelectArea.selectedRange,t))},e.prototype.removeCols=function(){var t;this.isLocatedInSingleTable()&&(null===(t=this.columnService)||void 0===t||t.removeCols(this.tableSelectArea.selectedRange))},e.prototype.setBackgroundColor=function(t){var e;null===(e=this.formatService)||void 0===e||e.setBackgroundColor(t)},e.prototype.setVerticalAlign=function(t){var e;null===(e=this.formatService)||void 0===e||e.setVerticalAlign(t)},e.prototype.getVerticalAlign=function(){var t;return(null===(t=this.formatService)||void 0===t?void 0:t.getVerticalAlign())||p.STVerticalJc.center},e.prototype.insertRowsAbove=function(t){var e;this.isLocatedInSingleTable()&&(null===(e=this.rowService)||void 0===e||e.insertRowsAbove(this.tableSelectArea.selectedRange,t))},e.prototype.insertRowsBelow=function(t){var e;this.isLocatedInSingleTable()&&(null===(e=this.rowService)||void 0===e||e.insertRowsBelow(this.tableSelectArea.selectedRange,t))},e.prototype.removeRows=function(){var t;this.isLocatedInSingleTable()&&(null===(t=this.rowService)||void 0===t||t.removeRows(this.tableSelectArea.selectedRange))},e.prototype.canMerge=function(){var t;return(null===(t=this.mergeService)||void 0===t?void 0:t.isAllowMerge())||!1},e.prototype.merge=function(){var t;null===(t=this.mergeService)||void 0===t||t.merge()},e.prototype.canSplit=function(){var t,e;return(null===(t=this.splitService)||void 0===t?void 0:t.isAllowSplit())&&!!(null===(e=this.tableSelectArea)||void 0===e?void 0:e.isInnerCell())||!1},e.prototype.split=function(t,e){var r;null===(r=this.splitService)||void 0===r||r.split(t,e)},e.prototype.clearContent=function(){var t;null===(t=this.formatService)||void 0===t||t.clearContent()},e.prototype.getBorderType=function(t){var e;return(null===(e=this.borderService)||void 0===e?void 0:e.getBorderType(t))||p.WdBorderType.None},e.prototype.setBorder=function(t,e){var r;null===(r=this.borderService)||void 0===r||r.setBorder(t,e)},e.prototype.setTableHorizonAlignment=function(t){var e;null===(e=this.tableAlignService)||void 0===e||e.setTableHorizonAlignment(t)},e.prototype.getTableHorizonAlignment=function(){return this.tableAlignService?this.tableAlignService.getTableHorizonAlignment():p.STJcTable.PBDEFAULT},e.prototype.getCellProperty=function(t){var e;return(null===(e=this.formatService)||void 0===e?void 0:e.getCellProperty(t))||null},e.prototype.setTableVerticalAnchorTextType=function(){var t;null===(t=this.tableWrapTextService)||void 0===t||t.setVerticalAnchorTextType()},e.prototype.isTableWrapText=function(){var t;return null===(t=this.tableWrapTextService)||void 0===t?void 0:t.isTableWrapText()},e.prototype.setTableVerticalAnchorPageType=function(t){var e;null===(e=this.tableWrapTextService)||void 0===e||e.setVerticalAnchorPageType(t)},e.prototype.getTableVerticalAnchorType=function(){var t;return null===(t=this.tableWrapTextService)||void 0===t?void 0:t.getVerticalAnchorType()},e.prototype.setTableInlineWrapType=function(){var t;null===(t=this.tableWrapTextService)||void 0===t||t.setInlineWrapType()},e.prototype.setTableSquareWrapType=function(){var t;null===(t=this.tableWrapTextService)||void 0===t||t.setSquareWrapType()},e.prototype.getSelectedTable=function(){return this.table},e.prototype.getCellsCountOfFirstSelectedRow=function(){var t;return(null===(t=this.rowService)||void 0===t?void 0:t.getCellsCountOfFirstSelectedRow())||0},e.prototype.getTableInfo=function(){if(this._deltaOpt&&this.tableSelectArea){var t=this._state.getTableStream().getTableInfo(this._deltaOpt.originRange.begin(),this.tableSelectArea.nestingLevel);if(t)return t}return null},e.prototype.getTableCellInfo=function(t){return this.tableSelectArea?this._state.getTableStream().getCellInfo(t.begin(),this.tableSelectArea.nestingLevel):null},e.prototype.canRemoveOnRestrictEdit=function(t){var e=this;if(!(this._state.context instanceof tn.z&&this._state.context.isRestrictProtectOn))return!0;var r=!1;return t.someOp((function(t){return t instanceof h.uE&&t.operationType===h.C8.DeleteText&&!e._state.getRestrictEdit().checkPermissionRangeByGcpRange(t.param.range)&&(r=!0,!0)})),!r},e.prototype.removeTable=function(){if(this._state&&this._deltaOpt){var t=this._deltaOpt.buildDelta();if(this.table){if(this.table.deleteTable(),this.table.getTableActionManager().consumeActionsToDelta(t),t.setCommandType(p.Type.DocDeleteTable),!this.canRemoveOnRestrictEdit(t))return;this._state.applyDelta(t)}}},e.prototype.getVMergeCount=function(){var t;return(null===(t=this.splitService)||void 0===t?void 0:t.getVMergeCount())||0},e.prototype.hasMergeGroup=function(){var t;return(null===(t=this.splitService)||void 0===t?void 0:t.hasMergeGroup())||!1},e.prototype.isInFirstCell=function(){return this.controlSelectService.isInFirstCell()},e.prototype.isInLastCell=function(){return this.controlSelectService.isInLastCell()},e.prototype.selectFirstCellContent=function(){return this.controlSelectService.selectFirstCellContent()},e.prototype.toNextCell=function(){return this.controlSelectService.toNextCell()},e.prototype.toPrevCell=function(){return this.controlSelectService.toPrevCell()},e.prototype.getPrevCellRange=function(){return this.controlSelectService.getPrevCellRange()},e.prototype.getNextCellRange=function(){return this.controlSelectService.getNextCellRange()},e.prototype.selectCurrentTable=function(){return this.controlSelectService.selectCurrentTable()},e.prototype.attemptBackwardToTable=function(){return this.controlSelectService.attemptBackwardToTable()},e.prototype.attemptForwardToTable=function(){return this.controlSelectService.attemptForwardToTable()},e.prototype.attemptSelectTableBeforeCursor=function(){return this.controlSelectService.attemptSelectTableBeforeCursor()},e.prototype.isCursorInCellBegin=function(){return this.controlSelectService.isCursorInCellBegin()},e.prototype.clearFirstCellContent=function(){var t;return null===(t=this.formatService)||void 0===t?void 0:t.clearFirstCellContent()},e.prototype.attemptMoveCursorPrev=function(){return this.controlSelectService.attemptMoveCursorPrev()},e.prototype.attemptMoveCursorNext=function(){return this.controlSelectService.attemptMoveCursorNext()},e.prototype.setTableStyleTheme=function(t){var e;return null===(e=this.formatService)||void 0===e?void 0:e.setTableStyleTheme(t)},e.prototype.isLocatedInSingleTable=function(){return this.tableSelectArea&&!this.tableSelectArea.isCrossTable()},e.prototype.createSelectedTable=function(){if(!this.tableSelectArea)return null;var t=null;return this.tableSelectArea.isInnerCell()&&(t=this.tableSelectArea.selectedRange.begin()),this.tableSelectArea.isInnerTable()&&(t=this.tableSelectArea.cellRanges[0].begin),null===t?null:on.createTable(this._state,t,this.tableSelectArea.nestingLevel)},e}(Rr),Dn=function(t){function e(e,r,n){var o=t.call(this,e,r)||this;return o.originFieldInfo=n,o}return(0,i.__extends)(e,t),e.createStateField=function(t,r,n){return new e(t,r,n)},e.prototype.getFieldInfo=function(){return this.originFieldInfo},e.prototype.getCode=function(){if(this._state){var t=this.originFieldInfo.fieldCode.range;return this._state.getTextStream().readText(t.begin(),t.length())}return""},e.prototype.getResult=function(){var t,e=(null!==(t=this.originFieldInfo.fieldResult)&&void 0!==t?t:{}).range;return this._state&&e?this._state.getTextStream().readText(e.begin(),e.length()):""},e.prototype.getType=function(){var t=this.getCode().trim();if(t.length>0){var e=t.split(" ");if(e.length>0){var r=e[0];for(var n in c.X5C)if(Object.prototype.hasOwnProperty.call(c.X5C,n)&&r===c.X5C[n])return c.X5C[n]}}return c.X5C.fieldEmpty},e.prototype.getNext=function(){var t;if(this._state&&this._deltaOpt){var r=this._state.getFieldStream();if(r){var n=r.createFieldIterator({limitRange:this._deltaOpt.originRange}),o=this.getRange();if(n.seek(o.begin()),n.hasNext()){n.next();var i=r.getDecodedFieldInfo(n.getRange().begin(),null===(t=this.originFieldInfo)||void 0===t?void 0:t.nestingLevel);if(i){var a=h.C1.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateField(this._state,a,i)}}}}},e.prototype.getPrev=function(){var t;if(this._state&&this._deltaOpt){var r=this._state.getFieldStream();if(r){var n=r.createFieldIterator({limitRange:this._deltaOpt.originRange}),o=this.getRange();if(n.seek(o.begin()),n.hasPrev()){n.prev();var i=r.getDecodedFieldInfo(n.getRange().begin(),null===(t=this.originFieldInfo)||void 0===t?void 0:t.nestingLevel);if(i){var a=h.C1.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateField(this._state,a,i)}}}}},e}(Rr),Fn=function(t){function e(e,r,n){void 0===n&&(n=1);var o=t.call(this,e,r)||this;return o.nestingLevel=n,o}return(0,i.__extends)(e,t),e.createStateFields=function(t,r,n){return new e(t,r,n)},e.prototype.add=function(t,e,r,n){var o=e!==c.X5C.fieldEmpty?" ".concat(e," "):" ";o+=r,n&&(o+=" ".concat("\\* MERGEFORMAT")),o+=" ",t.insertField(o,"xxx")},e.prototype.createIterator=function(){var t,e,r,n;return(0,i.__generator)(this,(function(o){switch(o.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];if(!(t=this._state.getFieldStream()))return[3,4];e=t.createFieldIterator({limitRange:this._deltaOpt.originRange}),o.label=1;case 1:return e.hasNext()?(r=t.getDecodedFieldInfo(e.getRange().begin(),this.nestingLevel),e.next(),r?((n=this._deltaOpt.copy()).originRange=r.fieldRange.clone(),[4,Dn.createStateField(this._state,n,r)]):[3,3]):[3,4];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(Ir);function En(t,e,r,n,o){var i;void 0===o&&(o=!1);var a=n?new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(n):new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));if((null===(i=p.FieldUtil.decodeFieldCode(r))||void 0===i?void 0:i.name)===p.FieldName.HYPERLINK){var s=Be.generateStyleProperty(e,t,"Hyperlink");(null==s?void 0:s.type)===p.STStyleType.character&&((o||s.rPr.color.val===a.color.val)&&a.setDefault(a.tKeys.color),a.setDefault(a.tKeys.u),a.rStyle.val=s.styleId)}return a}function Mn(t,e,r,n,a){void 0===a&&(a=!1);var s=e.currentRange().end(),l=[];r.forEach((function(r){var c=t.getStoryStream().collectCommentStoryInfosFromId(r.refProp.id);if(0!==c.length){var u=o.m7.generateRandomId(),g=a?n.begin():r.annotationRange.begin(),d=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CommentReferenceProperty))(r.refProp);d.id=u;var y=new p.GCPRange(g,s-g),f=e.currentRange().end();h.Gh.insertCommentReference(f,y,d,e),e.moveTo(new p.GCPRange(f+1,0)),c.forEach((function(e){var r=e.contentRange,n=e.subStoryProp;n.refId=u,n.id="c_".concat(o.m7.generateRandomId());var a=function(t,e){for(var r=e.begin(),n=e.end(),o=t.getTextStream(),a=t.dataEngine.getDataStream().getFieldStream(),s=[],l=r,p=r;p<n;){var c=a.getDecodedFieldInfo(p);if(c){var u=o.readText(l,p-l);u&&s.push({text:u}),l=p=c.fieldRange.end(),s.push({field:{fieldCode:(0,i.__spreadArray)([c.fieldCode.name],(0,i.__read)(c.fieldCode.instructions),!1).join(" "),fieldResult:c.fieldResult.result}})}else p+=1}var g=o.readText(l,p-l);return g&&s.push({text:g}),s}(t,r);l.push({commentFieldCodeTextList:a,subStoryProp:n})}))}}));var c=e.currentRange().end()-n.end(),u=t.getStoryStream().getStoryLastPos(p.STStoryType.commentContent),g=u+c;u<n.end()&&(g=u),e.moveTo(new p.GCPRange(g,0)),l.forEach((function(t){var r=t.commentFieldCodeTextList,n=t.subStoryProp;h.Gh.insertCommentStory(n,e.currentRange().end(),JSON.stringify(r),e)})),e.moveTo(new p.GCPRange(s,0))}function Ln(t){return t.replace(new RegExp(/([\u0013-\u0015])+/,"g"),"")}var An=function(){function t(t,e){this.updateDelta=e,this.state=t}return Object.defineProperty(t.prototype,"delta",{get:function(){return this.updateDelta||(this.updateDelta=h.C1.createLocalDeltaOption(this.state.selection.gcpRange,!1).buildDelta()),this.updateDelta},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sdtStream",{get:function(){return this.state.getDataStream().getSdtStream()},enumerable:!1,configurable:!0}),t.prototype.getResultDelta=function(){return 0===this.delta.operations.length?null:(this.delta.reverseSortOp(),this.delta)},t.prototype.setMergeUndo=function(){this.delta.globalOpts.undoOption.needMergeUndoStackTop=!0},t.prototype.commit=function(){var t=this.getResultDelta();t&&this.state.applyDelta(t)},t}(),Bn=function(t){function e(e,r,n){var o=t.call(this,e,n)||this;return o.info=r,o.state=e,o}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"range",{get:function(){return this.info.range},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentRange",{get:function(){return this.info.contentRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInline",{get:function(){return this.info.property.isInline},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBlock",{get:function(){return this.info.property.isBlock},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCell",{get:function(){return this.info.property.isCell},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRow",{get:function(){return this.info.property.isRow},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isShowingPlaceholder",{get:function(){return!!this.info.property.isShowingPlaceholder},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isTemporary",{get:function(){var t=this;return!!this.info.property.sdtPr.readOnly((function(){return t.info.property.sdtPr.temporary.val}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){var t,e=this;return null!==(t=this.info.property.readOnly((function(){return e.info.property.sdtPr.id.val})))&&void 0!==t?t:""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"containBlock",{get:function(){var t=this.state.getTextStream().createParagraphIterator();t.seek(this.range.begin());var e=t.getRange().backwardExpand(-1);return!t.getRange().contains(this.range)||e.equal(this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.sdtStream.getSdtInfo(this.range.begin(),this.info.property.nestingLevel-1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nestingLevel",{get:function(){return this.info.property.nestingLevel},enumerable:!1,configurable:!0}),e.prototype.setShowingPlaceholder=function(t){var e=this.createProperty();e.sdtPr.showingPlcHdr.val=t,this.updateProperty(e,!0)},e.prototype.insertPlaceholderChars=function(t){void 0===t&&(t="     ");var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));e.color.val="808080";var r=this.info.range.begin()+1;h.Gh.insertText(r,t,e,this.delta)},e.prototype.setBlock=function(){var t=this.createProperty();t.type.val=p.STSdtType.block,this.updateProperty(t,!0)},e.prototype.deleteContainer=function(){this.deleteText(this.range.end()-1,1),this.deleteText(this.range.begin(),1)},e.prototype.checkNestingSdt=function(){var t=this.info,e=!0,r=!0,n=this.parent;return n&&(t.range.begin()===n.contentRange.begin()&&(e=!1),t.range.end()===n.contentRange.end()&&(r=!1)),[e,r]},e.prototype.insertParagraph=function(t){var e=this.state.followParaProp(t),r=e.paraBreakSpan,n=e.paraProp;h.Gh.insertParagraph(t,r,n,this.delta)},e.prototype.updateProperty=function(t,e){void 0===e&&(e=!1);var r=e,n=t.readOnly((function(){return t.nestingLevel}));if(null!==n&&n>=0&&(r=!0),r){var o=t.clone();o.isBegin||(o.isBegin=!0),h.Gh.setSdtProperty({range:new p.GCPRange(this.info.range.begin(),1),property:o,mode:p.PropUpdateMode.Merge},this.delta)}var i=t.clone();i.isBegin&&(i.isBegin=!1),h.Gh.setSdtProperty({range:new p.GCPRange(this.info.range.end()-1,1),property:i,mode:p.PropUpdateMode.Merge},this.delta)},e.prototype.deleteText=function(t,e){h.Gh.deleteText(new p.GCPRange(t,e),this.delta)},e.prototype.getRunProperty=function(t){var e=this.state.getTextStream().createRunIterator();return e.seek(t),e.getCloneProperty()||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))},e.prototype.createProperty=function(){var t=this,e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SdtProperty));return e.nestingLevel=this.info.property.nestingLevel,this.info.property.readOnly((function(){return t.info.property.sdtPr.id.val}))?e.sdtPr.id.val=this.info.property.sdtPr.id.val:e.sdtPr.id.val="".concat(o.m7.generateRandomId()).concat(Date.now()),e},e}(An),Nn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.completeStructure=function(){this.containBlock&&this.setBlock()},e}(Bn),On=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.completeStructure=function(){if(this.state.getDataStream().getSdtStream().isTableBlockSdt(this.info)){var t=this.getContentRange();return t?void this.adjustTableSdtEnd(t):void this.deleteContainer()}var e=(0,i.__read)(this.checkAroundPara(),2),r=e[0],n=e[1];if(r||n){var o=(0,i.__read)(this.checkNestingSdt(),2),a=o[0],s=o[1];r&&a&&this.fixBlock(this.info.range.begin()),n&&s&&this.fixBlock(this.info.range.end())}},e.prototype.fixBlock=function(t){this.containBlock?(this.isBlock||this.setBlock(),this.insertParagraph(t)):this.setInline()},e.prototype.checkAroundPara=function(){var t=this.info,e=this.state.getTextStream().createParagraphIterator();e.seek(t.range.begin());var r=!0,n=!0;return e.getRange().begin()===t.range.begin()&&(r=!1),e.seek(t.range.end()),e.getRange().end()-1===t.range.end()&&(n=!1),[r,n]},e.prototype.setInline=function(){var t,e,r=this.createProperty();r.type.val=p.STSdtType.run,this.updateProperty(r,!0);var n=this.getChildren();try{for(var o=(0,i.__values)(n),a=o.next();!a.done;a=o.next())a.value.setInline()}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},e.prototype.getChildren=function(){var t=this;return this.sdtStream.collectSdtInRange(this.contentRange,this.nestingLevel+1).map((function(r){return new e(t.state,r,t.delta)}))},e.prototype.adjustTableSdtEnd=function(t){var e=t.range,r=t.endCell,n=e.end();r.range.contains(this.range.end())||(this.deleteText(this.range.end()-1,1),h.Gh.insertSdtEnd(n,this.info.property,this.getRunProperty(n),this.delta))},e.prototype.getContentRange=function(){var t=this.state.getDataStream().getTableStream(),e=t.getTableInfo(this.range.end());if(!e)return null;var r=t.getCellInfo(e.contentRange.end()-3);return r?{range:new p.GCPRange(r.range.begin(),r.contentRange.end()-1-r.range.begin()),endCell:r}:null},e}(Bn),kn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"nestingCell",{get:function(){var t=this.sdtStream.getSdtInfo(this.contentRange.begin(),this.nestingLevel+1);return(null==t?void 0:t.property.isCell)?new e(this.state,t,this.delta):null},enumerable:!1,configurable:!0}),e.prototype.completeStructure=function(){var e=this.state.getTableStream().getCellInfo(this.range.begin());!this.isCell||this.nestingLevel!==p.DEFAULT_NESTING_LEVEL||e&&this.range.begin()===e.contentRange.begin()&&this.range.end()===e.contentRange.end()-1||this.setBlock(),t.prototype.completeStructure.call(this)},e.prototype.setBlock=function(){var e;t.prototype.setBlock.call(this),null===(e=this.nestingCell)||void 0===e||e.setBlock()},e}(On),Gn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"isRow",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.completeStructure=function(){var t=this.getContentRange();t?(this.adjustRowEnd(t),this.adjustRowStart(t)):this.deleteContainer()},e.prototype.adjustRowStart=function(t){var e=t.range,r=t.startCell,n=e.begin();this.isRow&&this.range.begin()!==n&&!r.range.contains(this.range.begin())&&(this.deleteText(this.range.begin(),1),h.Gh.insertSdtStart(n,this.createProperty(),this.getRunProperty(n),this.delta))},e.prototype.adjustRowEnd=function(t){var e=t.range,r=t.endCell,n=e.end();this.isRow&&!r.range.contains(this.range.end())&&(this.deleteText(this.range.end()-1,1),h.Gh.insertSdtEnd(n,this.info.property,this.getRunProperty(n),this.delta))},e.prototype.getContentRange=function(){var t=this.state.getTableStream().getRowInfo(this.range.begin());if(!t)return null;var e=this.state.getTableStream().getCellInfo(t.contentRange.begin()),r=this.state.getTableStream().getCellInfo(t.contentRange.end()-1);return r&&e?{range:new p.GCPRange(t.range.begin(),r.contentRange.end()-1-t.range.begin()),endCell:r,startCell:e}:null},e}(Bn),Hn=function(t,e,r){switch(e.property.type.val){case p.STSdtType.run:return new Nn(t,e,r);case p.STSdtType.block:return new On(t,e,r);case p.STSdtType.cell:return new kn(t,e,r);case p.STSdtType.row:return new Gn(t,e,r)}return new Nn(t,e,r)},Wn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.create=function(t){return new e(t)},Object.defineProperty(e.prototype,"stream",{get:function(){return this.state.getDataStream().getSdtStream()},enumerable:!1,configurable:!0}),e.prototype.fillPlaceholder=function(t){for(var e=[],r=this.stream.createSdtIterator();r.hasNext();){var n=(0,p.createInfo)(r);(null==n?void 0:n.contentRange.isEmpty())&&e.push(Hn(this.state,n,this.delta)),r.next()}this.delta.globalOpts.extraInfo=c.ADj,this.reverseInvokeCallback(e,t),this.commit()},e.prototype.computedSdtContentChangeDelta=function(t,e){var r=this.stream.getSdtInfo(t.begin());if(r&&r.range.contains(t)){var n=r.contentRange,o=n.gcpBegin,i=n.len,a=Hn(this.state,r,this.delta);a.isTemporary?a.deleteContainer():a.isShowingPlaceholder&&e!==this.state.getTextStream().readText(o,i)&&a.setShowingPlaceholder(!1)}return this.getResultDelta()},e.prototype.computeStructureAdjustDelta=function(t){var e=this,r=this.collectEffectSdtInfos(t);return Array.from(r.values()).sort((function(t,e){return t.property.nestingLevel-e.property.nestingLevel})).forEach((function(t){Hn(e.state,t,e.delta).completeStructure()})),this.getResultDelta()},e.prototype.computePlaceholderRestoreDelta=function(){var t,e,r=this,n=this.state.dataEngine.getDataManager().getPropCacheManager().sdtDeleteList.findGCPs();n.sort((function(t,e){var r=t.key.sdt,n=e.key.sdt;return r.isBegin&&n.isBegin?n.nestingLevel-r.nestingLevel:r.isBegin||n.isBegin?Number(r.isBegin)-Number(n.isBegin):r.nestingLevel-n.nestingLevel}));var o=function(t,e,n,o){var i=a.stream.createSdtIterator({nestingLevel:e.nestingLevel,isRawIter:!0});e.isBegin?i.seek(t):i.seekPrev(t);var s=i.getProperty();if(!s||s.isBegin===e.isBegin)return"continue";var l=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(n),c=i.currPos(),u=a.getInsertPos(e,c,t,o);if(null===u)return a.delta.preventTextTrackChangesWrapper((function(){h.Gh.deleteText(new p.GCPRange(c,1),r.delta)})),"continue";a.delta.preventTextTrackChangesWrapper((function(){e.isBegin?h.Gh.insertSdtStart(u,e,l,r.delta):h.Gh.insertSdtEnd(u,e,l,r.delta)}))},a=this;try{for(var s=(0,i.__values)(n),l=s.next();!l.done;l=s.next()){var c=l.value,u=c.gcp,g=c.key;o(u,g.sdt,g.run,g.tableStartGcp)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return this.getResultDelta()},e.prototype.getSdtInfo=function(t,e){return this.sdtStream.getSdtInfo(t,e)},e.prototype.collectEffectSdtInfos=function(t){var e,r,n=this,o=new Map;try{for(var a=(0,i.__values)(t),s=a.next();!s.done;s=a.next()){for(var l=s.value,c=[p.STSdtType.run,p.STSdtType.block,p.STSdtType.cell,p.STSdtType.row],u=0;u<=c.length;u++){var g=l.begin()-1;if(g>=0){var h=this.stream.getSdtInfo(g);if(!h)continue;var d=h.range.toString();(null==h?void 0:h.property.type.val)!==c[u]||o.has(d)||h.range.end()-1!==g||o.set(d,h)}}[l.begin()-1,l.begin(),l.end()].forEach((function(t){var e=n.stream.getSdtInfo(t);if(e){var r=(null==e?void 0:e.range.toString())||"";e&&!o.has(r)&&o.set(r,e)}else n.state.getDataStream().getSdtStream().findAllTableAndRowSdtsByPos(t).forEach((function(t){if(t){var e=t.range.toString()||"";o.has(e)||o.set(e,t)}}))}))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o},e.prototype.getRowSdtPos=function(t,e,r){if(t.isRow){var n=this.state.getTableStream().getRowInfo(e);if(!n)return null;var o=n.range.begin();if(t.isBegin){var i=this.state.getTableStream().getCellInfo(r),a=this.state.getTableStream().getCellInfo(o);return i&&a&&i.range.equal(a.range)?r:n.contentRange.begin()}var s=this.state.getTableStream().getCellInfo(r),l=this.state.getTableStream().getCellInfo(n.contentRange.end()-1);return s&&l&&s.range.equal(l.range)?r:n.contentRange.end()-2}return r},e.prototype.getTableBlockSdtPos=function(t,e,r,n){if(t.isBlock&&Number.isInteger(n)){var o=this.state.getTableStream().getTableInfo(n);if(!o)return null;var i=this.state.getTableStream().getCellInfo(r),a=this.state.getTableStream().getCellInfo(o.contentRange.end()-3);return i&&a&&i.range.equal(a.range)?r:a?a.contentRange.end()-1:null}return r},e.prototype.getInsertPos=function(t,e,r,n){return t.isRow?this.getRowSdtPos(t,e,r):t.isBlock&&Number.isInteger(n)?this.getTableBlockSdtPos(t,e,r,n):r},e.prototype.reverseInvokeCallback=function(t,e){for(var r=t.length-1;r>=0;r--)e(t[r],r)},e}(An),Un=function(){function t(t,e){this.insertOptions={preventTextTrackChanges:!0},this.state=t,this.selection=this.state.context.service.getSelection();var r=this.state.selection;this.delta=e.buildDelta(),this.coreRange=r.getCoreRange(),this.dataStream=this.state.getDataStream(),this.sdtStream=this.dataStream.getSdtStream()}return t.prototype.setRangeTo=function(t,e,r){void 0===r&&(r=!0),this.state.setRangeTo(new p.GCPRange(t,e-t),{nonRenderSelection:!r,forceFocus:r,noSendCaret:!r,scrollToView:h.hF.NearTop,forceNotify:r,noSendSelectionChange:!r,customData:{disableFloatToolbar:!0,nonShowTableToolbar:!0}})},t.prototype.getFocusSdtRange=function(t){var e,r;if(!t)return null;if(t.property.isRow){var n=this.state.getTableStream().getRowInfo(t.range.end()-1);if(null==n?void 0:n.range)return n.range}return(null===(r=null===(e=this.selection)||void 0===e?void 0:e.getSdtSelection())||void 0===r?void 0:r.isEditDisabledType(null,t))?new p.GCPRange(t.contentRange.begin(),0):new p.GCPRange(t.contentRange.begin(),t.contentRange.len)},t.prototype.focusRangeToSdtByPosition=function(t,e){var r,n=null!=e?e:{focusToDefault:!1},o=n.focusToDefault,i=void 0!==o&&o,a=n.startLevel,s=n.endLevel,l=t instanceof p.GCPRange?t.begin():t,c=null===(r=this.selection)||void 0===r?void 0:r.getSdtSelection().findNearestSdt(l,{isIncludeWrappedSdt:!1,startLevel:a,endLevel:s});if(!c)return i&&this.setRangeTo(0,0,!1),new p.GCPRange(0,0);var u=this.getFocusSdtRange(c);return u&&this.setRangeTo(u.begin(),u.end()),u},t.prototype.delete=function(t){if(t){var e=new p.GCPRange(t.range.end()-1,1);this.state.getRevisionsManager().getRevisionBusinessHelper().isCompletelyDeleteRange(e)&&this.updateChildrenNestingLevel(new p.GCPRange(t.contentRange.begin(),t.contentRange.len),t.property.nestingLevel,!1),this.delta.setCommandType(p.Type.DocDeleteSdt),this.delta.globalOpts.updateSelection=!1,this.state.deleteText(e,this.delta),t.property.isShowingPlaceholder&&this.state.deleteText(t.contentRange,this.delta,{preventTextTrackChanges:!0}),this.state.deleteText(new p.GCPRange(t.range.begin(),1),this.delta),this.applyDelta()}},t.prototype.insert=function(t,e){var r=this.delAndAdjustRangeBeforeInsertSdt(t,e),n=r.isBreak,o=r.isShowPlaceholder;return n?null:this.insertSdt(t,e,o)},t.prototype.getInsertRowSdtPosition=function(){var t=this.state.selection.gcpRange,e=this.state.getTableStream().getRowInfo(t.begin());if(null==e?void 0:e.range.equal(t)){var r=this.state.getTableStream().getCellInfo(e.contentRange.end()-1);if(r){var n=e.range.begin(),o=r.contentRange.end()-1,i=this.sdtStream.findDeepestRowSdtByRange(new p.GCPRange(n,o-n));if(i)n=i.contentRange.begin(),o=i.contentRange.end();else{var a=this.state.getTableStream().getTableInfo(n),s=this.state.getTableStream().getCellInfo(a.contentRange.end()-3);if(s&&s.range.equal(r.range)){var l=this.sdtStream.findDeepestTableSdtByTable(a);l&&(o=l.contentRange.end())}}return{beginGCP:n,endGCP:o}}}return null},t.prototype.getInsertTableSdtPosition=function(){var t=this.state.selection.gcpRange,e=this.state.getTableStream().getTableInfo(t.end()-1);if(e){var r=this.dataStream.getTableStream().getTableParagraphPrefixRange(e);if(e.range.equal(t)||t.begin()>=r.begin()&&t.begin()<r.end()&&t.end()===e.range.end()){var n=this.state.getTableStream().getCellInfo(e.contentRange.end()-3);if(n){var o=e.range.begin(),i=n.contentRange.end()-1,a=this.sdtStream.findDeepestTableSdtByTable(e);return a&&(o=a.contentRange.begin(),i=a.contentRange.end()),{beginGCP:o,endGCP:i}}}}return null},t.prototype.isInTableBlockSdtRange=function(){var t=this.state.selection.gcpRange,e=this.state.getTableStream().getTableInfo(t.end()-1);if(!e)return!1;var r=this.dataStream.getTableStream().getTableParagraphPrefixRange(e);return t.begin()>=r.begin()&&t.end()<=e.range.end()},t.prototype.delAndAdjustRangeBeforeInsertSdt=function(t,e){if(this.isInTableBlockSdtRange()){var r=this.getInsertRowSdtPosition();if(r){var n=r.beginGCP,o=r.endGCP;return this.insertGcpBegin=n,this.insertGcpEnd=o,t.type.val=p.STSdtType.row,e.type.val=p.STSdtType.row,{isBreak:!1,isShowPlaceholder:!1}}var i=this.getInsertTableSdtPosition();if(i)return n=i.beginGCP,o=i.endGCP,this.insertGcpBegin=n,this.insertGcpEnd=o,t.type.val=p.STSdtType.block,e.type.val=p.STSdtType.block,{isBreak:!1,isShowPlaceholder:!1}}return this.originRange=this.adjustSelectRange(),this.selection.getRange().delete(this.originRange),this.insertGcpBegin=this.originRange.begin(),this.insertGcpEnd=this.originRange.begin(),this.selection.setRange(this.insertGcpBegin,this.insertGcpEnd),{isBreak:!1,isShowPlaceholder:!0}},t.prototype.adjustSelectRange=function(){var t=this.state.selection.gcpRange;return this.shouldRemainParaAfterSdt(t)||(t.len+=1),this.coreRange.fixToValidDeleteRange(t)},t.prototype.applyDelta=function(){this.state.applyDelta(this.delta)},t.prototype.updateProperty=function(t,e,r){if(void 0===r&&(r=!1),r){var n=t.clone();n.isBegin||(n.isBegin=!0),h.Gh.setSdtProperty({range:new p.GCPRange(e.range.begin(),1),property:n,mode:p.PropUpdateMode.Merge},this.delta)}var o=t.clone();o.isBegin&&(o.isBegin=!1),h.Gh.setSdtProperty({range:new p.GCPRange(e.range.end()-1,1),property:o,mode:p.PropUpdateMode.Merge},this.delta)},t.prototype.updateChildrenNestingLevel=function(t,e,r){var n=this;void 0===r&&(r=!0),this.sdtStream.collectSdtInContainedRange(t,{startLevel:e}).forEach((function(t){var e=t.property.clone();r?e.nestingLevel+=1:e.nestingLevel-=1,n.updateProperty(e,t,!0)}))},t.prototype.insertSdt=function(t,e,r){var n,i;void 0===r&&(r=!0),this.checkToInsertParagraph();var a=this.insertGcpBegin,s=this.insertGcpEnd,l=null===(n=this.sdtStream)||void 0===n?void 0:n.getSdtInfo(this.insertGcpBegin),c=1;if(l)if(a>l.range.begin()&&s<l.range.end())c=l.property.nestingLevel+1;else{var u=null===(i=this.sdtStream)||void 0===i?void 0:i.getSdtInfo(this.insertGcpBegin,l.property.nestingLevel-1);u&&a>u.range.begin()&&s<u.range.end()&&(c=u.property.nestingLevel+1)}t.nestingLevel=c,e.nestingLevel=c,e.sdtPr.id.val="".concat(o.m7.generateRandomId()).concat(Date.now());var g=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));return this.updateChildrenNestingLevel(new p.GCPRange(a,s-a),c,!0),this.delta.setCommandType(p.Type.DocInsertSdt),h.Gh.insertSdtEnd(s,e,g,this.delta),h.Gh.insertSdtStart(a,t,g,this.delta),this.applyDelta(),r?new p.GCPRange(a,2):null},t.prototype.checkToInsertParagraph=function(){var t=this.insertGcpBegin;if(Be.shouldInsertParaBeforeSdt(t,this.state)){var e=this.genCurrentFollowParaProp(t),r=e.paraBreakSpan,n=e.paraProp;this.filterAttributeOfFollowPara(n),h.Gh.insertParagraph(t,r,n,this.delta,this.insertOptions),this.insertGcpBegin+=1,this.insertGcpEnd+=1}},t.prototype.genCurrentFollowParaProp=function(t){return{paraProp:new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(this.state.currentParaProp(t)),paraBreakSpan:new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(this.state.followSpanProp(t))}},t.prototype.shouldRemainParaAfterSdt=function(t){if(t.isEmpty())return!0;var e=this.state.context.service,r=e.getSelection(),n=r.relationToSelectAndPara(!1,!1,!1,!1),o=r.getParaRangeFromSelection(!1);return!n||n&&(r.isSelectionEndAtStoryEnd(!1)||this.hasBottomBorder(o,e))},t.prototype.hasBottomBorder=function(t,e){var r=e.getDocument().getRange(t.begin(),t.end()).getParagraphFormat().getBorder();return r!==c.JjT.Undefined&&!r.bottom.isEmpty()},t.prototype.filterAttributeOfFollowPara=function(t){t.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.pBdr)},t}(),Vn=function(){function t(t,e,r,n){this._state=t,this._updateSelection=r,this._coreRange=new l.wA(this._state.dataEngine,e,this._updateSelection,n),l.s$.registerHookBeforeDeleteText(l.D9.handleHeadingList,Ze)}return t.createStateRange=function(e,r,n,o){return void 0===n&&(n=!1),void 0===o&&(o=!0),new t(e,r,n,o)},t.prototype.getFont=function(){return xr.createStateFont(this._state,this._deltaOption())},t.prototype.setFont=function(t){this.getFont().setFont(t)},t.prototype.filterRangeByTable=function(t){var e;if(null===(e=this.getTableSelectionArea())||void 0===e?void 0:e.isInnerTable()){var r=[];return t.splitValidRange(this._state.getTableStream(),(function(t){r.push(t)})),(0,i.__spreadArray)([],(0,i.__read)(this.getSpans()),!1).filter((function(t){return r.find((function(e){return e.contains(t.getRange())}))}))}return(0,i.__spreadArray)([],(0,i.__read)(this.getSpans()),!1)},t.prototype.modifyFontSizeRelatively=function(t){var e=this,r=function(e){return(0,o.pL)(Math.max((0,o.ev)(e)+t,1))};if(0!==this.range().length()){var n=this._deltaOption().buildDelta().setUpdateSelection(!1);n.setCommandType(p.Type.DocModifyText);var i=!1;this.filterRangeByTable(n).forEach((function(t){var o=t.getFont().getFontSize(),a=r(o);i=i||o!==a;var s=t.getAttributes().clone();s.sz.val=a,h.Gh.setRunProperty(t.getRange().intersectRange(e.range()),s,n,p.PropUpdateMode.Merge)})),i&&this._state.applyDelta(n)}else{var a=r(this.getFont().getFontSize());this.getFont().setFontSize(a)}},t.prototype.getSpans=function(){return Fr.createStateSpans(this._state,this._deltaOption())},t.prototype.getParagraphFormat=function(){return Mr.createStateParagraphFormat(this._state,this._deltaOption())},t.prototype.setParagraphFormat=function(t,e){this.getParagraphFormat().setFormat(t,e)},t.prototype.getParagraphs=function(){return Ar.createStateParagraphs(this._state,this._deltaOption())},t.prototype.setSectionFormat=function(t){this.getSectionFormat().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return Br.createStateSectionFormat(this._state,this._deltaOption())},t.prototype.getSections=function(){return Or.createStateSections(this._state,this._deltaOption())},t.prototype.getInlineShapes=function(){return Ur.createStateInlineShapes(this._state,this._deltaOption())},t.prototype.getInlinePlugins=function(){return Qr.createStateInlinePlugins(this._state,this._deltaOption())},t.prototype.getTextframes=function(){return Kr.create(this._state,this._deltaOption())},t.prototype.getCodeblocks=function(){return Yr.create(this._state,this._deltaOption())},t.prototype.getShapes=function(){return Wr.create(this._state,this._deltaOption())},t.prototype.getTableSelectionArea=function(){return this._coreRange.tableSelectionArea},t.prototype.getTableSelectionService=function(){return In.create(this._state,this._deltaOption())},t.prototype.getSdtService=function(){return new Un(this._state,this._deltaOption())},t.prototype.getFields=function(){return Fn.createStateFields(this._state,this._deltaOption())},t.prototype.range=function(){return this._coreRange.gcpRange},t.prototype.isInTable=function(){return this._coreRange.isInTable()},t.prototype.isInCellsOfTable=function(){return this._coreRange.isInCellsOfTable()},t.prototype.setRange=function(t,e,r){var n=this._coreRange.setRangeTo(new p.GCPRange(t,e-t),r);return n&&this._updateSelection&&this._state.setRangeTo(this._coreRange.gcpRange,r),n},t.prototype.getStart=function(){return this._coreRange.gcpRange.begin()},t.prototype.setStart=function(t){return this.setRange(t,this._coreRange.gcpRange.end())},t.prototype.getEnd=function(){return this._coreRange.gcpRange.end()},t.prototype.setEnd=function(t){return this.setRange(this._coreRange.gcpRange.begin(),t)},t.prototype.select=function(){this._state.setRangeTo(this._coreRange.gcpRange)},t.prototype.wholeStory=function(){var t,e,r=this._coreRange.storyValidRange();this._state.context.isRestrictProtectOn&&!(null===(e=null===(t=this._state)||void 0===t?void 0:t.getRestrictEdit())||void 0===e?void 0:e.checkPermissionRangeByGcpRange(r))||this._state.setRangeTo(this._coreRange.storyValidRange(),{scrollToView:h.hF.None,mobileContextMenu:h.A6.Show})},t.prototype.storyRange=function(){return this._coreRange.storyValidRange()},t.prototype.storyLength=function(){return this._coreRange.storyValidRange().length()},t.prototype.storyType=function(){return this._coreRange.subStoryInfo.storyProp.storyType},t.prototype.storyId=function(){return this._coreRange.subStoryInfo.subStoryProp.id},t.prototype.storyProperty=function(){return this._coreRange.subStoryInfo.subStoryProp},t.prototype.textBoxHostStoryType=function(){return this._coreRange.textboxHostStoryInfo.storyProp.storyType},t.prototype.textBoxHostStoryId=function(){return this._coreRange.textboxHostStoryInfo.subStoryProp.id},t.prototype.textBoxHostStoryProperty=function(){return this._coreRange.textboxHostStoryInfo.subStoryProp},t.prototype.collapse=function(t){void 0===t&&(t=c.k8b.CollapseStart);var e=this._coreRange.gcpRange;switch(t){case c.k8b.CollapseStart:e.len=0;break;case c.k8b.CollapseEnd:e.gcpBegin+=e.length(),e.len=0}this.setRange(e.begin(),e.end())},t.prototype.inRange=function(t){return t.range().contains(this.range())},t.prototype.isEqual=function(e){return e instanceof t&&this===e||e.range().equal(this.range())},t.prototype.getText=function(){return this._state.getTextStream().readText(this.range().begin(),this.range().length())},t.prototype.getPlainText=function(){var t="";if(0===this.range().length())return t;var e=this._state.getTextStream().createRunIterator(this.range());do{var r=e.getRange(!0);t+=(0,p.getPrintableText)(this._state.getTextStream().readText(r.begin(),r.length()))}while(e.next());return t},t.prototype.getTextAndImage=function(){var t=[];if(0===this.range().length())return t;var e=this._state.getTextStream().createRunIterator(this.range());do{var r=e.getRange(!0),n=e.getProperty();if(n)if(n.isPlaceholder){if(n.isPlaceholder){var o=p.PropertyUtil.findPlaceholderCharProperty(this._state.getDataStream(),r.begin());o instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)&&t.push({type:"image",value:Be.getImageInfo(o)})}}else{var i=this._state.getTextStream().readText(r.begin(),r.length());t.push({type:"text",value:i})}}while(e.next());return t},t.prototype.setText=function(t,e){var r=this._deltaOption().buildDelta();r.setCommandType(p.Type.DocInsertText);var n=this._validTypeRange(),o=this._state.getTextStream().createParagraphIterator(n).getRange();(n.equal(o)||n.end()===o.end()&&1===n.length())&&(n.len-=1),this.deleteWithDelta(n,r);var i=null!=e?e:this._state.followSpanProp(n.begin());h.Gh.insertText(n.begin(),t,i,r),this._state.applyDelta(r)},t.prototype.insertAfter=function(t){var e=this._coreRange.gcpRange.end();e=this._coreRange.fixToValidRange(new p.GCPRange(e,0)).end();var r=this._deltaOption().buildDelta();r.setCommandType(p.Type.DocInsertText);var n=this._state.followSpanProp(e);h.Gh.insertText(e,t,n,r),this._state.applyDelta(r)},t.prototype.insertBefore=function(t){var e=this._deltaOption().buildDelta();e.setCommandType(p.Type.DocInsertText);var r=e.currentRange().begin(),n=this._state.followSpanProp(r);h.Gh.insertText(r,t,n,e),this._state.applyDelta(e)},t.prototype.insertParagraph=function(t){var e=this._validTypeRange(t),r=e.begin(),n=e.end();this.doInsertParagraph(r,n,e)},t.prototype.insertParagraphAndTextAfterRange=function(t,e,r){var n=this._deltaOption().buildDelta();n.setCommandType(p.Type.DocInsertParagraph);var o=this._state.getTextStream().createParagraphIterator(),i=this._state.getTextStream().createRunIterator();o.seek(t.begin());var a=o.getRange().end()-1;i.seek(a);var s=i.getCloneProperty();s?s.setDefault(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).tKeys.isPlaceholder):s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));for(var l=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),c=0;c<e;c++)this.insertParagraphWithTargetProperty(a,a,n,l,s);if(!(this._state.context instanceof tn.z&&this._state.context.isRestrictProtectOn)||this._state.getRestrictEdit().checkPermissionRangeByGcpRange(t)){if(!r){var u=new p.GCPRange(t.end()-1+e,0);return n.moveTo(u),void this._state.applyDelta(n)}var g=new p.GCPRange(t.end()-1,e);h.Gh.insertText(g.end(),r,s,n),this._state.applyDelta(n)}},t.prototype.insertParagraphWithTargetProperty=function(t,e,r,n,o){var i=this._state.currentParaProp(t),a=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(i);if(h.Gh.insertParagraph(t,o,a,r),this._coreRange.isParaEnd(e)){var s={range:new p.GCPRange(t+1,1),property:n,mode:p.PropUpdateMode.Cover};h.Gh.setParagraphProperty(s,r),r.moveTo(new p.GCPRange(t+1,0)),r.globalOpts.updateSelection&&(this._state.cusorSpanProp=o)}},t.prototype.insertParagraphAfter=function(t,e){var r,n=null!==(r=null==t?void 0:t.end())&&void 0!==r?r:this._coreRange.gcpRange.end();if(e){var o=this._deltaOption().buildDelta();return o.setCommandType(p.Type.DocInsertParagraph),h.Gh.insertParagraph(n,new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),e,o),void this._state.applyDelta(o)}this.doInsertParagraph(n,n,p.GCPRange.emptyRange())},t.prototype.insertParagraphBefore=function(t){var e,r=null!==(e=null==t?void 0:t.begin())&&void 0!==e?e:this._coreRange.gcpRange.begin();this.doInsertParagraph(r,r,p.GCPRange.emptyRange())},t.prototype.doInsertParagraph=function(t,e,r,n,o,i){var a=n||this._deltaOption().buildDelta();a.setCommandType(p.Type.DocInsertParagraph),r&&this.deleteWithDelta(r,a);var s,l=this._state.currentParaProp(t);if(this.insertWithRevision(t,l,a),l.has(l.tKeys.numPr)&&l.numPr.numId.val){var c=this._state.getTextStream().createParagraphIterator();c.seek(t);var u=c.getRange(),g=this._state.getTextStream().createRunIterator();g.seek(u.end()-1),s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(g.getCloneProperty()||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)))}else s=i?new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(this._state.followSpanProp(e)):new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(this._state.followSpanProp(t));var d=this._state.followParaProp(e),y=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(l);y.delete(y.tKeys.pPrChange);var f=this._state.dataEngine.getDataManager().getStyleSheetManager();!function(t,e){var r=p.PropertyFactory.getPropertyClass(p.PropertyType.CTPBdr);t.forEach((function(t){t.pBdr.setDefault(r.tKeys.bottom),t.pBdr.setDefault(r.tKeys.top);var n=e.mergeStyleParagraphProperty(t);n.pBdr.has(r.tKeys.bottom)&&(t.pBdr.bottom.val=p.STBorder.none),n.pBdr.has(r.tKeys.top)&&(t.pBdr.top.val=p.STBorder.none)}))}([y],f),o&&y.merge(o),h.Gh.insertParagraph(t,s,y,a);var v=!1;if(this._coreRange.isParaEnd(e)){var m=d.paraProp;this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParaPropWithGcp(l,t).outlineLvl.val<p.STOutlineLvl.LevelNone&&m.cleanNumPr();var P={range:new p.GCPRange(t+1,1),property:m,mode:p.PropUpdateMode.Merge,options:{preventFormatTrackChanges:!0}};h.Gh.setParagraphProperty(P,a);var T=l.pStyle.val,S=f.getStylePropertyFromId(T);S&&!S.pPr.isEmpty(S.pPr.tKeys.outlineLvl)&&S.pPr.outlineLvl.val!==p.STOutlineLvl.LevelNone&&(d.paraBreakSpan.merge(Be.createClearRunProperty()),h.Gh.setRunProperty(new p.GCPRange(t+1,1),Be.createClearRunProperty(),a,p.PropUpdateMode.Merge,{preventFormatTrackChanges:!0})),a.moveTo(new p.GCPRange(t+1,0)),v=!0}else if(l.taskPr.taskState===p.STTaskState.done){var C=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(l);C.taskPr.taskState=p.STTaskState.todo,P={range:new p.GCPRange(t+1,1),property:C,mode:p.PropUpdateMode.Merge,options:{preventFormatTrackChanges:!0}},h.Gh.setParagraphProperty(P,a)}n||this._state.applyDelta(a),v&&a.globalOpts.updateSelection&&(this._state.cusorSpanProp=d.paraBreakSpan)},t.prototype.breakTypeToSectType=function(t){var e=p.STSectionMark.nextPage;switch(t){case c.EQ9.SectionBreakNextPage:e=p.STSectionMark.nextPage;break;case c.EQ9.SectionBreakContinuous:e=p.STSectionMark.continuous;break;case c.EQ9.SectionBreakEvenPage:e=p.STSectionMark.evenPage;break;case c.EQ9.SectionBreakOddPage:e=p.STSectionMark.oddPage}return e},t.prototype.insertBreak=function(t){var e;switch(t){case c.EQ9.PageBreak:(o=this._deltaOption().buildDelta()).setCommandType(p.Type.DocInsertPage);var r=this._validDeleteRange();this.deleteWithDelta(r,o);var n=this._state.followParaProp(r.begin());h.Gh.insertParagraph(r.begin(),n.paraBreakSpan,n.paraProp,o),h.Gh.insertText(o.currentRange().end(),p.PlaceholderChar.PageBreak,new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(n.paraBreakSpan),o),h.Gh.insertParagraph(o.currentRange().end(),n.paraBreakSpan,n.paraProp,o),this._state.applyDelta(o);break;case c.EQ9.SectionBreakNextPage:case c.EQ9.SectionBreakContinuous:case c.EQ9.SectionBreakEvenPage:case c.EQ9.SectionBreakOddPage:var o,i=this.getSections().item(0);if(!i)break;(o=this._deltaOption().buildDelta()).setCommandType(p.Type.DocInsertSection),r=this._validDeleteRange();var a=p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),s=(n=this._state.followParaProp(r.begin()),null!==(e=i.getAttributes())&&void 0!==e?e:new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty))),l=this.breakTypeToSectType(t);l!==(s.type.val===p.STSectionMark.PBDEFAULT?p.STSectionMark.nextPage:s.type)&&i.setSectType(l,o);var u=new(p.PropertyFactory.getPropertyClass(p.PropertyType.SectionProperty));u.setNull(u.tKeys.headerReference),u.setNull(u.tKeys.footerReference),h.Gh.setSectionProperty(r,u,o,p.PropUpdateMode.Merge),this.getParaRange(r.begin()).gcpBegin!==r.begin()&&h.Gh.insertParagraph(r.begin(),n.paraBreakSpan,n.paraProp,o),h.Gh.insertSection(o.currentRange().end(),a,n.paraProp,s,o),this._state.applyDelta(o)}},t.prototype.insertImage=function(t,e,r,n){this.getInlineShapes().addImage(t,e,r,n)},t.prototype.replaceImage=function(t,e){this.getInlineShapes().replaceImage(t,e)},t.prototype.movePlugin=function(t,e){this.getInlinePlugins().movePlugin(t,e)},t.prototype.insertSplitline=function(t,e,r,n){var o=n||this._deltaOption().buildDelta();o.setCommandType(p.Type.DocInsertParagraph);var i=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTBorderWml));i.val=t,i.color=e,i.color=Be.adjustColor(i.color),i.sz=8*r;var a=this._coreRange.gcpRange.begin(),s=this._state.getTextStream().createParagraphIterator();s.seek(a);var l=s.getCloneProperty();if(l){s.prev();var c,u=s.getCloneProperty();this._coreRange.isParaEnd(a)?this._coreRange.isStoryEnd(a)?((c=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))).pBdr.bottom=i,u&&u.pBdr.bottom.equalTo(i)&&(c.pBdr.top.color=i.color,this.setBottomSplitline(o,a)),this.doInsertParagraph(a,a,p.GCPRange.emptyRange(),o,c)):p.PropertyUtil.isValidBorder(l.pBdr.bottom)&&l.pBdr.bottom.equalTo(i)||this.setBottomSplitline(o,a,i):((c=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))).pBdr.bottom=i,u&&u.pBdr.bottom.equalTo(i)&&(c.pBdr.top.color=i.color,this.setBottomSplitline(o,a)),c.pBdr.bottom=i,this.doInsertParagraph(a,a,p.GCPRange.emptyRange(),o,c)),o.moveTo(new p.GCPRange(a+1)),n||this._state.applyDelta(o)}},t.prototype.setBottomSplitline=function(t,e,r){var n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));r?n.pBdr.bottom=r:n.pBdr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTPBdr).tKeys.bottom);var o={range:new p.GCPRange(e,0),property:n,mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(o,t)},t.prototype.getTextFromRange=function(t){return this._state.getTextStream().readText(t.gcpBegin,t.len)},t.prototype.clearFormatting=function(t){var e=null!=t?t:this._coreRange.gcpRange,r=this._state.getTextStream().createParagraphIterator(e).getRange(),n=!1;r.contains(e)?e.length()<=0?this._state.cusorSpanProp=null:(e.begin()===r.begin()&&(e.length(),r.length()),n=!0):n=!0;var o=this._deltaOption().buildDelta();o.setCommandType(p.Type.DocClearTextStyle),n&&o.splitValidRange(this._state.getTableStream(),(function(t){h.Gh.setRunProperty(t,Be.createClearRunProperty(),o,p.PropUpdateMode.Merge)})),o.splitValidRange(this._state.getTableStream(),(function(t){var e={range:t,property:p.PropertyUtil.createClearParagraphProperty(),mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(e,o)})),this._state.applyDelta(o),this._state.cusorSpanProp=null},t.prototype.formatBrush=function(t,e,r){var n=this,o=this._deltaOption().buildDelta();if(o.setCommandType(p.Type.DocModifyText),t&&o.splitValidRange(this._state.getTableStream(),(function(e){var i=function(t,e,r){var n={range:t,property:new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(e),mode:p.PropUpdateMode.Cover};if(r)return n;var o=e.clone();return o.cleanNumPr(),n.property=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))(o),n}(e,t,r);h.Gh.setParagraphProperty(i,o),tr(e,n._state,o,t,r)})),e){var i=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))(e);o.splitValidRange(this._state.getTableStream(),(function(t){h.Gh.setRunProperty(t,i,o,p.PropUpdateMode.Cover)})),this.getFieldRanges().forEach((function(t){var e=t.fieldResultRange,r=t.fieldCodeRange,a=n._state.getTextStream().readText(r.begin(),r.len),s=n.generateFieldResultProp(o,a,i);h.Gh.setRunProperty(e,s,o,p.PropUpdateMode.Merge)}))}this._state.applyDelta(o)},t.prototype.insertWithRevision=function(t,e,r){if(!this._state.dataEngine.getDataManager().isTrackRevisions){var n=this.getParaRange(t);e.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.pPrChange),r.setParagraphProperty(n,e,p.PropUpdateMode.Cover)}},t.prototype.applyDeleteDelta=function(t,e,r){var n=e||this._deltaOption().buildDelta();n.setCommandType(p.Type.DocDeleteText),this._state.deleteText(t,n,r),e||this._state.applyDelta(n)},t.prototype.deleteWithDelta=function(t,e,r){var n=this._validDeleteRange(t);n.isEmpty()||this._state&&!this._state.getRestrictEdit().checkPermissionRangeByGcpRange(n)||this.applyDeleteDelta(n,e,r)},t.prototype.delete=function(t,e){this.deleteWithDelta(t,void 0,e)},t.prototype.deleteWithMultiRanges=function(t,e){var r,n=this;if(0!==t.length){var o=this._deltaOption().buildDelta();o.setCommandType(p.Type.DocDeleteText);var i=null!=e?e:{},a=i.fixRange,s=void 0===a||a,l=i.willInsertGcp,c=void 0===l?-1:l;c&&(null===(r=this._state.getStoryStream().getMainStoryInfo())||void 0===r?void 0:r.range.end())===c+1&&h.Gh.insertParagraph(c,new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),o),t.sort((function(t,e){return e.begin()-t.begin()})),t.filter((function(t){return!t.isEmpty()})).forEach((function(t){var e=s?n._validDeleteRange(t):t;n._state.deleteText(e,o)})),this._state.applyDelta(o)}},t.prototype.setLink=function(t,e){this.insertField(t,e)},t.prototype.getStyleName=function(t){var e=c.JjT.Undefined;switch(t){case p.STStyleType.character:e=this.getFont().getStyleName();break;case p.STStyleType.paragraph:e=this.getParagraphFormat().getStyleName();break;default:(e=this.getFont().getStyleName())===c.JjT.Undefined&&(e=this.getParagraphFormat().getStyleName())}return e},t.prototype.getStyleShowName=function(t){var e=c.JjT.Undefined;switch(t){case p.STStyleType.character:e=this.getFont().getStyleShowName();break;case p.STStyleType.paragraph:e=this.getParagraphFormat().getStyleShowName();break;default:(e=this.getFont().getStyleShowName())===c.JjT.Undefined&&(e=this.getParagraphFormat().getStyleShowName())}return e},t.prototype.setHeadingStyleWithMutiRange=function(t,e){var r=this;if(!this._state)throw new Error("State is undefined");var n=this._deltaOption().buildDelta(),o=Be.generateStyleProperty(n,this._state.dataEngine.getDataManager().getStyleSheetManager(),t);o&&(this.getParagraphFormat().setHeadingWithMultiRanges(o,e,n),e.forEach((function(t){var e=r.getParaRange(t.begin()).begin(),o=r.getParaRange(t.end()-1).end(),i=new p.GCPRange(e,o-e);n.moveTo(i),n.splitValidRange(r._state.getTableStream(),(function(t){h.Gh.setRunProperty(t,Be.createClearRunProperty(),n,p.PropUpdateMode.Merge)})),n.moveTo(i)})),this._state.applyDelta(n))},t.prototype.getParaRange=function(t){return this._state.getTextStream().createParagraphIterator(new p.GCPRange(t,0)).getRange()},t.prototype.setStyle=function(t,e,r){if(!this._state)throw new Error("State is undefined");var n=e||this._deltaOption().buildDelta();n.globalOpts.updateSelection=!1;var o=Be.generateStyleProperty(n,this._state.dataEngine.getDataManager().getStyleSheetManager(),t);Array.isArray(r)&&o?(null==o?void 0:o.type)===p.STStyleType.paragraph?(this.getParagraphFormat().setStyle(o,n,r),Je(this._state,o,n,r)):o&&(null==o?void 0:o.type)===p.STStyleType.character&&this.getFont().setStyle(o,n,r):(null==o?void 0:o.type)===p.STStyleType.paragraph?(this.getParagraphFormat().setStyle(o,n),Je(this._state,o,n)):o&&(null==o?void 0:o.type)===p.STStyleType.character&&this.getFont().setStyle(o,n),e||this._state.applyDelta(n)},t.prototype.getLastParaStartPos=function(){var t=this._state.getStoryStream().getMainStoryInfo();if(null===t)return 1;var e=t.contentRange.end()-2;return this.getParaRange(e).gcpBegin},t.prototype.countWord=function(){var t=0,e=0,r=0,n=0,o=this._state.getTextStream(),i=o.createParagraphIterator(this._coreRange.gcpRange),a=this.getLastParaStartPos();do{var s=i.getRange(!0),l=s.gcpBegin,c=s.len,u=o.readText(l,c),g=l===a,d=l===i.getRange().begin();if(u.replace(/(\r|\n)/g,"").length||!g&&d){var y=u,f=0;if(d){var v=this._state.dataEngine.getDataManager().getNumberingManager().getListInfoFromGcpRange(new p.GCPRange(l));(null==v?void 0:v.actualText)&&(y="".concat(v.actualText," ").concat(y))}y=(0,h.S3)(y),y=(0,h._j)(y);var m=(0,h.Td)({dataEngine:this._state.dataEngine,textStream:this._state.getTextStream(),text:y,startGcp:l});y=m.text,f+=m.addSpaceLength,y=(0,h.ol)(y);var P=(0,h.Gb)(y);t+=P.wordCount,n+=P.wordCountNoPunctuation,e+=P.charactersNumber,r+=P.charactersNumberNoSpaces,e-=f}}while(i.next());return{wordCount:t,wordCountNoPunctuation:n,charactersNumber:e,charactersNumberNoSpaces:r}},t.prototype.getFieldProperty=function(t,e){return this._state.getFieldStream().getFieldCharProperty(t,e)},t.prototype.getDecodedFieldInfo=function(t,e){return this._state?this._state.getFieldStream().getDecodedFieldInfo(t,e):null},t.prototype.getDecodedFieldInfos=function(t){if(!this._state)return[];var e=this._coreRange.gcpRange;return this._state.getFieldStream().getDecodedFieldInfos(e,t)},t.prototype.getFieldRanges=function(t){void 0===t&&(t=1);var e=this._coreRange.gcpRange,r=this._state.dataEngine.getDataStream().getFieldStream();if(0===e.len){var n=r.getFieldRange(e.begin(),t);return n?[n]:[]}return r.getFieldRanges(e)},t.prototype.getVisibleFieldRanges=function(){var t=this.getFieldRanges();if(t.length>0){var e=this._state.dataEngine.getDataManager().getRevisionsManager();t=t.filter((function(t){return!e.isAllContentRevisionHidden(t.fieldRange)}))}return t},t.prototype.insertFields=function(t){var e=this,r=this._deltaOption().buildDelta();r.globalOpts.updateSelection=!0,r.setCommandType(p.Type.DocInsertField);var n=this.validDeleteFieldRange();this.deleteWithDelta(n,r);var o=this._state.followSpanProp(n.begin()),i=this._state.followParaProp(n.begin()),a=i.paraBreakSpan,s=i.paraProp;r.moveTo(new p.GCPRange(n.begin(),0)),t.forEach((function(t){var n,i=null!==(n=t.options)&&void 0!==n?n:{},l=i.wrapBefore,p=i.wrapAfter;l&&h.Gh.insertParagraph(r.currentRange().end(),a,s,r);var c=t.fieldCode,u=t.fieldResult,g=e.generateFieldResultProp(r,c,o,!0);h.Gh.insertField(c,u,o,r,g),p&&h.Gh.insertParagraph(r.currentRange().end(),a,s,r)})),this._state.applyDelta(r)},t.prototype.insertField=function(t,e,r){var n;void 0===r&&(r={});var i,a=r.nestingLevel,s=void 0===a?1:a,l=r.followProperty,c=void 0===l||l,u=r.isUnMergeUndoRedoStack,g=void 0!==u&&u,h=r.wrapAfter,d=r.wrapBefore;i=r.outerDelta&&r.outerDelta||this._deltaOption().buildDelta();var y=null!==(n=r.undoEventId)&&void 0!==n?n:o.m7.generateRandomId();i.globalOpts.undoOption.undoEventId=y,i.globalOpts.undoOption.isUnMerge=g,i.globalOpts.updateSelection=!0;var f=this.validDeleteRangeWithoutComment(),v=this.validDeleteFieldRange(),m=this._state.getTextStream().readText(v.begin(),v.length()),P=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));c&&(P=this._state.followSpanProp(v.begin())),this.deleteWithDelta(v,i),i.moveTo(new p.GCPRange(v.begin(),0)),i.setCommandType(p.Type.DocInsertField);var T=r.keepRangeText||e===m,S=Ln(t);o.Yd.info("Field","insert field,",v,"|".concat(S,"|"),"|".concat(e,"|"),"|".concat(m,"|"),T),this.internalInsertField(i,v,{fieldCode:S,fieldResult:e,runProperty:P,nestingLevel:s,needCover:!0,originRange:f},{wrapAfter:h,wrapBefore:d,keepRangeText:T}),r.notApplyDelta||this._state.applyDelta(i)},t.prototype.insertFieldStart=function(t,e,r){var n=this;this._state.insertTextStart(r,this._deltaOption(),(function(r){n.insertField(t,e,{outerDelta:r,notApplyDelta:!0})}))},t.prototype.insertFieldFinish=function(t,e,r){var n=this;this._state.insertTextFinish(r,this._deltaOption(),(function(r){r.setCommandType(p.Type.DocInsertField),n.insertField(t,e,{notApplyDelta:!0,outerDelta:r})}))},t.prototype.insertFieldCancel=function(t){this._state.insertTextCancel(t)},t.prototype.updateField=function(t,e,r){var n;void 0===r&&(r={});var i=r.needInverse,a=void 0===i||i,s=r.isUnMergeUndoRedoStack,l=void 0!==s&&s,c=r.preventTextTrackChanges,u=void 0!==c&&c,g=null!==(n=r.undoEventId)&&void 0!==n?n:o.m7.generateRandomId(),d=this._deltaOption();d.updateSelection=!0,d.undoOption.needInverse=a,d.undoOption.undoEventId=g,d.undoOption.isUnMerge=l;var y=d.buildDelta();y.setMutOption({preventTextTrackChanges:u});var f=this.validDeleteFieldRange();h.Gh.deleteText(f,y),y.moveTo(new p.GCPRange(f.begin(),0)),y.setCommandType(p.Type.DocUpdateField);var v=this._state.dataEngine.getDataStream().getFieldStream(),m=null==v?void 0:v.getDecodedFieldInfo(f.begin()),P=null!=m?m:{},T=P.fieldRange,S=P.fieldCode,C=P.fieldResult,b=P.nestingLevel,R=null==S?void 0:S.range,_=null==C?void 0:C.range;if(null==m?void 0:m.hasNestField)o.Yd.warn("不支持更新包含嵌套域的域",T);else{var w,x=r.wrapBefore,I=r.wrapAfter,D=r.keepRangeText||e===(null==C?void 0:C.result),F=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));R&&(F=this._state.currentSpanProp(R.begin())),_&&(w=this._state.currentSpanProp(_.begin()));var E=Ln(t);o.Yd.info("Field","update field,",f,"|".concat(E,"|"),"|".concat(e,"|"),m,D),this.internalInsertField(y,f,{fieldCode:E,fieldResult:e,fieldResultRange:_,fieldResultProperty:w,runProperty:F,nestingLevel:b,originRange:T},{wrapAfter:I,wrapBefore:x,keepRangeText:D}),this._state.applyDelta(y)}},t.prototype.moveField=function(t,e){var r;if(t!==e){var n=this._state.dataEngine.getDataStream().getFieldStream(),a=null==n?void 0:n.getDecodedFieldInfo(t);if(a){var s=this._deltaOption().buildDelta(),l=a.fieldRange,c=a.fieldResult,u=null==c?void 0:c.range,g=this.validDeleteFieldRange(l),d=new p.GCPRange(e,0);h.Gh.deleteText(g,s);var y=this._state.dataEngine.getDataManager().isTrackRevisions;t<e&&(!y||y&&this._state.getRevisionsManager().rangeIncludeInsRevision(g))&&(e-=g.length(),d=new p.GCPRange(e,g.length())),s.moveTo(new p.GCPRange(e,0));var f=this._state.followSpanProp(t),v=this._state.followSpanProp(u.begin()),m=(0,i.__assign)({},a);y&&(null===(r=m.fieldCode.switches)||void 0===r?void 0:r[p.FieldCommonSwitchesName.key])&&(m.fieldCode.switches[p.FieldCommonSwitchesName.key]=o.m7.generateRandomId());var P=p.FieldUtil.encodeField(m);this.internalInsertField(s,d,{fieldCode:P.fieldCode,fieldResult:P.fieldResult,fieldResultRange:u,fieldResultProperty:v,runProperty:f,nestingLevel:null==a?void 0:a.nestingLevel,originRange:l},{keepRangeText:!0,isMoveFiled:!0}),this._state.applyDelta(s)}}},t.prototype.internalInsertField=function(t,e,r,n){var a,s,l=this,c=n.wrapBefore,u=n.wrapAfter,d=n.keepRangeText,y=this._state.followParaProp(e.begin()),f=y.paraBreakSpan,v=y.paraProp;c&&h.Gh.insertParagraph(t.currentRange().end(),f,v,t);var m=r.fieldCode,P=r.fieldResult,T=r.fieldResultRange,S=r.fieldResultProperty,C=r.nestingLevel,b=r.runProperty,R=r.needCover,_=r.originRange,w=[],x=this._state.dataEngine.getDataManager().getStyleSheetManager(),I=this.findCommentsAfterRange(null!=_?_:e);if(d){var D=null!=T?T:e;h.Gh.insertFieldByRange(m,b,t,(function(t){w.push.apply(w,(0,i.__spreadArray)([],(0,i.__read)(h.Me.collectDataToDelta({dataEngine:l._state.dataEngine,delta:t,range:D,collectStory:!0,collectComment:!0})),!1)),S&&!function(t,e){var r;return(null===(r=p.FieldUtil.decodeFieldCode(t))||void 0===r?void 0:r.name)===p.FieldName.HYPERLINK&&!(null==e?void 0:e.rStyle.val)}(m,S)||function(t,e,r,n){void 0===n&&(n=!1);for(var o=length;o<e.operations.length;o++){var i=e.operations[o];if(i instanceof h.jb){var a=En(t,e,r,i.param.property,n);i.param.property=a}}}(x,t,m,!0)}),C),function(t,e){var r=new Map;t.operations.forEach((function(t){if(t instanceof h.I&&t.param.rangeType===p.RangeType.commentRange){var e=t.param,n=e.id,i=o.m7.generateRandomId();r.set(n,i),e.id=i,(a=t.param.property).id=i}else if(t instanceof h.Zw){var a;n=(a=t.param.property).id,(i=r.get(n))&&(a.id=i)}})),e.forEach((function(t){var e="c_".concat(o.m7.generateRandomId());t.storyId=e,t.delta.operations.forEach((function(t){if(t instanceof h.di&&t.param.property instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.CommentStoryProperty)){var n=t.param.property,o=n.refId,i=r.get(o);i&&(n.id=e,n.refId=i)}}))}))}(t,w)}else{var F=null!=S?S:En(x,t,m,b,R);h.Gh.insertField(m,P,b,t,F)}if(I.length>0&&Mn(this._state,t,I,e,n.isMoveFiled),u&&h.Gh.insertParagraph(t.currentRange().end(),f,v,t),w.length>0){var E=t.globalOpts.buildDelta();!function(t,e,r,n){var o=t.context,i=t.dataEngine,a=[];n.forEach((function(t){if(t.storyType===p.STStoryType.commentContent){var e=[];o.run(g.aU.TRANS_DELTA_TO_OPERATION_DATA,t.delta,e,i),a.push({storyId:t.storyId,storyOps:e,storyType:t.storyType})}}));var s=t.getDataStream().getStoryStream();o.run(g.aU.TRANS_OPERATION_DATA_TO_DELTA,r,s,o,[],a,e,0)}(this._state,e,E,w),this._state.getStoryStream().getStoryLastPos(p.STStoryType.commentContent)>e.end()?(a=t.operations).unshift.apply(a,(0,i.__spreadArray)([],(0,i.__read)(E.operations),!1)):(s=t.operations).push.apply(s,(0,i.__spreadArray)([],(0,i.__read)(E.operations),!1))}},t.prototype.setGCPRange=function(t){return this._coreRange.setRangeTo(t)},t.prototype.generateFieldResultProp=function(t,e,r,n){return void 0===n&&(n=!1),En(this._state.dataEngine.getDataManager().getStyleSheetManager(),t,e,r,n)},t.prototype._deltaOption=function(){return h.C1.createLocalDeltaOption(this._coreRange.gcpRange,this._updateSelection,void 0)},t.prototype._validDeleteRange=function(t){return this._coreRange.fixToValidDeleteRange(t||this._coreRange.gcpRange)},t.prototype.validDeleteRangeWithoutComment=function(t){var e=t||this._coreRange.gcpRange;return this._coreRange.fixToValidDeleteRange(e)},t.prototype.validDeleteFieldRange=function(t){var e=this.validDeleteRangeWithoutComment(t),r=this.findCommentsAfterRange(e);return r.length>0&&(e=new p.GCPRange(e.begin(),e.length()+r.length)),e},t.prototype.findCommentsAfterRange=function(t){return this._state.context.service.getComment().collectCommentInfosFromGcpRanges(t).filter((function(e){return e.annotationRange&&e.annotationRange.contains(t)&&t.end()===e.annotationRange.end()}))},t.prototype._validTypeRange=function(t){return this._coreRange.fixToValidReplaceRange(null!=t?t:this._coreRange.gcpRange)},t.prototype.insertLineBreak=function(){var t=this._deltaOption().buildDelta();t.globalOpts.commandType=p.Type.DocInsertText;var e=t.currentRange().begin();h.Gh.insertText(e,p.PlaceholderChar.LineBreak,p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty).createPlaceholderRun(),t),this._state.applyDelta(t)},t}(),zn=function(){function t(t){this._state=t,this._range=null}return t.createStateSelection=function(e){return new t(e)},t.prototype.getRange=function(){return this._getRange()},t.prototype.getFont=function(){return this._getRange().getFont()},t.prototype.setFont=function(t){this._getRange().setFont(t)},t.prototype.getTextStyle=function(){var t=this,e=this._gcpRange(),r=null;if(0===e.length())if(this._state.isRangeBeginAtParaStart(e)&&this._state.listMarkerSpanProp){var n=this._state.currentParaProp(e.begin());r=this._state.listMarkerSpanProp,n&&r&&(r=this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(r,n,e.begin()))}else n=this._state.currentParaProp(e.begin()),r=this._state.followSpanProp(e.begin()),n&&r&&(r=this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(r,n,e.begin()));return r||h.Yy.splitCellRange(this._state.dataEngine.getDataStream().getTableStream(),e,(function(e){var n=t._state.getTextStream().createRunIterator(e);if(!(r=n.getCloneProperty()))return r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),!1;for(;n.next();){var o=n.getCloneProperty();o&&r.common(o)}return!0})),r||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty))},t.prototype.getParagraphStyle=function(){var t=this,e=null;return h.Yy.splitCellRange(this._state.dataEngine.getDataStream().getTableStream(),this._gcpRange(),(function(r){var n=t._state.getTextStream().createParagraphIterator(r),o=n.getCloneProperty();if(!o)return!1;for(e?e.common(o):e=o;n.next();){var i=n.getCloneProperty();i&&(null==e||e.common(i))}return!0})),e||new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty))},t.prototype.getSpans=function(){return this._getRange().getSpans()},t.prototype.getParagraphFormat=function(){return this._getRange().getParagraphFormat()},t.prototype.setParagraphFormat=function(t,e){this._getRange().setParagraphFormat(t,e)},t.prototype.getParagraphs=function(){return this._getRange().getParagraphs()},t.prototype.setHeadingStyleWithMutiRange=function(t,e){this._getRange().setHeadingStyleWithMutiRange(t,e)},t.prototype.setSectionFormat=function(t){this._getRange().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return this._getRange().getSectionFormat()},t.prototype.getSections=function(){return this._getRange().getSections()},t.prototype.getInlineShapes=function(){return this._getRange().getInlineShapes()},t.prototype.getInlinePlugins=function(){return this._getRange().getInlinePlugins()},t.prototype.getTextframes=function(){return this._getRange().getTextframes()},t.prototype.getCodeblocks=function(){return this._getRange().getCodeblocks()},t.prototype.getTableSelectionArea=function(){return this._getRange().getTableSelectionArea()},t.prototype.getTableSelectionService=function(){return this._getRange().getTableSelectionService()},t.prototype.getSdtService=function(){return this._getRange().getSdtService()},t.prototype.range=function(){return this._getRange().range()},t.prototype.setRange=function(t,e,r){return this._getRange().setRange(t,e,r)},t.prototype.getStart=function(){return this._getRange().getStart()},t.prototype.setStart=function(t){return this._getRange().setStart(t)},t.prototype.getEnd=function(){return this._getRange().getEnd()},t.prototype.setEnd=function(t){return this._getRange().setEnd(t)},t.prototype.wholeStory=function(){this._getRange().wholeStory()},t.prototype.storyRange=function(){return this._getRange().storyRange()},t.prototype.storyLength=function(){return this._getRange().storyLength()},t.prototype.storyType=function(){return this._getRange().storyType()},t.prototype.storyId=function(){return this._getRange().storyId()},t.prototype.storyProperty=function(){return this._getRange().storyProperty()},t.prototype.textBoxHostStoryType=function(){return this._getRange().textBoxHostStoryType()},t.prototype.textBoxHostStoryId=function(){return this._getRange().textBoxHostStoryId()},t.prototype.textBoxHostStoryProperty=function(){return this._getRange().textBoxHostStoryProperty()},t.prototype.collapse=function(t){void 0===t&&(t=c.k8b.CollapseStart),this._getRange().collapse(t)},t.prototype.inRange=function(t){return this._getRange().inRange(t)},t.prototype.isEqual=function(t){return this._getRange().isEqual(t)},t.prototype.getText=function(){return this._getRange().getText()},t.prototype.getPlainText=function(){return this._getRange().getPlainText()},t.prototype.getTextAndImage=function(){return this._getRange().getTextAndImage()},t.prototype.getTextFromRange=function(t){return this._getRange().getTextFromRange(t)},t.prototype.setText=function(t){this._getRange().setText(t)},t.prototype.insertAfter=function(t){this._getRange().insertAfter(t)},t.prototype.insertBefore=function(t){this._getRange().insertBefore(t)},t.prototype.insertParagraph=function(t){this._getRange().insertParagraph(t)},t.prototype.insertParagraphAndTextAfterRange=function(t,e,r){this._getRange().insertParagraphAndTextAfterRange(t,e,r)},t.prototype.insertParagraphAfter=function(t,e){this._getRange().insertParagraphAfter(t,e)},t.prototype.insertParagraphBefore=function(t){this._getRange().insertParagraphBefore(t)},t.prototype.insertBreak=function(t){this._getRange().insertBreak(t)},t.prototype.insertImage=function(t,e,r,n){this._getRange().insertImage(t,e,r,n)},t.prototype.replaceImage=function(t,e){this._getRange().replaceImage(t,e)},t.prototype.movePlugin=function(t,e){this._getRange().movePlugin(t,e)},t.prototype.insertSplitline=function(t,e,r){this._getRange().insertSplitline(t,e,r)},t.prototype.clearFormatting=function(t){this._getRange().clearFormatting(t)},t.prototype.formatBrush=function(t,e,r){if(0===this.range().len){var n=(0,i.__spreadArray)([],(0,i.__read)(this._getRange().getParagraphs()),!1)[0].getRange();this.setRange(n.begin(),n.end())}this._getRange().formatBrush(t,e,r)},t.prototype.delete=function(t,e){void 0===t&&(t=null);var r=t||this._gcpRange();r.isEmpty()&&(r=this.getDeleteNextBreakRange(r.begin())),this._getRange().delete(r,e)},t.prototype.getDeleteNextBreakRange=function(t){var e=l._l.nextTextBreak(this._state.getTextStream(),t);return e=this.fixToDeleteRangeByField(t,e),e=this.nextMathPosition(e),e=this.nextPicturePosition(e),e=this.nextSdtPosition(t,e),new p.GCPRange(t,e-t)},t.prototype.fixToDeleteRangeByField=function(t,e){var r,n=null!==(r=this.getFieldInfoByGcp(e))&&void 0!==r?r:{},o=n.fieldInfo,i=n.fieldRangeInfo;if(!i||!o)return e;var a=i.fieldResultRange;return o.canFocusInField&&t>a.begin()&&e===a.end()?e:this.nextFieldPosition(e)},t.prototype.deleteWithMultiRanges=function(t,e){this._getRange().deleteWithMultiRanges(t,e)},t.prototype.setLink=function(t,e){this._getRange().setLink(t,e)},t.prototype.getStyleName=function(t){return this._getRange().getStyleName(t)},t.prototype.getStyleShowName=function(t){return this._getRange().getStyleShowName(t)},t.prototype.getSentenceByGCP=function(t){if(!(t<0)){var e=this._state.getTextStream(),r=this.getShouldBreakParaRange(t),n=r&&r.realRange;return{text:n&&e.readText(n.begin(),n.length())||"",range:n||new p.GCPRange(t,0)}}},t.prototype.findClosedPunctuationPos=function(t,e,r,n){var o=/[!?。！？\n]/g,i=e.match(o),a=r.match(o),s=t.begin(),l=t.end();a&&a.length>0&&(s=s+r.lastIndexOf(a[a.length-1])+1),s===t.end()&&(s=a&&a.length>1?t.begin()+r.substr(0,r.length-1).lastIndexOf(a[a.length-2])+1:t.begin()),i&&i.length>0&&(l=e.indexOf(i[0])+1+n);var c=this.getFieldRange(new p.GCPRange(n,e.length)),u=this.getFieldRange(new p.GCPRange(t.begin(),r.length));return c&&l>c.begin()&&l<c.end()&&(l=c.begin()+c.length()),u&&s>u.begin()&&s<u.end()&&(s=u.begin()),this.convertRangeFilterSpecial(new p.GCPRange(s,l-s))},t.prototype.convertRangeFilterSpecial=function(t){var e=this.filterSpecialChar(t),r=e.text,n=e.commentRefCount;return{realRange:new p.GCPRange(t.begin(),r.length),reflexRange:new p.GCPRange(t.begin(),r.length+n)}},t.prototype.filterSpecialChar=function(t){var e=this._state.getTextStream().readText(t.begin(),t.length()),r=0,n=e.split("").filter((function(t,e){return t===p.PlaceholderChar.CommentReference&&(r+=1),t&&![p.PlaceholderChar.SectionBreak,p.PlaceholderChar.ParagraphBreak,p.PlaceholderChar.CommentReference].includes(t)})).join("");return{commentRefCount:r,filterCount:e.length-n.length,text:n}},t.prototype.filterCommentPlaceholder=function(t){if(!this._state.getTextStream().readText(t.begin(),t.length()).split("").some((function(t){return t!==p.PlaceholderChar.CommentReference}))){var e=this.prevWordBreak(t.begin());return new p.GCPRange(e,t.end()-e)}return t},t.prototype.setStyle=function(t,e){this._getRange().setStyle(t,void 0,e)},t.prototype.typeText=function(t){var e=this._getRange();this.isSelectionAtShape()?Kr.inputTextframe(this._state,t,e):e.setText(t)},t.prototype.typeParagraph=function(){this._getRange().insertParagraph()},t.prototype.typeBackspace=function(t){var e=this._gcpRange();if(e.isEmpty()){var r=this.skipAnchors(e.begin(),!0,t),n=this.skipAnchors(r,!0,t),o=this.prevTextBreak(n,{isBackspace:!0}),i=r-o,a=new p.GCPRange(o,i);(0,p.isFootnoteEndnoteReference)(this._state.getTextStream(),a)?this.setRange(a.begin(),a.end()):this._getRange(a).delete()}else this._getRange().delete()},t.prototype.skipAnchors=function(t,e,r){if(void 0===r&&(r=!0),!this.shouldSkipAnchors(t,e,r))return t;var n=this._state.getDrawingStream().createDrawingIterator();return n.seek(t+(e?-1:0)),t+this.proceedSpanIterForSkippingAnchors(n,e)},t.prototype.proceedSpanIterForSkippingAnchors=function(t,e){for(var r,n=0,o=t.getRange().begin();(e?t.hasPrev():t.hasNext())&&t.getPropertyType()===p.PropertyType.DrawingProperty&&(null===(r=t.getProperty())||void 0===r?void 0:r.drawingStates)!==p.DrawingStates.Inline&&o===t.getRange().begin();)n+=e?-1:1,o+=t.getRange().len*(e?-1:1),e?t.prev():t.next();return n},t.prototype.shouldSkipAnchors=function(t,e,r){var n=this._state.getTextStream().readText(t+(e?-1:0),1);return!!r&&n===p.PlaceholderChar.DrawingAnchor},t.prototype.countWord=function(){return this._getRange().countWord()},t.prototype.prevMathPosition=function(t){var e=this._state.getMathStream().getMathInfo(t,1);if(e){var r=e.range.begin();return e.property.isBegin||(r-=1),r}return t},t.prototype.prevFieldPosition=function(t,e){var r=this._state.dataEngine.getDataStream().getFieldStream(),n=r.getNestingFieldInfo(t);if(!n)return t;var o=r.getDecodedFieldInfo(t,n.nestingLevel),i=o.fieldRange,a=o.fieldResult;return!o.canFocusInField||(null==e?void 0:e.skipField)?i.begin():(t===a.range.end()&&(t=this.prevFieldPosition(t-1,e)),(null==e?void 0:e.isBackspace)||t!==a.range.begin()||(t=this.prevFieldPosition(i.begin(),e)),t)},t.prototype.prevFootnoteOrEndnotePosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getNotesStream(),n=r.getFootnoteInfoFromGcp(e)||r.getEndnoteInfoFromGcp(e);return n&&e>=n.range.begin()&&e<=n.range.end()&&(e=this.prevTextBreak(n.range.begin())),e},t.prototype.prevPicturePosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getDrawingStream().getPictureInfoFromGcp(e);return r&&e>=r.range.begin()&&e<=r.range.end()&&(e=this.prevTextBreak(r.range.begin())),e},t.prototype.prevTextBreak=function(t,e){var r=l._l.previousTextBreak(this._state.getTextStream(),t);return this.checkAndIgnorePlaceholderForward(r,e)},t.prototype.checkAndIgnorePlaceholderForward=function(t,e){return t=this.prevFieldPosition(t,e),t=this.prevMathPosition(t),t=this.prevPicturePosition(t)},t.prototype.nextMathPosition=function(t){var e,r=this._state.getMathStream().getMathInfo(t,1);return null!==(e=null==r?void 0:r.range.end())&&void 0!==e?e:t},t.prototype.nextSdtPosition=function(t,e){var r=new p.GCPRange(t,e-t);return this._state.getDataStream().getSdtStream().containIntersectSdt(r)?t:e},t.prototype.getFieldInfoByGcp=function(t){var e=this._state.dataEngine.getDataStream().getFieldStream(),r=e.getFieldRange(t);if(!r)return null;var n=e.getNestingFieldInfo(t),o=e.getFieldRange(t,null==n?void 0:n.nestingLevel);(null==n?void 0:n.nestingLevel)&&(null==n?void 0:n.nestingLevel)>1&&(t=this.nextTextBreak(o.fieldRange.end()));var i=r.fieldRange;return{fieldRangeInfo:r,fieldInfo:e.getDecodedFieldInfo(i.gcpBegin)}},t.prototype.nextFieldPosition=function(t,e){var r=this._state.dataEngine.getDataStream().getFieldStream(),n=r.getNestingFieldInfo(t);if(!n||t===n.range.begin())return t;var o=r.getDecodedFieldInfo(t,n.nestingLevel),i=o.fieldRange,a=o.fieldCode,s=o.fieldResult;return!o.canFocusInField||(null==e?void 0:e.skipField)?i.end():(t===a.range.begin()&&(t=this.nextFieldPosition(s.range.begin()+1,e)),t===s.range.end()&&(t=this.nextFieldPosition(i.end(),e)),t)},t.prototype.nextFootnoteOrEndnotePosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getNotesStream(),n=r.getFootnoteInfoFromGcp(e)||r.getEndnoteInfoFromGcp(e);return n&&e>=n.range.begin()&&e<=n.range.end()&&(e=n.range.end()),e},t.prototype.nextPicturePosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getDrawingStream().getPictureInfoFromGcp(e);return r&&e>=r.range.begin()&&e<=r.range.end()&&(e=r.range.end()),e},t.prototype.nextTextBreak=function(t,e){var r=l._l.nextTextBreak(this._state.getTextStream(),t);return this.checkAndIgnorePlaceholderBackward(r,e)},t.prototype.checkAndIgnorePlaceholderBackward=function(t,e){return t=this.nextFieldPosition(t,e),t=this.nextMathPosition(t),t=this.nextPicturePosition(t)},t.prototype.prevWordBreak=function(t,e){var r=this._state.getTextStream();if(t<=0||t>r.getLength()-1)return t;if(this.isSelectionCollapseAtParaStart())return t-1;var n=this.prevTextBreak(t,e);if(n-t>1)return n;var i=r.readText(t-1,1).charCodeAt(0);if(!o.m7.isAlphabetOrNumber(i)&&!this.isCaretAtCommentReference(t))return n;var a=r.createParagraphIterator();a.seek(t);for(var s=a.getRange(),l=s.begin(),p=t;p>=s.begin()+1;p--){var c=r.readText(p-1,1).charCodeAt(0);if(!o.m7.isAlphabetOrNumber(c)&&!this.isCaretAtCommentReference(p)){l=p;break}}return l=this.checkAndIgnorePlaceholderForward(l)},t.prototype.nextWordBreak=function(t,e){var r=this._state.getTextStream();if(t<0||t>=r.getLength()-1)return t;if(this.isSelectionCollapseAtParaEnd())return t+1;var n=this.nextTextBreak(t,e);if(n-t>1)return n;var i=r.readText(t,1).charCodeAt(0);if(!o.m7.isAlphabetOrNumber(i))return n;var a=r.createParagraphIterator();a.seek(t);for(var s=a.getRange(),l=s.end()-1,p=t;p<s.end()-1;p++){var c=r.readText(p,1).charCodeAt(0);if(!o.m7.isAlphabetOrNumber(c)){l=p;break}}return l=this.checkAndIgnorePlaceholderBackward(l)},t.prototype.prevSkipSpace=function(t){var e=this._state.getTextStream();if(t<=0||t>e.getLength()-1)return t;var r=e.readText(t-1,1).charCodeAt(0);if(!o.m7.isSpace(r))return t;var n=e.createParagraphIterator();n.seek(t);for(var i=n.getRange(),a=i.begin(),s=t;s>i.begin()+1;s--)if(r=e.readText(s-1,1).charCodeAt(0),!o.m7.isSpace(r)){a=s;break}return a},t.prototype.nextSkipSpace=function(t){var e=this._state.getTextStream();if(t<0||t>=e.getLength()-1)return t;var r=e.readText(t,1).charCodeAt(0);if(!o.m7.isSpace(r))return t;var n=e.createParagraphIterator();n.seek(t);for(var i=n.getRange(),a=i.end()-1,s=t;s<i.end()-1;s++)if(r=e.readText(s,1).charCodeAt(0),!o.m7.isSpace(r)){a=s;break}return a},t.prototype.selectWord=function(t,e){var r=this._state.getTextStream();if(!(t<0||t>=r.getLength()-1)&&null===this._state.listMarkerSpanProp){var n=r.readText(t,1);if(n!==p.PlaceholderChar.CommentReference){var a=n.charCodeAt(0),s={scrollToView:h.hF.None,forceFocus:!1,mobileContextMenu:h.A6.Show},l=!1;if((0,p.isLineBreaker)(a)&&(l=!0),o.m7.isSpace(a)){var c=this.prevSkipSpace(t),u=this.nextSkipSpace(t);this.setRange(c,u,s)}else if(l){var g=this.getParaRange(t);if(c=this.prevWordBreak(t),this.isGCPAtTableCell(t)&&g&&this._state.getTextStream().readText(g.end(),1)===p.PlaceholderChar.TableCellBreak)return void this.setRange(g.begin(),g.end()+1,s);if(g&&!g.contains(c))return;var d=this.filterCommentPlaceholder(new p.GCPRange(c,t-c));this.setRange(d.begin(),d.end(),s)}else if(o.m7.isAlphabetOrNumber(a))c=this.prevWordBreak(t),u=this.nextWordBreak(t),d=this.filterCommentPlaceholder(new p.GCPRange(c,u-c)),this.setRange(d.begin(),d.end(),s);else if((0,Sr.isHanScript)(a)&&void 0!==Intl.Segmenter){var y=Math.max(0,t-10),f=r.readText(y,20),v=(0,i.__read)(function(t,e){var r,n,o=new Intl.Segmenter("zh",{granularity:"word"}).segment(t);try{for(var a=(0,i.__values)(o),s=a.next();!s.done;s=a.next()){var l=s.value;if(e>=l.index&&e<l.index+l.segment.length)return[l.index-e,l.index+l.segment.length-e]}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return[0,0]}(f,t-y),2);c=v[0],u=v[1],this.setRange(c+t,u+t,s)}else e?(c=this.prevTextBreak(t),this.setRange(c,t,s)):(u=this.nextTextBreak(t),this.setRange(t,u,s))}else this.selectWord(t+1,e)}},t.prototype.getParaRange=function(t){var e=this._state.getTextStream();if(t<0||t>=e.getLength()-1)return null;var r=e.createParagraphIterator();return r.seek(t),r.getRange()},t.prototype.getShouldBreakParaRange=function(t){var e=this._state.getTextStream(),r=this.getParaRange(t);if(r){if(e.readText(r.end()-1,1)===p.PlaceholderChar.ParagraphReturn&&(r=new p.GCPRange(r.begin(),r.length()-1)),r.isEmpty())return null;var n=t-r.begin(),o=r.length()-n,i=e.readText(t,o),a=e.readText(r.begin(),n);return this.findClosedPunctuationPos(r,i,a,t)}return null},t.prototype.getContentTextByRange=function(t){if(t){var e=this._state.getTextStream(),r=t.begin(),n=t.length();return e.readText(r,n)}return""},t.prototype.selectParagraph=function(t){var e,r,n=this.getParaRange(t);if(n){var o=this._state.getTextStream(),i=this.isGCPAtTableCell(t);if(!i&&1===n.len&&(0,p.isLineBreaker)(o.readText(t,1).charCodeAt(0)))return;var a=n.end();if(i&&this._state.getTextStream().readText(n.end(),1)===p.PlaceholderChar.TableCellBreak&&(a+=1),(null===(e=this._state.context)||void 0===e?void 0:e.isRestrictProtectOn)&&!(null===(r=this._state)||void 0===r?void 0:r.getRestrictEdit().checkPermissionRangeByGcpRange(n)))return;this.setRange(n.begin(),a,{scrollToView:h.hF.None,forceFocus:!1,mobileContextMenu:h.A6.Show})}},t.prototype.getSpanPropAtParaStart=function(){var t=this._state.getTextStream(),e=t.createParagraphIterator();e.seek(this._gcpRange().begin());var r=e.getRange(),n=t.createRunIterator();return n.seek(r.begin()),n.getCloneProperty()},t.prototype.getParaRangeFromSelection=function(t){var e=this._state.getTextStream().createParagraphIterator();return t?e.seek(this._gcpRange().begin()):0===this._gcpRange().len?e.seek(this._gcpRange().end()):e.seek(this._gcpRange().end()-1),e.getRange()},t.prototype.isSelectionBeginAtStoryBegin=function(){return this._gcpRange().begin()===this.storyRange().begin()},t.prototype.isSelectionEndAtStoryEnd=function(t){return void 0===t&&(t=!0),t?this._gcpRange().end()===this.storyRange().end():this._gcpRange().end()===this.storyRange().end()-1},t.prototype.relationToSelectAndPara=function(t,e,r,n){void 0===n&&(n=!0);var o=this.getParaRangeFromSelection(r),i=this._gcpRange().begin(),a=this._gcpRange().end();return t?e?i===o.begin():!n&&i===o.end()-1:e?a===o.begin():n?a===o.end():a===o.end()-1},t.prototype.isSelectAllParagraph=function(){return this.relationToSelectAndPara(!0,!0,!0)&&this.relationToSelectAndPara(!1,!1,!0)},t.prototype.isSelectWholeTable=function(){var t=this._state.getTextStream().createRunIterator();t.seek(this._gcpRange().begin());var e=t.getRange(!0);return this._state.getTextStream().readText(e.begin(),1)===p.PlaceholderChar.TableStart},t.prototype.isSelectionAtTableCell=function(){var t=this._state.getTextStream().createRunIterator();t.seek(this._gcpRange().begin());var e=t.getRange(!0);return this._state.getTextStream().readText(e.begin(),1)===p.PlaceholderChar.TableCellBreak},t.prototype.isGCPAtTableCell=function(t){return!!this._state.getTableStream().getCellInfo(t)},t.prototype.isSelectionAtMath=function(){var t=this._gcpRange(),e=this._state.getMathStream().getMathInfo(t.begin(),1);if(null===e)return!1;if(e.range.equal(t))return!0;var r=this.getParagraphFormat();return!(!r.getAttributes().isOMathPara||!r.getRange().equal(t))},t.prototype.isSelectionContainsMath=function(){var t,e,r=this.getText();if(r.includes(p.PlaceholderChar.MathBegin)||r.includes(p.PlaceholderChar.MathEnd))return!0;var n=this.getParagraphs();try{for(var o=(0,i.__values)(n),a=o.next();!a.done;a=o.next())if(a.value.getAttributes().isOMathPara)return!0}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return!1},t.prototype.isParagraphContainsMath=function(){var t,e,r=this.getParagraphs();try{for(var n=(0,i.__values)(r),o=n.next();!o.done;o=n.next()){var a=o.value.getRange(),s=this._state.getTextStream().readText(a.begin(),a.length());if(s.includes(p.PlaceholderChar.MathBegin)||s.includes(p.PlaceholderChar.MathEnd))return!0}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return!1},t.prototype.isSelectionAtParagraphBegin=function(){var t=this._gcpRange().begin();return 0===t||"\r"===this._state.getTextStream().readText(t-1,1)},t.prototype.isSelectionCollapseAtParaStart=function(){return!!this._coreSelection().isCollapse()&&this.relationToSelectAndPara(!0,!0,!0)},t.prototype.isSelectionAtDrawing=function(t){if(1===this._gcpRange().len){var e=this._state.getTextStream().createRunIterator();e.seek(this._gcpRange().begin());var r=e.getProperty(),n=e.getRange();if(null==r?void 0:r.isPlaceholder){var o=p.PropertyUtil.findPlaceholderCharProperty(this._state.getDataStream(),n.begin());return o instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)&&(!t||o.drawingType===t)}}return!1},t.prototype.isSelectionAtShape=function(){return this.isSelectionAtDrawing(p.DrawingType.WordprocessingShape)},t.prototype.isSelectionAtImage=function(){return this.isSelectionAtDrawing(p.DrawingType.Picture)},t.prototype.isSelectionAtEmbeddedObject=function(){var t=this.getRange().range(),e=t.gcpBegin,r=t.len;return 1===r&&this._state.getTextStream().readText(e,r)===p.PlaceholderChar.EmbeddedObjectAnchor},t.prototype.isSelectionAtAnchorContainer=function(){if(1===this._gcpRange().len){var t=this._gcpRange().begin(),e=this._state.getDrawingStream().getDrawingInfoFromGcp(t);if(e&&e.property instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)&&e.property.drawingStates===p.DrawingStates.Floating)return!0}return!1},t.prototype.isSelectionAtPlugin=function(){var t=this._gcpRange().begin(),e=this._state.getFieldStream().getDecodedFieldInfo(t),r=p.FieldUtil.getComplexFieldSubType(null==e?void 0:e.fieldCode.switches);return!(!e||!r)&&["tdSheetIframe","addonHina","addonIframe"].includes(r)},t.prototype.isSelectionAtField=function(t,e){void 0===e&&(e=1);var r=this.getRange().getDecodedFieldInfos(e);return t?r.some((function(e){return e.fieldCode.name===t})):!!r.length},t.prototype.isSelectionInsideField=function(t,e){void 0===e&&(e=1);var r=(0,i.__read)(this.getRange().getDecodedFieldInfos(e),1)[0];return!!r&&(0!==this._gcpRange().len||(null==r?void 0:r.fieldRange.begin())!==this._gcpRange().begin())&&(!t||t===r.fieldCode.name)&&r.fieldRange.contains(this._gcpRange())},t.prototype.isSelectionAtTextLink=function(){var t,e,r=this._state.dataEngine.getDataStream().getFieldStream().getDecodedFieldInfo(this._gcpRange().begin());return!!r&&!(r.fieldCode.range.begin()>=this._gcpRange().begin())&&null!==(e=(null===(t=r.fieldCode.switches)||void 0===t?void 0:t[p.FieldCommonSwitchesName.displayLayoutType])===p.FieldDisplayLayoutTypeChar.Text)&&void 0!==e&&e},t.prototype.isSelectionEndAtParaBreak=function(){if(this._gcpRange().len<=0)return!1;var t=this._state.getTextStream().createRunIterator();t.seek(this._gcpRange().end()-1);var e=t.getRange(!0),r=this._state.getTextStream().readText(e.begin(),e.len);return[p.PlaceholderChar.ParagraphReturn,p.PlaceholderChar.ParagraphBreak].includes(r)},t.prototype.isSelectionAtParaBreak=function(){if(1===this._gcpRange().len){var t=this._state.getTextStream().createRunIterator();t.seek(this._gcpRange().begin());var e=t.getRange(!0),r=this._state.getTextStream().readText(e.begin(),e.len);return[p.PlaceholderChar.ParagraphReturn,p.PlaceholderChar.ParagraphBreak].includes(r)}return!1},t.prototype.isSelectionAtTextFrame=function(t){if(this.storyType()!==p.STStoryType.textboxContent)return!1;var e=this.storyProperty(),r=p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty);return t?e instanceof r&&e.textBoxType===t:e instanceof r},t.prototype.isSelectionAtCodeblock=function(){return this.isSelectionAtTextFrame(p.TextFrameType.CodeBlock)},t.prototype.isSelectionAtLightblock=function(){return this.isSelectionAtTextFrame(p.TextFrameType.LightBlock)},t.prototype.isSelectionCollapseAtParaEnd=function(){return!!this._coreSelection().isCollapse()&&this.relationToSelectAndPara(!0,!1,!0,!1)},t.prototype.isSelectionAtListStart=function(){var t=this._state.dataEngine.getDataManager().getNumberingManager().getListInfoFromGcpRange(this._gcpRange());return null!==t&&0===t.order&&0===t.listLevel},t.prototype.isSelectionBelongsToSameList=function(){return!0},t.prototype.isSelectWholeList=function(t){var e=this,r=this._state.dataEngine.getDataManager().getNumberingManager().getWholeListByListId(t);return 0!==r.length&&r.every((function(t){return e._gcpRange().contains(t.gcp-1)}))},t.prototype.isSelectionAtMention=function(){if(0===this._gcpRange().len){var t=this._state.dataEngine.getDataStream().getFieldStream();if(null==t?void 0:t.getFieldRange(this._gcpRange().begin()))return!0}return!1},t.prototype.isSelectionAtCard=function(){var t=this._state.getFieldStream(),e=null==t?void 0:t.getDecodedFieldInfo(this._gcpRange().begin());return!(!e||![p.FieldName.GROUP_CONTACT_CARD,p.FieldName.MEMBER_CONTACT_CARD,p.FieldName.WXWORK_APP,p.FieldName.WXWORK_CALENDER,p.FieldName.WXWORK_GROUP_CHAT].includes(e.fieldCode.name))},t.prototype.isCaretAtCommentReference=function(t){return!(!t&&(!this._gcpRange().begin()||this._gcpRange().len>0))&&p.PropertyUtil.findPlaceholderCharProperty(this._state.getDataStream(),(t||this._gcpRange().begin())-1)instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.CommentReferenceProperty)},t.prototype.getFirstListInfoInSelection=function(t){var e,r;return null!==(r=null===(e=this._state.dataEngine.getDataManager().getNumberingManager())||void 0===e?void 0:e.getListInfoFromGcpRange(t||this._gcpRange()))&&void 0!==r?r:null},t.prototype.getParaRangeIfCollapsed=function(){if(!this._coreSelection().isCollapse())return null;var t=this._state.getTextStream().createParagraphIterator();t.seek(this._gcpRange().begin());var e=t.getRange();return Vn.createStateRange(this._state,e)},t.prototype.validDeleteRange=function(){return this._coreSelection().validDeleteRange()},t.prototype._getRange=function(t){this._range||(this._range=Vn.createStateRange(this._state,this._gcpRange(),!0));var e=t||this._gcpRange(),r=this._range.getTableSelectionArea();return(e.notEqual(this._range.range())||r&&e.notEqual(r.selectedRange))&&this._range.setGCPRange(e),this._range},Object.defineProperty(t.prototype,"gcpRange",{get:function(){return this._gcpRange()},enumerable:!1,configurable:!0}),t.prototype._gcpRange=function(){return this._state.selection.gcpRange},t.prototype._coreSelection=function(){return this._state.selection},t.prototype.getDecodedFieldInfo=function(t,e){return this._getRange().getDecodedFieldInfo(t,e)},t.prototype.getDecodedFieldInfos=function(t){return this._getRange().getDecodedFieldInfos(t)},t.prototype.getFieldRanges=function(){return this._getRange().getFieldRanges()},t.prototype.getVisibleFieldRanges=function(){return this._getRange().getVisibleFieldRanges()},t.prototype.insertField=function(t,e,r){this._getRange().insertField(t,e,r)},t.prototype.insertFields=function(t){this._getRange().insertFields(t)},t.prototype.insertFieldStart=function(t,e,r){this._getRange().insertFieldStart(t,e,r)},t.prototype.insertFieldFinish=function(t,e,r){this._getRange().insertFieldFinish(t,e,r)},t.prototype.insertFieldCancel=function(t){this._getRange().insertFieldCancel(t)},t.prototype.updateField=function(t,e,r){this._getRange().updateField(t,e,r)},t.prototype.moveField=function(t,e){this._getRange().moveField(t,e)},t.prototype.getSelectionContent=function(){return this.getTextAndImage()},t.prototype.insertTextAndSelected=function(t){var e=this.range();if(e&&t&&t.length>0){var r=e.begin();this.setText(t),this._state.setRangeTo(new p.GCPRange(r,t.length))}},t.prototype.isSelectionAtIframePlugin=function(){var t=this._gcpRange();if(t.len>1){var e=this._state.getFieldStream().getDecodedFieldInfo(t.begin());if(e)return p.FieldUtil.isContainerField(e.fieldCode.switches)&&t.equal(e.fieldRange)}return!1},t.prototype.increaseFontSize=function(){return this._getRange().modifyFontSizeRelatively(1)},t.prototype.decreaseFontSize=function(){return this._getRange().modifyFontSizeRelatively(-1)},t.prototype.typeLineBreak=function(){this._getRange().insertLineBreak()},t.prototype.getSelectedPropertyInfo=function(t){var e;if(!t||t.isEmpty()||t.isNull())return[];var r=this._state.getTextStream().createRunIterator(t),n=[];do{var o=r.getRange(!0),i=(null===(e=r.getCloneProperty())||void 0===e?void 0:e.isPlaceholder)?p.PropertyUtil.findPlaceholderCharProperty(this._state.getDataStream(),o.begin()):r.getCloneProperty();i&&n.push({range:o,property:i})}while(r.next());return n},t.prototype.filterFieldCodeRange=function(t){var e=this._state.dataEngine.getDataStream().getFieldStream();return e?t.filter((function(t){var r;return!(e.isRangeInField(t)&&(null===(r=e.getDecodedFieldInfo(t.begin()))||void 0===r?void 0:r.layoutType)!==p.FieldLayoutType.Text)})):t},t.prototype.isRangeInFieldCode=function(t){var e=this._state.dataEngine.getDataStream().getFieldStream();return null==e?void 0:e.isRangeInField(t)},t.prototype.isInTable=function(){return this._getRange().isInTable()},t.prototype.isInCellsOfTable=function(){return this._getRange().isInCellsOfTable()},t.prototype.isInMainDocument=function(){return this.storyType()===p.STStoryType.mainDocument},t.prototype.getSdtSelectionCache=function(){return this._coreSelection().sdt},t.prototype.getSdtSelection=function(){return this._coreSelection().getSdtSelection()},t.prototype.isInHeaderFooter=function(){return this.storyType()===p.STStoryType.headerContent||this.storyType()===p.STStoryType.footerContent},t.prototype.getFieldRange=function(t){var e,r=this._state.getTextStream().readText(t.begin(),t.length()).indexOf(p.PlaceholderChar.FieldBegin);if(r<0)return null;var n=this._state.dataEngine.getDataStream().getFieldStream(),o=null===(e=null==n?void 0:n.getFieldRange(t.begin()+r))||void 0===e?void 0:e.fieldRange;return o||null},t.prototype.isIncludeExtContainer=function(){var t=this;return(0,i.__spreadArray)([],(0,i.__read)(this._getRange().getInlinePlugins()),!1).some((function(e){var r=e.getRange(),n=t._state.getTextStream().readText(r.begin(),r.length());return p.FieldCodeManager.getInstance().isContainerField(n)}))},t.prototype.isSelectionContainsRevision=function(){return this._state.dataEngine.getDataManager().getRevisionsManager().rangeIncludeTextRevision(this._gcpRange(),!0)},t.prototype.getCompleteParaRange=function(t){var e,r,n=null!=t?t:this.range();if(n.equal(this.range())&&this.isInCellsOfTable())return t;var o=null===(e=this._state.context.getViewRangeFromGcpRange(new p.GCPRange(n.begin(),0)))||void 0===e?void 0:e.start,i=(0,Q.liF)(o);if(i){if(i.isEmpty())return i;var a=n.isEmpty()?n.end():n.end()-1,s=null===(r=this._state.context.getViewRangeFromGcpRange(new p.GCPRange(Math.max(a,0),0)))||void 0===r?void 0:r.start;if(s){var l=(0,Q.liF)(s);if(l)return new p.GCPRange(i.begin(),l.end()-i.begin())}}},t.prototype.getCompleteParaRangeInSdt=function(t){var e;if(!t||!t.isValid())return t;var r=this._state.getDataStream().getSdtStream(),n=r.getSdtInfo(t.begin()),o=r.getSdtInfo(t.end()-1);if(n&&o&&n.range.equal(o.range)&&n.property===o.property&&n.range.equal(t)){var i=t.isEmpty()?t.end():t.end()-1,a=null===(e=this._state.context.getViewRangeFromGcpRange(new p.GCPRange(Math.max(i,0),0)))||void 0===e?void 0:e.start;if(!a)return t;var s=(0,Q.liF)(a);if(!s)return t;if(Kt(this._state.context.service,s))return t.unionRange(s)}return t},t.prototype.getCompleteParaRangeForUpdateParaProp=function(){var t;return this._state.getRevisionsManager().getRevisionModelWrapper().existTextLenRevision&&null!==(t=this.getCompleteParaRange())&&void 0!==t?t:this._gcpRange()},t.prototype.getEndParaRange=function(t){var e,r=null!=t?t:this.range(),n=r.isEmpty()?r.end():r.end()-1,o=null===(e=this._state.context.getViewRangeFromGcpRange(new p.GCPRange(Math.max(n,0),0)))||void 0===e?void 0:e.start;if(o){var i=(0,Q.liF)(o);if(i)return this._state.getDataStream().getTextStream().createParagraphIterator(new p.GCPRange(i.end()-1,1)).getRange()}},t.prototype.getEndParaRangeForUpdateParaProp=function(){var t;return this._state.getRevisionsManager().getRevisionModelWrapper().existTextLenRevision&&null!==(t=this.getEndParaRange())&&void 0!==t?t:this._gcpRange()},t.prototype.getAdaptiveParaRangeForUpdateParaProp=function(){return this._state.getRevisionsManager().getRevisionModelWrapper().existTextLenRevision?this.range().isEmpty()?this.getEndParaRangeForUpdateParaProp():this.getCompleteParaRangeForUpdateParaProp():this._gcpRange()},t}(),Kn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.setCellHeight=function(t,e){var r=this.findBottomRow(t);if(r){var n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableRowProperty));n.trHeight.val=e,r.setProperty(n),this.setCommandType(p.Type.DocModifyTableRowHeight),this.applyTableStructureUpdate()}},e.prototype.findBottomRow=function(t){var e,r=null===(e=this.table)||void 0===e?void 0:e.getCell(t),n=null==r?void 0:r.getVMergeCells();return n?n[n.length-1].parent:null},e}(an),jn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.moveTo=function(t){var e=this,r=this.getSourceTableRange(),n=this.cursorOffset(r.begin()),o=function(){var t=h.C1.createLocalDeltaOption(r).buildDelta();e.state.deleteText(r,t),t.setCommandType(p.Type.DocMoveContent),e.state.applyDelta(t)},i=function(){var r=new p.GCPRange(t,0);if(Be.shouldInsertParaBeforeTable(t,e.state)){var n=e.state.followParaProp(t);e.state.context.service.getSelection().insertParagraphAfter(r,n.paraProp),r.gcpBegin+=1}e.state.context.clipboardManager.pasteSelectionInnerData({targetRange:r,pasteScene:c.KGc.TableDrag})};this.state.context.clipboardManager.storeSelectionInnerData(r,!0),r.begin()>t?(o(),i(),this.state.setRangeTo(new p.GCPRange(t+n,0))):(i(),o(),this.state.setRangeTo(new p.GCPRange(t-r.len+n,0)))},e.prototype.moveOnSquareWrapType=function(t,e){var r=this.table.getRange(),n=this.table.getProperty().clone();if(n.tblPr.tblpPr.horzAnchor=p.STHAnchor.page,n.tblPr.tblpPr.vertAnchor===p.STVAnchor.margin&&(n.tblPr.tblpPr.vertAnchor=p.STVAnchor.page),n.tblPr.tblOverlap.val=p.STTblOverlap.overlap,n.tblPr.tblpPr.tblpX=t.x,n.tblPr.tblpPr.tblpY=t.y,n.tblPr.tblpPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPPr).tKeys.tblpXSpec),n.tblPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPrBase).tKeys.jc),n.tblPr.tblpPr.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTblPPr).tKeys.tblpYSpec),this.table.setProperty(n),this.setCommandType(p.Type.DocModifyTable),this.applyTableUpdate(),void 0!==e){var o=this.state.getTableStream().getTableInfo(e,p.DEFAULT_TABLE_NESTING_LEVEL),i=o?o.range.begin():e;if(r.end()!==i)return void this.moveTo(i)}},e.prototype.cursorOffset=function(t){return this.state.selection.getCoreRange().fixToValidRange(new p.GCPRange(t,0)).begin()-t},e.prototype.getSourceTableRange=function(){var t=this.table.getRange();return this.state.selection.getCoreRange().fixToSdtRange(t)},e}(an);function Yn(t,e,r){var n=e.begin,o=e.end,i=r.begin,a=r.end,s=t.selfLeft?n:o;return!(!t.otherLeft||s!==i)||!(!t.otherRight||s!==a)||!!(t.otherContain&&s>i&&s<a)}function qn(t,e,r){var n=[];return Array.isArray(e)?e.forEach((function(e){e.some((function(e){return!!Yn(r,t.interval,e.interval)&&(n.push(e),!0)}))})):e.rows.forEach((function(e){e.cells.some((function(e){return!!Yn(r,t.interval,e.interval)&&(n.push(e),!0)}))})),n}var Qn,Xn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"tableSelectArea",{get:function(){return this.state.selection.tableSelectionArea},enumerable:!1,configurable:!0}),e.prototype.getCellContentWidth=function(t){var e=this.table.getCell(t);if(!e)return null;var r=this.state.dataEngine.getDataManager().getStyleSheetManager(),n=r.mergeStyleTableProperty(this.table.getProperty()),a=r.mergeTableCellPropWithGcp(e.getProperty().clone(),n,t),s=(0,p.mergeTableMar)(a,n).tcMar,l=(0,i.__read)([s.left.w,s.right.w],2),c=l[0],u=l[1],g=dn(e,r),h=function(t){return(0,o.pL)(t/8)},d=(0,i.__read)([h(g.left.sz),h(g.right.sz)],2),y=d[0],f=d[1];return e.width-(c+u)-(y+f)},e.prototype.setColumnWidth=function(t,e,r,n){var o=this.table.getCell(t);if(o){var i=n?this.getVerticalCellAffectedBySelection(o,r):qn(o,this.table,r),a=this.findAllNear(i,r);this.legalToChangeWidth(a,i)&&(i.forEach((function(t){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));r.tcW.w=e,t.setProperty(r)})),this.setCommandType(p.Type.DocModifyTableColumnWidth),this.applyTableStructureUpdate())}},e.prototype.setCellWidth=function(t,e,r,n){var o=this,i=this.table.getCell(t);if(i){var a=e-i.getProperty().tcW.w,s=this.getDiffByAutoAline(i,a,r),l=n?this.getVerticalCellAffectedBySelection(i,r):qn(i,this.table,r),c=this.findAllNear(l,r);if(this.legalToChangeWidth(c,l)){var u=s>0?this.findAdjustableDiff(c.nearCells):this.findAdjustableDiff(l);null===u&&(u=s);var g=Math.min(Math.abs(u),Math.abs(s)),h=s>0?g:-g,d=-h;l.forEach((function(t){o.setCellWidthByDiff(t,h)})),c.nearCells.forEach((function(t){o.setCellWidthByDiff(t,d)})),this.hasWBefore(this.table.rows)&&this.table.fixMergedStructure(),this.setCommandType(p.Type.DocModifyTableColumnWidth),this.applyTableStructureUpdate()}}},e.prototype.hasWBefore=function(t){return t.some((function(t){return p.TablePropertyUtil.getWidth(t.getProperty().wBefore)>0}))},e.prototype.getDiffByAutoAline=function(t,e,r){var n=null,o=function(t,e){var r=t,n=t;return e.rows.forEach((function(e){e.cells.forEach((function(e){var o=Math.abs(t-e.interval.begin);0!==o&&r>o&&(r=o,n=e.interval.begin),0!==(o=Math.abs(t-e.interval.end))&&r>o&&(r=o,n=e.interval.end)}))})),n}(n=r.selfLeft?t.interval.begin+e:t.interval.end+e,this.table);return Math.abs(n-o)>50?e:e+o-n},e.prototype.getVerticalCellAffectedBySelection=function(t,e){if(!this.tableSelectArea||this.tableSelectArea.isInnerCell()||this.tableSelectArea.isCrossTable())return qn(t,this.table,e);if(this.tableSelectArea.isInnerTable()){var r=this.table.intersectCellRange(this.tableSelectArea.cellRanges[0]);if(this.hasCell(t,r))return qn(t,r,e);var n=t.nextCell();if(n&&this.hasCell(n,r))return qn(t,this.mergePrevCell(r),e);var o=t.prevCell();if(o&&this.hasCell(o,r))return qn(t,this.mergeNextCell(r),e)}return qn(t,this.table,e)},e.prototype.findAllNear=function(t,e){return e.selfLeft?this.findAllPrev(t):this.findAllNext(t)},e.prototype.findAllPrev=function(t){var e=[],r=[];return t.forEach((function(t){var n=t.prevCell();n?e.push(n):r.push(t.parent)})),{nearCells:e,nearRows:r}},e.prototype.findAllNext=function(t){var e=[];return t.forEach((function(t){var r=t.nextCell();r&&e.push(r)})),{nearCells:e,nearRows:[]}},e.prototype.findAdjustableDiff=function(t){if(!t[0])return null;var e=t[0].getProperty().tcW.w-236;return t.slice(1).forEach((function(t){var r=t.getProperty().tcW.w-236;e=Math.min(e,r)})),e},e.prototype.adjustTableIndent=function(){var t=this,e=Number.MAX_SAFE_INTEGER;this.table.rows.forEach((function(t){e=Math.min(t.getProperty().wBefore.w,e)})),this.setTableIndentByDiff(this.table,e),this.table.rows.forEach((function(r){t.setRowBeforeWidth(r,-e)}))},e.prototype.setCellWidthByDiff=function(t,e){var r=t.getProperty().tcW.w,n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty));n.tcW.w=r+e,t.setProperty(n)},e.prototype.setTableIndentByDiff=function(t,e){var r=t.getProperty().tblPr.tblInd.w,n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableProperty));n.tblPr.tblInd.w=r+e,t.setProperty(n)},e.prototype.setRowBeforeWidth=function(t,e){var r=t.getProperty().wBefore.w,n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableRowProperty));n.wBefore.w=r+e,t.setProperty(n)},e.prototype.hasCell=function(t,e){var r=t.getRange();return e.some((function(t){return t.some((function(t){return r.intersect(t.getRange())}))}))},e.prototype.mergePrevCell=function(t){return t.slice(0).map((function(t){var e=t[0].prevCell();return e?(t.unshift(e),t):t}))},e.prototype.mergeNextCell=function(t){return t.slice(0).map((function(t){var e=t[t.length-1].nextCell();return e?(t.push(e),t):t}))},e.prototype.legalToChangeWidth=function(t,e){var r=t.nearCells[0],n=e[0],o=t.nearCells[t.nearCells.length-1],i=e[e.length-1];return!r||[r,n].every((function(t){return!t.isVMergedCell()}))&&[o,i].every((function(t){return!t.nextCellOfMergedGroup()}))},e}(an),Jn=function(t){function e(e,r,n){var o=t.call(this,e,r)||this;return o.table=n,o.widthService=new Xn(o.table,r,o._state),o.heightService=new Kn(o.table,r,o._state),o.moveService=new jn(o.table,r,o._state),o.columnService=new Pn(o.table,r,o._state),o.rowService=new Rn(o.table,r,e),o.tableWrapTextService=new xn(o.table,r,o._state),o}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"controlService",{get:function(){return new wn(this._state)},enumerable:!1,configurable:!0}),e.prototype.createUpdateDelta=function(){var t=this._deltaOpt.buildDelta();return this.table.toDelta(t),t},e.create=function(t,r,n){return new e(t,r,n)},e.prototype.getCellContentWidth=function(t){return this.widthService.getCellContentWidth(t)},e.prototype.setColumnWidth=function(t,e,r,n){void 0===n&&(n=!1),this.widthService.setColumnWidth(t,e,r,n)},e.prototype.setCellWidth=function(t,e,r,n){void 0===n&&(n=!1),this.widthService.setCellWidth(t,e,r,n)},e.prototype.setCellHeight=function(t,e){this.heightService.setCellHeight(t,e)},e.prototype.moveTo=function(t){this.moveService.moveTo(t)},e.prototype.moveOnSquareWrapType=function(t,e){this.moveService.moveOnSquareWrapType(t,e)},e.prototype.increaseRightSideColWidth=function(t,e){this.columnService.increaseRightSideColWidth(t,e)},e.prototype.setColsWidth=function(t){this.columnService.setColsWidth(t)},e.prototype.insertRowsAbove=function(t,e){void 0===e&&(e=1),this.rowService.insertRowsAbove(t,e)},e.prototype.insertRowsBelow=function(t,e){void 0===e&&(e=1),this.rowService.insertRowsBelow(t,e)},e.prototype.insertColsLeft=function(t,e){void 0===e&&(e=1),this.columnService.insertColsLeft(t,e)},e.prototype.insertColsRight=function(t,e){void 0===e&&(e=1),this.columnService.insertColsRight(t,e)},e.prototype.removeCols=function(t){this.columnService.removeCols(t)},e.prototype.removeRows=function(t){this.rowService.removeRows(t)},e.prototype.moveColsTo=function(t,e){this.columnService.moveColsTo(t,e)},e.prototype.moveRowsTo=function(t,e){this.rowService.moveRowsTo(t,e)},e.prototype.averageColWidths=function(t){this.columnService.averageColWidths(t)},e.prototype.selectTable=function(){this.controlService.selectTable(this.table.info)},e.prototype.isTableWrapText=function(){return this.tableWrapTextService.isTableWrapText()},e.prototype.scaleTable=function(t,e,r){if(t>0&&this.table.scaleX(t),e&&e.length>0){var n=this.table.rows.findIndex((function(t){return t.getRange().begin()===r.begin()}));Jr(this.table.rows.slice(n),(function(t,r){t.setHeight(e[r])}))}var o=this.table.toDelta(this._deltaOpt.buildDelta());o.setCommandType(p.Type.DocScaleTable),this._state.applyDelta(o)},e.prototype.getTableModel=function(){return this.table},e}(Rr),Zn=function(){function t(t){this.state=t,this.notesStream=this.state.getDataStream().getNotesStream()}return t.prototype.deltaOption=function(){return h.C1.createLocalDeltaOption(this.state.selection.gcpRange)},Object.defineProperty(t.prototype,"notesManager",{get:function(){return this.state.dataEngine.getDataManager().getNotesManager()},enumerable:!1,configurable:!0}),t.prototype.addNote=function(t,e){this.insertNoteSeparator(e);var r=this.state.dataEngine.getDataManager().getStyleSheetManager(),n=this.deltaOption().buildDelta(),o=e===c.wK_.ENDNOTE;n.setCommandType(o?p.Type.DocInsertEndnote:p.Type.DocInsertFootnote);var i=(null==t?void 0:t.isValid())?t:this.state.selection.gcpRange,a=this.getUniqRefId();if(!this.state.context.service.getSelection().isInMainDocument())return console.error("尾注脚注只能在正文插入"),!1;var s=o?p.BuiltinStyleName.EndnoteRef:p.BuiltinStyleName.FootnoteRef,l=Be.generateStyleProperty(n,r,s);if(!l)return!1;var u=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));u.rStyle.val=l.styleId;var g=this.state.getStoryStream().getStoryLastPos(o?p.STStoryType.endnoteContent:p.STStoryType.footnoteContent);h.Gh.insertNoteRef(i.end(),a,n,e,u);var d=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),y=o?Be.generateStyleProperty(n,r,p.BuiltinStyleName.EndnoteContent):Be.generateStyleProperty(n,r,p.BuiltinStyleName.FootnoteContent);return y&&(d.pStyle.val=y.styleId),h.Gh.insertNoteStory({storyId:a,newStoryEnd:g+1,delta:n,noteRefRunProperty:u,noteType:e,type:p.STFtnEdnType.normal,paraProp:d}),this.state.applyDelta(n),!0},t.prototype.deleteNoteStory=function(t){var e=this.getNoteSubStoryInfoFromId(t);if(e){var r=e.range,n=e.property instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.EndnoteStoryProperty),o=this.deltaOption().buildDelta();o.setCommandType(n?p.Type.DocDeleteEndnote:p.Type.DocDeleteFootnote),h.Gh.deleteText(r,o),this.state.applyDelta(o)}},t.prototype.gotoSubStoryByMainStoryPlaceholderGCP=function(t){var e,r=null===(e=this.state.getDataStream().getStoryStream().getMainStoryInfo())||void 0===e?void 0:e.contentRange;if(r&&r.contains(new p.GCPRange(t,1))){var n=this.getNoteIdFromMainStoryGCP(t),o=this.getNoteSubStoryInfoFromId(n),i=null==o?void 0:o.range;i&&i.len>1&&(i.gcpBegin=i.begin()+1),this.gotoRange(i)}},t.prototype.gotoMainStoryBySubStoryPlaceholderGcp=function(t){var e,r=null===(e=this.state.getDataStream().getStoryStream().getMainStoryInfo())||void 0===e?void 0:e.contentRange;if(r&&!r.contains(new p.GCPRange(t,1))){var n=this.getSubStoryInfoFromSubStoryNoteGCP(t),o=this.getNoteInfoFromSubStoryInfo(n);this.gotoRange(null==o?void 0:o.range)}},t.prototype.gotoRange=function(t){var e=this.state.selection.gcpRange;t&&(e=new p.GCPRange(t.begin(),0)),this.state.setRangeTo(e,{forceFocus:!0,noSendCaret:!0})},t.prototype.getNoteIdFromMainStoryGCP=function(t){var e=this.notesStream.getEndnoteInfoFromGcp(t)||this.notesStream.getFootnoteInfoFromGcp(t);return null==e?void 0:e.property.id},t.prototype.getNoteSubStoryInfoFromId=function(t){return t?this.state.dataEngine.getDataManager().getNotesManager().notesLocator.getNoteSubStoryInfoById(t):null},t.prototype.getNoteInfoFromSubStoryInfo=function(t){if(!t||!t.property)return null;var e=t.property instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.EndnoteStoryProperty),r=t.property.id;return e?this.notesStream.getEndnoteInfo(r):this.notesStream.getFootnoteInfo(r)},t.prototype.getSubStoryInfoFromSubStoryNoteGCP=function(t){var e,r=null===(e=this.state.getDataStream().getStoryStream().getMainStoryInfo())||void 0===e?void 0:e.contentRange;return!r||r.contains(new p.GCPRange(t,1))?null:this.state.dataEngine.getDataManager().getNotesManager().notesLocator.getNoteSubStoryInfoByGCP(t)},t.prototype.getUniqRefId=function(t){var e=function(t,e){var r=void 0===e?{collectEndnote:!0,collectFootnote:!0}:e,n=r.collectEndnote,o=r.collectFootnote,i=[];if(n){var a=t.createEndnoteIterator();do{(s=a.getProperty())&&i.push(s.id)}while(a.hasNext()&&a.next())}if(o){a=t.createFootnoteIterator();do{var s;(s=a.getProperty())&&i.push(s.id)}while(a.hasNext()&&a.next())}return i}(this.notesStream),r=function(){for(var t=function(){return"".concat((16777216*(1+Math.random())|0).toString(16).substring(1))},r=t();e.includes(r);)r=t();return r};return t?e.includes(t)?r():t:r()},t.prototype.getBuiltInStyleProp=function(t,e){var r=this.state.dataEngine.getDataManager().getStyleSheetManager(),n=e===c.wK_.ENDNOTE?p.BuiltinStyleName.EndnoteRef:p.BuiltinStyleName.FootnoteRef;return Be.generateStyleProperty(t,r,n)},t.prototype.getStoryEndPos=function(t){return this.state.getStoryStream().getStoryLastPos(t===c.wK_.ENDNOTE?p.STStoryType.endnoteContent:p.STStoryType.footnoteContent)},t.prototype.getMainStoryNoteType=function(t){var e=this.notesStream.getEndnoteInfoFromGcp(t)||this.notesStream.getFootnoteInfoFromGcp(t);return e?e.property instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.EndnoteStoryProperty)?c.wK_.ENDNOTE:c.wK_.FOOTNOTE:null},t.prototype.hasNoteSeparator=function(t){var e=this.state.dataEngine.getDataManager().getSettingsManager(),r=this.state.dataEngine.getDataManager().getNotesManager(),n=t===c.wK_.ENDNOTE?e.getDocSettingsProperty(!0).endnotePr:e.getDocSettingsProperty(!0).footnotePr,o=t===c.wK_.ENDNOTE?n.endnote:n.footnote;return!!r.getNoteSeparator(o)},t.prototype.shouldInsertSeparator=function(t){return!this.hasNoteSeparator(t)},t.prototype.getNoteSeparatorIds=function(t,e){var r=this.state.dataEngine.getDataManager().getNotesManager(),n=t===c.wK_.FOOTNOTE?r.getFootnoteSeparators():r.getEndnoteSeparators();return n?{normalId:n.normal.subStoryProp.id,continuationId:n.continuation.subStoryProp.id}:this.setNoteSeparator(t,e)},t.prototype.setNoteSeparator=function(t,e){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DocumentSettingsProperty)),n=t===c.wK_.ENDNOTE?new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTEdnDocProps)):new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTFtnDocProps)),o=this.getUniqRefId(),i=this.getUniqRefId(),a=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTFtnEdnSepRef)),s=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTFtnEdnSepRef));return a.id=o,s.id=i,t===c.wK_.ENDNOTE?(n.endnote.appendProperty(a,"normalSepId"),n.endnote.appendProperty(s,"continuationSepId"),r.endnotePr=n):(n.footnote.appendProperty(a,"normalSepId"),n.footnote.appendProperty(s,"continuationSepId"),r.footnotePr=n),h.Gh.setSettingProperty(r,p.ModifyType.settings,e),{normalId:o,continuationId:i}},t.prototype.insertNoteSeparator=function(t){if(this.shouldInsertSeparator(t)){var e=this.getStoryEndPos(t),r=h.C1.createLocalDeltaOption(new p.GCPRange(e,0)).buildDelta(),n=this.getNoteSeparatorIds(t,r);h.Gh.insertNoteStory({storyId:n.normalId,newStoryEnd:r.currentRange().end(),delta:r,noteType:t,type:p.STFtnEdnType.separator}),h.Gh.insertNoteStory({storyId:n.continuationId,newStoryEnd:r.currentRange().end(),delta:r,noteType:t,type:p.STFtnEdnType.continuationSeparator}),this.state.applyDelta(r)}},t.prototype.collectNotes=function(t,e){this.notesManager.collectNotes(t,e)},t.prototype.clearCollectedNotes=function(){this.notesManager.clearCollectedNotes()},t.prototype.gotoNextNote=function(t){if(!(this.state.context instanceof Ct.zq&&this.state.context.isRestrictProtectOn)){var e=this.notesManager.getNextNote(t);e&&this.gotoRange(new p.GCPRange(e.gcpEnd-1,0))}},t.prototype.gotoPrevNote=function(t){if(!(this.state.context instanceof Ct.zq&&this.state.context.isRestrictProtectOn)){var e=this.notesManager.getPrevNote(t);e&&this.gotoRange(new p.GCPRange(e.gcpEnd-1,0))}},t}(),$n=function(){function t(){this.description="Error Merge Group"}return t.prototype.fixDelta=function(t,e){var r,n,o=t.getDataStream().getTableStream().getMergedMapping(e.range.begin(),e.property.nestingLevel);if(!o)return null;var a=o.getErrorCells();if(0===a.length)return null;var s=on.createTable(t,e.range.begin());if(!s)return null;var l=function(t,e){var r=s.rows[t];if(!r)return"continue";var n=r.cells.find((function(t){return t.interval.begin===e}));if(!n)return"continue";n.clearVMerge()};try{for(var p=(0,i.__values)(a),c=p.next();!c.done;c=p.next()){var u=c.value;l(u.rowIndex,u.colBegin)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}var g=t.delta();return s.toDelta(g),g},t.prototype.check=function(t,e,r){var n=t.getTableStream(),o=n.getTableInfo(e.range.begin());if(!o)return!0;var i=n.getMergedMapping(e.range.begin(),o.property.nestingLevel);return!(!i||i.getErrorMergedCells().length>0)},t.prototype.tableValidate=function(t,e,r){if(this.check(t,e,r))return{errors:[]};var n=t.getTableStream().getMergedMapping(e.range.begin(),e.property.nestingLevel);if(!n)return{errors:[{errorType:h.kz.Fatal,reportModule:h.bg.TABLE,message:"".concat(this.description,": build merged map error"),needFix:!0}],isBreak:!0};var o=n.getErrorMergedCells().length;return{errors:[{errorType:h.kz.Fatal,reportModule:h.bg.TABLE,message:"".concat(this.description,": error continue cells ").concat(o),needFix:!0}],isBreak:!0}},t}(),to=function(){function t(){}return t.prototype.fixDelta=function(){return null},t.prototype.tableValidate=function(t,e){for(var r=t.getTableStream(),n=t.getTextStream(),o=r.createTableIterator({nestingLevel:e.property.nestingLevel});o.hasNext();){var i=o.getRange(),a=n.readText(i.begin(),1)!==p.PlaceholderChar.TableStart,s=n.readText(i.end()-1,1)!==p.PlaceholderChar.TableEnd;if(a||s)return{errors:[{errorType:h.kz.Fatal,reportModule:h.bg.TABLE,message:"".concat(this.description,": error ").concat(a?"start":"end"," placeholder"),needFix:!1}],isBreak:!0};if(i.len<5)return{errors:[{errorType:h.kz.Fatal,reportModule:h.bg.TABLE,message:"".concat(this.description,": the contents of table are empty"),needFix:!1}],isBreak:!0};o.next()}return{errors:[]}},t}(),eo=function(){function t(){this.description="TableStructure",this.errorCells=[],this.errorRows=[],this.tableStartPrevPositions=[]}return t.prototype.tablePrePlaceholderCheck=function(t){return!(!t.includes(p.PlaceholderChar.SdtStart)||t.includes(p.PlaceholderChar.SdtEnd))},t.prototype.check=function(t,e,r){if(this.errorCells.length>0)return!1;var n=t.getTableStream(),o=t.getTextStream(),i=n.getTableParagraphPrefixRange(e),a=!1;if(1!==i.len){var s=o.readText(i.gcpBegin,i.len);this.tablePrePlaceholderCheck(s)||(a=!0)}var l=o.readText(e.contentRange.end()-1,1)!==p.PlaceholderChar.TableRowBreak;a?(this.tableStartPrevPositions.push(e.range.begin()),(0,h.j_)(r,"structure error type:prev-start gcp:".concat(e.range.begin()))):l&&(0,h.j_)(r,"structure error type:prev-end gcp:".concat(e.range.end()));for(var c=e.property.nestingLevel,u=n.createRowIterator({limitRange:e.contentRange,nestingLevel:c});u.hasNext();){for(var g=u.getContentRange(!0),d=n.createCellIterator({limitRange:g,nestingLevel:c}),y=0,f=0;d.hasNext();){var v=d.getContentRange(!0);v.isEmpty()&&this.errorCells.push(v.begin()),o.readText(v.end()-1,1)!==p.PlaceholderChar.ParagraphReturn&&(this.errorCells.push(v.end()),(0,h.j_)(r,"char before cell-break invalid gcp:".concat(v.end()-1))),y+=1,f+=d.getRange(!0).len,d.next()}0===y&&this.errorRows.push(u.getRange(!0)),f!==g.len&&(0,h.j_)(r,"cell length not match row"),o.readText(g.end()-1,1)!==p.PlaceholderChar.TableCellBreak&&(0,h.j_)(r,"char before row-break invalid gcp:".concat(g.end()-1)),u.next()}return 0===this.errorCells.length&&0===this.errorRows.length&&!a},t.prototype.tableValidate=function(t,e,r){return this.check(t,e,r)?{errors:[]}:{errors:[{errorType:h.kz.Fatal,reportModule:h.bg.TABLE,message:"".concat(this.description," errorCells.length:").concat(this.errorCells.length),needFix:!0}],isBreak:!0}},t.prototype.fixDelta=function(t,e){var r,n;this.reset(),this.tableValidate(t.getDataStream(),e,p.Type.DocModifyText);var o=t.delta(),a=this.errorCells.concat(this.tableStartPrevPositions);a.sort((function(t,e){return e-t}));try{for(var s=(0,i.__values)(a),l=s.next();!l.done;l=s.next()){var c=l.value;h.Gh.insertParagraph(c,new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),o)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return this.reset(),o},t.prototype.reset=function(){this.errorCells=[],this.errorRows=[],this.tableStartPrevPositions=[]},t}(),ro=function(){function t(t,e){var r;this.tableInfo=null,this.state=t,this.handlers=[new eo,new to,new $n],this.tableInfo=this.tableStream.getTableInfo(e.begin()),this.range=(null===(r=this.tableInfo)||void 0===r?void 0:r.range)||e}return Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),t.prototype.check=function(t){var e=this;if(!this.tableInfo)return{errors:[]};try{var r=this.handlers.map((function(r){return r.tableValidate(e.state.getDataStream(),e.tableInfo,t)})),n=r.some((function(t){return!!t.isBreak}));return{errors:r.reduce((function(t,e){return t.concat(e.errors||[])}),[]),isBreak:n}}catch(t){return{errors:[{errorType:h.kz.Fatal,reportModule:h.bg.TABLE,message:"table check with uncaught error",needFix:!1}],isBreak:!0}}},t.prototype.proxyFix=function(){var t=this;this.handlers.forEach((function(e){var r=e.fixDelta(t.state,t.tableInfo);r&&t.state.applyDelta(r)}))},t}(),no=[p.PlaceholderChar.SdtStart],oo=function(){function t(t,e,r){this.actions=[],this.state=t,this.ranges=e,this.delta=t.delta(),this.paraIter=t.getTextStream().createParagraphIterator(),this.currentRange=r}return Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),t.prototype.apply=function(){this.doFixProcess(),this.delta.setCommandType(p.Type.DocModifyTable),this.state.applyDelta(this.delta)},t.prototype.requestFixDelta=function(){return this.doFixProcess(),0===this.delta.operations.length?null:this.delta},t.prototype.doFixProcess=function(){this.processTables(),this.transActionToDelta(),this.currentRange&&this.delta.moveTo(this.currentRange)},t.prototype.processTables=function(){var t,e;if(this.ranges.length){var r=this.ranges[0].begin(),n=this.ranges[this.ranges.length-1].end(),o=this.tableStream.collectAllTablesInRange(new p.GCPRange(r,n-r));if(o)try{for(var a=(0,i.__values)(o),s=a.next();!s.done;s=a.next()){var l=s.value;this.processTable(l)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}}},t.prototype.processTable=function(t){if(this.isInvalidTable(t))this.deleteText(t.range);else{var e=new on(this.state,t);this.processMergedStructure(e),this.processTableStart(t),this.processRows(e),this.processTableContentEnd(e)}},t.prototype.processTableContentEnd=function(t){var e=t.lastRow();if(e){var r=e.getRange().end(),n=t.getContentRange().end();r<n&&this.deleteText(new p.GCPRange(r,n-r))}},t.prototype.processRows=function(t){var e,r,n,o;try{for(var a=(0,i.__values)(t.rows),s=a.next();!s.done;s=a.next()){var l=s.value,c=l.lastCell();if(c){try{for(var u=(n=void 0,(0,i.__values)(l.cells)),g=u.next();!g.done;g=u.next()){var h=g.value.getContentRange().end();this.paraIter.seek(h-1);var d=this.paraIter.getProperty();this.paraIter.getRange().end()===h&&d&&!d.isPlaceholder||this.insertPara(h)}}catch(t){n={error:t}}finally{try{g&&!g.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}var y=l.getRange().end()-1,f=c.getRange().end();y>f&&this.deleteText(new p.GCPRange(f,y-f))}else this.deleteText(l.getRange())}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}},t.prototype.processTableStart=function(t){var e=this.tableStream.getTableParagraphPrefixRange(t);if(1!==(null==e?void 0:e.len)&&0!==t.range.begin()){var r=this.findTablePrePlaceholderPos(t);r>=0?this.insertPara(r):this.insertPara(t.range.begin())}},t.prototype.findTablePrePlaceholderPos=function(t){for(var e=this.tableStream.getTableParagraphPrefixRange(t),r=this.state.getTextStream().readText(e.gcpBegin,e.len),n=0;n<r.length;n++)if(no.indexOf(r[n])>=0)return e.gcpBegin+n;return-1},t.prototype.processMergedStructure=function(t){t.fixMergedStructure(),t.getTableActionManager().consumeActionsToDelta(this.delta)},t.prototype.transActionToDelta=function(){var t,e;this.actions.sort((function(t,e){return e.pos-t.pos}));try{for(var r=(0,i.__values)(this.actions),n=r.next();!n.done;n=r.next())n.value.callback(this.delta)}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.isInvalidTable=function(t){if(t.range.len<5)return!0;for(var e=t.property.nestingLevel,r=this.tableStream.createRowIterator({limitRange:t.contentRange,nestingLevel:e});r.hasNext();){if(this.tableStream.createCellIterator({limitRange:r.getRange(),nestingLevel:e}).hasNext())return!1;r.next()}return!0},t.prototype.insertPara=function(t){var e=this;this.actions.push({pos:t,callback:function(){var r=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));h.Gh.insertParagraph(t,n,r,e.delta),e.expandCurrentRange(t,1)}})},t.prototype.deleteText=function(t){var e=this;this.actions.push({pos:t.begin(),callback:function(){h.Gh.deleteTextForce(t,e.delta),e.shrinkCurrentRange(t)}})},t.prototype.expandCurrentRange=function(t,e){this.currentRange&&(t<=this.currentRange.begin()?this.currentRange.offset(e):t<this.currentRange.end()&&(this.currentRange.len+=e))},t.prototype.shrinkCurrentRange=function(t){if(this.currentRange&&!(t.begin()>=this.currentRange.end()))if(t.end()<this.currentRange.begin())this.currentRange.offset(-t.len);else{var e=Math.max(t.begin(),this.currentRange.begin()),r=this.currentRange.len-t.intersectRange(this.currentRange).len;this.currentRange=new p.GCPRange(e,r)}},t}(),io=function(){function t(t){this.cachedWordCount=0,this.state=t,this.dataEngine=this.state.dataEngine,this.initJustification()}return t.prototype.deltaOption=function(t){return h.C1.createLocalDeltaOption(new p.GCPRange(0,this.textStream.getLength()),!!t)},t.prototype.mainDocDeltaOption=function(){return h.C1.createLocalDeltaOption(this.getMainStoryRange()||new p.GCPRange(0,0),!1)},Object.defineProperty(t.prototype,"textStream",{get:function(){return this.dataEngine.getDataStream().getTextStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mathStream",{get:function(){return this.dataEngine.getDataStream().getMathStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storyStream",{get:function(){return this.dataEngine.getDataStream().getStoryStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.dataEngine.getDataStream().getTableStream()},enumerable:!1,configurable:!0}),t.prototype.initJustification=function(){this.tabJustification=p.STTabJc.left},t.prototype.getTableFromGcp=function(t,e){var r=this.tableStream.getTableInfo(t,e);return r?on.createTable(this.state,r.range.begin(),r.property.nestingLevel):null},t.prototype.hasTable=function(t,e){return!!this.tableStream.getTableInfo(t,e)},t.prototype.hasEmptyTable=function(){for(var t=this.tableStream.createTableIterator();t.hasNext();){if(t.getContentRange(!0).isEmpty())return!0;t.next()}return!1},t.prototype.getTableCount=function(t,e){for(var r=this.tableStream.createTableIterator({limitRange:t,nestingLevel:e}),n=0;r.hasNext();)n+=1,r.next();return n},t.prototype.getSubtableCountFromGcp=function(t,e){return this.getTableCount(t,e)},t.prototype.getListInfoFromGcpRange=function(t){return this.state.dataEngine.getDataManager().getNumberingManager()?this.state.dataEngine.getDataManager().getNumberingManager().getListInfoFromGcpRange(t):null},t.prototype.getListInfoArrayFromGcpRange=function(t){return this.state.dataEngine.getDataManager().getNumberingManager()?this.state.dataEngine.getDataManager().getNumberingManager().getListInfoArrayFromGcpRange(t):[]},t.prototype.getFields=function(){return Fn.createStateFields(this.state,this.deltaOption())},t.prototype.getSpans=function(){return Fr.createStateSpans(this.state,this.deltaOption())},t.prototype.getParagraphs=function(){return Ar.createStateParagraphs(this.state,this.deltaOption())},t.prototype.getSdts=function(){return Wn.create(this.state)},t.prototype.getSdt=function(t,e){var r;if(e)r=e;else if(!(r=this.state.getDataStream().getSdtStream().getSdtInfo(t)))return null;return Hn(this.state,r)},t.prototype.setSectionFormat=function(t){this.getSectionFormat().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return Br.createStateSectionFormat(this.state,this.mainDocDeltaOption())},t.prototype.getSections=function(){return Or.createStateSections(this.state,this.mainDocDeltaOption())},t.prototype.getTableService=function(t,e,r){var n=this.getTableFromGcp(t.begin(),e);return n?Jn.create(this.state,this.deltaOption(r),n):null},t.prototype.getRange=function(t,e,r){return Vn.createStateRange(this.state,new p.GCPRange(t,e-t),null==r?void 0:r.updateSelection,null==r?void 0:r.fixRange)},t.prototype.getSelection=function(){return zn.createStateSelection(this.state)},t.prototype.select=function(){Vn.createStateRange(this.state,this.state.selection.gcpRange).wholeStory()},t.prototype.getInlineShapes=function(){return Ur.createStateInlineShapes(this.state,this.deltaOption())},t.prototype.getInlinePlugins=function(){return Qr.createStateInlinePlugins(this.state,this.deltaOption())},t.prototype.getTextframes=function(){return Kr.create(this.state,this.deltaOption())},t.prototype.getCodeblocks=function(){return Yr.create(this.state,this.deltaOption())},t.prototype.getShapes=function(){return Wr.create(this.state,this.deltaOption())},t.prototype.onCompositionStart=function(t){this.state.compositionStart(t)},t.prototype.onCompositionUpdate=function(t,e){this.state.compositionUpdate(t,e)},t.prototype.onCompositionEnd=function(t,e){this.state.compositionEnd(t,e)},t.prototype.getRunPropertyFromGCPRange=function(t){var e=this.state.getTextStream().createRunIterator(t),r=[];do{var n=e.getProperty();n&&r.push(n)}while(e.next());return r},t.prototype.isCanBeReplace=function(t){var e=this.state.dataEngine.getDataStream().getFieldStream(),r=e.getDecodedFieldInfo(t.begin());return r?r.layoutType===p.FieldLayoutType.Text:!(null==e?void 0:e.isRangeInField(t))},t.prototype.createTargetRegExp=function(t){var e,r,n=[p.PlaceholderChar.CommentReference],o="[".concat(n.join("|"),"]*"),a="\\[".concat(n.join("\\|"),"\\]\\*"),s=t.split(""),l="";try{for(var c=(0,i.__values)(s.entries()),u=c.next();!u.done;u=c.next()){var g=(0,i.__read)(u.value,2),h=g[0],d=g[1];h!==s.length-1?l+=d+o:l+=d}}catch(t){e={error:t}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}var y=new RegExp("(?:".concat(a,"|[-\\/\\\\^$*+?.()|\\[\\]{}])"),"g"),f=l.replace(y,(function(t){return t===o?t:"\\".concat(t)}));return new RegExp("".concat(f),"gi")},t.prototype.search=function(t){var e,r=[],n=[],o=[],a=this.createTargetRegExp(t),s=new RegExp("".concat(p.PlaceholderChar.DrawingAnchor),"gi"),l=new RegExp("".concat(p.PlaceholderChar.FootnoteEndnoteReference),"gi"),u=this.textStream.createParagraphIterator();u.seek(0);do{var g=u.getContentRange(),h=this.textStream.readText(g.begin(),g.length());if(g.begin()>=this.getDocumentEndPos())break;if(!this.isInCommentRange(g.begin())&&!(null===(e=u.getProperty())||void 0===e?void 0:e.isOMathPara))for(var d=a.exec(h),y=s.exec(h),f=l.exec(h);d||y||f;)if(d){var v=this.searchInParagraph(d,g);v&&(this.mathStream.getMathInfo(v.realRange.begin(),1)||r.push(v)),d=a.exec(h)}else if(y){var m=this.searchInPlaceholderSubStory(t,y,g,a);m.length>0&&(r=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(r),!1),(0,i.__read)(m),!1)),y=s.exec(h)}else if(f){var P=this.searchInNoteSubStory(t,f,g,a);if(P){var T=P.noteType,S=P.ranges;T===c.wK_.ENDNOTE?o=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(o),!1),(0,i.__read)(S),!1):n=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(n),!1),(0,i.__read)(S),!1)}f=l.exec(h)}}while(u.hasNext()&&u.next());var C=(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(r),!1),(0,i.__read)(n),!1),(0,i.__read)(o),!1),b=this.state.getRevisionsManager();return b.getRevisionModelWrapper().existTextLenRevision?C.filter((function(t){return!b.getRevisionStatusHelper().isAllContentRevisionHidden(t.realRange)})):C},t.prototype.searchInParagraph=function(t,e){var r=this.state.dataEngine.getDataStream().getFieldStream(),n=new p.GCPRange(e.begin()+t.index,t[0].length),o=r&&r.getFieldRange(n.begin());if(null==r?void 0:r.isRangeInField(n)){var i=null==r?void 0:r.getDecodedFieldInfo(n.begin()),a=i.fieldResult,s=i.isAutoUpdate,l=i.layoutType,c=i.displayLayoutType;if((null==a?void 0:a.range.contains(n))&&!s&&(l!==p.FieldLayoutType.Container||c===p.FieldDisplayLayoutTypeChar.Inline))return{logicalRange:n,realRange:n}}else{if(!o)return{logicalRange:n,realRange:n};if(o.fieldResultRange.contains(n))return{logicalRange:n,realRange:n}}},t.prototype.searchInPlaceholderSubStory=function(t,e,r,n){var o,a=[],s=new p.GCPRange(r.begin()+e.index,p.PlaceholderChar.DrawingAnchor.length),l=null===(o=this.dataEngine.getDataStream().getDrawingStream().getDrawingInfoFromGcp(s.begin()))||void 0===o?void 0:o.property;if(l&&l.hasContentId()){var c=this.storyStream.getSubStoryInfoFromId(l.drawing.graphic.graphicData.wsp.txbx.contentId);if(c){var u=this.searchInSubStory(t,s,c.range,n);a=(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(a),!1),(0,i.__read)(u),!1)}}return a},t.prototype.searchInNoteSubStory=function(t,e,r,n){var o=new p.GCPRange(r.begin()+e.index,p.PlaceholderChar.FootnoteEndnoteReference.length),i=new Zn(this.state),a=i.getNoteIdFromMainStoryGCP(o.begin()),s=i.getMainStoryNoteType(o.begin());if(!a||!s)return null;var l=i.getNoteSubStoryInfoFromId(a);return l?{noteType:s,ranges:this.searchInSubStory(t,o,l.range,n)}:null},t.prototype.searchInSubStory=function(t,e,r,n){for(var o=[],i=this.state.dataEngine.getDataStream().getFieldStream(),a=this.textStream.readText(r.begin(),r.length()),s=n.exec(a);s;){var l=new p.GCPRange(r.begin()+s.index,t.length),c=i&&i.getFieldRange(l.begin());c?c.fieldResultRange.contains(l)&&o.push({logicalRange:e,realRange:l,isStory:!0}):o.push({logicalRange:e,realRange:l,isStory:!0}),s=n.exec(a)}return o},t.prototype.replaceAll=function(t,e,r){for(var n=this.state.delta(),o=0,i=t.length-1;i>=0;i--){var a=t[i].clone();if(this.isCanBeReplace(a))if(h.Gh.deleteText(a,n),o+=1,r){var s=a.length(),l=this.textStream.createRunIterator(a),c=a.begin();do{var u=l.getCloneProperty();if(s!==e.length&&u){h.Gh.insertText(c,e,u,n);break}var g=c-a.begin(),d=l.getContentRange(),y=d.gcpBegin+d.length()-g-a.begin();u&&(h.Gh.insertNormalTextVaild(e.substr(g,y)),h.Gh.insertText(c,e.substr(g,y),u,n)),c+=y}while(l.next())}else{var f=this.state.followSpanProp(a.begin());f&&(h.Gh.insertNormalTextVaild(e),h.Gh.insertText(a.begin(),e,f,n))}}return n.setCommandType(p.Type.DocReplaceAllText),this.state.applyDelta(n),o},t.prototype.countWord=function(t){if(void 0===t&&(t=!1),t)return this.cachedWordCount;var e=0,r=this.storyStream.getMainStoryInfo();if(null===r)return this.cachedWordCount=0,this.cachedWordCount;var n=this.textStream.createParagraphIterator(r.contentRange);do{var i=n.getRange(),a=this.textStream.readText(i.begin(),i.length());e+=o.m7.countWordReg(a)}while(n.next());return this.cachedWordCount=e-1,this.cachedWordCount},t.prototype.readText=function(t,e){return this.state.getTextStream().readText(t,e)},t.prototype.docIsEmpty=function(){var t=this.textStream.readText(0,11);return["\0","\r\0","\r\0","\r\r\0"].indexOf(t)>-1},t.prototype.getCurLastStoryEndPos=function(t){return this.storyStream.getStoryLastPos(t)},t.prototype.getFirstParamText=function(){return this.state.context.getFirstParaText()},t.prototype.getFirstParaTextRegardless=function(){return this.state.context.getFirstParaTextRegardless()},t.prototype.getFirstParaRange=function(){return this.state.context.getFirstParaRange()},t.prototype.isParaEmpty=function(t){return this.state.context.isParaEmpty(t)},t.prototype.isInCommentRange=function(t){var e=this.storyStream.getStoryInfoFromGcp(t);return(null==e?void 0:e.storyProp.storyType)===p.STStoryType.commentContent},t.prototype.getCommandTypeFromStoryType=function(t){var e=p.Type.Empty;switch(t){case p.STStoryType.headerContent:e=p.Type.DocInsertHeader;break;case p.STStoryType.footerContent:e=p.Type.DocInsertFooter;break;case p.STStoryType.footnoteContent:e=p.Type.DocInsertFootnote;break;case p.STStoryType.endnoteContent:e=p.Type.DocInsertEndnote;break;case p.STStoryType.commentContent:e=p.Type.DocInsertComment;break;case p.STStoryType.textboxContent:e=p.Type.DocInsertTextbox}return e},t.prototype.insertStory=function(t,e,r,n){if(this.state){var o=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1).buildDelta();o.setCommandType(this.getCommandTypeFromStoryType(t));var i=Be.createStoryPropertyFromType(t);if(i){i.id=e;var a=this.storyStream.getStoryLastPos(t);a!==Be.defaultCp&&(h.Gh.insertSubStory(a,i,p.PlaceholderChar.SubStoryBegin,o,p.PropUpdateMode.Insert),h.Gh.insertParagraph(o.currentRange().end(),n||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),r||new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),o),h.Gh.insertSubStory(o.currentRange().end(),i.clone(),p.PlaceholderChar.SubStoryEnd,o,p.PropUpdateMode.Insert),this.state.applyDelta(o))}}},t.prototype.getSubStoryInfoFromId=function(t,e,r){return this.storyStream.getSubStoryInfoFromId(t,e,r)},t.prototype.toApplyDelta=function(t){this.state.applyDelta(t)},t.prototype.getParamInfoFromGcpRange=function(t){var e=this.textStream.createParagraphIterator();e.seek(t.begin());var r=e.getRange().begin();e.seek(t.end()-1);var n=e.getRange().end()-r;return{content:this.textStream.readText(r,n),range:new p.GCPRange(r,n)}},t.prototype.findContentFromId=function(t,e,r){var n=r||this.storyStream.getSubStoryInfoFromId(t,e);if(n){var o=n.contentRange;return this.textStream.readText(o.begin(),o.length())}return""},t.prototype.getStoryLastPos=function(t){return this.storyStream.getStoryLastPos(t)},t.prototype.getIndentFromGcp=function(t){var e=this.getParamInfoFromGcpRange(new p.GCPRange(t,0)),r=e.content,n=e.range;if(r&&r.length>0){var o=r.match(/^ +/g);if(o&&o.length>0)return new p.GCPRange(n.begin(),o[0].length)}return new p.GCPRange(n.begin(),0)},t.prototype.getLineNumber=function(t,e){var r=this.storyStream.getSubStoryInfoFromId(e,t);if(r){var n=0,o=this.textStream.createParagraphIterator(r.contentRange);do{n+=1}while(o.next());return n}return 0},t.prototype.getSubStoryInfoFromGcp=function(t){return this.storyStream.getSubStoryInfoFromGcp(t)},t.prototype.removeContainerStories=function(t,e){var r=this,n=[],o=this.storyStream.createSubStoryIterator();do{var i=o.getProperty();i&&t.includes(i.id)&&n.push(o.getRange())}while(o.hasNext()&&o.next());if(n.length>0){var a=this.deltaOption().buildDelta();a.setCommandType(e),n.reverse().forEach((function(t){r.state.deleteText(t,a,{preventTextTrackChanges:!0})})),this.state.applyDelta(a)}},t.prototype.getShadingProperty=function(){return this.state.dataEngine.getDataManager().getSettingsManager().getShadingProperty()},t.prototype.setDocSettingProperty=function(t,e){var r=e||h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1).buildDelta();r.setCommandType(p.Type.DocSetSettings),h.Gh.setSettingProperty(t,p.ModifyType.settings,r),r.moveTo(this.state.selection.gcpRange),this.state.applyDelta(r)},t.prototype.collectSpans=function(t,e){var r=[],n=this.textStream.createRunIterator(e);do{var o=n.getProperty();if(o){var i=n.getRange();t(o,i)&&r.push(i)}}while(n.next());return r},t.prototype.collectOutlineParagraph=function(t){var e=this,r=t.limitRange,n=t.maxTextLength,o=void 0===n?200:n,i=t.getRefText,a=t.collectSpanProp,s=void 0!==a&&a,l=[],c=this.storyStream.getMainStoryInfo();if(null===c||r&&!c.range.contains(r))return l;var u=null!=r?r:c.range;this.state.dataEngine.getIsChunkLoading()&&(u=new p.GCPRange(u.begin(),this.state.dataEngine.getGCPChunkEnd()));var g=this.state.dataEngine.getDataManager().getStyleSheetManager();return this.state.getRevisionsManager().getRevisionBusinessHelper().forEachMergedParaInfos({searchRange:u,cb:function(t){var r=t.range,n=t.contentRange,a=t.property,c=n.end();if(a){var u=e.getMergedStyleOutlineLvl(g,a).outlineLvl;if(u!==p.STOutlineLvl.LevelNone&&!e.tableStream.getTableInfo(c)){var h=g.mergeStyleParaPropWithGcp(a,c);if(h&&u!==p.STOutlineLvl.LevelNone){var d=e.getOutlineFromStream(h,r,u,o,i,s);d.text!==p.PlaceholderChar.SectionBreak&&l.push(d)}}}}}),l},t.prototype.getMergedStyleOutlineLvl=function(t,e){var r=e.has(e.tKeys.outlineLvl)?e.outlineLvl.val:p.STOutlineLvl.LevelNone;return t.traceToParagraphBaseStyle(e,(function(t,e){var n;if(r===p.STOutlineLvl.LevelNone&&t.has(t.tKeys.outlineLvl)&&t.outlineLvl.val!==p.STOutlineLvl.LevelNone)return r=t.outlineLvl.val,!0;var o=p.OutlineToLvlMap[null!==(n=null==e?void 0:e.toLowerCase())&&void 0!==n?n:""];return void 0!==o&&(r=o,!0)}),!0),{outlineLvl:r}},t.prototype.getTableFixer=function(t){return new ro(this.state,t)},t.prototype.convertToTableRanges=function(t){return this.tableStream.convertToTableRanges(t)},t.prototype.getOutlineFromStream=function(t,e,r,n,o,i){var a=this;void 0===i&&(i=!1);var s=this.state.dataEngine.getDataManager().getNumberingManager(),l=this.textStream.createRunIterator(),c=this.state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(t.pStyle.val),u="";if(o){u=o(e).replace(/\r\n?/g,""),l.seek(e.begin());var g=i&&l.getCloneProperty()||void 0;return{text:u,range:e,outlineLevel:r,styleName:(null==c?void 0:c.name.val)||"",paraId:t.paraId,spanProp:g}}u+=this.getListInfoActualText(s,t,e);var h=!0;l.setLimitRange(new p.GCPRange(e.begin(),e.length()));var d=i&&l.getCloneProperty()||void 0,y=!0,f="",v=function(){var t=l.getRange(!0),r=m.textStream.readText(t.begin(),t.len);if(y=m.updateIsFieldCodeComplete(r,y),m.notContainsSpecialChar(r))!f&&y?u+=r:f+=r,h=!1;else if(m.containsDrawingType(r)){var n=p.PropertyUtil.findPlaceholderCharProperty(m.dataEngine.getDataStream(),t.begin());if(n instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)){var o=m.collectOutlineFromDrawingType(n);u+=o,h=!o}}else if(h){var i=0,s=!0,c=Array.from(r).filter((function(t){return a.notContainsSpecialChar(t)?(s=!1,!0):(s&&(i+=1),!1)}));u+=c.join(""),e.gcpBegin+=i,e.len-=i}y&&f&&(u+=p.FieldCodeManager.filterFieldCode(f),f="")},m=this;do{v()}while(l.next()&&(u.length<n||!y));return{text:u,range:e,outlineLevel:r,styleName:(null==c?void 0:c.name.val)||"",paraId:t.paraId,spanProp:d}},t.prototype.getListInfoActualText=function(t,e,r){if(null==t?void 0:t.isListParagraph(e)){var n=t.getListInfoFromGcpRange(r);if(null==n?void 0:n.actualText)return"".concat(n.actualText," ")}return""},t.prototype.updateIsFieldCodeComplete=function(t,e){var r=e;return t===p.PlaceholderChar.FieldBegin&&(r=!1),t===p.PlaceholderChar.FieldEnd&&(r=!0),r},t.prototype.notContainsSpecialChar=function(t){if(!t)return!1;var e=t.charCodeAt(0);return!(isNaN(e)||e!==p.PlaceholderCharCode.FieldBegin&&e!==p.PlaceholderCharCode.FieldSeparate&&e!==p.PlaceholderCharCode.FieldEnd&&(0,p.isDontRenderChar)(e))},t.prototype.containsDrawingType=function(t){return t===p.PlaceholderChar.DrawingAnchor},t.prototype.collectOutlineWithoutTitleSubtitle=function(t){void 0===t&&(t=200);var e=[],r=this.storyStream.getMainStoryInfo();if(null===r)return e;var n=this.textStream.createRunIterator(),o=this.textStream.createParagraphIterator(r.range);do{var i=o.getProperty();if(i&&(i=this.state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParaPropWithGcp(i,o.getRange().begin())),i&&i.outlineLvl.val!==p.STOutlineLvl.LevelNone){var a=i instanceof p.ListInfo?i.paragraphStyle:i.pStyle.val;if(a===p.BuiltinStyleName.Title||a===p.BuiltinStyleName.Subtitle)continue;var s=o.getRange(),l="";l+=this.collectList(i,s),n.setLimitRange(new p.GCPRange(s.begin(),s.length())),l+=this.getSpanText(n,s,t),l=p.FieldUtil.getFilterFieldCodeText(l);var c=this.state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(i.pStyle.val),u={text:l,range:s,outlineLevel:i.outlineLvl.val,styleName:(null==c?void 0:c.name.val)||"",paraId:i.paraId};e.push(u)}}while(o.next());return e},t.prototype.getSpanText=function(t,e,r){var n,o=!0,i="";do{o=(n=this.collectSpanText(t,e)).isFieldCodeComplete,i+=n.newText}while(t.next()&&(i.length<r||!o));return i},t.prototype.collectSpanText=function(t,e){var r=t.getRange(!0),n=this.textStream.readText(r.begin(),r.len),o=!0,i="",a=e,s=this.isFieldCodeComplete(n);if([p.PlaceholderChar.DrawingAnchor,p.PlaceholderChar.SectionBreak,p.PlaceholderChar.PageBreak].includes(n))if(this.containsDrawingType(n)){var l=p.PropertyUtil.findPlaceholderCharProperty(this.dataEngine.getDataStream(),r.begin());if(l instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)){var c=this.collectOutlineFromDrawingType(l);i+=c,o=!c}}else o&&(a.gcpBegin+=r.length(),a.len-=r.length());else i+=n,o=!1;return{isFieldCodeComplete:s,newText:i}},t.prototype.collectList=function(t,e){var r="",n=this.state.dataEngine.getDataManager().getNumberingManager();if(null==n?void 0:n.isListParagraph(t)){var o=n.getListInfoFromGcpRange(e);(null==o?void 0:o.isNumbered)&&o.actualText&&(r+="".concat(o.actualText," "))}return r},t.prototype.collectOutlineFromDrawingType=function(t){var e="",r=t.drawingType;if(r===p.DrawingType.Picture)switch(t.drawing.addonSource){case p.STAddonSourceType.latex:e="[公式]";break;case p.STAddonSourceType.sign:case p.STAddonSourceType.signbar:e="[电子签名]";break;default:e="[图片]"}else if(r===p.DrawingType.WordprocessingShape){var n=t.drawing.graphic.graphicData.wsp.txbx.contentId,o=this.state.getStoryStream().getSubStoryInfoFromId(n,p.STStoryType.textboxContent);if((null==o?void 0:o.subStoryProp)&&o.subStoryProp instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty)){var i=o.subStoryProp;(i.textBoxType===p.TextFrameType.CodeBlock||i.has(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTextBoxStoryPr).tKeys.language))&&(e="[代码块]"),i.textBoxType===p.TextFrameType.LightBlock&&(e="[高亮块]")}else e="[图形]"}return e},t.prototype.collectOutLineFromParaPropertyType=function(t){return t.pBdr.bottom?"[分割线]":""},t.prototype.getMainStoryRange=function(){var t=this.storyStream.getMainStoryInfo();return null==t?void 0:t.contentRange},t.prototype.isFieldCodeComplete=function(t){return t===p.PlaceholderChar.FieldEnd},t.prototype.getParaCount=function(){var t=0,e=this.storyStream.getMainStoryInfo();if(null===e)return t;for(var r=this.textStream.createParagraphIterator(e.contentRange);r.next();)t+=1;return t},t.prototype.isParaCountMoreThan=function(t){var e=0,r=this.storyStream.getMainStoryInfo();if(null===r)return!1;for(var n=this.textStream.createParagraphIterator(r.contentRange);n.next();){if(e+1>t)return!0;e+=1}return!1},t.prototype.getTextFromGcpRange=function(t){return this.textStream.readText(t.begin(),t.length())},t.prototype.getTextStyleAtRange=function(t){var e=this.state.getTextStream().createRunIterator(t),r=[];do{var n=e.getCloneProperty();n&&r.push(n)}while(e.next());return r},t.prototype.nextTextBreak=function(t){return l._l.previousTextBreak(this.textStream,t)},t.prototype.previousTextBreak=function(t){return l._l.previousTextBreak(this.textStream,t)},t.prototype.getParaStyleAtRange=function(t,e){void 0===e&&(e=!1);var r=this.textStream.createParagraphIterator(t),n=this.state.dataEngine.getDataManager().getStyleSheetManager(),o=[];do{var i=r.getCloneProperty();i&&(i=e?n.mergeStyleParaPropWithGcp(i,t.begin()):i,o.push(i))}while(r.next());return o},t.prototype.getDocumentLength=function(){return this.textStream.getLength()},t.prototype.collectDiffRanges=function(){var t,e,r,n=this.textStream.createRunIterator(),o=[];do{var i=n.getRange(),a=n.getCloneProperty();if(a&&a.diff){var s=o[o.length-1];s&&s[0].end()===i.begin()&&(r=a,(e=t).diff&&e.diff===r.diff&&e.author===r.author)?s[0].len+=i.len:a.isPlaceholder&&(0,p.isLineBreaker)(this.textStream.charCodeAt(0))||(t=a,o.push([i,a.author]))}}while(n.next());return o},t.prototype.getPlaceholderGcp=function(t){var e;return null===(e=this.dataEngine.getDataStream().getDrawingStream().getDrawingInfoFromContentId(t))||void 0===e?void 0:e.range},t.prototype.generateStyleProperty=function(t,e){var r=this.state.dataEngine.getDataManager().getStyleSheetManager();return Be.generateStyleProperty(t,r,e)},Object.defineProperty(t.prototype,"storyId",{get:function(){return this.state.selection.subStoryInfo.subStoryProp.id},enumerable:!1,configurable:!0}),t.prototype.clearIteratorCache=function(){_r.clearIteratorCache()},t.prototype.collectListInfo=function(t){var e=this.state.dataEngine.getDataManager().getNumberingManager();return(null==e?void 0:e.collectListInfo(t))||null},t.prototype.getDocumentEndPos=function(){var t=this.storyStream.getMainStoryInfo();return null===t?1:t.contentRange.end()-1},t.prototype.isSelectionAtTextFrame=function(t,e){var r=this.storyStream.getSubStoryInfoFromGcp(t);if(!r)return!1;var n=r.storyProp,o=r.subStoryProp,i=n.storyType===p.STStoryType.textboxContent,a=p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty);return e?i&&o instanceof a&&o.textBoxType===e:i&&o instanceof a},t.prototype.isSelectionAtCodeblock=function(t){return this.isSelectionAtTextFrame(t,p.TextFrameType.CodeBlock)},t.prototype.isSelectionAtLightblock=function(t){var e=this.storyStream.getSubStoryInfoFromGcp(t);if(!e)return!1;var r=e.storyProp,n=e.subStoryProp;return r.storyType===p.STStoryType.textboxContent&&n instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty)&&n.isLightBlock},t.prototype.getDocSettingsProperty=function(){return this.state.dataEngine.getDataManager().getSettingsManager().getDocSettingsProperty()},t.prototype.getConstraintSpace=function(){return this.state.context.constraintSpace},t.prototype.getDefaultTabStopPos=function(){return this.state.dataEngine.getDataManager().getSettingsManager().getDocSettingsProperty().defaultTabStop.val||p.Defaults.tabSize},t.prototype.getSelectionFrameType=function(t){var e=this.storyStream.getSubStoryInfoFromGcp(t);if(e){var r=e.storyProp,n=e.subStoryProp;return r.storyType===p.STStoryType.textboxContent&&n instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty)?n.textBoxType:void 0}},t.prototype.getTabJustification=function(){return this.tabJustification},t.prototype.setTabJustification=function(t){this.tabJustification=t},t.prototype.requestTableFixDelta=function(t,e){return function(t,e,r){return new oo(t,e,r).requestFixDelta()}(this.state,t,e)},t}(),ao=r(283317),so=function(){function t(t,e){this._state=t,this._dataStream=this._state.getDataStream(),this.document=e}return t.prototype.applyDelta=function(t){t.setMutOption({preventTextTrackChanges:!0,preventFormatTrackChanges:!0}),this._state.applyDelta(t)},t.prototype.getCheckText=function(){var t,e,r="",n=this._dataStream.getStoryStream().getMainStoryInfo();if(null===n)return"";var o=this._dataStream.getTextStream().createParagraphIterator(n.range);do{var a=o.getRange(),s=this.document.getRange(a.begin(),a.end(),{fixRange:!1}).getSpans();try{for(var l=(t=void 0,(0,i.__values)((0,i.__spreadArray)([],(0,i.__read)(s),!1))),p=l.next();!p.done;p=l.next()){var c=p.value,u=c.getRange(),g=this.document.getTextFromGcpRange(u),h=c.getFont().getAttributes(!1),d=this.isValid(g,h,u),y=d.translatable,f=d.preservable;y&&f&&(r+=g)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}if((r+="\n").length>100){r=r.substring(0,100);break}}while(o.next());return r},t.prototype.insertSection=function(t,e,r,n){if(e&&r&&n){var o=h.C1.createServerDeltaOption(new p.GCPRange(t,0)).buildDelta();o.globalOpts.fromServer=!1,o.setUpdateSelection(!1),h.Gh.insertSection(o.currentRange().end(),e,n,r,o),this.applyDelta(o)}},t.prototype.insertParagraph=function(t,e){var r=h.C1.createLocalDeltaOption(new p.GCPRange(t,0)).buildDelta();r.setUpdateSelection(!1),this.buildDeltaTranslate(r,e);var n=r.currentRange().end();return this.applyDelta(r),n},t.prototype.deleteLastParaBreak=function(t){var e=h.C1.createLocalDeltaOption(new p.GCPRange(t,0)).buildDelta();return e.setUpdateSelection(!1),h.Gh.deleteText(new p.GCPRange(t,1),e),this.applyDelta(e),t},t.prototype.replaceDiff=function(t,e){var r=h.C1.createLocalDeltaOption(t).buildDelta();r.setUpdateSelection(!1),h.Gh.deleteText(t,r),this.buildDeltaTranslate(r,e),this.applyDelta(r)},t.prototype.isFieldBegin=function(t){return!(!t||t!==p.PlaceholderChar.FieldBegin)},t.prototype.isFieldSeparate=function(t){return!(!t||t!==p.PlaceholderChar.FieldSeparate)},t.prototype.isFieldEnd=function(t){return!(!t||t!==p.PlaceholderChar.FieldEnd)},t.prototype.isDrawingAnchor=function(t){return!(!t||t!==p.PlaceholderChar.DrawingAnchor)},t.prototype.isTableCell=function(t){return!(!t||t!==p.PlaceholderChar.TableCellBreak)},t.prototype.isTableRow=function(t){return!(!t||t!==p.PlaceholderChar.TableRowBreak)},t.prototype.isTableStart=function(t){return!(!t||t!==p.PlaceholderChar.TableStart)},t.prototype.isTableEnd=function(t){return!(!t||t!==p.PlaceholderChar.TableEnd)},t.prototype.isMathBegin=function(t){return!(!t||t!==p.PlaceholderChar.MathBegin)},t.prototype.isMathEnd=function(t){return!(!t||t!==p.PlaceholderChar.MathEnd)},t.prototype.isParagraphEnd=function(t){return!(!t||t!==p.PlaceholderChar.ParagraphBreak&&t!==p.PlaceholderChar.ParagraphReturn)},t.prototype.isTextRun=function(t){return!(!t||!(0,p.isNormalText)(t))||this.isTabRun(t)},t.prototype.isTabRun=function(t){return!(!t||t!==p.PlaceholderChar.Tab)},t.prototype.isContainFieldCode=function(t){var e=Object.keys(p.FieldName),r=!1;return e.forEach((function(e){t.includes(e)&&(r=!0)})),r},t.prototype.getTableProperty=function(t){var e;return(null===(e=this._dataStream.getTableStream().getTableInfo(t.begin()))||void 0===e?void 0:e.property)||new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableProperty))},t.prototype.getTableRowProperty=function(t){var e;return(null===(e=this._dataStream.getTableStream().getRowInfo(t.begin()))||void 0===e?void 0:e.property)||new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableRowProperty))},t.prototype.getTableCellProperty=function(t){var e;return(null===(e=this._dataStream.getTableStream().getCellInfo(t.begin()))||void 0===e?void 0:e.property)||new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty))},t.prototype.getMathProperty=function(t){var e,r;return null!==(r=null===(e=this._dataStream.getMathStream().getMathInfo(t.begin()))||void 0===e?void 0:e.property)&&void 0!==r?r:new(p.PropertyFactory.getPropertyClass(p.PropertyType.MathProperty))},t.prototype.getDrawingProperty=function(t){var e=p.PropertyUtil.findPlaceholderCharProperty(this._dataStream,t.begin());return e instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)?e:new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty))},t.prototype.buildDeltaTranslate=function(t,e){var r=this;e.forEach((function(e,n){var i=e.text,a=e.translateText,s=e.itemProp;if(s){var l=p.PropertyFactory.getPropertyClass(p.PropertyType.FieldCharProperty);if(r.isParagraphEnd(i)){var c=s.paragraphProp||new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));h.Gh.insertParagraph(t.currentRange().end(),s.runProp,c,t)}else r.isTextRun(i)?h.Gh.insertText(t.currentRange().end(),o.m7.isEmpty(a)?i:a,s.runProp,t):r.isTableStart(i)?h.Gh.insertTableStart(t.currentRange().end(),t,new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableProperty))(s.contentProp),s.paragraphProp):r.isTableEnd(i)?(c=s.contentProp||new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableProperty)),h.Gh.insertTableEnd(t.currentRange().end(),c,t,s.paragraphProp)):r.isTableRow(i)?(c=s.contentProp||new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableRowProperty)),h.Gh.insertTableRow(t.currentRange().end(),c,t,s.paragraphProp)):r.isTableCell(i)?(c=s.contentProp||new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableCellProperty)),h.Gh.insertTableCell(t.currentRange().end(),c,t,s.paragraphProp)):(r.isFieldBegin(i)||r.isFieldSeparate(i)||r.isFieldEnd(i))&&s.contentProp instanceof l?h.Gh.insertFieldChar(t.currentRange().end(),s.runProp,s.contentProp,t):r.isMathBegin(i)?(c=s.contentProp||new(p.PropertyFactory.getPropertyClass(p.PropertyType.MathProperty)),h.Gh.insertMath(t.currentRange().end(),c,s.runProp,t)):r.isMathEnd(i)?(c=s.contentProp||new(p.PropertyFactory.getPropertyClass(p.PropertyType.TableProperty)),h.Gh.insertMath(t.currentRange().end(),c,s.runProp,t)):r.isDrawingAnchor(i)&&(c=s.contentProp||new(p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)),h.Gh.insertDrawing(t.currentRange().end(),c,t))}}))},t.prototype.isSpecialChar=function(t,e){if(t===p.PlaceholderChar.Space||t===p.PlaceholderChar.FullWidthSpace||t===p.PlaceholderChar.ZeroSpace||t===p.PlaceholderChar.NonBreakSpace||t===p.PlaceholderChar.NoWidthOptionalBreak||t===p.PlaceholderChar.NoWidthNoBreak||t===p.PlaceholderChar.Tab)return!0;var r=t.codePointAt(0);return!(!r||!(0,ao.isExtPictographic)(r))||e.isPlaceholder&&!(0,p.isNormalText)(t)},t.prototype.isFieldCode=function(t,e){var r=this._state.dataEngine.getDataStream().getFieldStream(),n=r.getFieldCharProperty(e.begin());return!!(null==r?void 0:r.isRangeInFieldCode(e,null==n?void 0:n.nestingLevel))},t.prototype.isInMath=function(t,e){return null!==this._state.dataEngine.getDataStream().getMathStream().getMathInfo(e.begin())},t.prototype.isValid=function(t,e,r){return e instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)&&(0===t.length||this.isSpecialChar(t,e)||this.isFieldCode(e,r)||this.isInMath(e,r))?{translatable:!1,preservable:!0,checkable:!1}:{translatable:!0,preservable:!0,checkable:!0}},t.prototype.getTranslateDeltaData=function(){var t=this._dataStream.getStoryStream().createStoryIterator().getRange();if(null===t)return null;var e=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1,!1).buildDelta();return h.Me.collectDataToDelta({dataEngine:this._state.dataEngine,delta:e,range:t}),e},t}(),lo=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),po=function(){function t(t,e){var r=this;this.findListCache=new Map,this.templateLevelCache=new Map,this.onListModelChange=function(t){var e=r.numberingManager.getListInfoFromGcpRange(r.selection.range());if(e){var n=e.listId,o=r.deltaOption().buildDelta();o.setCommandType(p.Type.DocSetNumbering),r.forEachTemplates(n,(function(i){if(r.isSelectAllLevel||i.ilvl===e.listLevel){var a=p.ListUtils.setLevelRunProperty(r.numberingManager.getNumberingProperty(),n,e.listLevel,t.listMarkerSpanProperty);return h.Gh.setSettingProperty(a,p.ModifyType.numbering,o),!r.isSelectAllLevel}return!1})),r.state.applyDelta(o)}},this.state=t,this.dataStream=this.state.dataEngine.getDataStream(),this.selection=e,this.numberingManager=t.dataEngine.getDataManager().getNumberingManager(),this.state.context.on(h.at.ListModelShouldChange,this.onListModelChange,this)}return Object.defineProperty(t.prototype,"selectionRange",{get:function(){return this.state.selection.gcpRange},enumerable:!1,configurable:!0}),t.prototype.deltaOption=function(t,e){return void 0===e&&(e=!1),h.C1.createLocalDeltaOption(t||this.selectionRange,e)},t.prototype.isSingleLevelList=function(t){return 1===this.numberingManager.getExistsListLevels(t.listId).length},t.prototype.createFindIterator=function(t,e){var r=this.dataStream.createDataIterator(),n=this.dataStream.getStoryStream().getSubStoryInfoFromGcp(t.gcpBegin);if(n&&r.setLimitRange(n.range),e===c.Sd$.Prev){r.seek(t.gcpBegin);var o=this.dataStream.getTextStream().readText(r.getRange().begin(),1);o&&Be.isTableSeperate(o)?r.seek(t.gcpBegin+1):r.seek(t.gcpBegin)}else r.seek(t.end()-(t.len>0?1:0));return r},t.prototype.matchType=function(t,e){return e.listType===t},t.prototype.matchStyle=function(t,e){return e.listFmt===t.listFormat&&e.lvlText===t.listText},t.prototype.matchTemplatesWithStylesetsAt=function(t,e,r){for(var n=0,o=r;o<t.length&&n<e.length;++o){var i=e[n];if(!i||t[o].numFmt.val!==i.listFormat||t[o].lvlText.val!==i.listText)return!1;n+=1}return n===e.length},t.prototype.matchFullStyleset=function(t,e){var r=String(e.listId),n=this.findListCache.get(r);if(void 0===n){var o=this.getTemplatesById(e.listId),i=this.matchTemplatesWithStylesetsAt(o,t,0);return this.findListCache.set(r,i),i}return n},t.prototype.matchPartialStyleset=function(t,e){var r="_".concat(e.listId),n=this.findListCache.get(r);if(void 0===n){for(var o=this.getTemplatesById(e.listId),i=0;i<p.Defaults.listLevelLimit-t.length;++i)if(this.matchTemplatesWithStylesetsAt(o,t,i))return this.findListCache.set(r,!0),!0;return this.findListCache.set(r,!1),!1}return n},t.prototype.createTraitPredicateMethod=function(t){var e=[];return void 0!==t.style&&e.push(this.matchStyle.bind(this,t.style)),void 0!==t.fullStyleset?e.push(this.matchFullStyleset.bind(this,t.fullStyleset)):t.partialStyleset&&e.push(this.matchPartialStyleset.bind(this,t.partialStyleset)),void 0!==t.type&&e.push(this.matchType.bind(this,t.type)),function(t){return e.every((function(e){return e(t)}))}},t.prototype.createCanMoveFunction=function(t,e,r){var n=e===c.Sd$.Prev?function(){return t.prev(p.IterType.Paragraph)}:function(){return t.next(p.IterType.Paragraph)};return r?function(){for(;n();)if(r(t.getRange(p.IterType.Paragraph)))return!0;return!1}:n},t.prototype.unidirectionalFindList=function(t,e,r,n,o){var i=this.createTraitPredicateMethod(n),a=this.createFindIterator(t,e),s=this.createCanMoveFunction(a,e,o);if(!s())return null;do{var l=this.numberingManager.getListInfoFromGcpRange(a.getRange());if(l&&i(l))return l}while(s()&&r);return null},t.prototype.findList=function(t,e){this.findListCache.clear();for(var r=Array.isArray(e.crossParagraph)?e.crossParagraph:e.directions.map((function(){return!!e.crossParagraph})),n=0;n<e.directions.length;++n){var o=this.unidirectionalFindList(t,e.directions[n],!!r[n],e.traits,e.paragraphFilter);if(o)return o}return null},t.prototype.applyDelta=function(t,e){t.operations.length>0&&!e&&this.state.applyDelta(t)},t.prototype.getValidListOpRange=function(t){var e=this.dataStream.getStoryStream().getSubStoryInfoFromGcp(t.gcpBegin);if(!e)throw Error("invalid gcp range for list operation");return t.end()>e.range.end()?e.range.intersectRange(t):t},t.prototype.getParaStartTabNum=function(t){var e,r,n=this.dataStream.getTextStream().readText(t.begin(),t.len),o=0;try{for(var a=(0,i.__values)(n),s=a.next();!s.done&&"\t"===s.value;s=a.next())o+=1}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o},t.prototype.deleteParaStartTab=function(t,e){var r=this.dataStream.getTextStream().createParagraphIterator(t),n=0;do{var o=r.getRange(),i=this.getParaStartTabNum(o),a=new p.GCPRange(o.begin()-n,i);n+=i,h.Gh.deleteText(a,e)}while(r.next())},t.prototype.createListInRange=function(t,e,r){void 0===r&&(r=!0);var n=this.getValidListOpRange(t),o=this.deltaOption(n).buildDelta();o.setCommandType(p.Type.DocModifyParagraphNumbering),o.globalOpts.undoOption.isUnMerge=r;var i=e.styleset;if(!(i.length<=0)){var a=this.createTemplatesFromStyleset(i,e.listLevelLimit,n),s=a.paragraphs,l=a.spans;if(s){var c=p.ListUtils.createId(),u=p.ListUtils.isTaskFormat(i[0].listFormat)&&i[0].listText===p.TaskStateChar.Done?p.STTaskState.done:p.STTaskState.todo;return this.insertListTemplates(c,s,o,l),this.setListParaPropsInRange(n,c,s[0],e.listLevelRule,u,o),this.deleteParaStartTab(n,o),this.applyDelta(o),o.operations.length>0?{listId:c,range:n}:void 0}}},t.prototype.createRootTemplateParagraphByIndents=function(t,e){void 0===e&&(e=0);var r=Number.MAX_SAFE_INTEGER;if(t){var n=this.dataStream.getTextStream().createParagraphIterator(t);do{var o=n.getCloneProperty(),i=n.getRange();if(o){if(o.numPr.isEmpty(p.PropertyFactory.getPropertyClass(p.PropertyType.CTNumPr).tKeys.numId)||this.isTaskList(o.numPr.numId.val)){var a=this.combineIndents(o,i),s=a.valueIndent||a.characterUnitIndent/p.DefaultsUnit.indentChars*p.Defaults.fontSize;s+a.extraIndent<r&&(r=s+a.extraIndent)}}else r=0}while(n.next()&&r>0)}r===Number.MAX_SAFE_INTEGER&&(r=e);var l=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTLvlWml));return l.pPr.ind.hanging=p.Defaults.listDefaultHanging,l.pPr.ind.left=r+l.pPr.ind.hanging,l},t.prototype.createTemplatesFromStyleset=function(t,e,r){var n=this.createRootTemplateParagraphByIndents(r,t[0].listLeftIndent);n.ilvl=0,n.start.val=1,n.lvlJc.val=p.STJcWml.left;var o=(0,i.__read)(t,1)[0];n.numFmt.val=o.listFormat,(p.ListUtils.isBulletFormat(o.listFormat)||p.ListUtils.isTaskFormat(o.listFormat))&&p.ListUtils.setSpanFont(n.rPr,"wingdings");var a=[];if(p.ListUtils.isBulletFormat(o.listFormat)||p.ListUtils.isNumberedFormat(o.listFormat)){n.lvlText.val=o.listText,void 0!==o.listHangingIndent&&(n.pPr.ind.left-=n.pPr.ind.hanging,n.pPr.ind.hanging=o.listHangingIndent,n.pPr.ind.left+=n.pPr.ind.hanging),a.push(n);for(var s=1;s<t.length;++s){var l=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTLvlWml));l.ilvl=s,l.start.val=1,l.lvlJc.val=p.STJcWml.left,l.numFmt.val=t[s].listFormat,l.lvlText.val=t[s].listText,l.pPr.ind.hanging=t[s].listHangingIndent||p.Defaults.listDefaultHanging,t[s].listLeftIndent&&(l.pPr.ind.left=n.pPr.ind.left-n.pPr.ind.hanging+(t[s].listLeftIndent-(t[0].listLeftIndent||0))+l.pPr.ind.hanging),a.push(l)}}else p.ListUtils.isTaskFormat(o.listFormat)&&(n.numFmt.val=o.listFormat,n.lvlText.val=o.listText,a.push(n));return p.ListUtils.completeListTemplateParagraphs(a[0],a,Math.min(e||p.Defaults.listLevelLimit,p.Defaults.maxSupportListLevelLimit)),{paragraphs:a,spans:void 0}},t.prototype.splitValidParaRange=function(t){var e=this,r=[];return h.Yy.splitCellRange(this.state.dataEngine.getDataStream().getTableStream(),t,(function(t){var n=e.dataStream.getTextStream().createParagraphIterator(t),o=e.dataStream.getTextStream().createRunIterator();do{var i=n.getRange();o.seek(i.end()-1);var a=e.dataStream.getTextStream().readText(i.begin(),1);a&&!Be.isTableSeperate(a)&&r.push(i)}while(n.next());return!0})),r},t.prototype.createListParaProperty=function(t,e,r,n){var o=lo.clone();return void 0!==e&&(o.numPr.numId.val=e),t.type===c.syi.absolute&&void 0!==t.value&&(o.numPr.ilvl.val=t.value),r&&(p.ListUtils.isTaskFormat(r)?n&&(o.taskPr.taskState=n):o.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.taskPr)),o},t.prototype.getListLevelLimit=function(t){if(t){var e=this.templateLevelCache.get(t);if(void 0!==e)return e;var r=this.getRawTemplatesById(t),n=r.length>0?this.parseTemplateLeveLimit(r):p.Defaults.listLevelLimit;return this.templateLevelCache.set(t,n),n}return p.Defaults.listLevelLimit},t.prototype.getValidLevel=function(t,e){return Math.max(0,Math.min(t,e-1))},t.prototype.isTaskList=function(t){return this.numberingManager.getListTypeByListId(t)===p.ListType.Task},t.prototype.isParaHasNumPr=function(t){return t.numPr.isEmpty(p.PropertyFactory.getPropertyClass(p.PropertyType.CTNumPr).tKeys.ilvl)||t.numPr.isEmpty(p.PropertyFactory.getPropertyClass(p.PropertyType.CTNumPr).tKeys.numId)},t.prototype.setListParaPropsInRange=function(t,e,r,n,o,a){var s=this,l=a||this.deltaOption(this.selectionRange).buildDelta();l.setCommandType(p.Type.DocModifyParagraphNumbering);var u=p.ListUtils.isTaskFormat(r.numFmt.val)?{type:c.syi.absolute,value:0}:(0,i.__assign)({type:c.syi.auto},n),g=this.createListParaProperty(u,e,r.numFmt.val,o),d=this.dataStream.getTextStream().createParagraphIterator();this.splitValidParaRange(t).forEach((function(t){var n=-1,o=-1;d.seek(t.gcpBegin);var i=d.getCloneProperty();if(i){var a=s.getListLevelLimit(e);if(u.type===c.syi.auto){if(s.isParaHasNumPr(i)||s.isTaskList(i.numPr.numId.val)){var y=s.combineIndents(i,t),f=y.valueIndent||y.characterUnitIndent/p.DefaultsUnit.indentChars*p.Defaults.fontSize,v=r.pPr.ind.left-r.pPr.ind.hanging;o=s.getValidLevel(Math.floor(((f+y.extraIndent-v)/p.Defaults.fontSize+1)/2),a)}}else u.type===c.syi.relative&&u.value&&(n=i.numPr.ilvl.val,o=s.getValidLevel(n+u.value,a))}var m=g;if(o!==n&&((m=g.clone()).numPr.ilvl.val=o),!m.equalTo(lo)){var P=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));P.setNull(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty).tKeys.ind);var T={range:t,property:P,mode:p.PropUpdateMode.Clean};h.Gh.setParagraphProperty(T,l),T.property=m,T.mode=p.PropUpdateMode.Merge,T.property.ind=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTInd)),h.Gh.setParagraphProperty(T,l)}})),this.applyDelta(l,a)},t.prototype.replaceListInRange=function(t,e){var r=this.getTemplateById(e.listId,0);if(r){var n=this.getValidListOpRange(t),o=this.deltaOption().buildDelta();o.setCommandType(p.Type.DocModifyParagraphNumbering),o.globalOpts.undoOption.undoListener=e.notifyUndo,this.setListParaPropsInRange(n,e.listId,r,e.listLevelRule,void 0,o),this.applyDelta(o)}},t.prototype.getListUndoParaRange=function(){return this.selection.getParaRange(this.numberingManager.lastUpdateGcp-1)},t.prototype.replaceList=function(t,e,r){e.listId&&this.modifyListParaProps(t,e.listId,e.listLevelRule,r)},t.prototype.modifyListParaProps=function(t,e,r,n,o){var a=this,s=o||this.deltaOption(this.selectionRange).buildDelta();s.setCommandType(p.Type.DocModifyParagraphNumbering);var l=this.numberingManager.getWholeListByListId(t);if(l.length>0){var u=this.getListLevelLimit(l[0].listId),g=l[0].listId,d=(0,i.__assign)({type:c.syi.auto},r),y=this.createListParaProperty(d,e,l[0].listFmt),f=0;l.forEach((function(t){if(!n||n(t)){var e=new p.GCPRange(t.gcp-1,1),r=y;if(d.type===c.syi.relative&&d.value){var o=a.getValidLevel(t.listLevel+d.value,u);o!==t.listLevel&&((r=y.clone()).numPr.ilvl.val=o)}if(!r.equalTo(lo)){var i={range:e,property:r,mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(i,s)}f+=1}})),this.numberingManager.getListsByListTemplateId(g).length===f&&this.removeTemplatesById(g,s)}this.applyDelta(s,o)},t.prototype.modifyListStyleset=function(t,e,r){var n=r||this.deltaOption(this.selectionRange).buildDelta();n.setCommandType(p.Type.DocModifyParagraphNumbering);var o=p.ListUtils.getPeriodListStyleset(e),i=[];this.forEachTemplates(t,(function(t){var e=t.clone(),r=o[t.ilvl%o.length];return e.ilvl=t.ilvl,e.numFmt.val=r.listFormat,e.lvlText.val=r.listText,e.pPr.ind.left-=e.pPr.ind.hanging,e.pPr.ind.hanging=r.listHangingIndent||p.Defaults.listDefaultHanging,e.pPr.ind.left+=e.pPr.ind.hanging,void 0!==r.listLeftIndent&&(e.pPr.ind.left=r.listLeftIndent+e.pPr.ind.hanging),""!==e.rPr.rFonts.eastAsia&&"wingdings"!==e.rPr.rFonts.eastAsia||(p.ListUtils.isBulletFormat(e.numFmt.val)||p.ListUtils.isTaskFormat(e.numFmt.val)?p.ListUtils.setSpanFont(e.rPr,"wingdings"):p.ListUtils.setSpanFont(e.rPr,"")),i.push(e),!1}));var a=p.ListUtils.insertLevelsType(new(p.PropertyFactory.getPropertyClass(p.PropertyType.NumberingProperty)),t,i);h.Gh.setSettingProperty(a,p.ModifyType.numbering,n),this.applyDelta(n,r)},t.prototype.modifyList=function(t,e,r){var n=e.styleset&&e.styleset.length>0;if(e.listLevelRule||n){var o=void 0,i=this.deltaOption().buildDelta();if(i.setCommandType(p.Type.DocModifyParagraphNumbering),(r||0===this.getRawTemplatesById(t).length)&&n){var a=this.getListLevelLimit(t),s=this.createTemplatesFromStyleset(e.styleset,a),l=s.paragraphs,c=s.spans;l&&(o=p.ListUtils.createId(),this.insertListTemplates(o,l,i,c),this.modifyListParaProps(t,o,e.listLevelRule,r,i))}else e.listLevelRule&&this.modifyListParaProps(t,void 0,e.listLevelRule,r,i),n&&this.modifyListStyleset(t,e.styleset,i);return this.applyDelta(i),o}},t.prototype.combineIndents=function(t,e,r){var n=this.dataStream.getTextStream().createParagraphIterator(e),o=n.getRange(),a=this.getParaStartTabNum(o),s=p.Defaults.fontSize*a*2,l={valueIndent:Number(t.ind.left)-Number(t.ind.hanging),characterUnitIndent:t.ind.leftChars,extraIndent:s},c={valueIndent:Number(t.ind.hanging||t.ind.firstLine),characterUnitIndent:t.ind.hangingChars||t.ind.firstLineChars},u=(0,i.__assign)({ignoreHangingIndent:!0,characterUnit:!1},r);if(0===c.characterUnitIndent&&0===c.valueIndent)return l;if((t.ind.hanging>0||t.ind.hangingChars>0)&&u.ignoreHangingIndent)return l;var g=c.valueIndent;if(0!==c.characterUnitIndent){var h=this.dataStream.getTextStream().createRunIterator(e);h.seek(e.begin());var d=h.getProperty()||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),y=n.getProperty()||new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));g=((d=this.state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(d,y,e.begin()))?Number(d.sz):p.Defaults.fontSize)*(c.characterUnitIndent/p.DefaultsUnit.indentChars)}var f=l.valueIndent;return 0!==l.characterUnitIndent&&(f=p.Defaults.fontSize*(l.characterUnitIndent/p.DefaultsUnit.indentChars)),u.characterUnit&&0===l.valueIndent?{characterUnitIndent:f+Math.abs(g/p.Defaults.fontSize)*p.DefaultsUnit.indentChars,valueIndent:0,extraIndent:s}:{characterUnitIndent:0,valueIndent:f+Math.abs(g),extraIndent:s}},t.prototype.convertListIndentIntoParagraph=function(t,e,r){var n=this.numberingManager.getListInfoFromGcpRange(e);if(n){var o=this.combineIndents(n,e,{ignoreHangingIndent:r}),i=t;0!==o.characterUnitIndent&&(i.ind.leftChars=o.characterUnitIndent),i.ind.left=o.valueIndent}},t.prototype.cancelListParagraph=function(t,e,r){var n=e.getRange(),o=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty)),i=this.dataStream.getTextStream().createParagraphIterator(n).getProperty(),a=this.state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParagraphProperty(i||o);o.cleanNumPr((null==i?void 0:i.isNumPrCleaned())&&!a.isNumPrCleaned()),this.convertListIndentIntoParagraph(o,n,t);var s={range:n,property:o,mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(s,r)},t.prototype.insertListTemplates=function(t,e,r,n){if(Array.isArray(e)&&0!==e.length){n&&e.forEach((function(t,e){var r=(null==n?void 0:n[e])?n[e]:new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty));t.rPr=r}));var o=p.ListUtils.insertLevelsType(new(p.PropertyFactory.getPropertyClass(p.PropertyType.NumberingProperty)),t,e);h.Gh.setSettingProperty(o,p.ModifyType.numbering,r)}},t.prototype.forEachTemplates=function(t,e){var r=this.numberingManager.getAbstractNumType(t);null==r||r.lvl.forEach((function(t){if(t instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.CTLvlWml)&&e(t))return!0}))},t.prototype.parseTemplateLeveLimit=function(t){if(t.length<=0)return p.Defaults.listLevelLimit;var e=0;return t.forEach((function(t){var r=t.ilvl;r>e&&(e=r)})),e+1},t.prototype.getRawTemplatesById=function(t){var e=[];return this.forEachTemplates(t,(function(t){return e.push(t),!1})),e},t.prototype.getTemplateById=function(t,e){return this.numberingManager.getLevelType(t,e)},t.prototype.getTemplatesById=function(t){var e=this.getRawTemplatesById(t);if(e.length>0){if(p.ListUtils.isTaskFormat(e[0].numFmt.val))return[e[0]];var r=this.parseTemplateLeveLimit(e);e.length>r&&(e=e.slice(0,r))}return e.sort((function(t,e){return t.ilvl-e.ilvl}))},t.prototype.removeTemplatesById=function(t,e){var r=p.ListUtils.removeAbstractNumType(t,this.numberingManager.getNumberingProperty(!0));r&&h.Gh.setSettingProperty(r,p.ModifyType.numbering,e)},t.prototype.cancelListInRange=function(t,e){var r=this;void 0===e&&(e=!0);var n=this.getValidListOpRange(t),o=this.deltaOption(this.selectionRange,!1).buildDelta();o.setCommandType(p.Type.DocModifyParagraphNumbering);var i=new Map,a=this.dataStream.getTextStream().createParagraphIterator(n);do{var s=a.getProperty(),l=null==s?void 0:s.numPr.numId.val;if(l){this.cancelListParagraph(e,a,o);var c=i.get(l);i.set(l,void 0===c?1:c+1)}}while(a.next());return i.forEach((function(t,e){r.numberingManager.getListsByListTemplateId(e).length===t&&r.removeTemplatesById(e,o)})),this.applyDelta(o),n},t.prototype.cancelList=function(t,e){var r=this;void 0===e&&(e=!0);var n=this.deltaOption(this.selectionRange,!1).buildDelta();n.setCommandType(p.Type.DocModifyParagraphNumbering);var o=this.dataStream.getTextStream().createParagraphIterator(),a=this.numberingManager.getWholeListByListId(t);if(a.length>0){a.forEach((function(t){o.seek(t.gcp-1),r.cancelListParagraph(e,o,n)}));var s=(0,i.__read)(a,1)[0].listId;this.numberingManager.getListsByListTemplateId(s).length===a.length&&this.removeTemplatesById(s,n)}this.applyDelta(n)},t.prototype.addListTemplates=function(t,e,r,n){if(e.length>0&&!this.numberingManager.hasTemplate(t)){var o=r.currentRange();e.sort((function(t,e){return t.ilvl-e.ilvl}));var a=(0,i.__read)(e,1)[0];0===a.ilvl&&(p.ListUtils.isTaskFormat(a.numFmt.val)?this.insertListTemplates(t,[a],r,n):(p.ListUtils.completeListTemplateParagraphs(a,e),this.insertListTemplates(t,e,r,n)),this.templateLevelCache.set(t,e.length),r.moveTo(o))}},t.prototype.getListStyleset=function(t){var e=this.getTemplatesById(t);return e?e.map((function(t){return{listFormat:t.numFmt.val,listText:t.lvlText.val,listHangingIndent:Math.floor(t.pPr.ind.hanging),listLeftIndent:Math.floor(t.pPr.ind.left-t.pPr.ind.hanging||t.pPr.ind.leftChars/p.DefaultsUnit.indentChars*p.Defaults.fontSize)}})):[]},t.prototype.setListMarkerSelection=function(t){this.isSelectAllLevel=void 0;var e=this.numberingManager.getListInfoFromGcpRange(this.selection.range());(null==e?void 0:e.listMarkerSpanProp)?(this.state.listMarkerSpanProp=e.listMarkerSpanProp,this.isSelectAllLevel=t):this.state.listMarkerSpanProp=null},t.prototype.clearListMarkerSelection=function(){this.isSelectAllLevel=void 0,this.state.listMarkerSpanProp=null},t.prototype.isLastParagraph=function(t){return!this.dataStream.getTextStream().createParagraphIterator(t).next()},t}(),co=function(){function t(t,e){this._state=t,this._service=e}return t.prototype.replaceWithMarkdownFormat=function(t,e,r,n){var o=this.convertToMarkdown(t,e,r,n);o&&this._state.applyDelta(o)},t.prototype.convertToMarkdown=function(t,e,r,n,o){var i=null;switch(r){case c.ogv.Headline:i=this.replaceWithHeadlineFormat(t,e,n,o);break;case c.ogv.BulletList:i=this.replaceWithBulletList(t,e,o);break;case c.ogv.TaskList:i=this.replaceWithTaskList(t,e,n,o);break;case c.ogv.Codeblock:i=this.replaceWithCodeblock(t,n);break;case c.ogv.Horizontal:i=this.replaceWithHorizontal(t,e,n);break;case c.ogv.Quote:i=this.replaceWithQuoteFormat(t,e,n,o);break;case c.ogv.HighlightBlock:i=this.replaceWithLightblockFormat(t)}return i&&i.setUpdateSelection(!0),i},t.prototype._deltaOption=function(t,e){return void 0===e&&(e=!1),h.C1.createLocalDeltaOption(t,e)},t.prototype.replaceWithHeadlineFormat=function(t,e,r,n){var o=(null==n?void 0:n.externalDelta)||this._deltaOption(t).buildDelta();o.moveTo(new p.GCPRange(t.gcpBegin,0)),this._service.getDocument().getRange(t.gcpBegin,t.end()-1).setStyle(r,o);var i=new p.GCPRange(t.begin(),e);return h.Gh.deleteText(i,o),o.moveTo(new p.GCPRange(t.gcpBegin,0)),o},t.prototype.replaceWithCodeblock=function(t,e){var r=new p.GCPRange(t.begin(),t.length()+1),n=o.m7.generateRandomId(),i=(0,p.createCodeblockTextboxProperty)({id:n,language:e.length?e:"plain text",theme:"normal",wordWrap:!0});if(!i)return null;var a={content:"",storyType:p.STStoryType.textboxContent,textboxStoryProperty:i},s=(0,p.createDefaultCodeblockProperty)(n,this._service.getDocument().getRange(t.begin(),t.begin()).getSectionFormat().getContentWidth());return this._service.getDocument().getCodeblocks().addTextFrame(a,{textFrameProp:s,updateSelection:!0,spanStyle:"melo-codeblock-Base-theme-char",paraStyle:"melo-codeblock-Base-theme-para",range:r,selection:this._service.getSelection()}),null},t.prototype.replaceWithBulletList=function(t,e,r){if(Kt(this._service,t))return null;var n=Re.BulletCircle;return this.replaceWithList(t,e,n,p.ListType.Bullet,r)},t.prototype.replaceWithTaskList=function(t,e,r,n){if(Kt(this._service,t))return null;var o=r===p.TaskStateChar.Done,i=Re.TaskList;return this.replaceWithList(t,e,i,p.ListType.Task,n,o?p.STTaskState.done:p.STTaskState.todo)},t.prototype.replaceWithList=function(t,e,r,n,o,i){var a=o&&o.externalDelta||this._deltaOption(t).buildDelta();a.setCommandType(p.Type.DocModifyParagraphNumbering);var s=new mr(this._state,this._service),l={range:t,listType:n,listStyles:r},c=new vr(this._state.context,this._state).findAuto(l);return s.setListInAutoFindResult(c,n,a,r,i),h.Gh.deleteText(new p.GCPRange(t.begin(),e),a),a},t.prototype.replaceWithHorizontal=function(t,e,r,n){var o=new p.GCPRange(t.begin(),e),i=Vn.createStateRange(this._state,o),a=n&&n.externalDelta||this._deltaOption(t).buildDelta();return a.setCommandType(p.Type.DocInsertParagraph),h.Gh.deleteText(o,a),i.insertSplitline(Number(r),p.Defaults.splitlineColor,p.Defaults.splitlineSize,a),a},t.prototype.replaceWithQuoteFormat=function(t,e,r,n){var o=n&&n.externalDelta||this._deltaOption(t).buildDelta();o.setCommandType(p.Type.DocModifyParagraphStyle),h.Gh.setRunProperty(t,Be.createClearRunProperty(),o,p.PropUpdateMode.Merge);var i=new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));i.blockQuote=!0;var a={range:t,property:i,mode:p.PropUpdateMode.Merge};h.Gh.setParagraphProperty(a,o);var s=new p.GCPRange(t.begin(),e);return h.Gh.deleteText(s,o),o},t.prototype.replaceWithLightblockFormat=function(t){var e=new p.GCPRange(t.begin(),t.length()+1),r=o.m7.generateRandomId(),n=new(p.PropertyFactory.getPropertyClass(p.PropertyType.TextboxStoryProperty));n.id=r,n.wordWrap=!0,n.isCodeBlock=!1,n.isLightBlock=!0;var i={storyType:p.STStoryType.textboxContent,content:p.PlaceholderChar.ParagraphReturn,textboxStoryProperty:n},a=this._service.getDocument().getRange(t.begin(),t.begin()).getSectionFormat().getContentWidth();return this._service.getTextframes().addTextFrame(i,{textFrameProp:(0,p.createDefaultLightblockProperty)(n.id,a),updateSelection:!0,selection:this._service.getSelection(),range:e}),null},t}(),uo=r(572324);!function(t){t[t.CommentRef=0]="CommentRef",t[t.CommentRange=1]="CommentRange",t[t.CommentContent=2]="CommentContent"}(Qn||(Qn={}));var go,ho,yo,fo,vo,mo=function(){function t(t){this.state=t,this.historyCommentRange=new Map}return t.prototype.getHistoryRangeMap=function(t){return this.historyCommentRange.get(t)||new p.GCPRange},t.prototype.addComment=function(t,e,r,n){var o;if(r){var i=this.state.getStoryStream(),a=new l.wA(this.state.dataEngine,r),s=a.fixToValidCommentRange(r);s=a.trimSpecialPlaceholder(s);var c=this.deltaOption().buildDelta();c.setCommandType(p.Type.DocInsertComment),c.globalOpts.updateSelection=!1;var u=i.getStoryLastPos(p.STStoryType.commentContent);(null==n?void 0:n.isGlobal)?h.Gh.insertCommentStory(t,u,e,c):h.Gh.insertComment({commentStoryPr:t,storyPos:u,text:e,insertRange:s,delta:c,preventRefTrackChanges:this.state.getRevisionsManager().getRevisionBusinessHelper().shouldPreventCommentRefTrackChanges(s)}),null===(o=null==n?void 0:n.beforeApply)||void 0===o||o.call(n,c),this.state.applyDelta(c)}},t.prototype.updateComment=function(t,e,r){var n=this.deltaOption().buildDelta(),i=this.state.getStoryStream();n.setCommandType(p.Type.DocModifyComment),n.globalOpts.updateSelection=!1;var a=i.getSubStoryInfoFromId(r,p.STStoryType.commentContent);a?(a&&(h.Gh.deleteText(a.contentRange,n),h.Gh.updateCommentStory(t,a.range.begin(),e,n)),this.state.applyDelta(n)):o.Yd.error("can not find commentStoryInfo!")},t.prototype.modifyArchiveComment=function(t){var e=this.deltaOption().buildDelta(),r=this.state.getStoryStream();e.setCommandType(p.Type.DocModifyComment),e.globalOpts.updateSelection=!1;var n=r.getSubStoryInfoFromId(t.id,p.STStoryType.commentContent);n?(n&&h.Gh.modifyArchiveComment(t,n.range,e),this.state.applyDelta(e)):o.Yd.error("can not find commentStoryInfo!")},t.prototype.appendComment=function(t,e){var r,n=this.state.getDataStream().getAnnotationStream(),i=null===(r=n.getCommentRangeInfoFromId(t.refId))||void 0===r?void 0:r.refProp;if(i){var a=n.getCommentRangeInfoFromId(t.refId),s=null==a?void 0:a.refRange;if(s){var l=this.state.getStoryStream(),c=this.deltaOption().buildDelta();c.setCommandType(p.Type.DocInsertComment),c.globalOpts.updateSelection=!1;var u=l.getStoryLastPos(p.STStoryType.commentContent);h.Gh.appendComment(t,u,e,s,c,i),this.state.applyDelta(c)}else o.Yd.error("can not find comment ref!")}},t.prototype.deleteCommentFromAnchorId=function(t){var e=this.deltaOption().buildDelta();e.setCommandType(p.Type.DocDeleteComment),this.collectCommentDeletionToDeltaByAnchorId(e,t),this.state.applyDelta(e)},t.prototype.deleteCommentStoryAfterDeleteComment=function(t){var e=this.deltaOption(!1).buildDelta();e.setCommandType(p.Type.DocDeleteComment),this.collectCommentDeletionToDeltaByAnchorId(e,t),this.state.applyDelta(e)},t.prototype.deleteCommentFromStoryId=function(t){var e=this.state.getStoryStream().getSubStoryInfoFromId(t,p.STStoryType.commentContent);if(e){var r=e.subStoryProp;if(1===this.getCommentFromAnchorId(r.refId).length)this.deleteCommentFromAnchorId(r.refId);else{var n=this.deltaOption().buildDelta();n.setCommandType(p.Type.DocDeleteComment),h.Gh.deleteText(e.range,n),this.state.applyDelta(n)}}},t.prototype.isArchiveComment=function(t){return this.collectCommentSubStoryInfosById(t).every((function(t){return t.property.isArchive}))},t.prototype.isGlobalComment=function(t){return this.collectCommentSubStoryInfosById(t).every((function(t){return t.property.isGlobal}))},t.prototype.getCommentFromAnchorId=function(t){var e=this,r=this.collectCommentSubStoryInfosById(t);return r.forEach((function(r){e.historyCommentRange.set(t,r.range)})),r},t.prototype.getCommentFromStoryId=function(t){return this.state.getStoryStream().getSubStoryInfoFromId(t,p.STStoryType.commentContent)},t.prototype.collectCommentInfosFromGcpRanges=function(t){var e=this,r=Array.isArray(t)?t:[t];return(0,uo.Z)(r.map((function(t){return e.collectComments(t)})))},t.prototype.updateCommentHeight=function(t){var e=this,r=this.deltaOption().buildDelta();r.globalOpts.updateSelection=!1,r.globalOpts.needCollab=!1,t.forEach((function(t){var n=t.range;e.state.getTextStream().readText(n.gcpBegin,n.len)===p.PlaceholderChar.CommentReference&&h.Gh.updateCommentRef(t.property,t.range,r)})),this.state.applyDelta(r)},t.prototype.getCommentRefPropertyFromGcp=function(t){var e=p.PropertyUtil.findPlaceholderCharProperty(this.state.getDataStream(),t);return e instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.CommentReferenceProperty)?e:null},t.prototype.getCommentRangeInfoByAnchorId=function(t){return this.state.getDataStream().getAnnotationStream().getCommentRangeInfoFromId(t)},t.prototype.collectCommentSubStoryInfosById=function(t){var e,r=this.state.getStoryStream(),n=this.state.getTextStream(),o=this.state.getFieldStream(),i=r.createSubStoryIterator({storyType:p.STStoryType.commentContent}),a=new Set(Array.isArray(t)?t:[t]),s=new Map,l=function(){var t=i.getCloneProperty();if(t instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.CommentStoryProperty)&&a.has(t.refId)){for(var e=t.refId,r=i.getRange(!0),l=i.getContentRange(!0),c=[],u=o.createFieldIterator({limitRange:l}),g=[];u.hasNext();){var d=u.getRange(!0);g.push(d),u.next()}g.length>0?(0,h.Ao)(l,g,[],c,n):c.push({text:n.readText(l.begin(),l.len)});var y=c.map((function(t,e){return c.length-1===e&&(t.text=t.text.trim()),t})).filter((function(t){return t.text})),f={range:r,property:t,contentRange:l,text:JSON.stringify(y)};s.has(e)?s.get(e).push(f):s.set(e,[f])}};do{l()}while(i.hasNext()&&i.next());return Array.isArray(t)?t.map((function(t){var e;return null!==(e=s.get(t))&&void 0!==e?e:[]})):null!==(e=s.get(t))&&void 0!==e?e:[]},t.prototype.collectCommentSubStoryInfosByRange=function(t){var e=this.state.getAnnotationStream().collectCommentRangeInfoFromRange(t),r=[];return e.forEach((function(e){t.contains(e.refRange)&&r.push(e.refProp.id)})),(0,uo.Z)(this.collectCommentSubStoryInfosById(r))},t.prototype.collectComments=function(t){return this.state.getDataStream().getAnnotationStream().collectCommentRangeInfoFromRange(t)},t.prototype.collectCommentDeletionToDeltaByAnchorId=function(t,e,r){var n;void 0===r&&(r={deleteCommentRef:!0,deleteCommentRange:!0,deleteCommentContent:!0});var o=this.state.getAnnotationStream(),a=o.getCommentRangeInfoFromId(e),s=r.deleteCommentRef,l=r.deleteCommentRange,p=[];if(r.deleteCommentContent){var c=this.collectCommentSubStoryInfosById(e);p.push.apply(p,(0,i.__spreadArray)([],(0,i.__read)(c.map((function(t){return{commentPart:Qn.CommentContent,range:t.range}}))),!1))}if(s&&(null==a?void 0:a.refRange)&&p.push({commentPart:Qn.CommentRef,range:a.refRange}),l){var u=(null==a?void 0:a.annotationRange)||(null===(n=o.getCommentRangeSimpleInfoFromId(e))||void 0===n?void 0:n.annotationRange);u&&p.push({commentPart:Qn.CommentRange,range:u})}p.sort((function(t,e){return t.range.lessThan(e.range)?1:-1})),p.forEach((function(r){r.commentPart!==Qn.CommentRange?h.Gh.deleteText(r.range,t):h.Gh.deleteComment(r.range,e,t)}))},t.prototype.deltaOption=function(t){return h.C1.createLocalDeltaOption(this.state.selection.gcpRange,t)},t}(),Po=r(536001),To=function(){function t(t){this._state=t}return t.prototype.getFontNamesCache=function(){return this._state.getDataStream().getFontNamesCache()},t.prototype.clearFontNamesCache=function(){this._state.getDataStream().clearFontNamesCache()},t.prototype.invalidateMeasureCache=function(t){Po.dp.getDefaultEngine().invalidateMeasureCache(t)},t}(),So=function(){function t(t){this.state=t,this.annotationStream=this.state.getDataStream().getAnnotationStream()}return t.prototype.deltaOption=function(){return h.C1.createLocalDeltaOption(this.state.selection.gcpRange)},t.prototype.addQuote=function(t,e){var r=new l.wA(this.state.dataEngine,t).fixToValidDeleteRange(t),n=this.deltaOption().buildDelta();n.setCommandType(p.Type.DocInsertQuote),h.Gh.insertQuote(r,e,n),this.state.applyDelta(n)},t.prototype.deleteQuote=function(t){var e=this.getQuoteRangeById(t);if(e){var r=e.annotationRange,n=new l.wA(this.state.dataEngine,r).fixToValidDeleteRange(r),o=this.deltaOption().buildDelta();o.setCommandType(p.Type.DocDeleteQuote),h.Gh.deleteQuote(n,t,o),this.state.applyDelta(o)}},t.prototype.getQuoteRangeById=function(t){return this.annotationStream.getQuoteRangeInfoFromId(t)},t}(),Co=function(){function t(t){this.isMemberInRangeId=function(){return!0},this.isDocumentOwner=function(){return!1},this.state=t,this.annotationStream=this.state.getDataStream().getAnnotationStream()}return t.prototype.deltaOption=function(){return h.C1.createLocalDeltaOption(this.state.selection.gcpRange)},t.prototype.setIsMemberInRange=function(t){this.isMemberInRangeId=t},t.prototype.setIsDocumentOwner=function(t){this.isDocumentOwner=t},t.prototype.addPermissionRange=function(t,e){this.addPermissionRanges([{range:t,rangeId:e}])},t.prototype.addPermissionRanges=function(t){var e=this.deltaOption().buildDelta();e.setCommandType(p.Type.DocInsertPermission),this.buildAddPermissionRangeDelta(t,e),this.state.applyDelta(e)},t.prototype.deletePermissionRange=function(t){this.deletePermissionRanges([t])},t.prototype.deletePermissionRanges=function(t){var e=this.deltaOption().buildDelta();e.setCommandType(p.Type.DocDeletePermission),e.globalOpts.updateSelection=!1,this.buildDeletePermissionRangeDelta(t,e),this.state.applyDelta(e)},t.prototype.getPermissionRangeById=function(t){return this.annotationStream.getPermissionRangeInfoFromId(t)},t.prototype.getPermissionRangesByGcpPoint=function(t){return this.annotationStream.collectPermissionRangeInfoFromGcp(t)},t.prototype.getPermissionRangesByGcpRange=function(t){return this.annotationStream.collectPermissionRangeInfoFromRange(t)},t.prototype.getPermissionRangeIdsByGcpRange=function(t){return this.getPermissionRangesByGcpRange(t).map((function(t){return t.rangeProp.id}))},t.prototype.hasPermissionRangeByGcpPoint=function(t){return this.annotationStream.collectPermissionRangeInfoFromGcp(t).length>0},t.prototype.checkPermissionRangeByGcpRange=function(t){var e,r=this;if(!this.state.context.usePermissionRangeMode()||this.isDocumentOwner())return!0;var n=t,o=this.state.getStoryStream().getSubStoryInfoFromGcp(t.begin());if(o){var i=this.state.getDrawingStream().getDrawingInfoFromContentId(o.subStoryProp.id);n=null!==(e=null==i?void 0:i.range)&&void 0!==e?e:t}var a=!1;return this.annotationStream.forEachPermissionRange(n,(function(t){return a=!r.isMemberInRangeId(t.rangeProp.id)})),!a},t.prototype.checkPermissionRange=function(){var t=this.state.context.service.getSelection().range();return this.checkPermissionRangeByGcpRange(t)},t.prototype.buildAddPermissionRangeDelta=function(t,e){return t.forEach((function(t){var r=t.range,n=t.rangeId;h.Gh.insertPermissionRange(r,n,e)})),e},t.prototype.buildDeletePermissionRangeDelta=function(t,e){var r=this;return t.forEach((function(t){var n=r.getPermissionRangeById(t);if(n){var o=n.annotationRange;o&&h.Gh.deletePermissionRange(o,t,e)}})),e},t}(),bo=function(){function t(t){this.bookmarkInfos=[],this.state=t,this.annotationStream=this.state.getDataStream().getAnnotationStream()}return t.prototype.deltaOption=function(){return h.C1.createLocalDeltaOption(this.state.selection.gcpRange)},t.prototype.addBookmark=function(t,e){if(this.state.context.isRestrictProtectOn)return!1;if(this.isBookmarkExist(t))return!1;var r=this.deltaOption().buildDelta();r.setCommandType(p.Type.DocInsertBookmark);var n=new l.wA(this.state.dataEngine,e).fixToValidDeleteRange(e),i=o.m7.generateRandomId();return h.Gh.insertBookmark(n,i,t,r),this.state.applyDelta(r),!0},t.prototype.deleteBookmark=function(t){if(!this.state.context.isRestrictProtectOn){var e=this.getBookmarkInfo(t);if(e){var r=e.annotationRange,n=new l.wA(this.state.dataEngine,r).fixToValidRange(r),o=this.deltaOption().buildDelta();o.setCommandType(p.Type.DocDeleteBookmark),h.Gh.deleteBookmark(n,e.rangeProp.id,t,o),this.state.applyDelta(o)}}},t.prototype.getBookmarkInfo=function(t){return this.bookmarkInfos.find((function(e){return e.rangeProp.name===t}))},t.prototype.getBookmarkInfosByNames=function(t){return this.bookmarkInfos.filter((function(e){return t.includes(e.rangeProp.name)}))},t.prototype.collectAllBookmarks=function(){var t,e=new p.GCPRange(0,null===(t=this.state.context)||void 0===t?void 0:t.service.getDocument().getDocumentLength());this.bookmarkInfos=this.annotationStream.collectBookmarkRangeInfoFromRange(e)},t.prototype.getAllBookmarks=function(){return this.bookmarkInfos},t.prototype.getExplicitBookmarks=function(){return this.bookmarkInfos.filter((function(t){return!t.rangeProp.name.startsWith("_")}))},t.prototype.getHiddenBookmarks=function(){return this.bookmarkInfos.filter((function(t){return t.rangeProp.name.startsWith("_")}))},t.prototype.gotoBookmark=function(t,e){if(void 0===e&&(e=!0),!this.state.context.isRestrictProtectOn){var r=new p.GCPRange(0,0),n=this.getBookmarkInfo(t);if(n){var o=n.annotationRange;r=new p.GCPRange(o.begin(),e?o.length():0)}this.state.setRangeTo(r,{forceNotify:!0,forceFocus:!0,noSendCaret:!0,scrollToView:h.hF.NearTop})}},t.prototype.isBookmarkExist=function(t){return void 0!==this.getBookmarkInfo(t)},t.prototype.addBookmarkInRange=function(t,e,r){var n=new p.GCPRange(e,r);this.addBookmark(t,n)},t}(),Ro=function(){function t(){}var e;return t.removeNormalContentRevision=function(t,e){t.deleteRevisionRange(e.id,e.range)},t.removeNestingTableRevision=function(t,e){var r,n;if(e&&e.length)try{for(var o=(0,i.__values)(e),a=o.next();!a.done;a=o.next()){var s=a.value;s.structType!==p.RevisionStructType.Table?s.structType!==p.RevisionStructType.TableRow||this.removeTableRowRevision(t,s):this.removeTableRevision(t,s)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},t.removeTableRowRevision=function(t,e){var r,n,o=e.type===p.RevisionType.Insert,a=e.rowRevisionDetail,s=a.range,l=a.revisionsOfRow;try{for(var c=(0,i.__values)(l),u=c.next();!u.done;u=c.next()){var g=u.value;t.deleteRevisionRange(g.id,g.range)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}var h=new(p.PropertyFactory.getPropertyClass(p.PropertyType.CTTrPr));o?h.setNull(h.tKeys.ins):h.setNull(h.tKeys.del),t.setTableRowProperty(s,h,p.PropUpdateMode.Merge),this.removeNestingTableRevision(t,e.nestingRevisions)},t.removeTableRevision=function(t,e){var r,n,o=e.rowRevisionInfos;try{for(var a=(0,i.__values)(o),s=a.next();!s.done;s=a.next()){var l=s.value;this.removeTableRowRevision(t,l)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}this.removeNestingTableRevision(t,e.nestingRevisions)},t.removeMutiPlaceholderStructureRevision=function(t,e){var r,n,o=e.revisions;try{for(var a=(0,i.__values)(o),s=a.next();!s.done;s=a.next()){var l=s.value;t.deleteRevisionRange(l.id,l.range)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},t.removeSdtRevision=function(t,e){var r,n,o=e.revisions;try{for(var a=(0,i.__values)(o),s=a.next();!s.done;s=a.next()){var l=s.value;t.deleteRevisionRange(l.id,l.range)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},t.removeSectionBreakRevision=function(t,e){var r=e.relatedParaRevision;t.deleteRevisionRange(r.id,r.range)},e=t,t.actions=((go={})[p.RevisionStructType.Normal]=function(t,r){e.removeNormalContentRevision(t,r)},go[p.RevisionStructType.TableRow]=function(t,r){e.removeTableRowRevision(t,r)},go[p.RevisionStructType.Table]=function(t,r){e.removeTableRevision(t,r)},go[p.RevisionStructType.MutiPlaceholderStructure]=function(t,r){e.removeMutiPlaceholderStructureRevision(t,r)},go[p.RevisionStructType.Sdt]=function(t,r){e.removeSdtRevision(t,r)},go[p.RevisionStructType.SectionBreak]=function(t,r){e.removeSectionBreakRevision(t,r)},go),t}(),_o=function(){function t(){}var e;return t.deleteTextWhenCloseRevision=function(t,e,r){e.deleteText(r,t,{preventTextTrackChanges:!0})},t.deleteNormalContentRevisionText=function(t,e,r){t.deleteRevisionRange(r.id,r.range),this.deleteTextWhenCloseRevision(t,e,r.range)},t.deleteTableRowRevisionText=function(t,e,r){var n=r.range;this.deleteTextWhenCloseRevision(t,e,n)},t.deleteTableRevisionText=function(t,e,r){var n=r.range;this.deleteTextWhenCloseRevision(t,e,n)},t.deleteMutiPlaceholderStructureRevisionText=function(t,e,r){var n,o,a=r.revisions,s=r.range;try{for(var l=(0,i.__values)(a),p=l.next();!p.done;p=l.next()){var c=p.value;t.deleteRevisionRange(c.id,c.range)}}catch(t){n={error:t}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}this.deleteTextWhenCloseRevision(t,e,s)},t.deleteSdtRevisionText=function(t,e,r){var n,o,a,s,l=r.revisions;try{for(var p=(0,i.__values)(l),c=p.next();!c.done;c=p.next()){var u=c.value;t.deleteRevisionRange(u.id,u.range)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}var g=l.slice().reverse().map((function(t){return t.range}));try{for(var h=(0,i.__values)(g),d=h.next();!d.done;d=h.next()){var y=d.value;this.deleteTextWhenCloseRevision(t,e,y)}}catch(t){a={error:t}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}},t.deleteSectionBreakRevisionText=function(t,e,r){var n=r.range,o=r.relatedParaRevision;t.deleteRevisionRange(o.id,o.range),this.deleteTextWhenCloseRevision(t,e,n)},e=t,t.actions=((ho={})[p.RevisionStructType.Normal]=function(t,r,n){e.deleteNormalContentRevisionText(t,r,n)},ho[p.RevisionStructType.TableRow]=function(t,r,n){e.deleteTableRowRevisionText(t,r,n)},ho[p.RevisionStructType.Table]=function(t,r,n){e.deleteTableRevisionText(t,r,n)},ho[p.RevisionStructType.MutiPlaceholderStructure]=function(t,r,n){e.deleteMutiPlaceholderStructureRevisionText(t,r,n)},ho[p.RevisionStructType.Sdt]=function(t,r,n){e.deleteSdtRevisionText(t,r,n)},ho[p.RevisionStructType.SectionBreak]=function(t,r,n){e.deleteSectionBreakRevisionText(t,r,n)},ho),t}(),wo=function(){function t(){}var e;return t.coverRunPropertyWithoutRevision=function(t,e,r){r.setDefault(r.tKeys.rPrChange),t.setRunProperty(e,r,p.PropUpdateMode.Cover)},t.coverParaPropertyWithoutRevision=function(t,e,r){r.setDefault(r.tKeys.pPrChange),t.setParagraphProperty(e,r,p.PropUpdateMode.Cover)},t.coverSectPropertyWithoutRevision=function(t,e,r){r.setDefault(r.tKeys.sectPrChange),t.setSectionProperty(e,r,p.PropUpdateMode.Cover)},e=t,t.acceptRevisionActions=((yo={})[p.PropertyType.RunProperty]=function(t,r,n){if((0,p.isRunProperty)(n)){var o=n.clone();e.coverRunPropertyWithoutRevision(t,r,o)}},yo[p.PropertyType.ParagraphProperty]=function(t,r,n){if((0,p.isParagraphProperty)(n)){var o=n.clone();e.coverParaPropertyWithoutRevision(t,r,o)}},yo[p.PropertyType.SectionProperty]=function(t,r,n){if((0,p.isSectionProperty)(n)){var o=n.clone();e.coverSectPropertyWithoutRevision(t,r,o)}},yo),t.rejectRevisionActions=((fo={})[p.PropertyType.RunProperty]=function(t,r,n){if((0,p.isRunProperty)(n)){var o=n.rPrChange.rPr,i=n.create(o);e.coverRunPropertyWithoutRevision(t,r,i)}},fo[p.PropertyType.ParagraphProperty]=function(t,r,n){if((0,p.isParagraphProperty)(n)){var o=n.pPrChange.pPr,i=n.create(o);e.coverParaPropertyWithoutRevision(t,r,i)}},fo[p.PropertyType.SectionProperty]=function(t,r,n){if((0,p.isSectionProperty)(n)){var o=n.sectPrChange.sectPr,i=n.create(o);e.coverSectPropertyWithoutRevision(t,r,i)}},fo),t}(),xo=function(){function t(){}return t.removeRevision=function(t,e){var r=e.structType;Ro.actions[r](t,e)},t.deleteRevisionText=function(t,e,r){var n=r.structType;_o.actions[n](t,e,r)},t.acceptFormatRevision=function(t,e,r){var n,o;t.setUpdateSelection(!1),null===(o=(n=wo.acceptRevisionActions)[r.propertyType])||void 0===o||o.call(n,t,e,r)},t.rejectFormatRevision=function(t,e,r){var n,o;t.setUpdateSelection(!1),null===(o=(n=wo.rejectRevisionActions)[r.propertyType])||void 0===o||o.call(n,t,e,r)},t}(),Io=function(){function t(t){this.hooks=[],this.state=t,this.revisionManager=this.state.dataEngine.getDataManager().getRevisionsManager()}return Object.defineProperty(t.prototype,"revisionInfoManager",{get:function(){return this.revisionManager.getRevisionInfoManager()},enumerable:!1,configurable:!0}),t.prototype.addRevisionActionHook=function(t){this.hooks.push(t)},t.prototype.acceptRevision=function(t,e){var r=this.revisionInfoManager.getRevisionByParams(t,e);if(r){var n=r.range,o=this.buildDelta();o.setCommandType(p.Type.DocAcceptRevision),e===p.RevisionType.Insert?this.acceptInsertRevision(o,r):e===p.RevisionType.Delete?this.acceptDeleteRevision(o,r):e===p.RevisionType.Format&&this.acceptFormatRevision(o,n,r.formatProperty),this.hooks.forEach((function(t){return t(o,r,!0)})),this.applyDelta(o)}},t.prototype.rejectRevision=function(t,e){var r=this.revisionInfoManager.getRevisionByParams(t,e);if(r){var n=r.range,o=this.buildDelta();o.setCommandType(p.Type.DocRejectRevision),e===p.RevisionType.Insert?this.rejectInsertRevision(o,r):e===p.RevisionType.Delete?this.rejectDeleteRevision(o,r):e===p.RevisionType.Format&&this.rejectFormatRevision(o,n,r.formatProperty),this.hooks.forEach((function(t){return t(o,r,!1)})),this.applyDelta(o)}},t.prototype.setRevisionViewOptions=function(t){var e=this.revisionManager,r=e.getRevisionViewOptions(),n=(0,i.__assign)((0,i.__assign)({},r),t);JSON.stringify(r)!==JSON.stringify(n)&&(e.setRevisionViewOptions(n),this.triggerLayoutWhenRevisionViewChange(r,n),this.state.tryToFixSelectionToVisibleRange())},t.prototype.getRevisionViewOptions=function(){return this.revisionManager.getRevisionViewOptions()},t.prototype.isTrackRevisions=function(){return this.state.dataEngine.getDataManager().isTrackRevisions},t.prototype.toggleTrackRevisions=function(t){if(this.isTrackRevisions()!==t){var e=new(p.PropertyFactory.getPropertyClass(p.PropertyType.DocumentSettingsProperty));t?e.trackRevisions.val=!0:e.setNull(e.tKeys.trackRevisions);var r=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange(),!1).buildDelta();r.globalOpts.undoOption.needInverse=!1,this.state.context.service.getDocument().setDocSettingProperty(e,r)}},t.prototype.rangeIncludeTextRevision=function(t,e){return this.revisionManager.rangeIncludeTextRevision(t,e)},t.prototype.buildDelta=function(){var t=h.C1.createLocalDeltaOption(this.state.selection.gcpRange,!1).buildDelta();return t.setMutOption({preventFormatTrackChanges:!0}),t},t.prototype.applyDelta=function(t){this.state.applyDelta(t),this.state.cusorSpanProp=null,this.revisionInfoManager.syncRevisionsAfterOperateRevision()},t.prototype.acceptInsertRevision=function(t,e){xo.removeRevision(t,e)},t.prototype.rejectDeleteRevision=function(t,e){xo.removeRevision(t,e)},t.prototype.rejectInsertRevision=function(t,e){xo.deleteRevisionText(t,this.state,e)},t.prototype.acceptDeleteRevision=function(t,e){xo.deleteRevisionText(t,this.state,e)},t.prototype.acceptFormatRevision=function(t,e,r){xo.acceptFormatRevision(t,e,r)},t.prototype.rejectFormatRevision=function(t,e,r){xo.rejectFormatRevision(t,e,r)},t.prototype.getLayoutDirtyRangeMap=function(){var t,e,r=this,n=this.state.getStoryStream(),o=null!==(e=null===(t=n.getMainStoryInfo())||void 0===t?void 0:t.contentRange)&&void 0!==e?e:p.GCPRange.invalidRange(),a=new Map,s=null,l=function(t,e){var r=a.get(t)||[];a.set(t,(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(r),!1),[e],!1))};return this.revisionInfoManager.forEachRevisionInfo((function(t){var e,i=t.range.end();if(o.end()>=i)l(p.StoryID.MainDocId,t.contentRange);else if(s&&s.range.contains(t.range))l(s.subStoryProp.id,t.contentRange);else{var a=n.getSubStoryInfoFromGcp(t.range.begin());if(a){var c=a.range,u=a.subStoryProp;s=a;var g=null===(e=p.PropertyStoryUtil.getPlaceholderInfoBySubStory(a,r.state.getDataStream()))||void 0===e?void 0:e.range;g?(l(u.id,t.contentRange),l(o.end()>=g.end()?p.StoryID.MainDocId:u.id,g)):l(u.id,c)}}})),this.collectNoteDirtyRanges(o,l),new Map((0,i.__spreadArray)([],(0,i.__read)(a.entries()),!1).map((function(t){return[t[0],new h.I3(t[1])]})))},t.prototype.collectNoteDirtyRanges=function(t,e){var r=this.state.dataEngine.getDataManager().getNotesManager(),n=r.footnoteKeeper.collectAllNoteRange(t),o=r.endnoteKeeper.collectAllNoteRange(t);n.concat(o).forEach((function(t){e(p.StoryID.MainDocId,t)}))},t.prototype.triggerLayoutWhenRevisionViewChange=function(t,e){var r=this.getLayoutDirtyRangeMap();this.state.context.fire(new c.qbq(r,t,e))},t}(),Do=function(){function t(t,e){this.state=t,this.bookmark=e}return t.prototype.getPageIndexByGcp=function(t){var e=this.state.context.currentLayoutType;if(!(0,p.isPrintLayout)(e))return 1;for(var r=this.state.context.getDocumentBox().children,n=0,o=r.length-1;n<=o;){var i=Math.floor(n+o),a=r[i];if(a.containsRangeOrCP(t))return i+1;a.getRange().gcpBegin>t?o=i-1:n=i+1}return 1},t.prototype.updateOnlyPageRef=function(t){var e=this,r=(0,i.__read)(t,1)[0],n=h.C1.createLocalDeltaOption(r.fieldRange).buildDelta();t.reduceRight((function(t,r){var o,a=r.fieldCode,s=r.fieldResult,l=a.name,c=a.instructions,u=(0,i.__read)(null!=c?c:[],1)[0];if(l!==p.FieldName.PAGE_REF||!u)return t;var g=(null!==(o=e.bookmark.getBookmarkInfo(u))&&void 0!==o?o:{}).annotationRange;if(!g)return t;var d=e.getPageIndexByGcp(g.begin()).toString(),y=s.range;h.Gh.deleteText(y,n);var f=e.state.getTextStream().createRunIterator(y).getCloneProperty();return h.Gh.insertText(y.begin(),d,f,n),t}),[]),n.setCommandType(p.Type.DocUpdateField),this.state.applyDelta(n)},t}(),Fo=function(){function t(t){this._state=t}var e;return t.prototype.getSelection=function(){return this._selection||(this._selection=new zn(this._state)),this._selection},t.prototype.getDocument=function(){return this._document||(this._document=new io(this._state)),this._document},t.prototype.getTranslate=function(){return this._translate||(this._translate=new so(this._state,this.getDocument())),this._translate},t.prototype.getTextframes=function(){return this._textframes||(this._textframes=new Kr(this._state)),this._textframes},t.prototype.getNumbering=function(){return this._numbering||(this._numbering=new po(this._state,this.getSelection())),this._numbering},t.prototype.getMarkdown=function(){return this._markdown||(this._markdown=new co(this._state,this)),this._markdown},t.prototype.getComment=function(){return this._comment||(this._comment=new mo(this._state)),this._comment},t.prototype.getFontService=function(){return this._fontService||(this._fontService=new To(this._state)),this._fontService},t.prototype.getQuote=function(){return this._quote||(this._quote=new So(this._state)),this._quote},t.prototype.getBookmark=function(){return this._bookmark||(this._bookmark=new bo(this._state)),this._bookmark},t.prototype.getNote=function(){return this._note||(this._note=new Zn(this._state)),this._note},t.prototype.getPermissionRange=function(){return this._permissionRange||(this._permissionRange=new Co(this._state)),this._permissionRange},t.prototype.getRestrictEdit=function(){return this._state.getRestrictEdit()},t.prototype.getRevision=function(){return this._revision||(this._revision=new Io(this._state)),this._revision},t.prototype.getPageRef=function(){return this._pageRef||(this._pageRef=new Do(this._state,this.getBookmark())),this._pageRef},t=(0,i.__decorate)([(0,i.__param)(0,l.yg),(0,i.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==l.ZM&&l.ZM)?e:Object])],t)}(),Eo=function(t){t.factory.inject(c.vHF,(0,u.vM)(Fo))},Mo=r(87363),Lo=r.n(Mo),Ao="melo-caret",Bo=function(t,e){this.current=t,this.zoom=e},No=Math.min,Oo=Math.max,ko=function(t){function e(e,r){return t.call(this,e,r)||this}return(0,i.__extends)(e,t),e.prototype.calculate=function(){var t=this.findFollowInCurrentParagraph(),e=this.italicOf(t),r=No(this.caretHeightOf(t),this.lineHeight()),n=this.determineBottom(t)-r;return{x:this.xOf(this.current),y:n,height:r,italic:e}},e.prototype.determineBottom=function(t){var e=this.caretHeightOf(t),r=this.lineHeight();if(!this.inSameLine(t,this.current)){var n=this.findFollowInCurrentLine();return n?this.caretHeightOf(n)>e?this.bottomOf(n)-.22*this.caretHeightOf(n)+.22*e:this.bottomOf(n):this.bottomOfCurrentLineBox()}return e>r?this.bottomOfCurrentLineBoxWithTextBox():this.bottomOf(t)},e.prototype.lineHeight=function(){var t=this.getParentLineBox(this.current);return t?(0,o.FJ)(No(t.totalHeight,t.rect.height)):0},e.prototype.getParentLineBox=function(t){for(var e=t.leafBox;e&&!(0,c.o70)(e);)e=e.parentBox;return e},e.prototype.findFollowInCurrentParagraph=function(){return(0,Q.$Zc)(this.current,!1)},e.prototype.findFollowInCurrentLine=function(){var t=(0,Q.$Zc)(this.current,!0);return(0,c.NFz)(t.leafBox)?t:null},e.prototype.inSameLine=function(t,e){return this.getParentLineBox(t)===this.getParentLineBox(e)},e.prototype.caretHeightOf=function(t){return t.caretHeight(this.zoom)},e.prototype.xOf=function(t){return t.getDocumentOffset(this.zoom).x},e.prototype.yOf=function(t){return t.getDocumentOffset(this.zoom).y},e.prototype.bottomOf=function(t){return this.yOf(t)+this.caretHeightOf(t)},e.prototype.bottomOfCurrentLineBox=function(){var t=this.getParentLineBox(this.current),e=kr.MM.getOffsetPoint(t,c.uOS.Document).y;return(0,o.FJ)(e)+this.lineHeight()},e.prototype.bottomOfCurrentLineBoxWithTextBox=function(){var t=this.getParentLineBox(this.current);if(!t)return 0;var e=kr.MM.getOffsetPoint(t,c.uOS.Document).y;return(0,o.FJ)(e+Oo(t.edge.top,0))+this.lineHeight()},e.prototype.italicOf=function(t){return!!(0,c.NFz)(t.leafBox)&&t.leafBox.textStyle.i.val},e}(Bo),Go=function(t){function e(e){var r=t.call(this,e)||this;return r.timeout=0,r.viewRange=null,r.onCaretShow=function(){return r.setState({isShown:!0})},r.onCaretHidden=function(){return r.setState({isShown:!1})},r.caretChange=function(t){var e;(null===(e=r.props.context.surface)||void 0===e?void 0:e.isEditable())&&(r.update(t.viewRange),r.setState({isBlink:!0}))},r.hexToRgb=function(t){var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},r.rgbToHsv=function(t){var e=t.r,r=t.g,n=t.b,o=Math.max(e,r,n),i=Math.min(e,r,n),a=o-i,s=0,l=0===o?0:a/o,p=o/255;switch(o){case i:s=0;break;case e:s=r-n+a*(r<n?6:0),s/=6*a;break;case r:s=n-e+2*a,s/=6*a;break;case n:s=e-r+4*a,s/=6*a}return{h:s,s:l,v:p}},r.state={posX:0,posY:0,caretHeight:0,isCaret:!0,isBlink:!1,focus:!1,exceeded:!1,caretItalic:c.JjT.Undefined,blockCaretShow:!1,darkBackground:!1,isShown:!0},r}return(0,i.__extends)(e,t),e.prototype.shouldComponentUpdate=function(t,e){return this.state.focus||e.focus},e.prototype.componentDidMount=function(){this.props.context.on(c.DkJ.ON_POS_UPDATE,this.onPosUpdate,this),this.props.context.on(Q.cbw.ON_FOCUS,this.onFocus,this),this.props.context.on(Q.cbw.ON_BLUR,this.onBlur,this),this.props.context.on(Q.kgn.TABLE_DID_SCROLL,this.onComponentScroll,this),this.props.context.on(Q.kgn.TEXTFRAME_DID_SCROLL,this.onComponentScroll,this),this.props.context.on(c.GPM.ON_DRAG,this.onCaretDrag,this),this.props.context.once(Q.kgn.CARET_CHANGE,this.caretChange),this.props.context.on(h.at.CusorPropChange,this.updateCaretItalic,this),this.props.context.on(Q.Lll.HIDDEN,this.onCaretHidden),this.props.context.on(Q.Lll.SHOW,this.onCaretShow)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(c.DkJ.ON_POS_UPDATE,this),this.props.context.removeListener(Q.cbw.ON_FOCUS,this),this.props.context.removeListener(Q.cbw.ON_BLUR,this),this.props.context.removeListener(Q.kgn.TABLE_DID_SCROLL,this),this.props.context.removeListener(Q.kgn.TEXTFRAME_DID_SCROLL,this),this.props.context.removeListener(c.GPM.ON_DRAG,this),this.props.context.removeCallBack(Q.kgn.CARET_CHANGE,this.caretChange),this.props.context.removeCallBack(h.at.CusorPropChange,this.updateCaretItalic),this.props.context.removeCallBack(Q.Lll.HIDDEN,this.onCaretHidden),this.props.context.removeCallBack(Q.Lll.SHOW,this.onCaretShow)},e.prototype.componentDidUpdate=function(){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.isVisible()?t.setState({isBlink:!0}):(t.setState({isBlink:!1}),clearTimeout(t.timeout))}),500)},e.prototype.onPosUpdate=function(t){t&&t.data instanceof Q.rOq&&(this.viewRange=t.data,this.update(t.data))},e.prototype.onCaretDrag=function(t){t&&(t.dragAction===c.ZkC.START_DRAG?this.setState({blockCaretShow:!0}):(t.dragAction,c.ZkC.END_DRAG,this.setState({blockCaretShow:!1})))},e.prototype.isCursorExceedEditRange=function(t,e,r){var n=t.getDocumentOffset(this.props.zoom()||1),o=n.docWidth,i=n.docHeight;return this.isCursorExceedEditRangeInPc(e,r,o,i)},e.prototype.isCursorExceedEditRangeInMobile=function(t,e,r,n){return!this.props.service.getSelection().isSelectionAtTextFrame()&&(t<0||t>r||e<0||e>n)},e.prototype.isCursorExceedEditRangeInPc=function(t,e,r,n){var i=this.props.context;if(this.props.service.getSelection().isInTable())return this.isCursorExceedTable();var a=Q.d_x.findRootContainerBox(i.getDocumentBox());if(a){var s=0,l=0,p=a.edge.padding,c=p.left,u=p.right;if(this.props.service.getSelection().isSelectionAtCodeblock())return s=Math.floor((0,o.FJ)(c)),l=Math.floor((0,o.FJ)(u)),t<s||t>r-l||e<0||e>n}return!1},e.prototype.isRealShape=function(t){return t instanceof Q.SE$&&!!t.leafBox.getAncestorBy(c.tJJ)},e.prototype.isCursorExceedRealShape=function(t){if(!(t instanceof Q.SE$))return!1;var e=t.leafBox,r=e.getAncestorBy(c.tJJ);if(!r)return!1;var n=kr.MM.getOffsetPoint(e,(0,c.$o4)(r)),i=this.props.context.view.getRenderState(),a=(0,Q.UY)(r,i),s=r.getOriginSizeBox().rect,l=s.width,p=s.height,u=n.x,g=n.y;return u<0||u-(0,o.Ej)(a.left)>l||g<0||g-(0,o.Ej)(a.top)>p},e.prototype.isCursorExceedTable=function(){var t=this.getTableScrollInfo();if(!t)return!1;var e=t.tableScrollLeft,r=t.tableContainerWidth,n=this.getPointOffsetInTable();return null!==n&&(n<e||n>e+r)},e.prototype.getTableScrollInfo=function(){var t,e=null===(t=this.viewRange)||void 0===t?void 0:t.start;if(!e||!(0,c.Dyp)(e.leafBox))return null;var r=kr.s9.getOutestTableBox(e.leafBox);if(!r)return null;var n=this.props.context,i="table-".concat(r.tableId),a=n.view.getRenderState().getScrollerInfo(i);return a?{tableScrollLeft:(0,o.Ej)(a.left),tableContainerWidth:r.rectSize.width}:null},e.prototype.getPointOffsetInTable=function(){var t,e=null===(t=this.viewRange)||void 0===t?void 0:t.start;if(!e||!(0,c.Dyp)(e.leafBox))return null;var r=e.leafBox,n=this.props.zoom()||1,i=e.leafBoxOffset(n);return void 0===i?null:kr.MM.getBoxOffset(r,(function(t){return(0,c.YPi)(t)&&t.nestingLevel===p.DEFAULT_TABLE_NESTING_LEVEL})).x+(0,o.Ej)(i)},e.prototype.getPrevContentCaretCalculate=function(t,e){for(var r,n=t.gcp-1,o=t.leafBox.prevSibling,i=this.props.context.state.getTextStream();(0,p.isFootnoteEndnoteReference)(i,new p.GCPRange(n,1));)n-=1,o=null==o?void 0:o.prevSibling;if(o)return null==(r=new ko(new Q.SE$(o.nextSibling,0,n+1),e))?void 0:r.calculate()},e.prototype.update=function(t){var e,r,n;if((null===(e=this.props.context.surface)||void 0===e?void 0:e.isEditable())&&t.isCaret()){var o,i,a=this.props.context.state.getTextStream(),s=this.getRealViewPoint(t.start),l=this.props.zoom()||1,c=new ko(s,l).calculate(),u=c.x,g=c.y,h=c.height,d=c.italic;if((0,p.isFootnoteEndnoteReference)(a,new p.GCPRange(s.gcp-1,1))){var y=this.getPrevContentCaretCalculate(s,l);y&&(o=y.height,i=y.y)}var f=d||!!(null===(n=null===(r=this.props.context.state.cusorSpanProp)||void 0===r?void 0:r.i)||void 0===n?void 0:n.val);if(this.isCursorExceedEditRange(s,u,i||g)||this.isCursorExceedRealShape(s))this.setState({exceeded:!0,isBlink:!1});else{var v=this.applyContextPadding(u,i||g),m=v.posX,P=v.posY;this.setState({posX:m,posY:P,caretHeight:o||h,isCaret:t.isCaret(),isBlink:!1,exceeded:!1,caretItalic:f&&!0,darkBackground:this.isRealShape(s)||this.isDarkBackground()})}}else this.setState({isCaret:!1,isBlink:!1})},e.prototype.updateCaretItalic=function(){var t=this.props.service.getSelection().getFont().isItalic();this.setState({caretItalic:t&&!0})},e.prototype.getRealViewPoint=function(t){if(!(t instanceof Q.SE$))return t;var e=t.leafBox.parentBox;if((0,c.tqe)(e)){var r=0===t.charsOffset?e.firstChild:e.lastChild;return new Q.SE$(r,t.charsOffset,t.gcp)}return t},e.prototype.applyContextPadding=function(t,e){var r=this.props.context.view.getPadding();return this.props.zoom(),{posX:t+r.left,posY:e+r.top}},e.prototype.onFocus=function(){var t,e;if(null===(t=this.props.context.surface)||void 0===t?void 0:t.isEditable()){var r=this.props.service.getSelection().getStart(),n=this.props.service.getSelection().getEnd();this.setState({focus:!0,isBlink:!1,isCaret:!!(null===(e=this.viewRange)||void 0===e?void 0:e.isCaret())&&r===n})}},e.prototype.onBlur=function(){this.setState({focus:!1,isBlink:!1})},e.prototype.getTransform=function(){return this.state.caretItalic?o.wV.isIE()||o.wV.isWeWorkWin()?"rotate(19deg)":"rotate(13deg)":""},e.prototype.getTransformOrigin=function(){return this.state.caretItalic?"right 80%":"center center"},e.prototype.isVisible=function(){return this.state.isCaret&&this.state.focus&&!this.state.exceeded&&!this.state.blockCaretShow&&this.state.isShown&&!this.props.context.state.listMarkerSpanProp&&this.props.service.getPermissionRange().checkPermissionRange()&&this.props.context.state.getRestrictEdit().checkPermissionRange()},e.prototype.isDarkBackground=function(){var t=this.props.service.getSelection().getFont().getTextFillColor().toString();if(this.isColorDark(p.PropertyColorUtil.parseHexColor(t,p.Defaults.bgColor)))return!0;var e=this.props.service.getSelection().getTableSelectionService();if(!e)return!1;var r=this.props.service.getSelection().getRange().range().gcpBegin,n=e.getCellProperty(r);return!!n&&this.isColorDark(p.PropertyColorUtil.parseShadingProperties(n.shd,p.Defaults.bgColor))},e.prototype.isColorDark=function(t){if("transparent"===t)return!1;var e=new RegExp("([0-9｜A-F｜a-f]{6})").exec(t);if(e){var r=(0,i.__read)(e,2),n=(r[0],r[1]);return(a=this.rgbToHsv(this.hexToRgb(n))).v<.5||a.h>.5&&a.s>.5}var o=new RegExp("rgb\\((\\d{1,3})\\,\\s*(\\d{1,3})\\,\\s*(\\d{1,3})\\)").exec(t);if(o){var a,s=(0,i.__read)(o,4),l=(s[0],s[1]),p=s[2],c=s[3];return(a=this.rgbToHsv({r:parseInt(l,10),g:parseInt(p,10),b:parseInt(c,10)})).v<.5||a.h>.5&&a.s>.5}return!1},e.prototype.onComponentScroll=function(){var t=this;this.setState({blockCaretShow:!0,exceeded:!1}),this.onComponentScrollTimeout||(this.onComponentScrollTimeout=(0,o.Ds)((function(){t.setState({blockCaretShow:!1}),t.viewRange&&t.isVisible()&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.update(t.viewRange))}),500)),this.onComponentScrollTimeout()},e.prototype.render=function(){var t=[Ao],e=!this.props.context.isInBlockState()&&this.isVisible();return this.state.isBlink&&!this.state.blockCaretShow&&(this.state.darkBackground?t.push("melo-caret-blink-white"):t.push("melo-caret-blink-transparent")),Lo().createElement("div",{className:t.join(" "),style:{position:"absolute",height:this.state.caretHeight,width:"".concat(1,"px"),left:this.state.posX-.5,top:this.state.posY,display:e?"block":"none",backgroundColor:p.Defaults.caretColor,transform:this.getTransform(),transformOrigin:this.getTransformOrigin()}})},e}(Lo().Component),Ho="melo-hidden-editor",Wo="melo-hidden-editor-mobile",Uo=function(t){function e(e){var r=t.call(this,e)||this;return r.isFocus=!1,r.inputDomRef=null,r.compositionId="",r.viewRange=null,r.forceFocus=!0,r.spaceReg=new RegExp(p.PlaceholderChar.NonBreakSpace,"g"),r.caretChangedCompositionId="",r.isWindows=!1,r.props.viewRange&&(r.viewRange=r.props.viewRange),r.state={posX:0,posY:0},r.isWindows=o.wV.isWindows(),r.contentEditable=o.wV.isSafari()||o.wV.isMac()&&(o.wV.isTencentDocsDesktopApp()||o.wV.isWeWork())?"plaintext-only":"true",r}var r,n,a;return(0,i.__extends)(e,t),e.prototype.componentDidMount=function(){var t,e=this;this.props.context.on(c.V6o.MOUSE_EVENT,this.onMouseEvent,this),this.props.context.on(Q.kgn.CARET_CHANGE,this.onSelectionChanged,this),setTimeout((function(){e.viewRange&&(e.forceFocus=!0,e.update())}));var r=document.createEvent("CustomEvent");r.initCustomEvent("performance_edit_hidden_input_inited",!0,!0,{}),document.dispatchEvent(r),t=(0,i.__read)([this.onInput,this.onCompositionStart,this.onKeyDown].map((function(t){return function(r){return(0,i.__awaiter)(e,void 0,void 0,(function(){var e,n;return(0,i.__generator)(this,(function(o){return this.props.context.usePermissionRangeMode()||this.props.context.isRestrictProtectOn?(e=this.props.service.getPermissionRange().checkPermissionRange(),n=this.props.state.getRestrictEdit().checkPermissionRange(),e&&n?t.call(this,r):this.inputDomRef&&(this.inputDomRef.textContent=""),[2]):(t.call(this,r),[2])}))}))}})),3),this.onInput=t[0],this.onCompositionStart=t[1],this.onKeyDown=t[2]},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(c.V6o.MOUSE_EVENT,this),this.props.context.removeListener(Q.kgn.CARET_CHANGE,this)},e.prototype.isEditingField=function(){var t,e=this.props.context.service.getDocument().getTextFromGcpRange(this.props.context.service.getSelection().range()),r=p.FieldUtil.decodeFieldCode(e);if(!r)return!1;var n=p.FieldCodeManager.getInstance().getFieldProcessorByFieldCodeInfo(r);return null!==(t=null==n?void 0:n.isProhibitForcesFocus(e,r,this.props.context.uuid))&&void 0!==t&&t},e.prototype.componentDidUpdate=function(){this.isEditingField()||(this.isFocus||this.forceFocus)&&this.setFocus()},e.prototype.onMouseEvent=function(t){!t||t.mouseAction!==c.oXr.CLICK&&t.mouseAction!==c.oXr.DOUBLE_CLICK&&t.mouseAction!==c.oXr.TRIPLE_CLICK&&t.mouseAction!==c.oXr.LONG_CLICK||(this.forceFocus=!0,this.update())},e.prototype.onSelectionChanged=function(t){var e;if(t.viewRange){if(this.caretChangedCompositionId.length>0&&this.caretChangedCompositionId===this.compositionId&&t.option&&!0===t.option.forceNotify)return;this.viewRange=t.viewRange,this.forceFocus=!!(null===(e=t.option)||void 0===e?void 0:e.forceFocus),this.update()}},e.prototype.requestFocus=function(t){t&&(this.viewRange=t),this.forceFocus=!0,this.update(),this.props.context.fire(new Q.D_l(Q.cbw.ON_REQUEST_FOCUS,t))},e.prototype.requestBlur=function(){this.inputDomRef&&this.inputDomRef.blur(),this.props.context.fire(new Q.D_l(Q.cbw.ON_REQUEST_BLUR))},e.prototype.setFocus=function(){var t=this.props.scrollHandler.getScrollLeft(),e=this.props.scrollHandler.getScrollTop();this.inputDomRef&&this.inputDomRef.focus({preventScroll:!0}),this.props.scrollHandler.scrollTo(t,e)},e.prototype.update=function(){if(this.viewRange&&this.viewRange.start.documentBox){var t=(0,i.__assign)({},this.viewRange.start.getDocumentOffset(this.props.zoom())),e=t.x,r=t.y;Math.max(0,t.x),e=Math.min(t.docWidth,t.x),Math.max(0,t.y),r=Math.min(t.docHeight,t.y);var n=this.props.context.view.getPadding(),o=this.viewRange.start.caretHeight(this.props.zoom());this.setState({posX:e+(n.left||0),posY:r+(n.top||0)+o-5}),this.props.context.fire(new c.fV1(c.DkJ.ON_POS_UPDATE,this.viewRange),!1)}},e.prototype.onCompositionStart=function(){window.isPublishedURL?this.requestBlur():this.isEditable&&(this.props.service.getSelection().isSelectionAtShape()&&Kr.inputTextframe(this.props.state,"",this.props.service.getSelection().getRange()),this.compositionId="input_".concat(o.m7.generateRandomId()),this.props.state.compositionStart(this.compositionId,!0),this.props.context.fire(new c.fV1(c.DkJ.ON_COMPOSITION_START,null)))},e.prototype.onCompositionUpdate=function(t){if(this.isEditable){var e=void 0;e=o.wV.isIE()&&this.inputDomRef?this.inputDomRef.textContent:t.nativeEvent.data;var r=(0,p.getPrintableText)(e);this.checkReportControlChars(r,e),this.props.state.compositionUpdate(this.compositionId,r,!0)}},e.prototype.onCompositionEnd=function(t){if(this.isEditable){var e=void 0;e=o.wV.isIE()&&this.inputDomRef?this.inputDomRef.textContent:t.nativeEvent.data;var r=(0,p.getPrintableText)(e);this.checkReportControlChars(r,e),this.props.state.compositionEnd(this.compositionId,r),this.props.context.fire(new c.fV1(c.DkJ.ON_COMPOSITION_END,r)),this.props.context.fire(new c.fV1(c.DkJ.ON_INPUT,r))}this.inputDomRef&&(this.inputDomRef.textContent=""),this.compositionId=""},e.prototype.onInput=function(){var t=this;setTimeout((function(){t.compositionId.length<=0&&t.finishInput()}),0)},e.prototype.onKeyUp=function(){var t=this;o.wV.isIE()&&setTimeout((function(){t.compositionId.length<=0&&t.finishInput()}),100)},e.prototype.onKeyDown=function(t){var e=this,r=t.keyCode;229===t.keyCode&&"ArrowLeft"===t.key&&(r=u.VD.ARROW_LEFT),setTimeout((function(){e.controlCaretWhenComposition(r)}),50)},e.prototype.controlCaretWhenComposition=function(t){var e;if(this.compositionId.length>0){if(!this.isWindows&&(t===u.VD.ARROW_LEFT&&this.caretChangedCompositionId!==this.compositionId&&(this.caretChangedCompositionId=this.compositionId),this.caretChangedCompositionId!==this.compositionId))return;var r=this.inputDomRef;if(!r)return;var n=this.getCaretPosition(r),o=null===(e=this.props.state.getCompositionRange(this.compositionId))||void 0===e?void 0:e.begin();if(void 0===o||-1===n)return;this.props.state.setRangeTo(new p.GCPRange(o+n,0))||(this.caretChangedCompositionId="")}},e.prototype.getCaretPosition=function(t){var e=-1,r=t.ownerDocument||t.document,n=r.defaultView||r.parentWindow,o=document.selection;if((null==o?void 0:o.createRange)&&"Control"!==(null==o?void 0:o.type)){var i=o.createRange(),a=r.body.createTextRange();return a.moveToElementText(t),a.setEndPoint("EndToEnd",i),a.text.length}if(void 0!==n.getSelection&&n.getSelection().rangeCount>0){var s=n.getSelection().getRangeAt(0),l=s.cloneRange();l.selectNodeContents(t),l.setEnd(s.endContainer,s.endOffset),e=l.toString().length}return e},e.prototype.finishInput=function(){if(this.isEditable&&this.inputDomRef){var t=this.inputDomRef.textContent||"";this.inputDomRef.textContent="";var e=(0,p.getPrintableText)(t);this.checkReportControlChars(e,t),e&&(t=e.replace(this.spaceReg,p.PlaceholderChar.Space),this.props.service.getSelection().typeText(t),this.props.context.fire(new c.fV1(c.DkJ.ON_INPUT,t)))}},e.prototype.onClipboardEvent=function(t){t.preventDefault()},e.prototype.onFocus=function(t){t.preventDefault(),this.isFocus=!0,this.props.context.fire(new Q.D_l(Q.cbw.ON_FOCUS))},e.prototype.onBlur=function(t){var e=this;t.preventDefault(),this.isFocus=!1,setTimeout((function(){e.isFocus||e.props.context.fire(new Q.D_l(Q.cbw.ON_BLUR))}),300)},e.prototype.checkReportControlChars=function(t,e){t.length!==e.length&&u.kQ.tdwReport({opername:"doc_word_editor",module:"doc_input",action:"controlCharsInput",ver5:escape(e)})},Object.defineProperty(e.prototype,"isEditable",{get:function(){var t;return null===(t=this.props.context.surface)||void 0===t?void 0:t.isEditable()},enumerable:!1,configurable:!0}),e.prototype.render=function(){var t=this;return Lo().createElement("div",{id:Ho,contentEditable:this.contentEditable,ref:function(e){t.inputDomRef=e},onInput:this.onInput.bind(this),onKeyUp:this.onKeyUp.bind(this),onKeyDown:this.onKeyDown.bind(this),onCompositionStart:this.onCompositionStart.bind(this),onCompositionUpdate:this.onCompositionUpdate.bind(this),onCompositionEnd:this.onCompositionEnd.bind(this),onCopy:this.onClipboardEvent.bind(this),onCut:this.onClipboardEvent.bind(this),onPaste:this.onClipboardEvent.bind(this),onFocus:this.onFocus.bind(this),onBlur:this.onBlur.bind(this),spellCheck:!1,tabIndex:0,role:"textbox","aria-label":"腾讯文档正文内容","aria-activedescendant":"accessibility-placeholder","aria-owns":"accessibility-placeholder",style:{left:this.state.posX,top:this.state.posY}})},(0,i.__decorate)([(0,u.o3)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==Lo()&&Lo().CompositionEvent)?r:Object]),(0,i.__metadata)("design:returntype",void 0)],e.prototype,"onCompositionUpdate",null),(0,i.__decorate)([(0,u.o3)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(n=void 0!==Lo()&&Lo().CompositionEvent)?n:Object]),(0,i.__metadata)("design:returntype",void 0)],e.prototype,"onCompositionEnd",null),(0,i.__decorate)([(0,u.o3)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[]),(0,i.__metadata)("design:returntype",void 0)],e.prototype,"onInput",null),(0,i.__decorate)([(0,u.o3)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[]),(0,i.__metadata)("design:returntype",void 0)],e.prototype,"onKeyUp",null),(0,i.__decorate)([(0,u.o3)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(a=void 0!==Lo()&&Lo().KeyboardEvent)?a:Object]),(0,i.__metadata)("design:returntype",void 0)],e.prototype,"onKeyDown",null),e}(Lo().Component),Vo="melo-mobile-drag-container",zo="melo-mobile-caret-container",Ko="melo-mobile-selection-drag-left-ios",jo="melo-mobile-selection-drag-right-ios",Yo="melo-mobile-caret-drag-android",qo="melo-mobile-selection-drag-left-android",Qo="melo-mobile-selection-drag-right-android",Xo="melo-mobile-selection-caret-container",Jo="melo-mobile-selection-caret";!function(t){t[t.bottom=1]="bottom",t[t.top=-1]="top"}(vo||(vo={}));var Zo,$o=function(){function t(t){this.scrollRoot=t,this.startScrollTime=0}return t.prototype.startScroll=function(t){var e=this;t&&this.setScrollDirection(t),this.startScrollTime=Date.now(),this.animationTicker=requestAnimationFrame((function(){return e.handlerScroll()}))},t.prototype.cancelScroll=function(){this.animationTicker&&cancelAnimationFrame(this.animationTicker)},t.prototype.setScrollDirection=function(t){this.direction=t},t.prototype.getScrollDirection=function(){return this.direction},t.prototype.restart=function(){this.startScrollTime=Date.now(),this.cancelScroll(),this.startScroll()},t.prototype.getDirectionFactor=function(){return this.direction===vo.bottom?1:-1},t.prototype.handlerScroll=function(){var t=this,e=(Date.now()-this.startScrollTime)/3e3;e>=1&&(e=1);var r,n=30*(r=e,1-Math.pow(1-r,3))*this.getDirectionFactor(),o=this.scrollRoot.scrollHeight-this.scrollRoot.clientHeight,i=this.scrollRoot.scrollTop+n;return this.direction===vo.bottom&&i>o?(this.scrollRoot.scrollTop=o,void cancelAnimationFrame(this.animationTicker)):this.direction===vo.top&&i<0?(this.scrollRoot.scrollTop=0,void cancelAnimationFrame(this.animationTicker)):(this.scrollRoot.scrollTop=i,void(this.animationTicker=requestAnimationFrame((function(){return t.handlerScroll()}))))},t}();!function(t){function e(e){var r=t.call(this,e)||this;return r.draggerRef=Lo().createRef(),r.upBound=5,r.bottomBound=20,r.fingerOffset=50,r.dragContainerWidth=30,r.dragContainerHeight=30,r.LONG_TOUCH_TIME=300,r.caretPosYBeforeTouch=0,r.onTouchStart=function(t){r.props.context.isInBlockState()||(r.isParallelMoving=!0,r.clearDragFlagTimeoutId(),r.longTouch(t).then((function(t){var e,n=null===(e=r.selector.getSelection())||void 0===e?void 0:e.viewRange;if(n&&!r.isImageBox(n.start.leafBox)&&r.canDrag()&&"SELECT"===t){var o=n.start.gcp;(0,c.eJq)(n.start.leafBox)&&(o=n.start.leafBox.getRangeBegin()),r.doSelectStart(o)}})).catch((function(){r.clearDragFlagTimeoutId()})))},r.onTouchMove=function(t){r.props.context.isInBlockState()||(r.clearDragFlagTimeoutId(),r.doDragMove(t))},r.onTouchEnd=function(t){r.props.context.isInBlockState()||(r.clearDragFlagTimeoutId(),r.doDragEnd(t))},r.throttleIfUpdateCaret=(0,o.P2)((function(t){r.updateCaret(t)}),50),r.selector=r.props.overlay.touchSelector,r.state={posX:0,posY:0,caretHeight:0,visible:!1,componentScrolling:!1,clientX:0,clientY:0,isDragTouch:!1,followFingerPosX:0,followFingerPosY:0,isReadyToDrag:!1},r}(0,i.__extends)(e,t),e.prototype.shouldComponentUpdate=function(t,e){return this.state.visible||e.visible},e.prototype.componentDidMount=function(){this.props.scrollRoot.addEventListener("touchmove",this.onTouchMove),this.props.scrollRoot.addEventListener("touchstart",this.onTouchStart),this.props.scrollRoot.addEventListener("touchend",this.onTouchEnd)},e.prototype.componentWillUnmount=function(){this.props.scrollRoot.removeEventListener("touchmove",this.onTouchMove),this.props.scrollRoot.removeEventListener("touchstart",this.onTouchStart),this.props.scrollRoot.removeEventListener("touchend",this.onTouchEnd)},e.prototype.onRequestFocus=function(){this.blurOnTimeout()},e.prototype.onPosUpdate=function(t){t&&t.data instanceof Q.rOq&&(this.viewRange=t.data,this.state.isDragTouch||this.updateFakeCaret(t.data))},e.prototype.handleCaretInDocumentArea=function(t,e,r,n){var o=this,i=this.props.context.view.getPadding(),a=e+(i.left||0),s=r+(i.top||0),l=n.caretHeight(this.props.zoom()),p=(this.state.isDragTouch,!0),c=t.isCaret()&&l>0&&(void 0!==this.blurTimeoutId||!1)&&p;this.setState({posX:a,posY:s,caretHeight:l,visible:c,isReadyToDrag:!1},(function(){setTimeout((function(){o.setState({isReadyToDrag:!0})}),100)}))},e.prototype.updateFakeCaret=function(t){var e;if(t)if((null===(e=this.props.context.surface)||void 0===e?void 0:e.isEditable())&&t.isCaret()){var r=(0,Q.$Zc)(t.start),n=r.getDocumentOffset(this.props.zoom()),o=n.x,i=n.y,a=n.docWidth,s=n.docHeight;o<0||o>a||i<0||i>s?this.setState({visible:!1}):this.handleCaretInDocumentArea(t,o,i,r)}else this.setState({visible:!1})},e.prototype.blurOnTimeout=function(){var t=this;this.caretDragRef&&this.caretDragRef.classList.remove("melo-caret-drag-trans-anim"),this.blurTimeoutId&&clearTimeout(this.blurTimeoutId),this.blurTimeoutId=setTimeout((function(){t.caretDragRef&&(t.caretDragRef.classList.add("melo-caret-drag-trans-anim"),setTimeout((function(){t.setState({visible:!1})}),300))}),2800)},e.prototype.sendTouchEvent=function(t){var e=this.calTouchEventHitPoint(t);this.props.context.fire(new Q.NkY(t,e),!1)},e.prototype.onBlur=function(){this.setState({visible:!1})},e.prototype.isSelectionDragVisable=function(){var t,e=document.querySelectorAll(".melo-mobile-selection-drag")[0];return"visible"===(null===(t=null==e?void 0:e.style)||void 0===t?void 0:t.visibility)},e.prototype.longTouch=function(t){var e=this,r=this.getCaretPoint();return this.caretPosYBeforeTouch=r.clientCaretY,new Promise((function(n,o){e.dragFlagTimeoutId=setTimeout((function(){var i,a=e.getTouchPoint(t);if(a){var s=e.iosDragTriggerScope(r,a);if(e.isSelectionDragVisable()&&s)o();else{var l=e.getHitPoint(a);if(e.selector.onTouchEvent(t,l)){var p=null===(i=e.selector.getSelection())||void 0===i?void 0:i.viewRange;p?(s&&(null==p?void 0:p.isCaret())&&n("DRAG"),s||n("SELECT"),o()):o()}else o()}}}),e.LONG_TOUCH_TIME)}))},e.prototype.doSelectStart=function(t){this.props.context.run("selectWord",t)},e.prototype.doDragStart=function(t){var e=this;this.canDrag((function(t){return e.updateFakeCaretByGCPRange(t)}))},e.prototype.doDragMove=function(t){var e=this;!this.state.isDragTouch||(t.cancelable&&t.preventDefault(),this.canDrag((function(t){return e.updateFakeCaretByGCPRange(t)})))},e.prototype.doDragEnd=function(t){var e=this;this.canDrag((function(t){return e.updateFakeCaretByGCPRange(t)}))},e.prototype.doAndroidDragStart=function(){var t;(null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange)&&(this.setState({isDragTouch:!0}),this.dragStartUtil())},e.prototype.doAndroidDragEnd=function(t){this.state.isDragTouch&&(this.updateCaret(t),this.dragEndUtil(),this.setState({isDragTouch:!1}))},e.prototype.updateFakeCaretByGCPRange=function(t){if(t){var e=this.props.context;if(e instanceof Ct.zq){var r=e.getViewRangeFromGcpRange(t);this.updateFakeCaret(r)}}},e.prototype.doIOSDragStart=function(t){var e,r=null===(e=this.selector.getSelection())||void 0===e?void 0:e.viewRange;r&&(this.dragStartUtil(),this.updateFakeCaret(r),this.updateCaretForIOS(t),this.setState({isDragTouch:!0,visible:!0}))},e.prototype.doIOSDragEnd=function(t){this.state.isDragTouch&&(this.throttleIfUpdateCaret(t),this.dragEndUtil(),this.setState({visible:!1,isDragTouch:!1}))},e.prototype.dragStartUtil=function(){this.props.scrollHandler.disableScrollOnSelectionChanged(),this.startAutoScrollChecker(),this.props.context.fire(new c.CCO(c.ZkC.START_DRAG))},e.prototype.dragEndUtil=function(){var t,e;this.selector.finishMoving(),this.props.scrollHandler.enableScrollOnSelectionChanged(),this.stopAutoScroll(),this.props.context.fire(new c.CCO(c.ZkC.END_DRAG));var r=null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange;null===(e=this.props.context.surface)||void 0===e||e.requestFocus(r)},e.prototype.clearDragFlagTimeoutId=function(){this.dragFlagTimeoutId&&clearTimeout(this.dragFlagTimeoutId),this.dragFlagTimeoutId=void 0},e.prototype.isImageBox=function(t){return!(!(0,c.AOC)(t)&&!(0,c.qMb)(t))},e.prototype.canDrag=function(t){var e,r,n,o,i;if(null===window||void 0===window?void 0:window.isPublishedURL)return!0;var a=this.props.context;if(a instanceof Ct.zq&&a.isRestrictProtectOn){var s=null===(r=null===(e=this.selector.getSelection())||void 0===e?void 0:e.viewRange)||void 0===r?void 0:r.getGCPRange();if(!s)return!0;if(!a.state.getRestrictEdit().checkPermissionRangeByGcpRange(s)){var l=a.state.selection.getSdtSelection(),c=null===(i=null===(o=null===(n=a.service)||void 0===n?void 0:n.getDocument())||void 0===o?void 0:o.getSelection())||void 0===i?void 0:i.getSdtService();if(l.isWrappedSdtByRange(s))null==c||c.setRangeTo(0,0),t&&t(new p.GCPRange(0,0));else{var u=null==c?void 0:c.focusRangeToSdtByPosition(s,{focusToDefault:!1});t&&t(u)}return!1}}return!0},e.prototype.onRealDragTouchStart=function(t){t.preventDefault(),this.doDragStart(t)},e.prototype.onRealDragTouchMove=function(t){t.preventDefault(),this.blurOnTimeout(),this.doDragMove(t)},e.prototype.onRealDragTouchEnd=function(t){t.preventDefault(),this.blurOnTimeout(),this.sendTouchEvent(t),this.doDragEnd(t)},e.prototype.updateCaret=function(t){this.canDrag()},e.prototype.updateCaretForIOS=function(t){var e,r=this.getTouchPoint(t);if(r){var n=r.clientTouchX,i=r.clientTouchY,a=r.documentTouchY,s=r.resultNode;this.isParallelMoving&&!this.touchInLine(a)&&(this.isParallelMoving=!1),this.updateFollowFingerCaret(r);var l=this.getRealCaretUpOffset(),p=this.getHitPoint(r);p.y=this.isParallelMoving?p.y:p.y-(0,o.Ej)(l),this.selector.moveBoth({clientX:n,clientY:i-l,element:s},p),this.setState({clientX:r.clientTouchX,clientY:r.clientTouchY});var c=null===(e=this.selector.getSelection())||void 0===e?void 0:e.viewRange;c&&this.updateFakeCaret(c)}},e.prototype.updateCaretForAndroid=function(t){var e,r=this.getTouchPoint(t),n=this.getOffsetTouchPoint(t);if(r&&n){var o=n.clientTouchX,i=n.clientTouchY,a=n.resultNode,s=this.getHitPoint(n),l=this.props.scrollHandler,p=l.getScrollRootSize().bottom-l.getMobileBottomMargin();this.selector.moveBoth({clientX:o,clientY:Math.min(p,i+this.state.caretHeight/2),element:a},s),this.setState({clientX:r.clientTouchX,clientY:r.clientTouchY});var c=null===(e=this.selector.getSelection())||void 0===e?void 0:e.viewRange;c&&this.updateFakeCaret(c)}},e.prototype.updateFollowFingerCaret=function(t){var e=this.getFollowFingerCaretUpOffset(),r=t.documentTouchX,n=t.documentTouchY-e;this.isParallelMoving&&(n=this.getCaretPoint().documentCaretY),this.setState({followFingerPosX:r,followFingerPosY:n})},e.prototype.getFollowFingerCaretUpOffset=function(){return this.isParallelMoving?this.state.caretHeight/2:this.fingerOffset},e.prototype.getRealCaretUpOffset=function(){return this.getFollowFingerCaretUpOffset()-this.state.caretHeight/2},e.prototype.touchInLine=function(t){if(0===this.caretPosYBeforeTouch)return!0;var e=this.props.layoutController.getLayoutBox().__node__,r=null==e?void 0:e.getBoundingClientRect(),n=this.caretPosYBeforeTouch-(r.top||0),o=n-this.upBound,i=n+this.state.caretHeight+this.bottomBound;return t>o&&t<i},e.prototype.getTouchPoint=function(t){if(t.targetTouches){var e=t.targetTouches[0];e||"touchstart"!==t.type&&"touchmove"!==t.type&&"touchend"!==t.type||(e=t.changedTouches[0]);var r=e.clientX,n=e.clientY,o=this.props.layoutController.getLayoutBox().__node__;if(o){var i=o.getBoundingClientRect(),a={clientTouchX:r,clientTouchY:n,documentTouchX:r-(i.x||0),documentTouchY:n-(i.y||0),resultNode:o};return a.resultNode=this.getResultNode(a),a}}},e.prototype.getResultNode=function(t){var e=this.props.layoutController.getLayoutBox(),r=e.__node__;if(r){var n=r;if((0,c.gLh)(e)){var i=new o.DR({x:(0,o.Ej)(t.documentTouchX),y:(0,o.Ej)(t.documentTouchY)}),a=Q.d_x.getLeastGrandsonByPoint(e,i);n=a[0]&&a[0].__node__}return n}},e.prototype.getOffsetTouchPoint=function(t){},e.prototype.getAndroidOffsetTouchPoint=function(t){var e=this.getTouchPoint(t);if(e)return e.clientTouchY-=this.state.caretHeight/2+this.dragContainerHeight/2,e.documentTouchY-=this.state.caretHeight/2+this.dragContainerHeight/2,e.resultNode=this.getResultNode(e),e},e.prototype.getIOSOffsetTouchPoint=function(t){var e=this.getTouchPoint(t);if(e)return e.resultNode=this.getResultNode(e),e},e.prototype.getHitPoint=function(t){return new o.DR({x:(0,o.Ej)(t.documentTouchX/this.props.zoom()),y:(0,o.Ej)(t.documentTouchY/this.props.zoom())})},e.prototype.getCaretPoint=function(){var t,e=this.props.layoutController.getLayoutBox().__node__,r=null==e?void 0:e.getBoundingClientRect(),n=null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange;if(!e||!n)return{clientCaretX:0,clientCaretY:0,documentCaretX:0,documentCaretY:0,caretHeight:0};var o=(0,Q.$Zc)(null==n?void 0:n.start),i=o.getDocumentOffset(this.props.zoom()),a=i.x,s=i.y,l=o.caretHeight(this.props.zoom())||0;return{clientCaretX:a+r.left,clientCaretY:s+r.top,documentCaretX:a,documentCaretY:s,caretHeight:l}},e.prototype.androidDragTriggerScope=function(t,e){var r=e.clientTouchX>t.clientCaretX-this.dragContainerWidth/2&&e.clientTouchX<t.clientCaretX+this.dragContainerWidth/2,n=e.clientTouchY>t.clientCaretY+t.caretHeight&&e.clientTouchY<t.clientCaretY+t.caretHeight+this.dragContainerHeight;return r&&n},e.prototype.iosDragTriggerScope=function(t,e){var r=t.clientCaretY+t.caretHeight/2;return Math.pow(t.clientCaretX-e.clientTouchX,2)+Math.pow(r-e.clientTouchY,2)<Math.pow(t.caretHeight,2)},e.prototype.calTouchEventHitPoint=function(t){if(t.nativeEvent){var e=t.nativeEvent.changedTouches[0];if(this.draggerRef.current&&e){var r=this.draggerRef.current.getBoundingClientRect();return{x:(0,o.Ej)(e.clientX-r.left),y:(0,o.Ej)(e.clientY-r.top)-this.state.caretHeight/2}}}},e.prototype.onComponentScroll=function(){var t=this;this.setState({componentScrolling:!0}),this.onComponentScrollTimeout||(this.onComponentScrollTimeout=(0,o.Ds)((function(){t.setState({componentScrolling:!1}),t.viewRange&&t.state.visible&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.updateFakeCaret(t.viewRange))}),500)),this.onComponentScrollTimeout()},e.prototype.startAutoScrollChecker=function(){var t=this;this.stopAutoScroll(),this.autoScrollInterval=setInterval((function(){var e,r,n=t.state,o=n.posX,i=n.posY,a=n.caretHeight,s=n.clientY,l=n.clientX;r=t.autoScrollController?{x:l,y:s,type:Q.l29.client}:{x:o,y:i+a/2,type:Q.l29.scroll,xOffset:15,yOffset:a/2+15};var p=t.props.scrollHandler.getTouchEdgeJudgeInfoMobile(r);if(!(null==p?void 0:p.verticalEdge))return null===(e=t.autoScrollController)||void 0===e||e.cancelScroll(),void(t.autoScrollController=void 0);var c=p.verticalEdge===Q.Pb7.bottom?vo.bottom:vo.top;t.autoScrollController?c!==t.autoScrollController.getScrollDirection()&&(t.autoScrollController.setScrollDirection(c),t.autoScrollController.restart()):(t.autoScrollController=new $o(t.props.scrollHandler.getScrollRoot()),t.autoScrollController.startScroll(c))}),50)},e.prototype.stopAutoScroll=function(){var t;clearInterval(this.autoScrollInterval),null===(t=this.autoScrollController)||void 0===t||t.cancelScroll(),this.autoScrollController=void 0},e.prototype.androidCaretDrag=function(){return Lo().createElement("div",{className:Yo,style:{transform:this.state.isDragTouch?"scale(1.3)":"scale(1)",transformOrigin:"50% 0%"}})},e.prototype.renderFollowFingerCaret=function(t,e,r){return null},e.prototype.render=function(){var t,e=this;if(null===(t=this.props.context)||void 0===t?void 0:t.isInBlockState())return null;this.state.caretHeight;var r=this.state.caretHeight+4;return Lo().createElement("div",{className:"melo-mobile-caret_wrapper"},this.renderFollowFingerCaret(21,2,r),Lo().createElement("div",{className:zo,ref:function(t){e.caretDragRef=t},style:{position:"absolute",left:this.state.posX,top:this.state.posY,zIndex:20,visibility:this.state.visible&&!this.state.componentScrolling?"visible":"hidden"}},Lo().createElement("div",{className:"melo-mobile-caret",style:{position:"absolute",width:2,height:r,pointerEvents:"none",background:"#cccccc",transition:"transform ease 0.5s, opacity ease 0.5s",opacity:this.state.visible?"1":"0",transform:(this.state.isDragTouch,"scale(1, 1)"),transformOrigin:"50% 100%"}}),""))}}(Lo().Component),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(Zo||(Zo={})),function(t){function e(e){var r=t.call(this,e)||this;return r.viewRange=null,r.optionShow=!0,r.startPos=void 0,r.endPos=void 0,r.upBound=5,r.bottomBound=20,r.fingerOffset=40,r.caretContainerWidth=56,r.caretContainerExtraHeight=40,r.caretWidth=2,r.extraCaretHeight=4,r.isParallelMoving=!1,r.LONG_TOUCH_TIME=500,r.isFirstLongTouch=!1,r.isDragStart=!1,r.dragCheckerCallbackId=void 0,r.onTouchStart=function(){var t;r.longTouchTimeout&&clearTimeout(r.longTouchTimeout);var e=null===(t=r.selector.getSelection())||void 0===t?void 0:t.viewRange;r.isFirstLongTouch=!1,r.selector.setFocusFlag(),r.longTouchTimeout=setTimeout((function(){var t;(null==e?void 0:e.equals(null===(t=r.selector.getSelection())||void 0===t?void 0:t.viewRange))||(r.isFirstLongTouch=!0),r.isParallelMoving=!0}),r.LONG_TOUCH_TIME)},r.onTouchMove=function(t){r.longTouchTimeout&&clearTimeout(r.longTouchTimeout),r.shouldChangeSelectionByTouchMove()&&r.isDragStart&&(t.cancelable&&t.preventDefault(),r.throttleDoTouchMove(t))},r.onTouchEnd=function(t){r.longTouchTimeout&&clearTimeout(r.longTouchTimeout),(r.isFirstLongTouch||r.state.isLeftDragTouch||r.state.isRightDragTouch)&&(r.isParallelMoving=!1,r.dragTouchEnd(t)),r.isFirstLongTouch=!1,r.stopAutoScroll()},r.updateDragController=function(t){r.setState({isLeftDragTouch:t,isRightDragTouch:!t})},r.selectionCross=function(t,e){r.state.isRightDragTouch||r.shiftControllerToRightDrag(t,e),r.state.isLeftDragTouch||r.shiftControllerToLeftDrag(t,e)},r.throttleDoTouchMove=(0,o.P2)((function(t){if(r.shouldChangeSelectionByTouchMove()){var e=r.getTouchPoint(t),n=r.getTouchHitPoint(e);r.selectionCross(e,t),r.selector.keepMoving(),r.state.isLeftDragTouch?r.selector.moveStart(r.getTouchEventInfo(e),n):r.state.isRightDragTouch&&r.selector.moveEnd(r.getTouchEventInfo(e),n)}}),50),r.selector=r.props.overlay.touchSelector,r.selector.setSelectionCrossCallback(r.updateDragController),r.state={leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1,ComponentScrolling:!1,isLeftDragTouch:!1,isRightDragTouch:!1,clientX:0,clientY:0},r}(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"caretLeftMargin",{get:function(){return(this.caretContainerWidth-this.caretWidth)/2},enumerable:!1,configurable:!0}),e.prototype.shouldComponentUpdate=function(t,e){return this.state.visible||e.visible},e.prototype.componentDidMount=function(){this.props.context.on(Q.kgn.SELECTION_CHANGE,this.onSelectionChanged,this),this.props.context.on(Q.cbw.ON_BLUR,this.onBlur,this),this.props.context.on(Q.kgn.TABLE_DID_SCROLL,this.onComponentScroll,this),this.props.context.on(Q.kgn.TEXTFRAME_DID_SCROLL,this.onComponentScroll,this),this.props.scrollRoot.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.props.scrollRoot.addEventListener("touchmove",this.onTouchMove,{passive:!1}),this.props.scrollRoot.addEventListener("touchend",this.onTouchEnd,{passive:!1})},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(Q.kgn.SELECTION_CHANGE,this),this.props.context.removeListener(Q.cbw.ON_BLUR,this),this.props.context.removeListener(Q.kgn.TABLE_DID_SCROLL,this),this.props.context.removeListener(Q.kgn.TEXTFRAME_DID_SCROLL,this),this.props.scrollRoot.removeEventListener("touchstart",this.onTouchStart),this.props.scrollRoot.removeEventListener("touchmove",this.onTouchMove),this.props.scrollRoot.removeEventListener("touchend",this.onTouchEnd)},e.prototype.onSelectionChanged=function(t){(null==t?void 0:t.viewRange)&&(this.viewRange=t.viewRange,this.selector.updateBothFromRange(t.viewRange),t.option&&void 0!==t.option.mobileSelectionDrag?t.option.mobileSelectionDrag===h.p2.Hide?this.optionShow=!1:t.option.mobileSelectionDrag===h.p2.Show&&(this.optionShow=!0):this.optionShow=!0,this.update())},e.prototype.getCaretPosConsiderPadding=function(){var t=this.props.context.view.getPadding(),e=t.top,r=t.left;if(!this.viewRange)return{leftPosX:this.state.leftPosX-(r||0),leftPosY:this.state.leftPosY-(e||0),rightPosX:this.state.rightPosX-(r||0),rightPosY:this.state.rightPosY-(e||0)};var n=this.getViewRangePointPos(this.viewRange.start),o=this.getViewRangePointPos(this.viewRange.end);return{leftPosX:n.x,leftPosY:n.y,rightPosX:o.x,rightPosY:o.y}},e.prototype.touchCompare=function(t){var e=t.documentTouchX/this.props.zoom(),r=t.documentTouchY/this.props.zoom(),n=this.state,o=n.leftLineHeight,i=n.rightLineHeight,a=this.getCaretPosConsiderPadding(),s=a.leftPosX,l=a.leftPosY,p=a.rightPosX,c=a.rightPosY,u=l+o,g=l,h=c+i,d=c;return{touchInLeftLineWithPadding:r>g-this.upBound&&r<u+this.bottomBound,touchInRightLineWithPadding:r>d-this.upBound&&r<h+this.bottomBound,touchInLeftLine:r>g&&r<u,touchInRightLine:r>d&&r<h,touchOverLeftLine:r<g-3,touchBelowRightLine:r>h+3,touchBeforeLeftDrag:e<s,touchBehindRightDrag:e>p}},e.prototype.isDragInSameLine=function(){return this.state.leftPosY===this.state.rightPosY},e.prototype.getTouchHitPoint=function(t){var e=this.props.zoom();return new o.DR({x:(0,o.Ej)(t.documentTouchX/e),y:(0,o.Ej)(t.documentTouchY/e)})},e.prototype.getTouchEventInfo=function(t){var e=this.props.scrollHandler,r=e.getScrollRootSize().top+e.getMobileTopMargin(),n=e.getScrollRootSize().bottom-e.getMobileBottomMargin(),o=t.clientTouchY;return o>n&&(o=n),o<r&&(o=r),{clientX:t.clientTouchX,clientY:o,element:t.resultNode}},e.prototype.shiftControllerToLeftDrag=function(t,e){var r=this.touchCompare(t).touchBeforeLeftDrag;this.isParallelMoving&&this.leftDragInParallelMoving(r,e)},e.prototype.leftDragInParallelMoving=function(t,e){t&&this.isDragInSameLine()&&this.leftDragTouchStart(e)},e.prototype.shiftControllerToRightDrag=function(t,e){var r=this.touchCompare(t).touchBehindRightDrag;this.isParallelMoving&&this.rightDragInParallelMoving(r,e)},e.prototype.rightDragInParallelMoving=function(t,e){t&&this.isDragInSameLine()&&this.rightDragTouchStart(e)},e.prototype.autoScroll=function(){var t=this;this.autoScrollInterval&&clearInterval(this.autoScrollInterval),this.autoScrollInterval=setInterval((function(){t.state.isLeftDragTouch||t.state.isRightDragTouch?t.autoScrollUnit():clearInterval(t.autoScrollInterval)}),50)},e.prototype.autoScrollUnit=function(){var t;if(this.selector.start&&this.selector.end){var e,r=this.state,n=r.isLeftDragTouch,o=r.leftLineHeight,i=r.rightLineHeight,a=r.leftPosX,s=r.leftPosY,l=r.rightPosX,p=r.rightPosY,c=r.clientX,u=r.clientY;e=this.autoScrollController?{x:c,y:u,type:Q.l29.client}:{x:n?a:l,y:n?s+o/2:p+i/2,type:Q.l29.scroll,xOffset:15,yOffset:15+(n?o/2:i/2)};var g=this.props.scrollHandler.getTouchEdgeJudgeInfoMobile(e);if(!g)return null===(t=this.autoScrollController)||void 0===t||t.cancelScroll(),void(this.autoScrollController=null);var h=g.verticalEdge===Q.Pb7.bottom?vo.bottom:vo.top;this.autoScrollController?h!==this.autoScrollController.getScrollDirection()&&(this.autoScrollController.setScrollDirection(h),this.autoScrollController.restart()):(this.autoScrollController=new $o(this.props.scrollHandler.getScrollRoot()),this.autoScrollController.startScroll(h))}},e.prototype.stopAutoScroll=function(){var t;clearInterval(this.autoScrollInterval),null===(t=this.autoScrollController)||void 0===t||t.cancelScroll(),this.autoScrollController=null},e.prototype.getDocumentInfo=function(){var t=this.props.layoutController.getLayoutBox(),e=t.__node__;if(e)return{rect:e.getBoundingClientRect(),documentNode:e,documentBox:t}},e.prototype.onBlur=function(){var t;(null===(t=this.viewRange)||void 0===t?void 0:t.isCaret())&&this.setState({leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1})},e.prototype.update=function(){this.viewRange&&this.optionShow&&this.shouldChangeSelection()?(this.startPos=this.getViewRangePointPos(this.viewRange.start),this.endPos=this.getViewRangePointPos(this.viewRange.end),this.startPos&&this.endPos?this.showSelectionDrag():this.hideSelectionDrag()):this.hideSelectionDrag()},e.prototype.canShow=function(){var t,e;if(null===window||void 0===window?void 0:window.isPublishedURL)return!0;var r=this.props.context;if(r instanceof Ct.zq&&r.isRestrictProtectOn){var n=null===(e=null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange)||void 0===e?void 0:e.getGCPRange();if(!n)return!0;if(!r.state.getRestrictEdit().checkPermissionRangeByGcpRange(n))return!1}return!0},e.prototype.showSelectionDrag=function(){if(this.canShow()){var t=this.props.context.view.getPadding(),e=this.viewRange.start,r=this.viewRange.end,n=this.props.zoom(),o=t.top/n,i=t.left/n;this.setState({leftPosX:this.startPos.x+i,leftPosY:this.startPos.y+o,leftLineHeight:e.lineHeight,rightPosX:this.endPos.x+i,rightPosY:this.endPos.y+o,rightLineHeight:r.lineHeight,visible:!0})}else this.hideSelectionDrag()},e.prototype.hideSelectionDrag=function(){this.setState({leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1})},e.prototype.getViewRangePointPos=function(t){var e=t.getLineDocumentOffset(this.props.zoom()),r=0,n=0;if(null==t?void 0:t.lineBox){var i=t.lineBox.edge;r+=i.margin.left,n+=i.margin.top,i.recycle()}return{x:e.x+(0,o.FJ)(r),y:e.y+(0,o.FJ)(n)}},e.prototype.dragTouchStart=function(t,e){var r=this;this.dragCheckerCallbackId=setTimeout((function(){r.setState({isLeftDragTouch:e===Zo.Left,isRightDragTouch:e===Zo.Right}),r.isDragStart=!0,r.dragCheckerCallbackId=void 0,r.props.scrollHandler.disableScrollOnSelectionChanged(),r.props.context.fire(new c.nLn(t,c.iAz.START_DRAG)),r.autoScroll()}),200)},e.prototype.dragTouchEnd=function(t){if(clearTimeout(this.dragCheckerCallbackId),!this.isDragStart)return this.dragCheckerCallbackId?void this.props.context.fire(new Q.F78):void 0;this.selector.finishMoving(),this.stopAutoScroll(),this.props.scrollHandler.enableScrollOnSelectionChanged(),this.isDragStart=!1,this.dragCheckerCallbackId=void 0,this.props.context.fire(new c.nLn(t,c.iAz.END_DRAG)),this.setState({isLeftDragTouch:!1,isRightDragTouch:!1})},e.prototype.leftDragTouchStart=function(t){this.dragTouchStart(t,Zo.Left)},e.prototype.rightDragTouchStart=function(t){this.dragTouchStart(t,Zo.Right)},e.prototype.onLeftTouchStart=function(t){this.isParallelMoving=!0,this.leftDragTouchStart(t.nativeEvent),this.sendTouchEvent(t)},e.prototype.onLeftTouchEnd=function(t){this.isParallelMoving=!1,this.dragTouchEnd(t.nativeEvent),this.sendTouchEvent(t)},e.prototype.onRightTouchStart=function(t){this.isParallelMoving=!0,this.rightDragTouchStart(t.nativeEvent),this.sendTouchEvent(t)},e.prototype.onRightTouchEnd=function(t){this.isParallelMoving=!1,this.dragTouchEnd(t.nativeEvent),this.sendTouchEvent(t)},e.prototype.sendTouchEvent=function(t){this.props.context.fire(new Q.NkY(t),!1)},e.prototype.shouldChangeSelectionByTouchMove=function(){return!!this.shouldChangeSelection()&&!!(this.state.isLeftDragTouch||this.state.isRightDragTouch||this.isFirstLongTouch)},e.prototype.shouldChangeSelection=function(){var t,e=this.props.service.getSelection();if(e.isInCellsOfTable()||e.isSelectionAtImage()||e.isSelectionAtEmbeddedObject())return!1;var r=null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange;return!((null==r?void 0:r.isCaret())&&!this.state.isLeftDragTouch&&!this.state.isRightDragTouch)},e.prototype.getTouchPoint=function(t){var e=t.targetTouches[0];e||"touchmove"!==t.type||(e=t.changedTouches[0]);var r=e.clientX,n=e.clientY;this.setState({clientX:r,clientY:n});var o=this.props.layoutController.getLayoutBox().__node__,i={clientTouchX:r,clientTouchY:n,resultNode:o,documentTouchX:r,documentTouchY:n};if(!o)return i;var a=o.getBoundingClientRect();i.documentTouchX=r-a.left,i.documentTouchY=n-a.top;var s=this.touchCompare(i),l=s.touchInLeftLineWithPadding,p=s.touchInRightLineWithPadding;this.state.isLeftDragTouch&&!l&&(this.isParallelMoving=!1),this.state.isRightDragTouch&&!p&&(this.isParallelMoving=!1);var c=this.getOffsetTouchPoint(i);return c.resultNode=this.getTouchResultNode(i),c},e.prototype.getOffsetTouchPoint=function(t){var e=t,r=this.getDocumentInfo();if(!r)return e;var n=r.rect;if(this.isParallelMoving){var o=this.getCaretPosConsiderPadding(),i=o.leftPosY,a=o.rightPosY;this.state.isLeftDragTouch?(e.documentTouchY=(i+this.state.leftLineHeight/2)*this.props.zoom(),e.clientTouchY=e.documentTouchY+n.top):this.state.isRightDragTouch&&(e.documentTouchY=(a+this.state.rightLineHeight/2)*this.props.zoom(),e.clientTouchY=e.documentTouchY+n.top)}else e.clientTouchY=t.clientTouchY-this.fingerOffset,e.documentTouchY=t.documentTouchY-this.fingerOffset;return e.clientTouchX=t.clientTouchX,e.documentTouchX=t.documentTouchX,e},e.prototype.getTouchResultNode=function(t){var e=this.props.layoutController.getLayoutBox(),r=e.__node__;if(r){var n=r;if((0,c.gLh)(e)){var o=this.getTouchHitPoint(t),i=Q.d_x.getLeastGrandsonByPoint(e,o);n=i[0]&&i[0].__node__}return n}},e.prototype.onComponentScroll=function(){var t=this;this.setState({ComponentScrolling:!0}),this.onComponentScrollTimeout||(this.onComponentScrollTimeout=(0,o.Ds)((function(){t.setState({ComponentScrolling:!1}),t.viewRange&&t.state.visible&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.update())}),500)),this.onComponentScrollTimeout()},e.prototype.androidDrag=function(t){var e=this.getScale();return Lo().createElement("div",{className:"".concat(t===Zo.Left?qo:Qo),style:{transform:e,opacity:this.state.visible?1:0}})},e.prototype.iosDrag=function(t){var e=this.getScale();return Lo().createElement("div",{className:"".concat(t===Zo.Left?Ko:jo),style:{transform:e,opacity:this.state.visible?"1":"0",boxShadow:"0 0 0 0 rgba(0, 0, 0, 0)"}})},e.prototype.getScale=function(){return this.state.visible?"scale(1)":"scale(0)"},e.prototype.fakeCaret=function(t){var e,r,n,o,i,a=this;t===Zo.Left?(e=this.state.leftPosX-(this.caretContainerWidth+this.caretWidth)/2,r=(r=this.state.leftPosY-this.extraCaretHeight)-this.caretContainerExtraHeight+this.extraCaretHeight,o=this.state.leftLineHeight+this.caretContainerExtraHeight,i=this.caretContainerExtraHeight-this.extraCaretHeight,n=this.state.leftLineHeight+this.extraCaretHeight):(e=this.state.rightPosX-(this.caretContainerWidth-this.caretWidth)/2,r=this.state.rightPosY,n=this.state.rightLineHeight+this.extraCaretHeight,o=this.state.rightLineHeight+this.caretContainerExtraHeight,i=0);var s=Math.min(this.caretContainerWidth,this.props.scrollRoot.clientWidth-e);return Lo().createElement("div",{className:Xo,onMouseUp:function(t){a.props.context.fire(new Q.VDf(t),!1)},onTouchStart:function(e){t===Zo.Left?a.onLeftTouchStart(e):a.onRightTouchStart(e)},onTouchEnd:function(e){e.preventDefault(),t===Zo.Left?a.onLeftTouchEnd(e):a.onRightTouchEnd(e)},style:{left:e,top:r,height:o,width:s,opacity:this.state.visible?"1":"0"}},Lo().createElement("div",{className:Jo,style:{height:n,background:"#1e6fff",width:this.caretWidth,top:i,left:this.caretLeftMargin}}))},e.prototype.render=function(){var t=this,e=(this.caretWidth,this.caretWidth,-15-this.caretWidth/2),r=this.caretWidth/2-15;return Lo().createElement("div",{className:"melo-mobile-selection-drag",style:{visibility:this.state.visible&&!this.state.ComponentScrolling?"visible":"hidden"}},this.fakeCaret(Zo.Left),Lo().createElement("div",{className:Vo,onTouchStart:function(e){t.onLeftTouchStart(e)},onTouchEnd:function(e){e.preventDefault(),t.onLeftTouchEnd(e)},style:{left:this.state.leftPosX+e,top:this.state.leftPosY+-28}},this.iosDrag(Zo.Left)),this.fakeCaret(Zo.Right),Lo().createElement("div",{className:Vo,onTouchStart:function(e){t.onRightTouchStart(e)},onTouchEnd:function(e){e.preventDefault(),t.onRightTouchEnd(e)},style:{left:this.state.rightPosX+r,top:this.state.rightPosY+this.state.rightLineHeight+-2}},this.iosDrag(Zo.Right)))}}(Lo().Component);var ti,ei=function(){function t(){}return t.getShortCutKey=function(t){for(var e=t,r=[],n=u.VD.EMPTY;e>0;)e>=u.N9.COMMAND?(r.push(u.N9.COMMAND),e-=u.N9.COMMAND):e>=u.N9.WIN?(r.push(u.N9.WIN),e-=u.N9.WIN):e>=u.N9.CTRL_MAC?(r.push(u.N9.CTRL_MAC),e-=u.N9.CTRL_MAC):e>=u.N9.CTRL_WIN?(r.push(u.N9.CTRL_WIN),e-=u.N9.CTRL_WIN):e>=u.N9.ALT?(r.push(u.N9.ALT),e-=u.N9.ALT):e>=u.N9.SHIFT?(r.push(u.N9.SHIFT),e-=u.N9.SHIFT):(n=e,e=0);return{input:this.getIPadKeyName(n),modifier:this.getIPadModifierName(r)}},t.getIPadKeyName=function(t){var e=u.q2.EMPTY;return Object.keys(u.VD).some((function(r){return u.VD[r]===t&&void 0!==u.q2[r]&&(e=u.q2[r],!0)})),e},t.getIPadModifierName=function(t){return t.map((function(t){switch(t){case u.N9.COMMAND:return u.Bx.COMMAND;case u.N9.CTRL_MAC:return u.Bx.CTRL;case u.N9.ALT:return u.Bx.ALT;case u.N9.SHIFT:return u.Bx.SHIFT;default:return u.Bx.NONE}})).join("|")},t}(),ri=function(){function t(){var e=this;this.attached=!1,this.ipadKeymap=new Map,this.onIpadExternalKeyboardEvent=function(t){e.listeners.forEach((function(e){e(t)}))},this.addIPadAppKeyMap=function(t){if(o.wV.isTencentDocsIPadApp()&&window.mqq){e.attached||(window.mqq.addEventListener("shortcutKeyEvent",e.onIpadExternalKeyboardEvent),e.attached=!0);var r=[];t.forEach((function(t){if(t!==u.VD.EMPTY&&!e.ipadKeymap.has(t)){e.ipadKeymap.set(t,!0);var n=ei.getShortCutKey(t);n.input&&r.push(n)}})),r.length>0&&window.mqq.invoke("docx","registerShortcutKeyEvent",{shortcutKey:r})}},t.instance=this,this.listeners=[]}return t.getInstance=function(){return t.instance||new t,t.instance},t.prototype.attach=function(){o.wV.isTencentDocsIPadApp()&&window.mqq&&!this.attached&&(window.mqq.addEventListener("shortcutKeyEvent",this.onIpadExternalKeyboardEvent),this.attached=!0)},t.prototype.detach=function(){o.wV.isTencentDocsIPadApp()&&window.mqq&&(window.mqq.removeEventListener("shortcutKeyEvent",this.onIpadExternalKeyboardEvent),this.attached=!1)},t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.removeEventListener=function(t){for(var e=0;e<this.listeners.length;e++)t===this.listeners[e]&&(this.listeners.splice(e,1),e-=1)},t}(),ni=function(){function t(t){var e=this;this.lastInnerHeight=window.innerHeight,this.lastOrientation=Number(window.orientation),this.keyboardState=c.zO2.KEYBOARD_DOWN,this.onResize=function(){setTimeout((function(){var t=window.innerHeight,r=Number(window.orientation);e.isSameOrientation(r)&&(e.lastInnerHeight-t>150?e.onKeyboardUp(c.Gts.VIEWPORT_RESIZE):t-e.lastInnerHeight>150&&e.onKeyboardDown(c.Gts.VIEWPORT_RESIZE)),e.lastOrientation=r,e.lastInnerHeight=t}),100)},this.editor=t}return t.prototype.attach=function(){o.Yd.info("attach method called but KeyboardManager already attached")},t.prototype.detach=function(){},t.prototype.getKeyboardState=function(){return this.keyboardState},t.prototype.onFocus=function(){var t;(null===(t=this.editor.surface)||void 0===t?void 0:t.isFocusing())&&this.onKeyboardUp(c.Gts.EDITOR)},t.prototype.onBlur=function(){var t;(null===(t=this.editor.surface)||void 0===t?void 0:t.isFocusing())||this.onKeyboardDown(c.Gts.EDITOR)},t.prototype.isSameOrientation=function(t){return!((0!==this.lastOrientation&&180!==this.lastOrientation||0!==t&&180!==t)&&(90!==this.lastOrientation&&-90!==this.lastOrientation||90!==t&&-90!==t))},t.prototype.onKeyboardUp=function(t){this.keyboardState!==c.zO2.KEYBOARD_UP&&this.editor.fire(new c.wrd(c.LnY.MOBILE_KEYBOARD_SHOW,t)),this.keyboardState=c.zO2.KEYBOARD_UP},t.prototype.onKeyboardDown=function(t){this.keyboardState!==c.zO2.KEYBOARD_DOWN&&this.editor.fire(new c.wrd(c.LnY.MOBILE_KEYBOARD_HIDE,t)),this.keyboardState=c.zO2.KEYBOARD_DOWN},t}(),oi=function(){function t(){}return t.isMetaKey=function(t){return-1!==[u.VD.ARROW_DOWN,u.VD.ARROW_UP,u.VD.ARROW_LEFT,u.VD.ARROW_RIGHT,u.VD.HOME,u.VD.END,u.VD.DELETE,u.VD.BACKSPACE,u.VD.F1,u.VD.F2,u.VD.F3,u.VD.F4,u.VD.F5,u.VD.F6,u.VD.F7,u.VD.F8,u.VD.F9,u.VD.F10,u.VD.F11,u.VD.F12,u.VD.TAB,u.VD.PAGE_DOWN,u.VD.PAGE_UP,u.VD.ENTER,u.VD.ESCAPE,u.VD.SHIFT,u.VD.CAPS_LOCK,u.VD.ALT].indexOf(t)},t.isCtrlCmdKey=function(t){if(o.wV.isMac()){if(t===u.VD.META_LEFT||t===u.VD.META_RIGHT||t===u.yl.META_FIREFOX)return!0}else if(t===u.VD.CTRL)return!0;return!1},t.getKeyCode=function(t){var e=t.keyCode;return o.wV.isFireFox()&&(e===u.yl.EQUAL?e=u.VD.EQUAL:e===u.yl.MINUS&&(e=u.VD.MINUS)),229===e&&(e=this.getAmendedKeyCode(t)),e},t.getMouseCode=function(t){return t.buttons*u.wE},t.getWheelCode=function(t){var e=0;return t.deltaY>0?e=u.Al.WHEEL_CLOCKWISE:t.deltaY<0&&(e=u.Al.WHEEL_ANTICLOCKWISE),e},t.getIpadKeyCode=function(t){var e=u.VD.EMPTY;if(null==t?void 0:t.input){var r=t.input,n=t.modifier;void 0!==n?e=this.getIpadCombinationKeyCode(r,n):r===u.q2.ARROW_LEFT?e=u.VD.ARROW_LEFT:r===u.q2.ARROW_RIGHT?e=u.VD.ARROW_RIGHT:r===u.q2.ARROW_UP?e=u.VD.ARROW_UP:r===u.q2.ARROW_DOWN&&(e=u.VD.ARROW_DOWN)}return e},t.getIpadCombinationKeyCode=function(e,r){var n=u.VD.EMPTY,o=e.toUpperCase();return/^[A-Z]$/.test(o)?n=u.VD[o]:e===u.q2.EQUAL?n=u.VD.EQUAL:e===u.q2.ARROW_LEFT?n=u.VD.ARROW_LEFT:e===u.q2.ARROW_RIGHT?n=u.VD.ARROW_RIGHT:e===u.q2.ARROW_UP?n=u.VD.ARROW_UP:e===u.q2.ARROW_DOWN&&(n=u.VD.ARROW_DOWN),n=t.getKeyCodeWithModifier(r,n)},t.getKeyCodeWithModifier=function(t,e){var r=e;return t.split("|").forEach((function(t){switch(t){case u.Bx.COMMAND:r+=u.N9.COMMAND;break;case u.Bx.SHIFT:r+=u.N9.SHIFT;break;case u.Bx.ALT:r+=u.N9.ALT;break;case u.Bx.CTRL:r+=u.N9.CTRL_MAC}})),r},t.getAssistKey=function(t){var e=0;return e+=t.altKey?u.N9.ALT:0,e+=t.shiftKey?u.N9.SHIFT:0,o.wV.isMac()?(e+=t.ctrlKey?u.N9.CTRL_MAC:0,e+=t.metaKey?u.N9.COMMAND:0):(e+=t.ctrlKey?u.N9.CTRL_WIN:0,e+=t.metaKey?u.N9.WIN:0),e},t.getAmendedKeyCode=function(t){var e=t.code,r=t.key;return u.ii[e]?u.ii[e]:/[0-9a-zA-Z]/.test(r)?r.toUpperCase().charCodeAt(0):t.keyCode},t}(),ii=function(){function t(t,e){var r=this;this.keymap=new Map,this.attached=!1,this.onKeyEvent=function(t){var e=oi.getKeyCode(t),n=oi.getAssistKey(t),i=n+e;window.JankGlobalKeyCode="".concat(n,"_").concat(e),o.Yd.info("keymap|keydown",i,t),r.runAction(i,t)},this.onMouseEvent=function(t){var e=oi.getMouseCode(t),n=oi.getAssistKey(t)+e;r.runAction(n,t)},this.onWheelEvent=function(t){var e=oi.getWheelCode(t),n=oi.getAssistKey(t)+e;r.runAction(n,t)},this.onIpadExternalKeyboardEvent=function(t){if(o.Yd.info("keymap|onIpadExternalKeyboardEvent",t),t){var e=oi.getIpadKeyCode(t);r.runAction(e,void 0,o.wV.isTencentDocsIPadApp())}},this.editor=t,this.state=e}return t.prototype.attach=function(){var t;if(this.attached)o.Yd.warn("Editor KeymapManager has attached");else{var e=null===(t=this.editor.surface)||void 0===t?void 0:t.getFocusableDom();e?(e.addEventListener("keydown",this.onKeyEvent),e.addEventListener("mousedown",this.onMouseEvent),e.addEventListener("wheel",this.onWheelEvent,{passive:!1})):o.Yd.error("Editor KeymapManager attach focusableDom is null"),o.wV.isTencentDocsIPadApp()&&(ri.getInstance().attach(),ri.getInstance().addEventListener(this.onIpadExternalKeyboardEvent)),this.attached=!0}},t.prototype.detach=function(){var t,e=null===(t=this.editor.surface)||void 0===t?void 0:t.getFocusableDom();e?(e.removeEventListener("keydown",this.onKeyEvent),e.removeEventListener("mousedown",this.onMouseEvent),e.removeEventListener("wheel",this.onWheelEvent)):o.Yd.error("Editor KeymapManager detach surfaceDom is null"),o.wV.isTencentDocsIPadApp()&&(ri.getInstance().detach(),ri.getInstance().removeEventListener(this.onIpadExternalKeyboardEvent)),this.attached=!1},t.prototype.addKeymap=function(t){var e=this,r=o.wV.isMac()?"mac":"win",n=[].concat(t.keyBindings[r]);n.forEach((function(r){r!==u.VD.EMPTY&&(e.keymap.has(r)||e.keymap.set(r,t))})),o.wV.isTencentDocsIPadApp()&&ri.getInstance().addIPadAppKeyMap(n)},t.prototype.addKeymaps=function(t){var e=this;(0,i.__spreadArray)([],(0,i.__read)(t),!1).forEach((function(t){e.addKeymap(t)}))},t.prototype.runAction=function(t,e,r){var n,o,a;if(((null===(o=this.editor.surface)||void 0===o?void 0:o.isFocusing())||r)&&(a=this.keymap.get(t)),a){var s=a.action,l=a.extraArgs,p=void 0===l?[]:l,c=a.shouldPreventDefault;if((void 0===c||c)&&e&&e.preventDefault(),this.editor instanceof Ct.zq&&!this.editor.state.getRestrictEdit().isKeyMapActionAllowOnRestrictEdit(s))return;(n=this.editor).run.apply(n,(0,i.__spreadArray)([s],(0,i.__read)(p),!1))}},t}(),ai=r(661533),si=r.n(ai),li=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectNode=null,e}return(0,i.__extends)(e,t),e.prototype.componentDidMount=function(){this.props.context.on(Q.kgn.SELECTION_CHANGE,this.onSelectionChanged,this)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(Q.kgn.SELECTION_CHANGE,this)},e.prototype.onSelectionChanged=function(t){if(null==t?void 0:t.viewRange){var e=t.viewRange;if(e.start.gcp!==e.end.gcp&&this.selectNode){var r=document.createRange();r.selectNode(this.selectNode);var n=window.getSelection();n&&n.addRange(r)}}},e.prototype.render=function(){var t=this;return Lo().createElement("textarea",{id:"melo-hidden-select",ref:function(e){t.selectNode=e},style:{opacity:0}}," ")},e}(Lo().Component),pi=function(t){function e(e){var r=t.call(this,e)||this;return r.props=e,r.state={stamp:c.bKi.NONE,gcpRange:[0,0],deleteContent:"",readContent:"用户可以通过 control 加 ~ 打开或关闭无障碍功能",isCut:!1},r}return(0,i.__extends)(e,t),e.prototype.componentDidMount=function(){this.props.context.on(c.dnr.A11yContentChange,this.onContentChange,this)},e.prototype.onContentChange=function(t){var e,r=this,n=t.data;[c.bKi.NONE,c.bKi.ERROR].includes(n.stamp)||0!==(null===(e=n.readContent)||void 0===e?void 0:e.trim().length)&&(this.setState({readContent:" "}),this.onContentChangeTimeout||(this.onContentChangeTimeout=(0,o.Ds)((function(t){r.setState(t)}),300)),this.onContentChangeTimeout(n))},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(c.dnr.A11yContentChange,this)},e.prototype.render=function(){return Lo().createElement("div",{id:"accessibility-hidden-speak","aria-live":"assertive","aria-atomic":"true","aria-hidden":"false",style:{height:0,width:0,overflow:"hidden"}},this.state.readContent)},e}(Lo().Component),ci=r(398193),ui="",gi=new RegExp(ui,"g"),hi=function(t){function e(e){var r=t.call(this,e)||this;return r.isFocus=!1,r.inputDomRef=null,r.cacheInput=ui,r.compositionId="",r.viewRange=null,r.forceFocus=!0,r.spaceReg=new RegExp(p.PlaceholderChar.NonBreakSpace,"g"),r.beforeFinish=!1,r.followScreenView=(0,o.P2)((function(){var t=r.props.scrollHandler.getScrollLeft(),e=r.props.scrollHandler.getScrollTop(),n=t/r.props.zoom(),o=e/r.props.zoom();r.setState({posX:n,posY:o})}),200),r.state={posX:0,posY:0},document.body.style.webkitUserSelect="none",r.contentEditable=o.wV.isSafari()||o.wV.isMac()&&(o.wV.isTencentDocsDesktopApp()||o.wV.isWeWork())?"plaintext-only":"true",r}return(0,i.__extends)(e,t),e.prototype.componentDidMount=function(){var t,e=this;this.props.context.fire(new Q.yS1,!1),this.clearInput(),this.props.context.on(Q.kgn.CARET_CHANGE,this.onSelectionChanged,this);var r=document.createEvent("CustomEvent");r.initCustomEvent("performance_edit_hidden_input_inited",!0,!0,{}),document.dispatchEvent(r),t=(0,i.__read)([this.onInput,this.onCompositionStart].map((function(t){return function(){if(e.props.context.usePermissionRangeMode()||e.props.context.isRestrictProtectOn){var r=e.props.service.getPermissionRange().checkPermissionRange(),n=e.props.state.getRestrictEdit().checkPermissionRange();r&&n&&t.call(e)}else t.call(e)}})),2),this.onInput=t[0],this.onCompositionStart=t[1],this.props.context.isEditable()&&this.props.scrollHandler.addScrollListener(this.followScreenView)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(Q.kgn.CARET_CHANGE,this),this.props.context.isEditable()&&this.props.scrollHandler.removeScrollListener(this.followScreenView)},e.prototype.onSelectionChanged=function(t){var e,r,n;(null===(r=null===(e=null==t?void 0:t.option)||void 0===e?void 0:e.customData)||void 0===r?void 0:r.temporaryInput)||t.viewRange&&(this.viewRange=t.viewRange,t.option&&void 0!==t.option.forceFocus?this.forceFocus=t.option.forceFocus:this.forceFocus=!0,(null===(n=this.props.context.surface)||void 0===n?void 0:n.isEditable())&&this.update(),this.viewRange.isCaret()||this.clearInput())},e.prototype.requestFocus=function(t,e){var r,n,o,i;e&&this.inputDomRef&&!(null===(n=null===(r=this.props)||void 0===r?void 0:r.context)||void 0===n?void 0:n.isInBlockState())?null===(o=this.inputDomRef)||void 0===o||o.focus():this.compositionId?this.endComposition(!1):(t&&(this.viewRange=t),this.forceFocus=!0,(null===(i=this.props.context.surface)||void 0===i?void 0:i.isEditable())&&(this.clearInput(!0),this.update(),this.setFocus()),this.props.context.fire(new Q.D_l(Q.cbw.ON_REQUEST_FOCUS,t)))},e.prototype.requestBlur=function(){var t;this.inputDomRef&&this.isFocus&&(this.compositionId?this.endComposition():this.clearInput()),null===(t=this.inputDomRef)||void 0===t||t.blur(),this.props.context.fire(new Q.D_l(Q.cbw.ON_REQUEST_BLUR))},e.prototype.setFocus=function(){var t=this;this.props.context.isInBlockState()||setTimeout((function(){t.inputDomRef&&t.inputDomRef.focus({preventScroll:!0})}),100)},e.checkAndUpdateOffset=function(t){var e={x:t.x,y:t.y,docWidth:t.docWidth,docHeight:t.docHeight};return t.x<0&&(e.x=0),t.x>t.docWidth&&(e.x=t.docWidth),t.y<0&&(e.y=0),t.y>t.docHeight&&(e.y=t.docHeight),e},e.prototype.getHiddenEditorPosition=function(t){var r=this.props.scrollHandler.getScrollRoot();if(!r){var n=t.start.getDocumentOffset(this.props.zoom());if(0===n.x&&0===n.y&&0===n.docWidth&&0===n.docHeight)return{x:0,y:0};n=e.checkAndUpdateOffset(n);var o=this.props.context.view.getPadding(),i=t.start.caretHeight(this.props.zoom());return{x:n.x+(o.left||0),y:n.y+(o.top||0)+i-5}}return{x:r.scrollLeft/this.props.zoom(),y:r.scrollTop/this.props.zoom()}},e.prototype.update=function(){if(this.viewRange&&!this.props.context.isInBlockState()&&(this.isFocus||this.forceFocus)&&this.props.state.getRestrictEdit().checkPermissionRangeByGcpRange(this.viewRange.getGCPRange())){var t=this.getHiddenEditorPosition(this.viewRange);this.setState({posX:t.x,posY:t.y}),this.props.context.fire(new c.fV1(c.DkJ.ON_POS_UPDATE,this.viewRange),!1)}},e.prototype.onCompositionStart=function(){var t;this.compositionId&&this.endComposition(),(null===(t=this.props.context.surface)||void 0===t?void 0:t.isEditable())&&(this.compositionId="input_".concat(o.m7.generateRandomId()),this.props.state.compositionStart(this.compositionId,!0),this.props.context.fire(new c.fV1(c.DkJ.ON_COMPOSITION_START,null))),this.clearInput(!0)},e.prototype.onCompositionUpdate=function(t){var e;if(null===(e=this.props.context.surface)||void 0===e?void 0:e.isEditable()){var r=t.nativeEvent.data;this.props.state.compositionUpdate(this.compositionId,r,!0)}this.clearInput(!0)},e.prototype.onCompositionEnd=function(t){var e;if(null===(e=this.props.context.surface)||void 0===e?void 0:e.isEditable()){var r=t.nativeEvent.data;this.props.state.compositionEnd(this.compositionId,r),this.props.context.fire(new c.fV1(c.DkJ.ON_COMPOSITION_END,r))}this.compositionId="",this.clearInput(!0)},e.prototype.onInput=function(){var t=this;this.timeoutId&&clearTimeout(this.timeoutId),this.beforeFinish=!0,this.timeoutId=setTimeout((function(){t.finishInput(),t.beforeFinish=!1,t.timeoutId=null}),0)},e.prototype.finishInput=function(){var t;if(this.inputDomRef&&!this.compositionId&&(null===(t=this.props.context.surface)||void 0===t?void 0:t.isEditable())){var e=this.inputDomRef.textContent||"";o.Yd.info("hiddeneditor=== textContent: ".concat(escape(this.inputDomRef.textContent)));var r=e.replace(this.spaceReg,p.PlaceholderChar.Space);o.Yd.info("hiddeneditor=== findDiff[".concat(escape(this.cacheInput),",").concat(escape(r),"]"));var n=this.findDiff(this.cacheInput,r),i=n.toDeleteLength,a=n.toInputValue;o.Yd.info("hiddeneditor=== finishInput[toDeleteLength: ".concat(i,", toInputValue: ").concat(a,"]"));var s=this.props.state.selection.gcpRange;if(i&&s.isEmpty()){var l=new p.GCPRange(s.begin()-i,i);l.isValid()&&(o.Yd.info("hiddeneditor=== delete[".concat(l.begin(),", ").concat(l.length(),"}")),this.props.service.getSelection().delete(l))}var u=this.removeZeroWidthBreakSpace(a);if(this.props.service.getSelection().getText().startsWith(p.PlaceholderChar.TableStart)){var g=this.props.service.getSelection().range().begin()+1;this.props.service.getSelection().setRange(g,g)}u&&this.props.service.getSelection().typeText(u),this.cacheInput=r,o.Yd.info("hiddeneditor=== finishInput[".concat(escape(u),"], cacheInput[").concat(escape(this.cacheInput),"]")),u&&this.props.context.fire(new c.fV1(c.DkJ.ON_INPUT,u))}},e.prototype.onClipboardEvent=function(t){t.preventDefault()},e.prototype.onFocus=function(t){t.preventDefault(),this.isFocus=!0,this.props.context.fire(new Q.D_l(Q.cbw.ON_FOCUS))},e.prototype.onBlur=function(t){var e=this;t.preventDefault(),this.isFocus=!1,this.clearInput(),setTimeout((function(){e.isFocus||e.props.context.fire(new Q.D_l(Q.cbw.ON_BLUR))}),300)},e.prototype.onKeyDown=function(t){t.keyCode===u.VD.ENTER?this.compositionId?this.endComposition():this.clearInput(!0):t.keyCode===u.VD.BACKSPACE?this.cacheInput&&this.cacheInput!==ui||this.props.context.run("backspace"):t.keyCode===u.VD.ARROW_LEFT&&this.beforeFinish&&this.props.context.run(ci.a.ARROW_RIGHT)},e.prototype.endComposition=function(t){void 0===t&&(t=!0),this.compositionId&&(this.props.state.compositionEnd(this.compositionId,this.props.state.getCompositionText(),t),this.props.context.fire(new c.fV1(c.DkJ.ON_COMPOSITION_END,this.props.state.getCompositionText()))),this.compositionId="",this.clearInput()},e.prototype.findDiff=function(t,e){t=t.replace(gi,""),e=e.replace(gi,"");for(var r=0;r<t.length&&r<e.length&&t[r]===e[r];)r+=1;return{toDeleteLength:t.length-r,toInputValue:e.substring(r,e.length)}},e.prototype.removeZeroWidthBreakSpace=function(t){return t.replace(/\uFEFF/g,"")},e.prototype.clearInputOnChange=function(t){if(t){t.length>1&&this.clearInput();var e=t.charCodeAt(t.length-1);(e<33||e>126)&&65281!==e&&65292!==e&&65311!==e&&12290!==e&&this.clearInput()}},e.prototype.clearInput=function(t){if(void 0===t&&(t=!1),this.cacheInput=ui,this.inputDomRef){o.Yd.info("hiddeneditor=== clearInput[".concat(escape(this.inputDomRef.textContent),"]")),this.inputDomRef.textContent=ui;var e=document.getSelection();if(t&&e&&this.inputDomRef.firstChild){var r=document.createRange();r.setStart(this.inputDomRef.firstChild,0),r.collapse(!0),e.removeAllRanges(),e.addRange(r)}}},e.prototype.render=function(){var t=this;return Lo().createElement("div",{id:Wo,contentEditable:this.contentEditable,ref:function(e){t.inputDomRef=e},autoCapitalize:"off",onInput:this.onInput.bind(this),onCompositionStart:this.onCompositionStart.bind(this),onCompositionUpdate:this.onCompositionUpdate.bind(this),onCompositionEnd:this.onCompositionEnd.bind(this),onCopy:this.onClipboardEvent.bind(this),onCut:this.onClipboardEvent.bind(this),onPaste:this.onClipboardEvent.bind(this),onFocus:this.onFocus.bind(this),onBlur:this.onBlur.bind(this),onKeyDown:this.onKeyDown.bind(this),spellCheck:!1,tabIndex:-1,style:{left:this.state.posX,top:this.state.posY}})},e}(Lo().Component),di=function(t){for(var e=t.leafBox;e&&!(0,c.sJD)(e)&&!(0,c.t$M)(e);)e=e.parentBox;return(0,c.sJD)(e)?e:null},yi=function(t){for(var e=t.leafBox;e&&!(0,c.$5m)(e)&&!(0,c.t$M)(e);)e=e.parentBox;return(0,c.$5m)(e)?e:null},fi=function(t,e){return new p.GCPRange(t,e-t+1)},vi=function(t){var e=t.movingPoint,r=t.viewRange,n=t.editor,o=t.state,i=kr.s9.getOutestTableBox(e.leafBox);if(i){var a=void 0;if(kr.s9.getOutestTableBox(r.start.leafBox))a=function(t){var e,r=t.movingPoint,n=t.box,o=t.selection,i=di(r),a=kr.MM.getPrevBox(i),s=yi(r),l=s.getSiblingIndex(),u=o.range(),g=u.len>0,h=s.getRanges()[0],d=h.begin(),y=h.end();if((0,c.sJD)(a)){var f=a.children[l].getRanges()[0],v=f.begin(),m=f.end();e=g?u.contains(v)?new p.GCPRange(o.getStart(),m-o.getStart()):new p.GCPRange(v,o.getEnd()-v):new p.GCPRange(v,y-v)}else if(g){var P=n.getRange();if(P.equal(u)&&a){var T=a.getRangeBegin();e=new p.GCPRange(T,u.end()-T)}else{var S=P.begin(),C=P.end();e=new p.GCPRange(S,C-S)}}else e=new p.GCPRange(d,y-d);return e}({movingPoint:e,box:i,selection:n.service.getSelection(),textStream:o.getTextStream()});else{var s=kr.MM.getPrevBox(i);a=fi(n.selection.gcpRange.gcpBegin,s.getRangeEnd())}return n.setRangeTo(a),!0}return!1},mi=function(t){var e=t.movingPoint,r=t.viewRange,n=t.editor,o=t.state,i=kr.s9.getOutestTableBox(e.leafBox);if(i){var a=void 0;if(kr.s9.getOutestTableBox(r.start.leafBox))a=function(t){var e,r=t.movingPoint,n=t.box,o=t.selection,i=di(r),a=kr.MM.getNextBox(i),s=yi(r),l=s.getSiblingIndex(),u=o.range(),g=u.len>0,h=s.getRanges()[0],d=h.begin(),y=h.end();if((0,c.sJD)(a)){var f=a.children[l].getRanges()[0],v=f.begin(),m=f.end();e=g?u.contains(m)?new p.GCPRange(v,o.getEnd()-v):new p.GCPRange(o.getStart(),m-o.getStart()):new p.GCPRange(d,m-d)}else if(g){var P=n.getRange();if(P.equal(u)&&a){var T=a.getRangeEnd();e=new p.GCPRange(u.begin(),T-u.begin())}else{var S=P.begin(),C=P.end();e=new p.GCPRange(S,C-S)}}else e=new p.GCPRange(d,y-d);return e}({movingPoint:e,box:i,selection:n.service.getSelection(),textStream:o.getTextStream()});else{var s=kr.MM.getNextBox(i);a=fi(n.selection.gcpRange.gcpBegin,s.getRangeEnd())}return n.setRangeTo(a),!0}return!1};!function(t){t[t.START=0]="START",t[t.END=1]="END",t[t.UNDEFINED=2]="UNDEFINED"}(ti||(ti={}));var Pi,Ti,Si,Ci,bi,Ri,_i,wi,xi,Ii,Di,Fi=function(){function t(t,e,r){var n=this;this.range=p.GCPRange.emptyRange(),this.movingPoint=ti.UNDEFINED,this.setRangeBackward=function(t,e){var r=!0;n.movingPoint===ti.END?e>t.begin()?(r=!1,n.range=n.handleMultiRange(t,e,r)):(n.range=new p.GCPRange(e,t.begin()-e),n.movingPoint=ti.START):n.range=new p.GCPRange(e,t.end()-e),n.editor.service.getSelection().setRange(n.range.begin(),n.range.end(),{scrollToView:h.hF.Near,backward:r})},this.setRangeForward=function(t,e){var r=!1;n.movingPoint===ti.START?e<t.end()?(r=!0,n.range=n.handleMultiRange(t,e,r)):(n.range=new p.GCPRange(t.end(),e-t.end()),n.movingPoint=ti.END):n.range=new p.GCPRange(t.begin(),e-t.begin()),n.editor.service.getSelection().setRange(n.range.begin(),n.range.end(),{scrollToView:h.hF.Near,backward:r})},this.editor=t,this.state=e,this.selector=r,this.editor.on(h.at.CoreSelectionChange,(function(t){n.onCoreSelectionChanged(t)}),this)}return t.prototype.onCoreSelectionChanged=function(t){(null==t?void 0:t.range)&&(t.range.equal(this.range)||(0===t.range.length()?this.movingPoint=ti.UNDEFINED:t.option&&t.option.backward&&(this.movingPoint=t.option.backward?ti.START:ti.END)))},t.prototype.skipHiddenContent=function(t,e){return this.state.selection.getCoreRange().skipHidden(t,e)},t.prototype.moveLeft=function(){var t=this.editor.service.getSelection(),e=t.range(),r=this.getPrevDataGCP(e,t);this.editor instanceof Ct.zq&&!this.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(new p.GCPRange(r,0))||t.setRange(r,r,{scrollToView:h.hF.Near})},t.prototype.getPrevDataGCP=function(t,e){var r=t.begin(),n=this.editor.docEnv.renderType!==p.RenderType.Lite,o=e.skipAnchors(r,!0,n);return t.length()>0?o:(o=e.prevTextBreak(o,{skipField:!1}),o=this.skipHiddenContent(o,!0),r>1&&r-1-e.skipAnchors(r-1,!0,n)>0?e.skipAnchors(o,!0,n):o)},t.prototype.moveRight=function(){var t=this.editor.service.getSelection(),e=t.range(),r=this.getNextDataGCP(e,t);this.editor instanceof Ct.zq&&!this.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(new p.GCPRange(r,0))||t.setRange(r,r,{scrollToView:h.hF.Near})},t.prototype.getNextDataGCP=function(t,e){var r=t.end(),n=this.editor.docEnv.renderType!==p.RenderType.Lite,o=e.skipAnchors(r,!1,n);return t.length()>0?o:(o=e.nextTextBreak(o),o=this.skipHiddenContent(o,!1))},t.prototype.moveUp=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getCurrentLineBox(t.start);if(e){var r,n=this.getLinePosFromViewPoint(t.start),i=kr.s9.getPosFromLineToTableCell(n,e,!1);i&&(r=i.lineInTableBox,n=(0,o.FJ)(i.lineInTablePos));var a,s=kr.s9.getPosFromTableCellToLine(n,e,!1);if(s&&(r=s.lineOutsideTableBox,n=(0,o.FJ)(s.lineOutsideTablePos)),r||(r=kr.MM.getVerticalPrevLineBox(e)),r=kr.wl.filterNextLineBoxForHeaderFooter(e,r,!1)){var l=this.moveToLinePointByPosition(r,n),c=l.gcp;if(l.isBreak)return;a=c}else{if(this.editor instanceof Ct.zq&&!this.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(null==e?void 0:e.getRange()))return;a=this.selector.moveToLinePoint(e,!0)}null!==a&&(this.range=new p.GCPRange(a,0))}}},t.prototype.readonlyMoveUp=function(){var t=this.editor.scrollHandler.getScrollRootSize(),e=(t.bottom-t.top)/(10*this.editor.zoom);this.editor.scrollHandler.scrollBy(0,-e,"smooth")},t.prototype.readonlyMoveDown=function(){var t=this.editor.scrollHandler.getScrollRootSize(),e=(t.bottom-t.top)/(10*this.editor.zoom);this.editor.scrollHandler.scrollBy(0,e,"smooth")},t.prototype.moveDown=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getCurrentLineBox(t.end);if(e){var r,n=this.getLinePosFromViewPoint(t.start),i=kr.s9.getPosFromLineToTableCell(n,e,!0);i&&(r=i.lineInTableBox,n=(0,o.FJ)(i.lineInTablePos));var a,s=kr.s9.getPosFromTableCellToLine(n,e,!0);if(s&&(r=s.lineOutsideTableBox,n=(0,o.FJ)(s.lineOutsideTablePos)),r||(r=kr.MM.getVerticalNextLineBox(e)),r=kr.wl.filterNextLineBoxForHeaderFooter(e,r,!0)){var l=this.moveToLinePointByPosition(r,n),c=l.gcp;if(l.isBreak)return;(a=c)&&(a=this.fixGcpBySkippingAnchors(a,!1))}else{if(this.editor instanceof Ct.zq&&!this.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(null==e?void 0:e.getRange()))return;a=this.selector.moveToLinePoint(e,!1)}null!==a&&(this.range=new p.GCPRange(a,0))}}},t.prototype.selectLeft=function(){var t=this.editor.service.getSelection(),e=t.range(),r=this.getMovingPointGcp(e,ti.START),n=t.getDecodedFieldInfo(r-1);r=t.prevTextBreak(r,{skipField:!!n}),r=this.skipHiddenContent(r,!0);var o=this.editor.viewSelection.getViewRange();(function(t){var e=t.selection,r=t.state,n=t.gcp,o=t.setRangeBackward,i=t.getMovingPoint,a=t.viewRange,s=e.range(),l=r.getTextStream().readText(n,1);if(l===p.PlaceholderChar.TableCellBreak){var c=e.getTableSelectionService().getPrevCellRange();if(c){var u=r.getTableStream().getCellInfo(s.begin());if(u)return o(new p.GCPRange(s.begin(),Math.max(u.range.end(),s.end())-s.begin()),c.begin()),!0}}if(l===p.PlaceholderChar.TableRowBreak){if(r.getTextStream().readText(n-1,1)===p.PlaceholderChar.TableStart)o(s,n-1);else{var g=i(a,ti.START),h=di(g);o(s,kr.MM.getPrevBox(h).getRangeBegin())}return!0}var d=r.getTableStream().getTableInfo(n);return!(e.isInTable()||!d||(o(s,d.range.begin()),0))})({selection:t,state:this.state,gcp:r,setRangeBackward:this.setRangeBackward,getMovingPoint:this.getMovingPoint,viewRange:o})||this.setRangeBackward(e,r)},t.prototype.selectRight=function(){var t=this.editor.service.getSelection(),e=t.range(),r=this.getMovingPointGcp(e,ti.END),n=t.getDecodedFieldInfo(r),o=t.nextTextBreak(r,{skipField:!!n});(function(t){var e=t.state,r=t.originGcp,n=t.gcp,o=t.viewRange,i=t.getMovingPoint,a=t.selection,s=t.setRangeForward,l=a.range(),c=e.getTextStream().readText(r,1),u=e.getTextStream().readText(r-1,1);if(c===p.PlaceholderChar.TableRowBreak){if(e.getTextStream().readText(n,1)===p.PlaceholderChar.TableEnd)s(l,n+1);else{var g=i(o,ti.END),h=di(g);s(l,kr.MM.getNextBox(h).getRangeEnd())}return!0}if(u===p.PlaceholderChar.TableCellBreak){var d=a.getTableSelectionService().getNextCellRange();if(d){var y=e.getTableStream().getCellInfo(l.begin());if(y){var f=Math.min(y.range.begin(),l.begin());return s(new p.GCPRange(f,l.end()-f),d.end()),!0}}}var v=e.getTableStream().getTableInfo(n);return!(a.isInTable()||!v||(s(l,v.range.end()),0))})({gcp:o=this.skipHiddenContent(o,!1),originGcp:r,viewRange:this.editor.viewSelection.getViewRange(),getMovingPoint:this.getMovingPoint,setRangeForward:this.setRangeForward,selection:t,state:this.state})||this.setRangeForward(e,o)},t.prototype.selectUp=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ti.START),r=this.getCurrentLineBox(e);if(r){var n=this.getLinePosFromViewPoint(e);if(!vi({movingPoint:e,viewRange:t,editor:this.editor,state:this.state})){var o=this.getPrevLineBoxGcp(r,n,t.start.gcp,e);null!==o&&this.setRangeBackward(this.editor.service.getSelection().range(),o)}}}},t.prototype.selectDown=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ti.END),r=this.getCurrentLineBox(e);if(r){var n=this.getLinePosFromViewPoint(e);if(!mi({movingPoint:e,viewRange:t,editor:this.editor,state:this.state})){var o=this.getNextLineBoxGcp(r,n,t.end.gcp,e);null!==o&&this.setRangeForward(this.editor.service.getSelection().range(),o)}}}},t.prototype.getPrevLineBoxGcp=function(t,e,r,n){for(var o=kr.MM.getVerticalPrevLineBox(t),i=this.getGcpLineStart(t);o;){if(!(0,c.sJD)(o)){i=this.getGcpByLinePos(o,e);var a=t.getRange();this.movingPoint===ti.START&&i===a.begin()&&(i=this.editor.service.getSelection().prevTextBreak(i));break}var s=this.getGcpLineStart(t);if(s&&r>s){i=s;break}o=o.parentBox,o=kr.MM.getPrevBoxSkipHidden(o)}return i},t.prototype.getNextLineBoxGcp=function(t,e,r,n){for(var o=kr.MM.getVerticalNextLineBox(t),i=this.getGcpLineEnd(t);o;){if(!(0,c.sJD)(o)){i=this.getGcpByLinePos(o,e);var a=t.getRange();this.movingPoint===ti.END&&i===a.end()&&n.gcp!==a.begin()&&(i=this.editor.service.getSelection().nextTextBreak(i));break}var s=this.getGcpLineEnd(t);if(s&&r<s){i=s;break}o=o.parentBox,o=kr.MM.getNextBoxSkipHidden(o)}return i},t.prototype.getGcpByPosNearBy=function(t,e){var r,n,a;!function(t){t.Left="left",t.Right="right"}(a||(a={}));var s=Number.MAX_SAFE_INTEGER,l=t,p=a.Left,c=(0,o.Ej)(e);try{for(var u=(0,i.__values)(t.children),g=u.next();!g.done;g=u.next()){var h=g.value,d=h.getOuterPoint().x,y=d+h.totalWidth;if(d<=c&&c<=y){p=c-d>y-c?a.Right:a.Left,l=h;break}if(d>c){d-c<s&&(p=a.Left,l=h);break}s=y-e,l=h,p=a.Right}}catch(t){r={error:t}}finally{try{g&&!g.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}var f=l.getRange();return p===a.Left?f.begin():f.end()},t.prototype.moveToWordLeft=function(){var t=this.editor.service.getSelection().range().begin();t=this.editor.service.getSelection().prevSkipSpace(t),t=this.editor.service.getSelection().prevWordBreak(t),this.editor.service.getSelection().setRange(t,t,{scrollToView:h.hF.Near})},t.prototype.moveToWordRight=function(){var t=this.editor.service.getSelection().range().end();t=this.editor.service.getSelection().nextSkipSpace(t),t=this.editor.service.getSelection().nextWordBreak(t),this.editor.service.getSelection().setRange(t,t,{scrollToView:h.hF.Near})},t.prototype.selectToWordLeft=function(){var t=this.editor.service.getSelection().range(),e=this.getMovingPointGcp(t,ti.START);e=this.editor.service.getSelection().prevSkipSpace(e),e=this.editor.service.getSelection().prevWordBreak(e,{skipField:!0}),this.setRangeBackward(t,e)},t.prototype.selectToWordRight=function(){var t=this.editor.service.getSelection().range(),e=this.getMovingPointGcp(t,ti.END);e=this.editor.service.getSelection().nextSkipSpace(e),e=this.editor.service.getSelection().nextWordBreak(e,{skipField:!0}),this.setRangeForward(t,e)},t.prototype.moveToLineStart=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getCurrentLineBox(t.start);e&&this.selector.moveToLinePoint(e,!0)}},t.prototype.moveToLineEnd=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getCurrentLineBox(t.end);e&&this.selector.moveToLinePoint(e,!1)}},t.prototype.moveToParaStart=function(){var t=this.editor.service,e=t.getSelection().range(),r=this.getMovingPointGcp(e,ti.START),n=t.getSelection().getParaRange(r);if(n){var o=null==n?void 0:n.begin();t.getSelection().setRange(o,o,{scrollToView:h.hF.Near})}},t.prototype.moveToParaEnd=function(){var t=this.editor.service,e=t.getSelection().range(),r=t.getSelection().storyLength(),n=this.getMovingPointGcp(e,ti.END),o=t.getSelection().getParaRange(n);if(o){var i=o.begin()+o.length()===r?o.end():o.end()-1;t.getSelection().setRange(i,i,{scrollToView:h.hF.Near})}},t.prototype.selectToLineStart=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ti.START),r=this.getCurrentLineBox(e);if(r){var n=this.getGcpLineStart(r);null!==n&&this.setRangeBackward(this.editor.service.getSelection().range(),n)}}},t.prototype.selectToLineEnd=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ti.END),r=this.getCurrentLineBox(e);if(r){var n=this.getGcpLineEnd(r);null!==n&&this.setRangeForward(this.editor.service.getSelection().range(),n)}}},t.prototype.selectToParaStart=function(){var t=this.editor.service.getSelection().range(),e=this.getMovingPointGcp(t,ti.START),r=this.editor.service.getSelection().getParaRange(e);t.end()!==(null==r?void 0:r.begin())&&t.begin()!==(null==r?void 0:r.begin())||(r=this.editor.service.getSelection().getParaRange(r.begin()-1)),r&&this.setRangeBackward(t,r.begin())},t.prototype.selectToParaEnd=function(){var t=this.editor.service.getSelection().range(),e=this.getMovingPointGcp(t,ti.END),r=this.editor.service.getSelection().getParaRange(e);t.end()===(null==r?void 0:r.end())&&(r=this.editor.service.getSelection().getParaRange(r.end()+1)),r&&this.setRangeForward(t,r.end())},t.prototype.moveToPrevPage=function(){var t,e,r,n=this.editor.viewSelection.getViewRange();if(n){var a=this.getMovingPoint(n,ti.END),s=kr.MM.getOffsetPoint(a.lineBox,c.uOS.Document),l=this.editor.getDocumentBox(),u=this.editor.scrollHandler.getScrollRootSize(),g=.85*(u.bottom-u.top)/this.editor.zoom;s.y=s.y-(0,o.Ej)(g)-a.caretHeight();var d=this.editor.service.getSelection().storyRange().begin(),y=(0,i.__read)(kr.MM.getLeastGrandsonByPoint(l,s),1)[0];(0,c.$5m)(y)?y=null===(e=null===(t=y.parentBox)||void 0===t?void 0:t.parentBox)||void 0===e?void 0:e.prevSibling:(0,c.sJD)(y)&&(y=null===(r=y.parentBox)||void 0===r?void 0:r.prevSibling),y&&(d=y.getRangeBegin()),this.editor.setRangeTo(new p.GCPRange(d),{scrollToView:h.hF.Top})}},t.prototype.moveToNextPage=function(){var t,e,r,n=this.editor.viewSelection.getViewRange();if(n){var a=this.getMovingPoint(n,ti.END),s=kr.MM.getOffsetPoint(a.lineBox,c.uOS.Document),l=this.editor.getDocumentBox(),u=this.editor.scrollHandler.getScrollRootSize(),g=.85*(u.bottom-u.top)/this.editor.zoom;s.y=s.y+(0,o.Ej)(g)+a.caretHeight();var d=this.editor.service.getSelection().storyRange().end(),y=(0,i.__read)(kr.MM.getLeastGrandsonByPoint(l,s),1)[0];(0,c.$5m)(y)?y=null===(e=null===(t=y.parentBox)||void 0===t?void 0:t.parentBox)||void 0===e?void 0:e.nextSibling:(0,c.sJD)(y)&&(y=null===(r=y.parentBox)||void 0===r?void 0:r.nextSibling),y&&(d=y.getRangeEnd()),this.editor.setRangeTo(new p.GCPRange(d),{scrollToView:h.hF.Top})}},t.prototype.selectToPrevPage=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ti.START),r=kr.MM.getOffsetPoint(e.lineBox,c.uOS.Document),n=this.editor.getDocumentBox(),a=this.editor.scrollHandler.getScrollRootSize(),s=a.bottom-a.top;r.y=r.y-(0,o.Ej)(s)-e.caretHeight();var l=this.editor.service.getSelection().storyRange().begin(),p=(0,i.__read)(kr.MM.getGrandsonByPoint(n,c.uOS.Line,r),2),u=p[0];p[1],u&&(l=u.getRangeBegin()),this.setRangeBackward(this.editor.service.getSelection().range(),l)}},t.prototype.selectToNextPage=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ti.END),r=kr.MM.getOffsetPoint(e.lineBox,c.uOS.Document),n=this.editor.getDocumentBox(),a=this.editor.scrollHandler.getScrollRootSize(),s=a.bottom-a.top;r.y=r.y+(0,o.Ej)(s)+e.caretHeight();var l=this.editor.service.getSelection().storyRange().end(),p=(0,i.__read)(kr.MM.getGrandsonByPoint(n,c.uOS.Line,r),2),u=p[0];p[1],u&&(l=u.getRangeEnd()),this.setRangeForward(this.editor.service.getSelection().range(),l)}},t.prototype.moveToStoryStart=function(){var t=this.editor.service.getSelection().storyRange();this.editor.service.getSelection().setRange(t.begin(),t.begin(),{scrollToView:h.hF.Near})},t.prototype.moveToStoryEnd=function(){var t=this.editor.service.getSelection().storyRange();this.editor.service.getSelection().setRange(t.end(),t.end(),{scrollToView:h.hF.Near})},t.prototype.selectToStoryStart=function(){this.movingPoint=ti.START;var t=this.editor.service.getSelection().range(),e=this.editor.service.getSelection().storyRange();this.setRangeBackward(t,e.begin())},t.prototype.selectToStoryEnd=function(){this.movingPoint=ti.END;var t=this.editor.service.getSelection().range(),e=this.editor.service.getSelection().storyRange();this.setRangeForward(t,e.end())},t.prototype.selectAll=function(){this.editor.service.getSelection().wholeStory()},t.prototype.selectWord=function(t){this.editor.service.getSelection().selectWord(t)},t.prototype.selectParagraph=function(t){this.editor.service.getSelection().selectParagraph(t)},t.prototype.getMovingPoint=function(t,e){var r;return e===ti.START?this.movingPoint===ti.END?r=t.end:(this.movingPoint=e,r=t.start):e===ti.END&&(this.movingPoint===ti.START?r=t.start:(this.movingPoint=e,r=t.end)),r},t.prototype.getMovingPointGcp=function(t,e){var r;return e===ti.START?this.movingPoint===ti.END?r=this.fixGcpBySkippingAnchors(t.end(),!0):(this.movingPoint=e,r=this.fixGcpBySkippingAnchors(t.begin(),!0)):e===ti.END&&(this.movingPoint===ti.START?r=this.fixGcpBySkippingAnchors(t.begin(),!1):(this.movingPoint=e,r=this.fixGcpBySkippingAnchors(t.end(),!1))),r=r>0?r:0},t.prototype.fixGcpBySkippingAnchors=function(t,e){var r=this.editor.docEnv.renderType!==p.RenderType.Lite;return this.editor.service.getSelection().skipAnchors(t,e,r)},t.prototype.getCurrentLineBox=function(t){if(t instanceof Q.SE$){for(var e=t.leafBox.parentBox;e&&!(0,c.o70)(e);)e=e.parentBox;if((0,c.o70)(e))return e}return null},t.prototype.getGcpByLinePos=function(t,e){for(var r;!(0,c.o70)(t);){if(!t.firstChild)return this.getGcpByPosNearBy(t,e);t=t.firstChild}var n=new o.DR;n.x=(0,o.Ej)(e),n.y=null!==(r=t.totalHeight/2)&&void 0!==r?r:0;var a=(0,i.__read)(kr.MM.getGrandsonByPoint(t,c.uOS.Text,n),2),s=a[0],l=a[1];if(s&&l){var p=kr.MM.getOffsetByPosition(s,(0,o.FJ)(l.x)).offset,u=s.getRange().begin()+p,g=s.parentBox;return(0,c.tqe)(g)?s.getRangeEnd()-1-u>u-s.getRangeBegin()?g.getRangeBegin():g.getRangeEnd()-1:this.isTOCParaBox(g)?g.getRangeEnd():u}return this.getGcpByPosNearBy(t,e)},t.prototype.isTOCParaBox=function(t){var e;if(!t)return!1;if((0,c.o70)(t)){var r=this.state.getFieldStream(),n=t.getRangeBegin(),o=r.getDecodedFieldInfo(n);if(o){var i=o.hasNestField,a=o.nestingLevel;if(o.fieldCode.name===p.FieldName.TOC||i&&2===a&&(null===(e=r.getDecodedFieldInfo(n,1))||void 0===e?void 0:e.fieldCode.name)===p.FieldName.TOC)return!0}}return!1},t.prototype.getGcpLineStart=function(t){for(var e=null==t?void 0:t.firstChild;e;){if((0,c.NFz)(e))return e.getRangeBegin();e=e.firstChild}return null},t.prototype.getGcpLineEnd=function(t){for(var e=null==t?void 0:t.lastChild;e;){if((0,c.NFz)(e))return e.getRangeEnd();e=e.lastChild}return null},t.prototype.moveToLinePointByPosition=function(t,e){var r=this.getGcpByLinePos(t,e);if(r!==t.getRange().end()){if(this.editor instanceof Ct.zq&&!this.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(new p.GCPRange(r,0)))return{gcp:r,isBreak:!0};this.editor.service.getSelection().setRange(r,r,{scrollToView:h.hF.Near})}else{if(this.editor instanceof Ct.zq&&!this.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(t.getRange()))return{gcp:r,isBreak:!0};r=this.selector.moveToLinePoint(t,!1)}return{gcp:r,isBreak:!1}},t.prototype.handleMultiRange=function(t,e,r){var n=this.state.dataEngine.getDataStream().getFieldStream(),o=n.getNestingFieldInfos(t),i=n.getFieldRange(e,1),a=t.begin(),s=t.end();return i?1===o.length?r?new p.GCPRange(e,i.fieldResultRange.end()-e):new p.GCPRange(i.fieldResultRange.begin(),e-i.fieldResultRange.begin()):r?new p.GCPRange(i.fieldRange.end(),s-i.fieldRange.end()):new p.GCPRange(a,i.fieldRange.begin()-a):r?new p.GCPRange(e,s-e):new p.GCPRange(a,e-a)},t.prototype.moveHorizontallyLite=function(t,e){var r,n=t.paraPosOffset(this.editor.zoom),o=t.paraBox.__node__;if(o){var i=o.getBoundingClientRect(),a=i.x,s=i.y,l=i.width;r=e?{clientX:a,clientY:s+n.y+t.lineHeight/2,element:o}:{clientX:a+l,clientY:s+n.y+t.lineHeight/2,element:o}}var p=this.selector.findViewPoint(r,!0);if(p)return p.gcp},t.prototype.getLinePosFromViewPoint=function(t){var e,r=(0,o.FJ)(t.linePosOffset());if(t.leafBox.parentBox&&(0,c.JtM)(t.leafBox.parentBox)){var n=t.leafBox.parentBox,i=n.getOuterPoint().x+n.edge.margin.left;e=(0,o.FJ)(i)+r}else e=r;return e},t.prototype.findCurrentPageIndex=function(){var t=this.editor.viewSelection.getViewRange(),e=null==t?void 0:t.start.leafBox;if(e){var r=e.getAncestorOf(c.uOS.Page);return(null==r?void 0:r.getPageIndex())||0}return 0},t}(),Ei=r(279135),Mi=((Pi={})[Ei.a.BACKSPACE]=function(t,e){if(t&&t instanceof Ct.zq&&t.isEditable()){if(t.isCompositing())return;var r=t.service.getSelection(),n=(0,p.isPrintLayout)(t.docEnv.layoutType);r.typeBackspace(n)}},Pi[Ei.a.DELETE]=function(t,e){if(t&&t instanceof Ct.zq&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().delete()}},Pi[Ei.a.ENTER]=function(t,e){if(t&&t instanceof Ct.zq&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeParagraph()}},Pi[Ei.a.LINE_BREAK]=function(t,e){t&&t instanceof Ct.zq&&t.isEditable()&&t.service.getSelection().typeLineBreak()},Pi[Ei.a.TAB]=function(t,e){if(t&&t instanceof Ct.zq&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeText("\t")}},Pi[Ei.a.SHIFT_TAB]=function(t,e){if(t&&t instanceof Ct.zq&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeText("\t")}},Pi[Ei.a.BACKSPACE_WORD]=function(t,e){if(t&&t instanceof Ct.zq&&t.isEditable()){var r=t.service.getSelection().range();if(r.isEmpty()){var n=t.service.getSelection().prevSkipSpace(r.begin());n=t.service.getSelection().prevWordBreak(n),t.service.getSelection().delete(new p.GCPRange(n,r.begin()-n))}else t.service.getSelection().typeBackspace()}},Pi[Ei.a.DELETE_WORD]=function(t,e){if(t&&t instanceof Ct.zq&&t.isEditable()){var r=t.service.getSelection().range();if(r.isEmpty()){var n=t.service.getSelection().nextSkipSpace(r.begin());n=t.service.getSelection().nextWordBreak(n),t.service.getSelection().delete(new p.GCPRange(r.begin(),n-r.begin()))}else t.service.getSelection().delete()}},Pi[Ei.a.PURE_REDO]=function(t,e){t&&t instanceof Ct.zq&&t.isEditable()&&t.run("isRedoAvailable")&&t.run("redo")},Pi[Ei.a.BACKSPACE_LINE]=function(t,e){if(t&&t instanceof Ct.zq&&t.isEditable()){var r=t.service.getSelection(),n=r.range();if(n.isEmpty()){var o=t.viewSelection.getViewRange();if(!o||o.start instanceof Q.$gc)return;for(var i=o.start.leafBox.parentBox;i&&!(0,c.o70)(i);)i=i.parentBox;if(!i||!(0,c.o70)(i))return;if(r.isSelectionCollapseAtParaStart())return void r.typeBackspace();var a=i.getRangeBegin();r.delete(new p.GCPRange(a,n.begin()-a))}else r.typeBackspace()}},Pi),Li=[{keyBindings:{win:u.VD.BACKSPACE,mac:u.VD.BACKSPACE},action:Ei.a.BACKSPACE},{keyBindings:{win:u.N9.SHIFT+u.VD.BACKSPACE,mac:u.N9.SHIFT+u.VD.BACKSPACE},action:Ei.a.BACKSPACE},{keyBindings:{win:u.VD.DELETE,mac:u.VD.DELETE},action:Ei.a.DELETE},{keyBindings:{win:u.VD.TAB,mac:u.VD.TAB},action:Ei.a.TAB},{keyBindings:{win:u.VD.ENTER,mac:u.VD.ENTER},action:Ei.a.ENTER},{keyBindings:{win:u.N9.SHIFT+u.VD.ENTER,mac:u.N9.SHIFT+u.VD.ENTER},action:Ei.a.LINE_BREAK},{keyBindings:{win:u.N9.ALT+u.VD.BACKSPACE,mac:u.N9.ALT+u.VD.BACKSPACE},action:Ei.a.BACKSPACE_WORD},{keyBindings:{win:u.N9.ALT+u.VD.DELETE,mac:u.N9.ALT+u.VD.DELETE},action:Ei.a.DELETE_WORD},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.BACKSPACE,mac:u.N9.COMMAND+u.VD.BACKSPACE},action:Ei.a.BACKSPACE_LINE},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.Z,mac:u.N9.COMMAND+u.VD.Z},action:Ei.a.UNDO},{keyBindings:{win:[u.N9.CTRL_WIN+u.VD.Y,u.N9.CTRL_WIN+u.N9.SHIFT+u.VD.Z],mac:[u.N9.COMMAND+u.VD.Y,u.N9.COMMAND+u.N9.SHIFT+u.VD.Z]},action:Ei.a.REDO},{keyBindings:{win:-1,mac:u.N9.COMMAND+u.N9.SHIFT+u.VD.Z},action:Ei.a.PURE_REDO}],Ai=((Ti={})[ci.a.ARROW_LEFT]=function(t,e){var r;t&&t instanceof Ct.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveLeft())},Ti[ci.a.ARROW_RIGHT]=function(t,e){var r;t&&t instanceof Ct.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveRight())},Ti[ci.a.ARROW_UP]=function(t,e){var r,n,o;t&&t instanceof Ct.zq&&((null===(r=t.surface)||void 0===r?void 0:r.isEditable())?null===(n=t.surface)||void 0===n||n.selectionHandler.moveUp():null===(o=t.surface)||void 0===o||o.selectionHandler.readonlyMoveUp())},Ti[ci.a.ARROW_DOWN]=function(t,e){var r,n,o;t&&t instanceof Ct.zq&&((null===(r=t.surface)||void 0===r?void 0:r.isEditable())?null===(n=t.surface)||void 0===n||n.selectionHandler.moveDown():null===(o=t.surface)||void 0===o||o.selectionHandler.readonlyMoveDown())},Ti[ci.a.SELECT_LEFT]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectLeft())},Ti[ci.a.SELECT_RIGHT]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectRight())},Ti[ci.a.SELECT_UP]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectUp())},Ti[ci.a.SELECT_DOWN]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectDown())},Ti[ci.a.MOVE_TO_CHARACTER_LEFT]=function(t,e){var r;t&&t instanceof Ct.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveLeft(),u.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"one_character_to_the_left"}))},Ti[ci.a.MOVE_TO_CHARACTER_RIGHT]=function(t,e){var r;t&&t instanceof Ct.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveRight(),u.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"one_character_to_the_right"}))},Ti[ci.a.MOVE_TO_WORD_LEFT]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToWordLeft())},Ti[ci.a.MOVE_TO_WORD_RIGHT]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToWordRight())},Ti[ci.a.SELECT_TO_WORD_LEFT]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToWordLeft())},Ti[ci.a.SELECT_TO_WORD_RIGHT]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToWordRight())},Ti[ci.a.MOVE_TO_LINE_START]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToLineStart())},Ti[ci.a.MOVE_TO_LINE_END]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToLineEnd())},Ti[ci.a.SELECT_TO_LINE_START]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToLineStart())},Ti[ci.a.SELECT_TO_LINE_END]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToLineEnd())},Ti[ci.a.MOVE_TO_PREVIOUS_LINE]=function(t,e){var r;t&&t instanceof Ct.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveUp(),u.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"the_previous_line"}))},Ti[ci.a.MOVE_TO_NEXT_LINE]=function(t,e){var r;t&&t instanceof Ct.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveDown(),u.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"the_next_line"}))},Ti[ci.a.SELECT_TO_PARA_START]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToParaStart())},Ti[ci.a.SELECT_TO_PARA_END]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToParaEnd())},Ti[ci.a.MOVE_TO_PARA_START]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToParaStart(),u.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"the_beginning_of_the_paragraph"}))},Ti[ci.a.MOVE_TO_PARA_END]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToParaEnd(),u.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"the_end_of_the_paragraph"}))},Ti[ci.a.SELECT_TO_PREV_PAGE]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToPrevPage())},Ti[ci.a.SELECT_TO_NEXT_PAGE]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToNextPage())},Ti[ci.a.MOVE_TO_PREV_PAGE]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToPrevPage())},Ti[ci.a.MOVE_TO_NEXT_PAGE]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToNextPage())},Ti[ci.a.MOVE_TO_STORY_START]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToStoryStart())},Ti[ci.a.MOVE_TO_STORY_END]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToStoryEnd())},Ti[ci.a.SELECT_TO_STORY_START]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToStoryStart())},Ti[ci.a.SELECT_TO_STORY_END]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToStoryEnd())},Ti[ci.a.SELECT_WORD]=function(t,e,r){var n;t&&t instanceof Ct.zq&&(null===(n=t.surface)||void 0===n||n.selectionHandler.selectWord(r))},Ti[ci.a.SELECT_PARA]=function(t,e,r){var n;t&&t instanceof Ct.zq&&(null===(n=t.surface)||void 0===n||n.selectionHandler.selectParagraph(r))},Ti[ci.a.SELECT_ALL]=function(t,e){var r;t&&t instanceof Ct.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectAll())},Ti),Bi=[{keyBindings:{win:u.VD.ARROW_LEFT,mac:u.VD.ARROW_LEFT},action:ci.a.ARROW_LEFT},{keyBindings:{win:u.VD.ARROW_UP,mac:u.VD.ARROW_UP},action:ci.a.ARROW_UP},{keyBindings:{win:u.VD.ARROW_RIGHT,mac:u.VD.ARROW_RIGHT},action:ci.a.ARROW_RIGHT},{keyBindings:{win:u.VD.ARROW_DOWN,mac:u.VD.ARROW_DOWN},action:ci.a.ARROW_DOWN},{keyBindings:{win:u.N9.SHIFT+u.VD.ARROW_LEFT,mac:u.N9.SHIFT+u.VD.ARROW_LEFT},action:ci.a.SELECT_LEFT},{keyBindings:{win:u.N9.SHIFT+u.VD.ARROW_RIGHT,mac:u.N9.SHIFT+u.VD.ARROW_RIGHT},action:ci.a.SELECT_RIGHT},{keyBindings:{win:u.N9.SHIFT+u.VD.ARROW_UP,mac:u.N9.SHIFT+u.VD.ARROW_UP},action:ci.a.SELECT_UP},{keyBindings:{win:u.N9.SHIFT+u.VD.ARROW_DOWN,mac:u.N9.SHIFT+u.VD.ARROW_DOWN},action:ci.a.SELECT_DOWN},{keyBindings:{win:[],mac:u.N9.CTRL_MAC+u.VD.B},action:ci.a.MOVE_TO_CHARACTER_LEFT},{keyBindings:{win:[],mac:u.N9.CTRL_MAC+u.VD.F},action:ci.a.MOVE_TO_CHARACTER_RIGHT},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.ARROW_LEFT,mac:u.N9.ALT+u.VD.ARROW_LEFT},action:ci.a.MOVE_TO_WORD_LEFT},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.ARROW_RIGHT,mac:u.N9.ALT+u.VD.ARROW_RIGHT},action:ci.a.MOVE_TO_WORD_RIGHT},{keyBindings:{win:u.N9.CTRL_WIN+u.N9.SHIFT+u.VD.ARROW_LEFT,mac:u.N9.ALT+u.N9.SHIFT+u.VD.ARROW_LEFT},action:ci.a.SELECT_TO_WORD_LEFT},{keyBindings:{win:u.N9.CTRL_WIN+u.N9.SHIFT+u.VD.ARROW_RIGHT,mac:u.N9.ALT+u.N9.SHIFT+u.VD.ARROW_RIGHT},action:ci.a.SELECT_TO_WORD_RIGHT},{keyBindings:{win:u.VD.HOME,mac:[u.VD.HOME,u.N9.COMMAND+u.VD.ARROW_LEFT]},action:ci.a.MOVE_TO_LINE_START},{keyBindings:{win:u.VD.END,mac:[u.VD.END,u.N9.COMMAND+u.VD.ARROW_RIGHT]},action:ci.a.MOVE_TO_LINE_END},{keyBindings:{win:u.N9.SHIFT+u.VD.HOME,mac:[u.N9.SHIFT+u.VD.HOME,u.N9.COMMAND+u.N9.SHIFT+u.VD.ARROW_LEFT]},action:ci.a.SELECT_TO_LINE_START},{keyBindings:{win:u.N9.SHIFT+u.VD.END,mac:[u.N9.SHIFT+u.VD.END,u.N9.COMMAND+u.N9.SHIFT+u.VD.ARROW_RIGHT]},action:ci.a.SELECT_TO_LINE_END},{keyBindings:{win:[],mac:u.N9.CTRL_MAC+u.VD.P},action:ci.a.MOVE_TO_PREVIOUS_LINE},{keyBindings:{win:[],mac:u.N9.CTRL_MAC+u.VD.N},action:ci.a.MOVE_TO_NEXT_LINE},{keyBindings:{win:u.N9.CTRL_WIN+u.N9.SHIFT+u.VD.ARROW_UP,mac:u.N9.ALT+u.N9.SHIFT+u.VD.ARROW_UP},action:ci.a.SELECT_TO_PARA_START},{keyBindings:{win:u.N9.CTRL_WIN+u.N9.SHIFT+u.VD.ARROW_DOWN,mac:u.N9.ALT+u.N9.SHIFT+u.VD.ARROW_DOWN},action:ci.a.SELECT_TO_PARA_END},{keyBindings:{win:[],mac:u.N9.CTRL_MAC+u.VD.A},action:ci.a.MOVE_TO_PARA_START},{keyBindings:{win:[],mac:u.N9.CTRL_MAC+u.VD.E},action:ci.a.MOVE_TO_PARA_END},{keyBindings:{win:u.N9.SHIFT+u.VD.PAGE_UP,mac:u.N9.SHIFT+u.VD.PAGE_UP},action:ci.a.SELECT_TO_PREV_PAGE},{keyBindings:{win:u.N9.SHIFT+u.VD.PAGE_DOWN,mac:u.N9.SHIFT+u.VD.PAGE_DOWN},action:ci.a.SELECT_TO_NEXT_PAGE},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.HOME,mac:[u.N9.COMMAND+u.VD.HOME,u.N9.COMMAND+u.VD.ARROW_UP]},action:ci.a.MOVE_TO_STORY_START},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.END,mac:[u.N9.COMMAND+u.VD.END,u.N9.COMMAND+u.VD.ARROW_DOWN]},action:ci.a.MOVE_TO_STORY_END},{keyBindings:{win:u.VD.PAGE_DOWN,mac:u.VD.PAGE_DOWN},action:ci.a.MOVE_TO_NEXT_PAGE},{keyBindings:{win:u.VD.PAGE_UP,mac:u.VD.PAGE_UP},action:ci.a.MOVE_TO_PREV_PAGE},{keyBindings:{win:u.N9.CTRL_WIN+u.N9.SHIFT+u.VD.HOME,mac:u.N9.COMMAND+u.N9.SHIFT+u.VD.HOME},action:ci.a.SELECT_TO_STORY_START},{keyBindings:{win:u.N9.CTRL_WIN+u.N9.SHIFT+u.VD.END,mac:u.N9.COMMAND+u.N9.SHIFT+u.VD.END},action:ci.a.SELECT_TO_STORY_END},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.A,mac:u.N9.COMMAND+u.VD.A},action:ci.a.SELECT_ALL}],Ni=r(896100),Oi=((Si={})[Ni.a.COPY]=function(t,e){t&&t instanceof Ct.zq&&t.isCopyable()&&t.clipboardManager.copy()},Si[Ni.a.CUT]=function(t,e){t&&t instanceof Ct.zq&&t.isEditable()&&t.clipboardManager.cut()},Si[Ni.a.PASTE]=function(t,e){t&&t instanceof Ct.zq&&t.isEditable()&&t.clipboardManager.paste()},Si),ki=[{keyBindings:{win:u.N9.CTRL_WIN+u.VD.C,mac:u.N9.COMMAND+u.VD.C},action:Ni.a.COPY},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.X,mac:u.N9.COMMAND+u.VD.X},action:Ni.a.CUT},{keyBindings:{win:u.N9.CTRL_WIN+u.VD.V,mac:u.N9.COMMAND+u.VD.V},action:Ni.a.PASTE}],Gi=function(){function t(t){var e=document.getElementsByClassName("".concat(Q.F51.meloDocView));0===e.length?this.containerView=null:this.containerView=e[0],this.editor=t,this.selector=t.createSelector()}return t.prototype.updateCursorStyle=function(t){var e;if(this.containerView&&(this.containerView.style.cursor="text",t&&this.needUpdate())){var r=null===(e=this.selector.findHitViewPoint(!1,!0,!1,t,!1))||void 0===e?void 0:e.leafBox;this.hasUpdatedContainerCursorStyle(r)||this.hasUpdatedTextFrameCursorStyle(r)}},t.prototype.hasUpdatedContainerCursorStyle=function(t){return!!(0,c.vvs)(t)&&!!(0,c.Oij)(t)&&(this.containerView&&(this.containerView.style.cursor=this.editor.docEnv.editable?"move":"zoom-in"),!0)},t.prototype.hasUpdatedTextFrameCursorStyle=function(t){var e;return!!(0,c.tJJ)(t)&&(this.containerView&&(this.containerView.style.cursor=(null===(e=t.textboxProperty)||void 0===e?void 0:e.textBoxType)!==p.TextFrameType.TextFrame&&t.textboxProperty?"text":"move"),!0)},t.prototype.needUpdate=function(){return!!this.editor.service.getDocument().getShapes().item(0)},t}(),Hi="keydown",Wi=function(){function t(t,e,r,n){var o=this;this.mouseDownTime=0,this.mouseDownPos=[0,0],this.mouseUpTime=0,this.mouseUpPos=[0,0],this.mouseType=c.POP.NONE,this.mouseAction=c.oXr.NONE,this._viewRange=void 0,this.contextMenuShowTimeout=0,this.isInsert=!1,this.resetInsertStatus=function(){o.isInsert=!1},this.editor=t,this.state=e,this.mouseSelector=r.mouseSelector,this.scrollHandler=n,this.cursorUpdater=new Gi(t),this.onMouseMoveListener=this.onMouseMove.bind(this),this.onMouseUpListener=this.onMouseUp.bind(this)}return Object.defineProperty(t.prototype,"viewRange",{get:function(){return this._viewRange},set:function(t){this._viewRange=t},enumerable:!1,configurable:!0}),t.prototype.attach=function(){var t=this;document.addEventListener("mousemove",this.onMouseMoveListener),document.addEventListener("mouseup",this.onMouseUpListener),document.addEventListener(Hi,this.resetInsertStatus),this.editor.on(Q.kgn.PAGE_MOUSE_EVENT,(function(e){t.cursorUpdater.updateCursorStyle(e.hitPoint),e.event&&("mousedown"===e.event.type?t.onMouseDown(e.event.nativeEvent,e.hitPoint):"mousemove"===e.event.type?t.onMouseMove(e.event.nativeEvent,e.hitPoint):"mouseup"===e.event.type?t.onMouseUp(e.event.nativeEvent,e.hitPoint):"contextmenu"===e.event.type&&t.onContextMenu(e.event.nativeEvent,e.hitPoint))}))},t.prototype.detach=function(){document.removeEventListener("mousemove",this.onMouseMoveListener),document.removeEventListener("mouseup",this.onMouseMoveListener),document.removeEventListener(Hi,this.resetInsertStatus),this.editor.removeListener(Q.kgn.PAGE_MOUSE_EVENT,this)},t.prototype.onMouseDown=function(t,e){0===t.button&&(this.mouseSelector.lastSelectList&&(this.mouseAction=c.oXr.NONE),this.editor.fire(new c.Zl0(t,c.oXr.NONE,e)),this.scrollHandler.disableScrollOnSelectionChanged(),this.mouseType=c.POP.DOWN,this.mouseDownTime=Date.now(),this.mouseDownPos=[t.clientX,t.clientY],this.checkContinuousMouseDowns(t,e))},t.prototype.checkContinuousMouseDowns=function(t,e){var r=this;if(this.clickInterval(this.mouseUpTime,this.mouseDownTime)&&this.equalPos(this.mouseUpPos,this.mouseDownPos)&&this.mouseAction!==c.oXr.DRAG&&this.mouseAction!==c.oXr.LONG_CLICK||(this.mouseAction=c.oXr.NONE),this.mouseAction===c.oXr.NONE){if(this.isInsert)return this.isInsert=!1,this.editor.fire(new Q.uWz(Q.Lll.HIDDEN),!1),this.editor.run("undo"),clearTimeout(this.clickTimeInterval),void(this.clickTimeInterval=setTimeout((function(){r.editor.fire(new Q.uWz(Q.Lll.SHOW),!1),r.searchViewRangeByPoint(t,e)}),100));this.searchViewRangeByPoint(t,e)}},t.prototype.searchViewRangeByPoint=function(t,e){this.mouseSelector.onMouseEvent(t,c.POP.DOWN,e);var r=this.mouseSelector.getSelection();r&&(this.callMobileContextMenuIfNeed(r.viewRange),this.viewRange=r.viewRange)},t.prototype.onMouseMove=function(t,e){if(!this.editor.docEnv.isDragging){if(this.mouseType===c.POP.DOWN){var r=[t.clientX,t.clientY];this.equalPos(this.mouseDownPos,r)||(this.mouseType=c.POP.MOVE)}if(this.mouseType===c.POP.MOVE){if(this.mouseSelector.onMouseEvent(t,c.POP.MOVE,e),this.mouseSelector.start&&this.mouseSelector.end){var n=void 0;n=(0,Q.YrZ)(this.mouseSelector.start,this.mouseSelector.end)?this.mouseSelector.start:this.mouseSelector.end,this.scrollHandler.scrollByIfNeedThrottle(t.clientX,t.clientY,n)}this.onDrag(t,e)}}},t.prototype.onMouseUp=function(t,e){0===t.button&&this.mouseType!==c.POP.UP&&(this.editor.fire(new c.Zl0(t,c.oXr.NONE,e)),this.scrollHandler.enableScrollOnSelectionChanged(),this.mouseType=c.POP.UP,this.mouseUpTime=Date.now(),this.mouseUpPos=[t.clientX,t.clientY],this.mouseSelector.onMouseEvent(t,c.POP.UP,e),this.checkContinuousMouseUps(t,e))},t.prototype.checkContinuousMouseUps=function(t,e){this.equalPos(this.mouseDownPos,this.mouseUpPos)?this.clickInterval(this.mouseDownTime,this.mouseUpTime)?this.mouseAction===c.oXr.NONE||this.mouseAction===c.oXr.LONG_CLICK?this.onClick(t,e):this.mouseAction===c.oXr.CLICK||this.mouseAction===c.oXr.TRIPLE_CLICK?this.onDoubleClick(t,e):this.mouseAction===c.oXr.DOUBLE_CLICK&&this.onTripleClick(t,e):this.onLongClick(t,e):this.mouseAction=c.oXr.NONE},t.prototype.onContextMenu=function(t,e){if(this.mouseSelector.onMouseEvent(t,c.POP.CONTEXTMENU,e),o.wV.isTencentDocsIPadApp()){var r=this.mouseSelector.getSelection();(null==r?void 0:r.viewRange)&&this.callMobileContextMenu(r.viewRange)}},t.prototype.onDrag=function(t,e){var r;this.mouseAction=c.oXr.DRAG,o.wV.isTencentDocsIPadApp()&&(null===(r=this.editor.surface)||void 0===r||r.requestFocus(this.viewRange)),this.editor.fire(new c.Zl0(t,c.oXr.DRAG))},t.prototype.canClick=function(){var t,e,r,n,o;if(null===window||void 0===window?void 0:window.isPublishedURL)return!0;if(this.editor.isRestrictProtectOn){var i=null===(e=null===(t=this.mouseSelector.getSelection())||void 0===t?void 0:t.viewRange)||void 0===e?void 0:e.getGCPRange();if(!i)return!0;if(!this.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(i)){var a=this.editor.state.selection.getSdtSelection(),s=null===(o=null===(n=null===(r=this.editor.service)||void 0===r?void 0:r.getDocument())||void 0===n?void 0:n.getSelection())||void 0===o?void 0:o.getSdtService();return a.isWrappedSdtByRange(i)?null==s||s.setRangeTo(0,0):null==s||s.focusRangeToSdtByPosition(i,{focusToDefault:!1}),!1}}return!0},t.prototype.onClick=function(t,e){var r;this.canClick()&&(this.mouseAction=c.oXr.CLICK,this.editor.fire(new c.Zl0(t,c.oXr.CLICK,e)),o.wV.isTencentDocsIPadApp()&&(null===(r=this.editor.surface)||void 0===r||r.requestFocus(this.viewRange)))},t.prototype.onDoubleClick=function(t,e){var r,n;if(clearTimeout(this.contextMenuShowTimeout),this.canClick()){if(this.mouseAction=c.oXr.DOUBLE_CLICK,this.isInsert=this.isInsert||null!==(r=this.editor.run("action_dbclick",this.editor,e))&&void 0!==r&&r,this.mouseSelector.onDoubleClick(t),this.viewRange&&!this.state.waitingForReflow){var i=this.viewRange.start.documentBox;!this.isInsert&&i&&i.isValid()&&(this.editor.run("selectWord",this.viewRange.start.gcp),this.editor.fire(new Q.HLW))}o.wV.isTencentDocsIPadApp()&&(null===(n=this.editor.surface)||void 0===n||n.requestFocus(this.viewRange)),this.editor.fire(new c.Zl0(t,c.oXr.DOUBLE_CLICK,e))}},t.prototype.onTripleClick=function(t,e){if(this.canClick()&&(this.mouseAction=c.oXr.TRIPLE_CLICK,this.editor.fire(new c.Zl0(t,c.oXr.TRIPLE_CLICK,e)),this.viewRange&&!this.state.waitingForReflow)){var r=this.viewRange.start.documentBox;r&&r.isValid()&&(this.editor.run("selectParagraph",this.viewRange.start.gcp),this.editor.fire(new Q.Xvi))}},t.prototype.onLongClick=function(t,e){this.canClick()&&(this.mouseAction=c.oXr.LONG_CLICK,this.editor.fire(new c.Zl0(t,c.oXr.LONG_CLICK,e)))},t.prototype.clickInterval=function(t,e){return e-t<500},t.prototype.equalPos=function(t,e){return Math.abs(t[0]-e[0])<10&&Math.abs(t[1]-e[1])<10},t.prototype.callMobileContextMenuIfNeed=function(t){var e=this;o.wV.isTencentDocsIPadApp()&&t&&t.equals(this.viewRange)&&(this.contextMenuShowTimeout=setTimeout((function(){e.callMobileContextMenu(t)}),400))},t.prototype.callMobileContextMenu=function(t){this.editor.fire(new Q.Rmi(t))},t}(),Ui=r(937069),Vi=function(){function t(t,e){this.touchStartTime=0,this.touchStartPos=[0,0],this.touchEndTime=0,this.touchEndPos=[0,0],this.focusingTouch=!1,this.onBlur=!0,this.touchAction=c.Nli.NONE,this.viewRange=void 0,this.contextMenuShowTimeout=void 0,this.longTouchStartTimeout=void 0,this.editTipsShowTimeout=void 0,this.LONG_TOUCH_TIME=300,this.disableTouchEnterEdit=!1,this.isDoubleTouchToEdit=!1,this.disableTouchToEdit=["desktop_local","drive_file"].includes(Ui.default.getInstance().getConfig("client")),this.editor=t,this.touchSelector=e.touchSelector}return t.prototype.attach=function(){var t=this;this.editor.on(Q.kgn.PAGE_TOUCH_EVENT,(function(e){e.event&&("touchstart"===e.event.type?t.onTouchStart(e.event,e.hitPoint):"touchmove"===e.event.type?t.onTouchMove(e.event,e.hitPoint):"touchend"===e.event.type&&t.onTouchEnd(e.event,e.hitPoint))})),this.editor.on(Q.cbw.ON_FOCUS,(function(){t.onBlur=!1})),this.editor.on(Q.cbw.ON_BLUR,(function(){t.onBlur=!0}))},t.prototype.detach=function(){this.editor.removeListener(Q.kgn.PAGE_TOUCH_EVENT,this),this.editor.removeListener(Q.cbw.ON_BLUR,this)},t.prototype.onTouchStart=function(t,e){var r=this;if(!this.intercept(t)){this.editor.fire(new c.nn2(t.nativeEvent,c.Nli.NONE,e)),this.touchStartTime=Date.now();var n=t.changedTouches[0];this.touchStartPos=[n.clientX,n.clientY],this.touchInterval(this.touchEndTime,this.touchStartTime)&&this.equalPos(this.touchEndPos,this.touchStartPos)&&this.touchAction!==c.Nli.LONG_TOUCH||(this.touchAction=c.Nli.NONE),t.persist(),this.longTouchStartTimeout=setTimeout((function(){r.onLongTouch(t,e)}),this.LONG_TOUCH_TIME)}},t.prototype.onTouchMove=function(t,e){this.intercept(t)||(this.editor.fire(new c.nn2(t.nativeEvent,c.Nli.NONE,e)),t.touches[0].touchType&&"stylus"===t.touches[0].touchType||(this.longTouchStartTimeout&&clearTimeout(this.longTouchStartTimeout),this.touchStartTime=0,this.touchStartPos=[0,0],this.touchEndTime=0,this.touchEndPos=[0,0]))},t.prototype.onTouchEnd=function(t,e){var r,n;if(!this.intercept(t)){this.editor.fire(new c.nn2(t.nativeEvent,c.Nli.NONE,e)),this.touchEndTime=Date.now();var o=t.changedTouches[0];this.touchEndPos=[o.clientX,o.clientY],this.equalPos(this.touchStartPos,this.touchEndPos)?(this.longTouchStartTimeout&&clearTimeout(this.longTouchStartTimeout),this.touchInterval(this.touchStartTime,this.touchEndTime)?this.touchAction===c.Nli.NONE||this.touchAction===c.Nli.LONG_TOUCH?(this.focusingTouch=null!==(n=null===(r=this.editor.surface)||void 0===r?void 0:r.isFocusing())&&void 0!==n&&n,this.onTouch(t,e)):this.touchAction===c.Nli.TOUCH?this.onDoubleTouch(t,e):this.touchAction===c.Nli.DOUBLE_TOUCH&&this.onTripleTouch(t,e):this.onLongTouch(t,e)):this.touchAction=c.Nli.NONE}},t.prototype.diableOnceOnTouchEnterEdit=function(){this.disableTouchEnterEdit=!0},t.prototype.canTouch=function(){var t,e,r,n,o;if(null===window||void 0===window?void 0:window.isPublishedURL)return!0;if(this.editor.isRestrictProtectOn){var i=null===(e=null===(t=this.touchSelector.getSelection())||void 0===t?void 0:t.viewRange)||void 0===e?void 0:e.getGCPRange();if(!i)return!0;if(!this.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(i)){var a=this.editor.state.selection.getSdtSelection(),s=null===(o=null===(n=null===(r=this.editor.service)||void 0===r?void 0:r.getDocument())||void 0===n?void 0:n.getSelection())||void 0===o?void 0:o.getSdtService();return a.isWrappedSdtByRange(i)?null==s||s.setRangeTo(0,0):s.focusRangeToSdtByPosition(i,{focusToDefault:!1}),!1}}return!0},t.prototype.onTouch=function(t,e){var r,n,o,i=this;this.touchAction=c.Nli.TOUCH;var a=!1;if(this.touchSelector.onTouchEvent(t.nativeEvent,e,(function(){var t,e=i.touchSelector.getSelection(),r=null===(t=null==e?void 0:e.viewRange)||void 0===t?void 0:t.getGCPRange();return r&&!i.editor.state.getRestrictEdit().checkPermissionRangeByGcpRange(r)||(i.contextMenuShowTimeout=setTimeout((function(){i.editor.fire(new Q.F78,!1),i.contextMenuShowTimeout=void 0}),200),a=!0),!0})),this.canTouch()&&!a)if(this.editor.fire(new c.nn2(t.nativeEvent,c.Nli.TOUCH,e)),this.isDoubleTouchToEdit&&this.onBlur)this.showEditTips();else if(!this.touchSelector.lastSelectList){var s=this.onBlur,l=this.touchSelector.getSelection(),p=null===(r=null==l?void 0:l.viewRange)||void 0===r?void 0:r.getGCPRange(),u=!!p&&this.editor.service.getPermissionRange().checkPermissionRangeByGcpRange(p);(null==l?void 0:l.viewRange)&&(l.viewRange.equals(this.viewRange)&&u&&(this.contextMenuShowTimeout=setTimeout((function(){s||i.callContextMenu(l.viewRange)}),400)),this.viewRange=l.viewRange),u?(this.disableTouchToEdit&&s||(this.onBlur=!1),this.onBlur||null===(n=this.editor.surface)||void 0===n||n.requestFocus(this.viewRange)):(this.onBlur=!0,null===(o=this.editor.surface)||void 0===o||o.requestBlur())}},t.prototype.onDoubleTouch=function(t,e){var r,n,o;this.contextMenuShowTimeout&&clearTimeout(this.contextMenuShowTimeout),this.editTipsShowTimeout&&clearTimeout(this.editTipsShowTimeout),this.touchAction=c.Nli.DOUBLE_TOUCH;var i=!1;if(this.touchSelector.onTouchEvent(t.nativeEvent,e,(function(){return i=!0,!1})),this.canTouch()){var a=this.touchSelector.getSelection(),s=null===(r=null==a?void 0:a.viewRange)||void 0===r?void 0:r.getGCPRange(),l=!!s&&this.editor.service.getPermissionRange().checkPermissionRangeByGcpRange(s);(null==a?void 0:a.viewRange)&&(this.viewRange=a.viewRange,this.isDoubleTouchToEdit&&this.onBlur&&l?(this.onBlur=!1,u.kQ.tdwReport({opername:"doc_word_editor",module:"double_click",action:"edit"})):!this.isTextArea(a)||i||this.isMobilePagedView()||this.editor.run("selectWord",a.viewRange.start.gcp)),l?(this.disableTouchToEdit||null===(n=this.editor.surface)||void 0===n||n.requestFocus(this.viewRange),this.editor.fire(new c.nn2(t.nativeEvent,c.Nli.DOUBLE_TOUCH,e,null==a?void 0:a.viewRange))):(this.onBlur=!0,null===(o=this.editor.surface)||void 0===o||o.requestBlur())}},t.prototype.isMobilePagedView=function(){return(0,p.isPrintLayout)(this.editor.currentLayoutType)&&!1},t.prototype.onTripleTouch=function(t,e){if(this.touchAction=c.Nli.TRIPLE_TOUCH,this.touchSelector.onTouchEvent(t.nativeEvent,e),this.canTouch()){var r=this.touchSelector.getSelection();(null==r?void 0:r.viewRange)&&(this.isMobilePagedView()||!this.isTextArea(r)&&!this.focusingTouch||(this.viewRange=r.viewRange,this.editor.run("selectParagraph",r.viewRange.start.gcp)))}},t.prototype.onLongTouch=function(t,e){this.canTouch()&&"touchend"===t.type&&(this.touchAction=c.Nli.LONG_TOUCH,this.editor.fire(new c.nn2(t.nativeEvent,c.Nli.LONG_TOUCH,e)))},t.prototype.touchInterval=function(t,e){return e-t<this.LONG_TOUCH_TIME},t.prototype.isTextArea=function(t){return 0!==t.viewRange.start.leafBoxOffset()&&0!==t.viewRange.end.leafBoxOffset()},t.prototype.equalPos=function(t,e){return Math.abs(t[0]-e[0])<20&&Math.abs(t[1]-e[1])<30},t.prototype.callContextMenu=function(t){this.editor.fire(new Q.Rmi(t))},t.prototype.shouldIgnore=function(t){return!1},t.prototype.intercept=function(t){var e;t.stopPropagation();var r=!(null===(e=t.changedTouches)||void 0===e?void 0:e.length);if("touchstart"===t.type){if(this.shouldIgnore(t.target)||t.touches.length>1||r)return!0}else if("touchend"===t.type){if(!t.cancelable)return this.longTouchStartTimeout&&clearTimeout(this.longTouchStartTimeout),!0;if(o.wV.isTencentDocsIPadApp()&&t.preventDefault(),r)return!0}return!1},t.prototype.showEditTips=function(){var t=this;this.editTipsShowTimeout=setTimeout((function(){t.editor.fire(new Q._Nr)}),this.LONG_TOUCH_TIME)},t}();!function(t){t.MOVE_TO_PREVIOUS_LINE="上一航",t.MOVE_TO_NEXT_LINE="下一航",t.MOVE_TO_LINE_START="已到此行开头",t.MOVE_TO_LINE_END="已到此行最后",t.MOVE_TO_TABLE_LINE_START="已到此单元格开头",t.MOVE_TO_TABLE_LINE_END="已到此单元格最后",t.PAGE_START="已到本文开头",t.PAGE_END="已到文末",t.SELECTED="选中",t.DELETE="删除",t.PASTE="粘贴",t.CUT="剪切",t.COPY="复制",t.TABLE="表格",t.TABLE_UP_CELL="上一单元格",t.TABLE_DOWN_CELL="下一单元格",t.TABLE_LEFT_CELL="左一单元格",t.TABLE_RIGHT_CELL="右一单元格",t.TABLE_ENTER="进入表格",t.TABLE_LEAVE="离开表格",t.TABLE_FIRST="第一单元格",t.TABLE_CELL="单元格",t.PARA_BREAK="换行符",t.INTRODUCTION="欢迎使用腾讯文档",t.INTRODUCTION_WEWORK="欢迎使用企业微信文档"}(Ci||(Ci={})),function(t){t.TITLE="标题",t.SUBTITLE="副标题",t.HEADING1="标题1",t.HEADING2="标题2",t.HEADING3="标题3",t.HEADING4="标题4",t.HEADING5="标题5",t.NORMAL=""}(bi||(bi={})),function(t){t.CIRCLE="项目符号",t.HOLLOWCIRCLE="空心项目符号",t.SQUARE="正方形项目符号",t.DIAMOND="方块项目符号",t.STAR="四角星项目符号",t.HOOK="对勾项目符号",t.ARROW="箭头项目符号"}(Ri||(Ri={})),function(t){t.TableEndBreakSpan="TableEndBreakSpan",t.TableStartBreakSpan="TableStartBreakSpan",t.TableCellBreakSpan="TableCellBreakSpan",t.TableCellStartSpan="TableCellStartSpan",t.TableRowBreakSpan="TableRowBreakSpan",t.TableRowStartSpan="TableRowStartSpan",t.ParaBreakSpan="换行符",t.DrawingAnchor="绘图",t.DefaultPluginProperty="插件",t.EmbedCommentProperty="评论",t.CodeblockProperty="代码块",t.TextSpan="文字",t.LaTeX="LaTex公式",t.Sign="电子签名",t.ImageProperty="图片",t.SplitlineProperty="分割线",t.FieldBegin="域开始",t.FieldSeparate="域分割",t.FieldEnd="域结束",t.DocLink="腾讯文档链接",t.NormalLink="普通链接",t.Calendar="日历",t.File="文件",t.Audio="音频",t.Video="视频",t.Location="地图位置",t.AddonIframe="第三方内容",t.Attachment="文档附件",t.AddonLink="第三方插件链接"}(_i||(_i={})),function(t){t.Introduction="introduction",t.Selected="selected",t.SlightMove="slightMove",t.Line="line",t.Insert="insert",t.Delete="delete",t.Modify="modify",t.None="none",t.Error="error"}(wi||(wi={})),function(t){t.LEFT="arrowLeft",t.UP="arrowUp",t.RIGHT="arrowRight",t.DOWN="arrowDown"}(xi||(xi={})),function(t){t.ON_COPY="on_copy",t.ON_CUT="on_cut",t.ON_PASTE="on_paste"}(Ii||(Ii={})),function(t){t.Default="normalLink",t.File="file",t.Audio="audio",t.Video="video",t.Location="location",t.Calendar="calendar",t.Database="database",t.AddonIframe="addonIframe",t.TDSheetIFrame="tdSheetIframe",t.Attachment="attachment",t.NormalLink="normalLink",t.DocLink="docLink",t.AddonLink="addonLink",t.AddonHina="addonHina"}(Di||(Di={}));var zi,Ki=new Map([[Di.File,_i.File],[Di.Audio,_i.Audio],[Di.Video,_i.Video],[Di.Location,_i.Location],[Di.Calendar,_i.Calendar],[Di.AddonIframe,_i.AddonIframe],[Di.Attachment,_i.Attachment],[Di.NormalLink,_i.NormalLink],[Di.DocLink,_i.DocLink],[Di.AddonLink,_i.AddonLink]]);function ji(t){var e=p.FieldCodeManager.getInstance(),r=p.FieldUtil.decodeFieldCode(t);if(!r)return"";var n=e.getFieldProcessorByFieldCodeInfo(r);return n?n.getFieldLayoutText(r,{}):""}!function(t){t.BACKSPACE="backspace",t.DELETE="delete",t.TAB="tab",t.ENTER="enter",t.ARROW_LEFT="moveLeft",t.ARROW_UP="moveUp",t.ARROW_RIGHT="moveRight",t.ARROW_DOWN="moveDown",t.MOVE_TO_WORD_LEFT="moveToWordLeft",t.MOVE_TO_WORD_RIGHT="moveToWordRight",t.MOVE_TO_LINE_START="moveToLineStart",t.MOVE_TO_LINE_END="moveToLineEnd",t.MOVE_TO_STORY_START="moveToStoryStart",t.MOVE_TO_STORY_END="moveToStoryEnd",t.SELECT_WORD="selectWord",t.SELECT_PARA="selectParagraph",t.SELECT_ALL="selectAll"}(zi||(zi={}));var Yi,qi,Qi,Xi=[Di.File,Di.Audio,Di.Video,Di.Location,Di.AddonIframe,Di.TDSheetIFrame,Di.Attachment];function Ji(t){return Xi.includes(t)}function Zi(t){var e=t.content;switch(t.propertyType){case p.PlaceholderChar.FieldBegin:return{fieldCharSpan:1,content:e};case p.PlaceholderChar.FieldSeparate:return{fieldCharSpan:2,content:e};case p.PlaceholderChar.FieldEnd:return{fieldCharSpan:0,content:e}}return function(t){var e,r=t.fieldCharSpan,n=t.content,o=function(t,e){var r;return!!(null===(r=t.service.getDocument().getRange(e,e).getDecodedFieldInfo(e))||void 0===r?void 0:r.isAutoUpdate)}(t.editor,t.gcp),i=t.state.getTextStream().readText(t.gcp,t.len),a=p.FieldUtil.decodeFieldCode(t.propertyType),s=(null===(e=null==a?void 0:a.switches)||void 0===e?void 0:e[p.FieldCommonSwitchesName.subtype])||"",l=s&&Ki.get(s)||"";return 1===r?o?{fieldCharSpan:r,content:"".concat(n).concat(ji(i))}:{fieldCharSpan:r,content:"".concat(n).concat(l),isReadFieldResult:!(s&&Ji(s))}:2===r&&!o&&t.isReadFieldResult?{fieldCharSpan:r,content:"".concat(n).concat(i)}:{fieldCharSpan:r,content:n}}(t)}var $i=((Yi={})[p.BulletTextMapSymbol.get(p.BulletText.Arrow)||""]=Ri.ARROW,Yi[p.BulletTextMapSymbol.get(p.BulletText.Circle)||""]=Ri.CIRCLE,Yi[p.BulletTextMapSymbol.get(p.BulletText.HollowCircle)||""]=Ri.HOLLOWCIRCLE,Yi[p.BulletTextMapSymbol.get(p.BulletText.Square)||""]=Ri.SQUARE,Yi[p.BulletTextMapSymbol.get(p.BulletText.Diamond)||""]=Ri.DIAMOND,Yi[p.BulletTextMapSymbol.get(p.BulletText.Star)||""]=Ri.STAR,Yi[p.BulletTextMapSymbol.get(p.BulletText.Hook)||""]=Ri.HOOK,Yi),ta=((qi={}).Title=bi.TITLE,qi.Subtitle=bi.SUBTITLE,qi["heading 1"]=bi.HEADING1,qi["heading 2"]=bi.HEADING2,qi["heading 3"]=bi.HEADING3,qi["heading 4"]=bi.HEADING4,qi["heading 5"]=bi.HEADING5,qi.normal=bi.NORMAL,qi),ea=((Qi={})[p.PlaceholderChar.FieldBegin]={data:_i.FieldBegin},Qi[p.PlaceholderChar.FieldSeparate]={data:_i.FieldSeparate},Qi[p.PlaceholderChar.FieldEnd]={data:_i.FieldEnd},Qi[p.PlaceholderChar.DrawingAnchor]={data:_i.DrawingAnchor,action:function(t){var e=p.PropertyUtil.findPlaceholderCharProperty(t.state.getDataStream(),t.gcpBegin);return e instanceof p.PropertyFactory.getPropertyClass(p.PropertyType.DrawingProperty)?t.editor.service.getDocument().collectOutlineFromDrawingType(e).replace(/\[|]/g,""):_i.DrawingAnchor}},Qi[p.PlaceholderChar.ParagraphReturn]={data:_i.ParaBreakSpan,action:function(t){if(t.editor.service.getSelection().isInTable())return"";var e=_i.ParaBreakSpan;if(1===t.gcpLength)switch(t.direction){case xi.LEFT:case xi.UP:return Ci.MOVE_TO_PREVIOUS_LINE;case xi.RIGHT:case xi.DOWN:return Ci.MOVE_TO_NEXT_LINE}return e}},Qi[p.PlaceholderChar.CommentReference]={data:_i.EmbedCommentProperty},Qi[p.PlaceholderChar.TableCellBreak]={data:_i.TableCellBreakSpan,action:function(t){if(1===t.len)switch(t.direction){case xi.LEFT:return Ci.TABLE_LEFT_CELL;case xi.RIGHT:return Ci.TABLE_RIGHT_CELL;case xi.UP:return Ci.MOVE_TO_PREVIOUS_LINE;case xi.DOWN:return Ci.MOVE_TO_NEXT_LINE}return""}},Qi),ra=function(){function t(){this.accessibilityMap=new Map,this.accessibilityTitleStyleMap=new Map,this.accessibilityBulletListMap=new Map,this.clear(),this.initMap()}return t.prototype.clear=function(){this.accessibilityMap.clear(),this.accessibilityBulletListMap.clear(),this.accessibilityTitleStyleMap.clear()},t.prototype.initMap=function(){var t=this;Object.keys(ea).forEach((function(e){t.accessibilityMap.set(e,ea[e])})),Object.keys(ta).forEach((function(e){t.accessibilityTitleStyleMap.set(e,ta[e])})),Object.keys($i).forEach((function(e){t.accessibilityBulletListMap.set(e,$i[e])}))},t}(),na=function(){function t(t){this.isReadParaBreakSpan=!0,this.fieldCharSpan=0,this.isReadFieldResult=!0,this.isIntable=!1,this.isTableStart=!1,this.resetInformation="",this.contentProps=t,this.contentMap=new ra}return t.prototype.reset=function(){this.isTableStart=!1,this.resetInformation="",this.isReadParaBreakSpan=!0,this.fieldCharSpan=0,this.isReadFieldResult=!0},t.prototype.isParagraphBreak=function(t){return t===p.PlaceholderChar.ParagraphBreak||t===p.PlaceholderChar.ParagraphReturn},t.prototype.handleSpanContent=function(t){var e=t.gcpBegin,r=t.len,n=t.begin,o=t.end,i=t.text,a=t.gcpRange,s=t.direction,l={isNext:!0,readContent:""},p=Math.max(e,n),c=Math.min(e+r,o);if(p>=c&&(!i||this.contentMap.accessibilityMap.has(i)))return l.isNext=!1,l;var u=c-p,g=this.contentMap.accessibilityMap.get(i);if(void 0===g)return l.readContent+=i,l;if(!this.isReadParaBreakSpan&&a.len>1&&this.isParagraphBreak(i))return l.readContent="",l;if(g.action){var h={gcpBegin:p,len:u,state:this.contentProps.state,gcpLength:a.len,editor:this.contentProps.context,direction:s};l.readContent+=g.action(h)}else l.readContent+=g.data;return l},t.prototype.handleTable=function(){var t=this.contentProps.context.service.getSelection().isInTable();return t!==this.isIntable?(this.isIntable=t,t?Ci.TABLE_ENTER:Ci.TABLE_LEAVE):""},t.prototype.handleDifferentSpansReading=function(t,e,r){var n=t.getRange(!0),o=t.getContentRange(),a=o.gcpBegin,s=o.len,l=this.contentProps.state.getTextStream().readText(n.begin(),n.len),c="".concat(e).concat(this.handleTable());if(l===p.PlaceholderChar.TableStart&&(this.isTableStart=!0,this.resetInformation=c),l===p.PlaceholderChar.FieldBegin||0!==this.fieldCharSpan){var u=Zi({gcp:n.begin(),len:n.len,content:c,propertyType:l,fieldCharSpan:this.fieldCharSpan,editor:this.contentProps.context,state:this.contentProps.state,isReadFieldResult:this.isReadFieldResult}),g=u.fieldCharSpan,h=u.content,d=u.isReadFieldResult;return this.fieldCharSpan=g,this.isReadFieldResult=null!=d?d:this.isReadFieldResult,h}var y=(0,i.__assign)((0,i.__assign)({},r),{text:l,gcpBegin:a,len:s,property:l}),f=this.handleSpanContent(y);if(!f.isNext)return null;var v="".concat(c).concat(f.readContent);return l===p.PlaceholderChar.TableEnd&&this.isTableStart&&(this.isTableStart=!1,v="".concat(this.resetInformation).concat(Ci.TABLE)),v},t.prototype.getParaExtraContent=function(t){var e=this.contentProps.context.service.getSelection().getParaRange(t);if(!e)return{paraExtraContent:""};var r=e.gcpBegin,n=r+e.len,o="";return t===r&&(o="".concat(this.getTitle(r,n)).concat(this.getListReadContent(r,n))),{paraExtraContent:o,endGCP:n}},t.prototype.rangeContent=function(t){var e=t.begin,r=t.end,n=t.direction,o=t.isSelected,i={readContent:"",isRead:!0},a=e;do{var s=this.getParaExtraContent(a),l=s.paraExtraContent,c=s.endGCP,u=void 0===c?0:c;if(u<=0)return i;i.readContent+=l;var g=new p.GCPRange(a,Math.min(u,r)-a),h=this.contentProps.state.dataEngine.getDataStream().getTextStream().createRunIterator(g);do{var d={gcpRange:g,direction:n,end:r,begin:e,isSelected:o},y=this.handleDifferentSpansReading(h,i.readContent,d);if(null===y)break;if(i.readContent=y,i.readContent.length>=1500)break}while(h.next());a=u}while(a<r);return this.reset(),i},t.prototype.getCurrentLineBox=function(t){if(t instanceof Q.SE$){for(var e=t.leafBox.parentBox;e&&!(0,c.o70)(e);)e=e.parentBox;if((0,c.o70)(e))return e}return null},t.prototype.getGcp=function(t){return(0,c.Oij)(t)||(0,c.NFz)(t)||(0,c.tqe)(t)||(0,c.tJJ)(t)?t.getRange():null},t.prototype.getListReadContent=function(t,e){var r=this.contentProps.context.service.getDocument().getListInfoFromGcpRange(new p.GCPRange(t,e-t));if(!r)return"";if(r.isBullet)return this.contentMap.accessibilityBulletListMap.get(r.actualText)||"";if(r.isNumbered)return r.actualText;if(r.isTask)switch(r.taskPr.taskState){case p.STTaskState.done:return"已办";case p.STTaskState.todo:return"待办"}return""},t.prototype.getTitle=function(t,e){var r=this.contentProps.context.service.getDocument().getRange(t,e).getParagraphFormat().getAttributes(),n=r.pStyle.val,o=r.pBdr.bottom.val!==p.STBorder.PBDEFAULT?_i.SplitlineProperty:"",i=this.contentProps.state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(n),a=i&&p.StyleSheetManager.getStyleShowName(i)||"";return"".concat(a="正文"===a?"":a).concat(o)},t.prototype.lineRangeContent=function(t,e){var r,n,o=this.getCurrentLineBox(t);if(!o||!o.lastChild||!o.firstChild)return null;var i=null===(r=this.getGcp(o.firstChild))||void 0===r?void 0:r.begin(),a=null===(n=this.getGcp(o.lastChild))||void 0===n?void 0:n.end();if(void 0===i||void 0===a)return null;var s=a-i||o.getRange().len;return this.isReadParaBreakSpan=!1,{content:this.rangeContent({begin:i,end:i+s,direction:e}),gcpRange:[i,s]}},t}(),oa=function(){function t(t){this.currentCursorPosition=-1,this.lineStart=-1,this.operationMap=new Map,this.previousCursor=-1,this.managerProps=t,this.data=this.onNone(),this.content=new na(t),this.initMap()}return Object.defineProperty(t.prototype,"accessibilityData",{get:function(){return this.data},enumerable:!1,configurable:!0}),t.prototype.resetAccessibilityData=function(){this.data=this.onNone()},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedArea},enumerable:!1,configurable:!0}),t.prototype.resetSelected=function(){this.isSelectedArea=!1},t.getInstance=function(e){return t.instance||(t.instance=new t(e)),t.instance},t.destroy=function(){t.instance&&(t.instance=null)},t.prototype.operationSort=function(t,e){e&&(this.currentCursorPosition=e.start+e.len),this.data=this.operationMap.has(t)?this.operationMap.get(t)(e):this.onError(),this.isTable=this.isTableNow()},t.prototype.initMap=function(){var t,e=this,r=((t={})[wi.Insert]=function(t){return e.onInsert(t)},t[wi.Delete]=function(t){return e.onDelete(t)},t[wi.Modify]=function(t){return e.onModify(t)},t[wi.Selected]=function(t){return e.onSelected(t)},t[wi.SlightMove]=function(t){return e.onSlightMove(t)},t[wi.Line]=function(t){return e.onLine(t)},t[wi.Introduction]=function(t){return e.onIntroduction(t)},t[wi.None]=function(){return e.onNone()},t[wi.Error]=function(){return e.onError()},t);Object.keys(r).forEach((function(t){e.operationMap.set(t,r[t])}))},t.prototype.onIntroduction=function(t){var e=(null==t?void 0:t.operationContent)||Ci.INTRODUCTION,r=this.content.rangeContent({begin:(null==t?void 0:t.start)||0,end:((null==t?void 0:t.start)||0)+((null==t?void 0:t.len)||1)-1});return r.isRead&&(e+=r.readContent),{stamp:c.bKi.INTRODUCTION,readContent:e}},t.prototype.onSelected=function(t){if(!t)return this.onError();var e=t.start,r=t.len,n=t.operationContent,o=void 0===n?"":n;this.isSelectedArea=!0,this.currentCursorPosition=e+r;var i=this.content.rangeContent({begin:e,end:this.currentCursorPosition,isSelected:this.isSelectedArea}),a=i.isRead,s=i.readContent;return a?(this.selectedData=s,{stamp:c.bKi.SELECTED,gcpRange:[e,r],readContent:Ci.SELECTED+this.selectedData+o}):this.onNone()},t.prototype.onSlightMove=function(t){if(this.data={stamp:c.bKi.SLIGHT_MOVE},null==t?void 0:t.operationContent)return this.data.readContent=t.operationContent,this.data;if(!t)return this.data;var e=t.start,r=t.len,n=e+r,o=this.previousCursor>e?xi.LEFT:xi.RIGHT,i=this.content.rangeContent({begin:e,end:n,direction:o}),a=i.isRead,s=i.readContent;return a?{stamp:c.bKi.SLIGHT_MOVE,gcpRange:[e,r],readContent:s}:this.onNone()},t.prototype.onLine=function(t){var e;if(this.data={stamp:c.bKi.LINE},!t)return this.data;var r=t.start,n=t.len,o=new p.GCPRange(r,n),a=null===(e=this.managerProps.context.getViewRangeFromGcpRange(o))||void 0===e?void 0:e.start;if(!a)return this.onError();var s=this.previousCursor>r?xi.UP:xi.DOWN,l=this.content.lineRangeContent(a,s);if(!l)return this.onError();var u=l.content,g=l.gcpRange,h=(0,i.__read)(g,1)[0],d=this.pageEdge(h,this.lineStart);if(d)return{stamp:c.bKi.LINE,readContent:d};var y=u.readContent;if(!u.isRead)return this.onNone();var f=this.isTableNow();return f?(this.isTable||(y=Ci.TABLE_ENTER+y),this.isTable=!0):f||(this.isTable&&(y=Ci.TABLE_LEAVE+y),this.isTable=!1),{stamp:c.bKi.LINE,gcpRange:g,readContent:y}},t.prototype.onInsert=function(t){return t?{stamp:c.bKi.INSERT,gcpRange:[t.start,t.len],readContent:t.operationContent}:this.onError()},t.prototype.onDelete=function(t){var e={stamp:c.bKi.DELETE};if(!t)return e;var r=t.start,n=t.len;if(t.operationContent)return{stamp:c.bKi.DELETE,gcpRange:[r,n],readContent:t.operationContent};var o=this.selectedData;if(!this.isSelectedArea){var i=this.content.rangeContent({begin:r,end:r+n}),a=i.isRead,s=i.readContent;if(!a)return this.onNone();o=s}return{stamp:c.bKi.DELETE,gcpRange:[r,n],readContent:o}},t.prototype.onModify=function(t){return this.data={stamp:c.bKi.MODIFY},t?{stamp:c.bKi.MODIFY,gcpRange:[t.start,t.len],readContent:t.operationContent}:this.data},t.prototype.onError=function(){return{stamp:c.bKi.ERROR}},t.prototype.onNone=function(){return{stamp:c.bKi.NONE}},t.prototype.isTableNow=function(){return!1},t.prototype.pageEdge=function(t,e){if(t===e)return 0===t?Ci.PAGE_START:this.managerProps.context.service.getSelection().nextTextBreak(this.currentCursorPosition)===e?Ci.PAGE_END:void 0},t}(),ia=function(t){var e,r=oa.getInstance(t.operationProps);return(e={})[zi.ARROW_UP]=function(t,e){t&&t instanceof Ct.zq&&r.operationSort(wi.Line),e()},e[zi.ARROW_DOWN]=function(t,e){t&&t instanceof Ct.zq&&r.operationSort(wi.Line),e()},e[zi.ARROW_LEFT]=function(t,e){t&&t instanceof Ct.zq&&r.operationSort(wi.SlightMove),e()},e[zi.ARROW_RIGHT]=function(t,e){t&&t instanceof Ct.zq&&r.operationSort(wi.SlightMove),e()},e[zi.MOVE_TO_LINE_START]=function(t,e){if(t&&t instanceof Ct.zq){var n={start:0,len:0,operationContent:Ci.MOVE_TO_LINE_START};r.operationSort(wi.SlightMove,n)}e()},e[zi.MOVE_TO_LINE_END]=function(t,e){if(t&&t instanceof Ct.zq){var n={start:0,len:0,operationContent:Ci.MOVE_TO_LINE_END};r.operationSort(wi.SlightMove,n)}e()},e[zi.MOVE_TO_WORD_LEFT]=function(t,e){t&&t instanceof Ct.zq&&r.operationSort(wi.SlightMove),e()},e[zi.MOVE_TO_WORD_RIGHT]=function(t,e){t&&t instanceof Ct.zq&&r.operationSort(wi.SlightMove),e()},e[zi.MOVE_TO_STORY_START]=function(t,e){if(t&&t instanceof Ct.zq){var n={start:0,len:0,operationContent:Ci.PAGE_START};r.operationSort(wi.SlightMove,n)}e()},e[zi.MOVE_TO_STORY_END]=function(t,e){if(t&&t instanceof Ct.zq){var n={start:0,len:0,operationContent:Ci.PAGE_END};r.operationSort(wi.SlightMove,n)}e()},e[zi.SELECT_ALL]=function(t,e){if(t&&t instanceof Ct.zq&&t.service.getSelection().isInTable()){var n={start:0,len:-1,operationContent:Ci.TABLE};r.operationSort(wi.Selected,n)}e()},e},aa=function(t){var e,r=oa.getInstance(t.operationProps);return(e={})[zi.BACKSPACE]=function(e,n){if(e&&e instanceof Ct.zq&&e.isEditable()){var o=t.operationProps.state.selection.gcpRange,i=o.gcpBegin,a={start:i,len:o.len};if(!r.isSelected){var s=e.service.getSelection().prevTextBreak(i);a={start:s,len:i-s}}r.operationSort(wi.Delete,a)}n()},e[zi.DELETE]=function(e,n){if(e&&e instanceof Ct.zq&&e.isEditable()){var o=t.operationProps.state.selection.gcpRange,i=o.gcpBegin,a={start:i,len:o.len};r.isSelected||(a={start:i,len:e.service.getSelection().nextTextBreak(i)-i}),r.operationSort(wi.Delete,a)}n()},e[zi.ENTER]=function(e,n){if(e&&e instanceof Ct.zq&&e.isEditable()&&!e.isCompositing()&&r.isSelected){var o=t.operationProps.state.selection.gcpRange,i={start:o.gcpBegin,len:o.len};r.operationSort(wi.Delete,i)}n()},e},sa={stamp:c.bKi.ERROR},la=function(){function t(t){this.isChangeContent=!1,this.manager=null,this.currentCursorPosition=-1,this.operationProps=t,this.switchContent={start:0,len:0,operationContent:Ci.INTRODUCTION},this.operationProps.context.isLayoutFinished?this.handleRenderFinish():this.operationProps.context.once(Q.kgn.RENDER_FINISH,this.handleRenderFinish.bind(this)),this.operationProps.context.on(c.HnA.A11ySwitch,this.handleAccessibilitySwitch.bind(this))}return t.prototype.handleRenderFinish=function(){this.isRanderFinish=!0,this.initOperation()},t.prototype.handleAccessibilitySwitch=function(t){var e=t.accessibilityData,r=e.isSupported,n=e.content;if(this.isSupportedAccessibility=r,this.switchContent={start:0,len:0,operationContent:n},this.isSupportedAccessibility){var o=this.operationProps.context.service.getSelection().getParaRangeFromSelection(!0),i=o.gcpBegin,a=o.len;this.switchContent.len=a,this.switchContent.start=i,this.initOperation()}else this.destory()},t.prototype.initOperation=function(){this.isRanderFinish&&this.isSupportedAccessibility&&(this.manager=oa.getInstance(this.operationProps),this.operationProps.context.registerPlugin(ia(this)),this.operationProps.context.registerPlugin(aa(this)),this.operationProps.context.on(Q.kgn.CARET_CHANGE,this.onSelectionChanged,this),this.operationProps.context.on(h.at.ModelChange,this.onModelChange,this),this.operationProps.context.on(Ii.ON_COPY,this.onCopy,this),this.operationProps.context.on(Ii.ON_PASTE,this.onPaste,this),this.operationProps.context.on(Ii.ON_CUT,this.onCut,this),this.introduction(this.switchContent))},t.prototype.destory=function(){this.isRanderFinish&&!this.isSupportedAccessibility&&(this.introduction(this.switchContent),this.operationProps.context.removeListener(Ii.ON_COPY,this.onCopy),this.operationProps.context.removeListener(Ii.ON_PASTE,this.onPaste),this.operationProps.context.removeListener(Ii.ON_CUT,this.onCut),this.operationProps.context.removeListener(Q.kgn.CARET_CHANGE,this.onSelectionChanged),this.operationProps.context.removeListener(h.at.ModelChange,this.onModelChange),this.operationProps.context.unRegisterPlugin(ia(this)),this.operationProps.context.unRegisterPlugin(aa(this)),oa.destroy(),this.manager=null)},t.prototype.introduction=function(t){var e,r;null===(e=this.manager)||void 0===e||e.operationSort(wi.Introduction,t),this.accessibilityContentChange(null===(r=this.manager)||void 0===r?void 0:r.accessibilityData)},t.prototype.accessibilityContentChange=function(t){var e;void 0===t&&(t=sa),this.operationProps.context.fire(new c.ksp(t)),null===(e=this.manager)||void 0===e||e.resetAccessibilityData()},t.prototype.resetModelChangeData=function(){this.isCoordinator=!1,this.isComposition=!1,this.isChangeContent=!1},t.prototype.handleCursorMove=function(t){var e,r,n={type:wi.Error};if(!(null===(e=this.manager)||void 0===e?void 0:e.accessibilityData))return n;var o=this.manager.accessibilityData.stamp;if(o===c.bKi.LINE)n={type:wi.Line,parameters:{start:t,len:0}};else if(o===c.bKi.SLIGHT_MOVE){var i=this.manager.previousCursor-t;n={type:wi.SlightMove,parameters:{start:i<0?this.manager.previousCursor:t,len:Math.abs(i)}},(null===(r=this.manager)||void 0===r?void 0:r.isSelected)&&(n.parameters={start:this.manager.previousCursor<t?t-1:t,len:1})}return n},t.prototype.isDataChange=function(t,e){return t===e&&this.isChangeContent||this.isComposition||this.isCoordinator},t.prototype.onSelectionChanged=function(t){var e,r=t.viewRange,n=r.start,i=r.end;this.currentCursorPosition=i.gcp;var a=wi.None,s=void 0;if(this.manager)if(this.isDataChange(n.gcp,this.manager.previousCursor))this.resetModelChangeData();else{if(null===(e=this.manager.accessibilityData)||void 0===e?void 0:e.readContent)return oa.getInstance(this.operationProps).previousCursor=this.currentCursorPosition,void this.accessibilityContentChange(this.manager.accessibilityData);if(n.gcp!==i.gcp)a=wi.Selected,s={start:n.gcp,len:this.currentCursorPosition-n.gcp};else{var l=this.handleCursorMove(n.gcp);a=l.type,s=l.parameters,this.manager.resetSelected()}this.manager.operationSort(a,s);var p=this.manager.accessibilityData;oa.getInstance(this.operationProps).previousCursor=this.currentCursorPosition,p&&this.accessibilityContentChange(p)}else o.Yd.error("【无障碍异常】光标移动错误")},t.prototype.onModelChange=function(t){if(this.resetModelChangeData(),this.manager)if(this.manager.resetSelected(),this.operationProps.context.isCompositing())this.isComposition=!0;else{var e=t.fromServer,r=t.changeData;if(e){this.isCoordinator=!0;var n=this.operationProps.state.selection.gcpRange;oa.getInstance(this.operationProps).previousCursor=n.gcpBegin+n.len}else{var i=r.dirtyRangeMap.get("BB08J2");if(i){var a=i.first,s=a.gcpBegin,l=a.len;this.isChangeContent=!0,oa.getInstance(this.operationProps).previousCursor=s+l;var p=this.manager.accessibilityData;p&&this.accessibilityContentChange(p)}}}else o.Yd.error("【无障碍异常】数据处理错误")},t.prototype.onPaste=function(t){var e,r,n=this.operationProps.state.selection.gcpRange,o={start:n.gcpBegin,len:n.len,operationContent:Ci.PASTE};r=(null===(e=this.manager)||void 0===e?void 0:e.isSelected)?wi.Modify:wi.Insert,this.handleCutCopyPasteEvent(r,o)},t.prototype.onCopy=function(t){var e,r;if((null===(e=this.manager)||void 0===e?void 0:e.isSelected)&&!(null===(r=null==t?void 0:t.pasteData)||void 0===r?void 0:r.isCut)){var n=this.operationProps.state.selection.gcpRange,o={start:n.gcpBegin,len:n.len,operationContent:Ci.COPY};this.handleCutCopyPasteEvent(wi.Selected,o)}},t.prototype.onCut=function(t){var e=this.operationProps.state.selection.gcpRange,r={start:e.gcpBegin,len:e.len,operationContent:Ci.CUT};this.handleCutCopyPasteEvent(wi.Modify,r)},t.prototype.handleCutCopyPasteEvent=function(t,e){var r,n;null===(r=this.manager)||void 0===r||r.operationSort(t,e),this.accessibilityContentChange(null===(n=this.manager)||void 0===n?void 0:n.accessibilityData)},t}(),pa=function(){function t(t){var e=this;this.editor=t,this.onResize=function(){e.editor.fire(new c.TfM)}}return t.prototype.attach=function(){var t;window.addEventListener("resize",this.onResize),null===(t=window.visualViewport)||void 0===t||t.addEventListener("resize",this.onResize)},t.prototype.detach=function(){var t;window.removeEventListener("resize",this.onResize),null===(t=window.visualViewport)||void 0===t||t.removeEventListener("resize",this.onResize)},t}(),ca=function(){function t(t,e,r){this.context=t,this.state=e,this.layoutController=r,this.attached=!1,this.mode=o.wV.isTencentDocsIPadApp()?c.nsy.VIEW:c.nsy.EDIT,this._selectionHandler=new Fi(t,this.state,t.view.renderer.selectionOverlay.currentSelector),this._keymapManager=new ii(t,this.state),this._keyboardManager=new ni(t),this._mouseManager=new Wi(t,e,t.view.renderer.selectionOverlay,this.context.view.renderer.scrollHandler),this._touchManager=new Vi(t,t.view.renderer.selectionOverlay),this.resizeManager=new pa(t),this.initBasicEdit(),this.initAccessibility()}var e,r,n;return Object.defineProperty(t.prototype,"keymapManager",{get:function(){return this._keymapManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectionHandler",{get:function(){return this._selectionHandler},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keyboardManager",{get:function(){return this._keyboardManager},enumerable:!1,configurable:!0}),t.prototype.attach=function(){this.attached?o.Yd.warn("Surface has attached"):(this._mouseManager.attach(),this._touchManager.attach(),this.resizeManager.attach(),this._keymapManager.attach(),this._keyboardManager.attach(),this.attachEditingComponent(),this.attached=!0)},t.prototype.detach=function(){this._mouseManager.detach(),this._touchManager.detach(),this.resizeManager.detach(),this._keymapManager.detach(),this._keyboardManager.detach(),this.detachEditingComponent(),this.attached=!1},t.prototype.setMode=function(t){this.mode=t},t.prototype.getMode=function(){return this.mode},t.prototype.getFocusableDom=function(){return this.context.view.getDom()},t.prototype.isFocusing=function(){return(this.hiddenEditor instanceof Uo||this.hiddenEditor instanceof hi)&&this.hiddenEditor.isFocus},t.prototype.requestFocus=function(t,e){(this.hiddenEditor instanceof Uo||this.hiddenEditor instanceof hi)&&this.hiddenEditor.requestFocus(t,e)},t.prototype.requestBlur=function(){(this.hiddenEditor instanceof Uo||this.hiddenEditor instanceof hi)&&this.hiddenEditor.requestBlur()},t.prototype.isEditable=function(){return!(!this.context.isEditable()||this.getMode()!==c.nsy.EDIT)},t.prototype.diableOnceOnTouchEnterEdit=function(){this._touchManager.diableOnceOnTouchEnterEdit()},t.prototype.getSurfaceDom=function(){return this.context.view.getDom()},t.prototype.initAccessibility=function(){this._accessibility=new la({context:this.context,state:this.state})},t.prototype.initBasicEdit=function(){var t=this;this.context.registerPlugin(Mi),Li.forEach((function(e){t._keymapManager.addKeymap(e)})),this.context.registerPlugin(Ai),Bi.forEach((function(e){t._keymapManager.addKeymap(e)})),this.context.registerPlugin(Oi),ki.forEach((function(e){((o.wV.isIE()||o.wV.isWeWorkMacOrWin())&&e.action!==Ni.a.PASTE&&t.context.isCopyable()||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&t._keymapManager.addKeymap(e)}))},t.prototype.attachEditingComponent=function(){return(0,i.__awaiter)(this,void 0,void 0,(function(){var t,e,r,n,a,s,l=this;return(0,i.__generator)(this,(function(i){return(t=this.context.view.getDom())?(this.context.docEnv.preview||((e=t.querySelector(".hidden-editor"))&&(e.setAttribute("aria-hidden","true"),r=this.context.view.renderer.getViewSelection().gcpRange,n=(0,Q.rhU)(this.layoutController,r,this.context.view.getRenderState()),si().render(Lo().createElement(Lo().Fragment,null,Lo().createElement(Uo,{context:this.context,state:this.state,service:this.context.service,scrollHandler:this.context.view.renderer.scrollHandler,viewRange:n,zoom:function(){return l.context.view.renderer.zoom},ref:function(t){l.hiddenEditor=t}}),Lo().createElement("div",{id:"accessibility-placeholder"})),e)),this.attachIteractiveComponents(),(a=t.querySelector(".hidden-accessibility"))&&si().render(Lo().createElement(pi,{context:this.context}),a),o.wV.isWeWorkMacOrWin()&&(s=t.querySelector(".hidden-selection"))&&si().render(Lo().createElement(li,{context:this.context}),s)),[2]):(o.Yd.error("attachEditingComponent surface null"),[2])}))}))},t.prototype.attachIteractiveComponents=function(){var t=this,e=this.context.view.getDom();if(e){var r=e.querySelector(".caret");r&&si().render(Lo().createElement(Go,{context:this.context,service:this.context.service,zoom:function(){return t.context.view.renderer.zoom}}),r)}},t.prototype.detachEditingComponent=function(){var t=this.context.view.getDom();if(t){var e=t.querySelector(".hidden-editor");e&&e.remove();var r=t.querySelector(".caret");r&&r.remove();var n=t.querySelector(".mobile-caret-drag");n&&n.remove();var i=t.querySelector(".mobile-selection-drag");i&&i.remove();var a=t.querySelector(".hidden-selection");a&&a.remove()}else o.Yd.error("detachEditingComponent surface null")},t.prototype.detachIteractiveComponents=function(){var t=this.context.view.getDom();if(t){var e=t.querySelector(".caret");e&&si().unmountComponentAtNode(e);var r=t.querySelector(".mobile-caret-drag");r&&si().unmountComponentAtNode(r);var n=t.querySelector(".mobile-selection-drag");n&&si().unmountComponentAtNode(n)}},t=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,c.QZC),(0,i.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==Ct.zq&&Ct.zq)?e:Object,"function"==typeof(r=void 0!==l.ZM&&l.ZM)?r:Object,"function"==typeof(n=void 0!==kr.hy&&kr.hy)?n:Object])],t)}(),ua=function(t){var e=t.factory.inject(c.S$X,(0,u.vM)(ca));e&&e.attach()};function ga(t,e){var r=e,n=t.getSelection(),o=n.getTableSelectionArea();if(r||!n.isInCellsOfTable()||!o)return r=null!=r?r:n.gcpRange,r=n.getCompleteParaRangeInSdt(r),void n.delete(r);var i=t.getSelection().getTableSelectionService();return!!i&&!!i.getTableInfo()&&void(o.isWholeTable()?i.removeTable():i.clearContent())}!function(){function t(t,e){this.context=t,this.service=e}var e,r,a;t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.cut=function(t){this.context.isEditable()&&(this.context.isCopyable()?this.copyInterface?(this.copyInterface.copy(t,!0),ga(this.service,t),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_CUT))):o.Yd.warn("clipboard|cut without copyInterface"):o.Yd.info("Document is not copyable"))},(0,i.__decorate)([c.ygL,(0,i.__metadata)("design:type","function"==typeof(a=void 0!==c.ygL&&c.ygL)?a:Object)],t.prototype,"copyInterface",void 0),t=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,c.vHF),(0,i.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==c.Qwc&&c.Qwc)?e:Object,"function"==typeof(r=void 0!==c.vHF&&c.vHF)?r:Object])],t)}();var ha=function(){function t(t,e){var r=this;this.attached=!1,this.onCutByEvent=function(t){var e;r.context.isEditable()&&(r.context.isCopyable()?(null===(e=r.context.surface)||void 0===e?void 0:e.isFocusing())&&r.checkPermissionRange()&&(r.copyInterface&&r.copyInterface.onCopyByEvent(t,!0),ga(r.service),r.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_CUT))):o.Yd.info("Document is not copyable"))},this.context=t,this.service=e}var e,r,a;return t.prototype.attach=function(){if(this.attached)o.Yd.warn("cut has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("cut",this.onCutByEvent),this.attached=!0):o.Yd.error("CutByWeb attach surfaceDom is null")}},t.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("cut",this.onCutByEvent):o.Yd.error("CutByWeb detach surfaceDom is null"),this.attached=!1},t.prototype.cut=function(t){this.context.isEditable()&&(this.context.isCopyable()?this.copyInterface?(this.copyInterface.copy(t,!0),ga(this.service,t),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_CUT))):o.Yd.warn("clipboard|cut without copyInterface"):o.Yd.info("Document is not copyable"))},t.prototype.checkPermissionRange=function(){var t,e;return!this.context.service.getPermissionRange().checkPermissionRange()||this.context instanceof Ct.zq&&!(null===(e=null===(t=this.context)||void 0===t?void 0:t.state)||void 0===e?void 0:e.getRestrictEdit().checkPermissionRange())?(this.context.fire(new n.BeforeClipboardActionNotification(!1),!1),!1):(this.context.fire(new n.BeforeClipboardActionNotification(!0),!1),!0)},(0,i.__decorate)([c.ygL,(0,i.__metadata)("design:type","function"==typeof(a=void 0!==c.ygL&&c.ygL)?a:Object)],t.prototype,"copyInterface",void 0),t=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,c.vHF),(0,i.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==c.Qwc&&c.Qwc)?e:Object,"function"==typeof(r=void 0!==c.vHF&&c.vHF)?r:Object])],t)}(),da=function(t){var e;e=ha;var r=t.factory.inject(c.AXR,(0,u.vM)(e));r&&r.attach()},ya=r(671462),fa=function(t,e,r){void 0===r&&(r={});for(var n=r.ignoreParser&&r.ignoreParser[c.RzE.MainStory],o=n?"":"<div class='document'>",i="",a="",s=t.getModelBeginChild();s;){var l=e.parse(s,r);o+=l.html,i+=l.plain,a+=l.refText,s=s.getNextSibling(!0)}return{html:o=n?o:"".concat(o,"</div>"),plain:i,refText:a}},va=function(){function t(){this.map=new Map}return t.prototype.addParser=function(t,e){this.map.set(t,e)},t.prototype.getParser=function(t){return this.map.get(t)},t.prototype.parse=function(t,e){var r=this.getParser(t.uniqueTypeId);return r?r(t,e):(0,c.xFo)()},t.prototype.getModelParser=function(){var t=this;return function(e,r){return t.parse(e,r)}},t}();function ma(t){var e,r,n,o=t.getProperty();return t instanceof ya.CK&&o instanceof p.ListInfo&&(r=(e=t).getGCPRange(),1===(n=e.getLimitRanges()).length&&r.gcpBegin===n[0].gcpBegin&&r.len===n[0].len)}function Pa(t,e){if(!ma(t))return{extraHtml:"",extraPlain:""};var r=function(t){var e=t.getProperty(),r=e.isTask?p.BulletText.Square:p.BulletTextMapSymbol.get(e.lvlText);return e.isBullet||e.isTask?'<span style="font-family:Wingdings;\n                        mso-fareast-font-family:Wingdings;\n                        mso-bidi-font-family:Wingdings">\n                <span style="mso-list:Ignore;">'.concat(r,'<span style="font-family: Times New Roman">&nbsp;</span></span></span>'):'<span style="font-family:微软雅黑;\n                    mso-bidi-font-family:\'Times New Roman\';\n                    mso-font-kerning:1.0000pt;">\n            <span style="mso-list:Ignore;">'.concat(e.actualText,"<span>&nbsp;</span></span></span>\n    ")}(t);return{extraHtml:r,extraPlain:t.getProperty().actualText}}function Ta(t){return t>0?-t:Math.abs(t)}var Sa=function(t,e,r,n){var i=t.ind;n&&(i=n.ind);var a=function(t,e,r){var n=0,i=t.hangingChars,a=t.hanging,s=t.firstLineChars,l=t.firstLine;if(i)n=(u=i/p.DefaultsUnit.indentChars)*r,e.push("text-indent:".concat(Ta((0,o.ev)(n)),"pt")),e.push("mso-char-indent-count:".concat(Ta(u)));else if(a){var c=(0,o.ev)(a);e.push("text-indent:".concat(Ta(c),"pt")),n=a}if(i||a)return n;if(s){var u=s/p.DefaultsUnit.indentChars;e.push("text-indent:".concat(u,"em"))}else l&&(c=(0,o.ev)(l),e.push("text-indent:".concat(c,"pt")));return n}(i,e,r);!function(t,e,r){var n=t.hanging;t.firstLineChars&&(n=0);var i=t.left-n;if(t.hangingChars&&(i=0),0!==t.leftChars){var a=t.leftChars/p.DefaultsUnit.indentChars+r/p.Defaults.fontSize;e.push("margin-left:".concat(a,"em")),e.push("mso-para-margin-left:".concat(t.leftChars/p.DefaultsUnit.indentChars,"gd"))}else e.push("margin-left:".concat((0,o.ev)(i+r),"pt"));var s=t.right;0!==t.rightChars?(e.push("margin-left:".concat(t.rightChars/p.DefaultsUnit.indentChars,"em")),e.push("mso-para-margin-left:".concat(t.rightChars/p.DefaultsUnit.indentChars,"gd"))):e.push("margin-right:".concat((0,o.ev)(s),"pt"))}(i,e,a)};function Ca(t){return n.ooxmlBorderType2MsoBorderTypeMap[t]||""}function ba(t){return n.htmlBorderTypeMap[t]||""}var Ra,_a=function(t){var e=[],r=[],a=t.getProperty(),s=function(t,e,r){var n=e.getTextStream().createRunIterator(t),o=e.getTextStream().createParagraphIterator(t);n.seek(t.begin()),o.seek(t.begin());var i=n.getProperty()||new(p.PropertyFactory.getPropertyClass(p.PropertyType.RunProperty)),a=o.getProperty()||new(p.PropertyFactory.getPropertyClass(p.PropertyType.ParagraphProperty));return(i=r.getStyleSheetManager().mergeStyleRunPropWithGcp(i,a,t.begin()))?Number(i.sz.val):p.Defaults.fontSize}(t.getGCPRange(),t.dataStream,t.dataManager),l=t.dataManager.getNumberingManager().getListInfoFromGcpRange(t.getGCPRange());return a&&(function(t,e,r){t.jc.val===p.STJcWml.left?(e.push("text-align:left"),r.push("text-align-type-left")):t.jc.val===p.STJcWml.center?(e.push("text-align:center"),r.push("text-align-type-center")):t.jc.val===p.STJcWml.right?(e.push("text-align:right"),r.push("text-align-type-right")):(e.push("text-align:justify"),r.push("text-align-type-justify"),t.jc.val===p.STJcWml.distribute&&(e.push("text-justify:distribute-all-lines"),e.push("text-align-last: justify")))}(a,e,r),function(t,e){if(t.spacing.lineRule===p.STLineSpacingRule.auto){var r=t.spacing.line,n=0===r?1:r/p.DefaultsUnit.autoLineRule;e.push("line-height:".concat(100*n,"%"))}else if(t.spacing.lineRule===p.STLineSpacingRule.exact){var i=(0,o.FJ)(t.spacing.line),a=(0,o.ev)(t.spacing.line);e.push("line-height:".concat(i,"px;line-height:").concat(a,"pt;mso-line-height-rule:exactly"))}else t.spacing.lineRule===p.STLineSpacingRule.atLeast&&(i=(0,o.FJ)(t.spacing.line),a=(0,o.ev)(t.spacing.line),e.push("line-height:".concat(i,"px;mso-line-height-alt:").concat(a,"pt")))}(a,e),function(t,e){if(void 0!==t.spacing.before){var r=(0,o.ev)(t.spacing.before);e.push("margin-top:".concat(r,"pt"))}if(void 0!==t.spacing.after){var n=(0,o.ev)(t.spacing.after);e.push("margin-bottom:".concat(n,"pt"))}}(a,e),Sa(a,e,s,l),function(t,e,r){var o=[],a=[],s=t.pBdr,l=s.top,c=s.bottom,u=s.left,g=s.right;if(l.val!==p.STBorder.PBDEFAULT?(o.push("border-top: ".concat(ba(l.val)," #").concat(l.color," ").concat(l.sz/8,"pt")),o.push("mso-border-top-alt: ".concat(Ca(l.val)," #").concat(l.color," ").concat(l.sz/8,"pt"))):c.val!==p.STBorder.PBDEFAULT?(o.push("border-bottom: ".concat(ba(c.val)," #").concat(c.color," ").concat(c.sz/8,"pt")),o.push("mso-border-bottom-alt: ".concat(Ca(c.val)," #").concat(c.color," ").concat(c.sz/8,"pt"))):u.val!==p.STBorder.PBDEFAULT?(o.push("border-left: ".concat(ba(u.val)," #").concat(u.color," ").concat(u.sz/8,"pt")),o.push("mso-border-left-alt: ".concat(Ca(u.val)," #").concat(u.color," ").concat(u.sz/8,"pt"))):g.val!==p.STBorder.PBDEFAULT&&(o.push("border-right: ".concat(ba(g.val)," #").concat(g.color," ").concat(g.sz/8,"pt")),o.push("mso-border-right-alt: ".concat(Ca(g.val)," #").concat(g.color," ").concat(g.sz/8,"pt"))),c.val!==p.STBorder.PBDEFAULT){var h=n.borerV3V2Map[c.val]||"normal";a.push("horizontal-splitline",h)}e.push.apply(e,(0,i.__spreadArray)([],(0,i.__read)(o),!1)),r.push.apply(r,(0,i.__spreadArray)([],(0,i.__read)(a),!1))}(a,e,r),function(t,e,r){if(ma(t)){var o=t.getProperty(),i=o.listId,a=o.listLevel;e.push("mso-list:".concat((0,n.transformListIdToMsoId)(i)," level").concat(a+1)),r.push("MsoNormal")}}(t,e,r)),{styles:"".concat(e.join(";")),classes:"".concat(r.join(" "))}},wa=function(t,e,r){void 0===r&&(r={});var n=r.ignoreParser&&r.ignoreParser[c.RzE.Paragraph],o=function(t){var e,r='<p class="paragraph">',n="</p>",o=t.getProperty(),i=p.STOutlineLvl.LevelNone;if(o){var a=_a(t);if(r='<p class="paragraph '.concat(a.classes,'" style="').concat(a.styles,'">'),(i=o.outlineLvl.val)<p.STOutlineLvl.LevelNone)if(i>p.STOutlineLvl.Level6)r="<p>",n="</p>";else{var s=o.pStyle.val,l=null===(e=t.dataManager.getStyleSheetManager().getStylePropertyFromId(s))||void 0===e?void 0:e.name.val.toLowerCase(),c="heading".concat(i+=1);r="<h".concat(i,' class="paragraph ').concat(a.classes," tco-title-").concat(l||c,'" style="').concat(a.styles,'">'),n="</h".concat(i,">")}}return{htmlPrefix:r,htmlSuffix:n}}(t),i=n?"":o.htmlPrefix;!function(t){t.copyCssStyleManager.addCssStyle("p.MsoNormal",'\n        mso-style-name: 正文;\n        mso-style-parent: "";\n        margin: 0pt;\n        margin-bottom: .0001pt;\n        mso-pagination: none;\n        text-justify: inter-ideograph;\n        mso-font-kerning: 1.0000pt;\n    '),t.copyCssStyleManager.addCssStyle("p.paragraph","\n        mso-style-noshow: yes;\n        margin-top: 5.0000pt;\n        margin-right: 0.0000pt;\n        margin-bottom: 5.0000pt;\n        margin-left: 0.0000pt;\n        mso-margin-top-alt: auto;\n        mso-margin-bottom-alt: auto;\n        text-align: left;\n        font-family: 等线;\n        mso-bidi-font-family: 'Times New Roman';\n        font-size: 12.0000pt;\n    ")}(e);var a=Pa(t);i+=a.extraHtml;var s="";s+=a.extraPlain;for(var l="",u=t.getModelBeginChild(),g=t.getLimitRange();u;){var h=u.getLimitContent();if("\r"!==h){if(u instanceof ya.Gw)for(var d=u.getModelBeginChild();d;){var y;g.intersect(d.getGCPRange())&&(i+=(y=e.parse(d,r)).html,s+=y.plain,l+=y.refText),d=d.getNextModelSibling()}else i+=(y=e.parse(u,r)).html,s+=y.plain,l+=y.refText;u=u.getNextModelSibling()}else i+='<span lang="EN-US"><o:p></o:p></span>',s+=h,u=u.getNextModelSibling()}return n?i="<br/>"===i?i:"".concat(i,"<br/>"):i+=o.htmlSuffix,{html:i,plain:s,refText:l}},xa=function(t,e,r){var n;void 0===r&&(r={});for(var o=r.ignoreParser&&r.ignoreParser[c.RzE.Section],i=r.isContinuous,a=void 0===i||i,s=o?"":"<div class='section'>",l="",p="",u=t.getModelBeginChild(!0,null===(n=e.getState().selection.tableSelectionArea)||void 0===n?void 0:n.nestingLevel),g=function(){if(a){var t=e.parse(u,r);s+=t.html,l+=t.plain,p+=t.refText}else{var n=u.getGCPRange();u.getLimitRanges().find((function(t){return n.equal(t)}))&&(t=e.parse(u,r),s+=t.html,l+=t.plain,p+=t.refText)}u=u.getNextSibling(!0)};u;)g();return{html:s=o?s:"".concat(s,"</div>"),plain:l,refText:p}},Ia=new RegExp("".concat(p.PlaceholderChar.ParagraphReturn,"|").concat(p.PlaceholderChar.TableStart,"|").concat(p.PlaceholderChar.TableEnd,"|").concat(p.PlaceholderChar.TableCellBreak,"|").concat(p.PlaceholderChar.TableRowBreak,"|").concat(p.PlaceholderChar.SdtStart,"|").concat(p.PlaceholderChar.SdtEnd),"g"),Da=new RegExp("".concat(p.PlaceholderChar.TableStart,"|").concat(p.PlaceholderChar.TableEnd,"|").concat(p.PlaceholderChar.TableCellBreak,"|").concat(p.PlaceholderChar.TableRowBreak,"|").concat(p.PlaceholderChar.SdtStart,"|").concat(p.PlaceholderChar.SdtEnd),"g"),Fa=/[<>'"& ]/g,Ea=((Ra={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"})[String.fromCharCode(32)]="&#32;",Ra[String.fromCharCode(160)]="&#160;",Ra),Ma=function(t,e,r){if(t instanceof ya.Tp||t instanceof ya.VM||t instanceof ya.l$)return{html:"",plain:"",refText:""};var n=t.getLimitContent(),i=t.getProperty(),a="",s="";i&&(a=(a+=Q.vW8.computeTextSpanFullStyles(i).cssText).replace(/"/g,"")),(null==i?void 0:i.fontFamily)?s+="data-font-family='".concat(i.fontFamily,"'"):s+='data-font-family="default"';var l="";if((null==r?void 0:r.link)&&(l+='<a href="'.concat((0,o.r)(r.link),'">')),n.replace(/ /g,""))if("\r"===n)l+='<span lang="EN-US"><o:p></o:p></span>';else{var p=n.replace(Fa,(function(t){return Ea[t]})),c=p?p.replace(Ia,""):p;l+='<span style="'.concat(a,'" ').concat(s,">").concat(c,"</span>")}else l+='<span style="white-space: pre;'.concat(a,'" ').concat(s,">").concat(n,"</span>");return n=n.replace(Da,""),(null==r?void 0:r.link)&&(l+="</a>"),{html:l,plain:n,refText:n}},La=function(){function t(){this.cssStyleMap={}}return t.prototype.addCssStyle=function(t,e){var r=this.cssStyleMap[t];r&&r===e||(this.cssStyleMap[t]=r?r+e:e)},t.prototype.clearCssStyleMap=function(){for(var t in this.cssStyleMap)delete this.cssStyleMap[t]},t.prototype.generateStyleHtml=function(){var t="<style>\x3c!--";for(var e in this.cssStyleMap){var r=this.cssStyleMap[e];t+="".concat(e,"{").concat(r,"}\n            ")}return t+="--\x3e</style>"},t}(),Aa=function(){function t(t,e){this.copyCssStyleManager=new La,this.map=new Map,this.context=t,this.state=e,this.containerMgr=new va,this.initBasicModelParser(),this.addModelParser(c.RzE.LeafContainer,this.containerMgr.getModelParser()),this.addModelParser(c.RzE.Image,this.containerMgr.getModelParser()),this.addModelParser(c.RzE.FieldContainer,this.containerMgr.getModelParser())}return t.prototype.getState=function(){return this.state},t.prototype.initBasicModelParser=function(){this.addModelParser(c.RzE.MainStory,fa),this.addModelParser(c.RzE.Paragraph,wa),this.addModelParser(c.RzE.Section,xa),this.addModelParser(c.RzE.Text,Ma)},t.prototype.addModelParser=function(t,e){this.map.set(t,e)},t.prototype.getModelParser=function(t){return this.map.get(t)},t.prototype.addContainerParser=function(t,e){this.containerMgr.addParser(t,e)},t.prototype.parse=function(t,e){var r=this.getModelParser(t.type);return r?(0,ya.KT)(t.type)&&t.isHidden?(0,c.xFo)():r(t,this,e):(o.Yd.error("cannot find parser for type=".concat(t.type)),(0,c.xFo)())},t.prototype.doCopy=function(t,e){var r,n;n=Array.isArray(t)?t:t?[t]:this.state.selection.gcpRanges;var o,a=this.state.dataEngine,s=this.state.dataEngine.getDataStream().getStoryStream().getStoryInfoFromGcp(n[0].begin(),!0);((null==e?void 0:e.storyType)||(null===(r=null==s?void 0:s.storyProp)||void 0===r?void 0:r.storyType)||p.STStoryType.mainDocument)===p.STStoryType.mainDocument?o=(0,ya.zp)(new ya.fl(a),n):null==(o=(0,ya.ej)(new ya.fl(a),s?[s.contentRange]:[],n))||o.setLimit(n);var l="",u="",g="";if(this.copyCssStyleManager.clearCssStyleMap(),o){var h=this.parse(o,e);return l+=h.html,u+=h.plain,g+=h.refText,{html:l,plain:u.replace(/\r/g,"\n"),refText:g,style:this.copyCssStyleManager.generateStyleHtml()}}return(0,i.__assign)((0,i.__assign)({},(0,c.xFo)()),{style:""})},t}(),Ba=function(){function t(t,e){this.context=t,this.state=e}return t.prototype.doCut=function(t,e){var r=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange()).buildDelta();r.setCommandType(p.Type.DocCut);var n=this.processRange(t||this.state.selection.gcpRange);return this.dataParser(r,n,e)},t.prototype.collectDataForCopyMultiRange=function(t,e,r){var n=this,o=[],a=e.length>0;return e.forEach((function(e){var s,l,p=n.collectDataForCopy(t,e,r),c=p.storyDeltas,u=p.isAllDelRevision;try{for(var g=(0,i.__values)(c),h=g.next();!h.done;h=g.next()){var d=h.value;o.push(d)}}catch(t){s={error:t}}finally{try{h&&!h.done&&(l=g.return)&&l.call(g)}finally{if(s)throw s.error}}a=a&&u})),{storyDeltas:o,isAllDelRevision:a}},t.prototype.collectDataForCopy=function(t,e,r){var n=t.globalOpts.commandType===p.Type.DocCut,o=this.state.dataEngine,a=(0,p.isInMainStory)(o.getDataStream(),e.begin());return h.Me.collectDataForCopy((0,i.__assign)({delta:t,dataEngine:o,range:e,collectStory:!0,collectComment:n,collectSubStoryNoteRef:a},r))},t.prototype.doCopy=function(t,e){var r=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange()).buildDelta();r.setCommandType(p.Type.DocCopy);var n=this.processRange(t||this.state.selection.gcpRange);return this.dataParser(r,n,e)},t.prototype.dataParser=function(t,e,r){var n=this,a=t.globalOpts.commandType===p.Type.DocCut,s=this.state.dataEngine,l=(0,p.isInMainStory)(s.getDataStream(),e.begin()),c=h.Me.collectDataForCopy((0,i.__assign)({delta:t,dataEngine:s,range:e,collectStory:!0,collectComment:a,collectSubStoryNoteRef:l},r||{keepFormatRevision:!0})),u=c.storyDeltas,d=c.isAllDelRevision,y=[];this.state.context.run(g.aU.TRANS_DELTA_TO_OPERATION_DATA,t,y,this.state.dataEngine);var f="",v=this.context.docEnv.uniqueId;v&&(f=v);var m=[];return u.forEach((function(t){var e=[];n.state.context.run(g.aU.TRANS_DELTA_TO_OPERATION_DATA,t.delta,e,n.state.dataEngine),m.push({storyId:t.storyId,storyOps:e,storyType:t.storyType})})),o.Yd.info(p.Type.DocCopy,"copy internal range [".concat(e.begin(),", ").concat(e.end(),"]!"),"isAllDelRevision:",d),{innerDataStr:this.stringifyInnerData(y,m,f,e.begin()),isAllDelRevision:d,gcpRange:e}},t.prototype.stringifyInnerData=function(t,e,r,n){return t.forEach((function(t){t.param=p.TransformUtil.transformNewParamToOld(t.param,t.operationType,t.propertyType)})),e.forEach((function(t){t.storyType="STStoryType_".concat(p.STStoryType[t.storyType]),t.storyOps.forEach((function(t){return t.param=p.TransformUtil.transformNewParamToOld(t.param,t.operationType,t.propertyType)}))})),JSON.stringify({mainStory:t,subStory:e,srcGlobalPadId:r,copyStart:n})},t.prototype.parseCopyData=function(t,e,r){var n=this,o=[];this.state.context.run(g.aU.TRANS_DELTA_TO_OPERATION_DATA,t,o,this.state.dataEngine);var i="",a=this.context.docEnv.uniqueId;a&&(i=a);var s=[];return e.forEach((function(t){var e=[];n.state.context.run(g.aU.TRANS_DELTA_TO_OPERATION_DATA,t.delta,e,n.state.dataEngine),s.push({storyId:t.storyId,storyOps:e,storyType:t.storyType})})),JSON.stringify({mainStory:o,subStory:s,srcGlobalPadId:i,copyStart:null==r?void 0:r.begin()})},t.prototype.processRange=function(t){var e,r,n,o;return t&&t.isValid()&&null!==(o=null===(n=null===(r=null===(e=this.state)||void 0===e?void 0:e.context)||void 0===r?void 0:r.service)||void 0===n?void 0:n.getSelection().getCompleteParaRangeInSdt(t))&&void 0!==o?o:t},t.prototype.doMultiCopy=function(t,e,r){var n=h.C1.createLocalDeltaOption(p.GCPRange.emptyRange()).buildDelta();n.setCommandType(e===c.Y61.Copy?p.Type.DocCopy:p.Type.DocCut);var o=this.collectDataForCopyMultiRange(n,t,r),i=o.storyDeltas,a=o.isAllDelRevision;return{innerDataStr:this.parseCopyData(n,i,t[0]),isAllDelRevision:a}},t}();function Na(t,e){u.kQ.zzsValue(u.GI.COPY_DATA_LENGTH,e),u.kQ.zzsValue(u.GI.COPY_DATA_USE_TIME,(Date.now()-t)/1e3)}var Oa,ka,Ga,Ha=Pt.default,Wa=function(){function t(t,e,r){this.className="",this.state=e,this.context=t,this.customClipboard=r,this.copyParserManager=new Aa(t,e),this.copyInternal=new Ba(t,e)}var e,r,a;return t.prototype.setInnerDataType=function(t){this.dataType=t},t.prototype.getInnerDataType=function(){var t;return null!==(t=this.dataType)&&void 0!==t?t:(0,n.getDataType)()},t.prototype.addCopyModelParser=function(t,e){this.copyParserManager.addModelParser(t,e)},t.prototype.addCopyContainerParser=function(t,e){this.copyParserManager.addContainerParser(t,e)},t.prototype.generateHtml=function(t,e){void 0===e&&(e=!1);var r=t,n=e?this.copyInternal.doCut(r,{keepFormatRevision:!1}):this.copyInternal.doCopy(r,{keepFormatRevision:!1}),i=n.innerDataStr,a=n.isAllDelRevision,s=n.gcpRange;if(r&&(r=null!=s?s:r),this.reportCopyWordCount(r),a)return{html:"",plain:"",innerData:"",htmlWithMeloData:"",isAllDelRevision:a};var l=this.copyParserManager.doCopy(r),p=l.html,c=l.plain,u=l.style,g=this.getHtmlWithMeloData(p,c,u,i);return o.Yd.info("generateHtml length info result.plain: ".concat(c.length,", result.html: ").concat(g.length)),{html:p,plain:c,innerData:i,htmlWithMeloData:g,isAllDelRevision:a}},t.prototype.storeSelectionInnerData=function(t,e,r){void 0===e&&(e=!1);var n=t,i=e?this.copyInternal.doCut(n):this.copyInternal.doCopy(n),a=i.innerDataStr,s=i.isAllDelRevision,l=i.gcpRange;n&&(n=null!=l?l:n);var p=this.copyParserManager.doCopy(n,r),u=p.html,g=p.plain,h=p.style,d=this.getHtmlWithMeloData(u,g,h,a);return this.customClipboard.setSelectionInnerData({html:d,plain:g,innerData:a}),this.customClipboard.setPasteType(e?c.Y61.Cut:c.Y61.Copy),o.Yd.info("storeSelectionInnerData length info result.plain: ".concat(g.length,", result.html: ").concat(d.length)),{html:u,plain:g,innerData:a,htmlWithMeloData:d,isAllDelRevision:s}},t.prototype.getHtmlWithMeloData=function(t,e,r,o){var i=document.createElement("div"),a='\n            <html>\n            <head>\n                <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n                <meta name="ProgId" content="Word.Document" />\n                <meta name="Generator" content="Microsoft Word 14" />\n                <meta name="Originator" content="Microsoft Word 14" />'.concat(r,"</head><body>"),l=document.createElement("div");l.setAttribute("tdoc-data-src",o),l.setAttribute("data-version",n.DATA_VERSION),l.setAttribute(n.INNER_DATA_TYPE,this.getInnerDataType());var p=(e||"").replace(h.Xr,"");return l.setAttribute("data-hash",s().hash(p)),i.appendChild(l),"".concat(a+i.innerHTML+t,"</body></html>")},t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.onCopyByEvent=function(t){},t.prototype.setClipboardData=function(t,e){void 0===e&&(e=!1),this.customClipboard.setData(t.htmlWithMeloData,t.plain,t.innerData),e||this.customClipboard.writeToSysytemClipboard()},t.prototype.fireCopyEvent=function(t){void 0===t&&(t=!1),t||this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_COPY))},t.prototype.copy=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=!1);var n=Date.now(),o=this.generateHtml(t);o.isAllDelRevision?this.showMarkedAsDeletionTips():(Na(n,o.htmlWithMeloData.length),this.setClipboardData(o,r),this.fireCopyEvent(e))},t.prototype.blockGenerateMutiRange2Html=function(t,e,r){var n=this.copyInternal.doMultiCopy(t,e,{keepFormatRevision:r}),o=n.innerDataStr,i=n.isAllDelRevision,a=this.copyParserManager.doCopy(t,{isContinuous:!1}),s=a.html,l=a.plain,p=a.style,c=this.getHtmlWithMeloData(s,l,p,o);return this.customClipboard.setSelectionInnerData({html:c,plain:l,innerData:o}),{html:s,plain:l,innerData:o,htmlWithMeloData:c,isAllDelRevision:i}},t.prototype.mobileBlockMultiCopy=function(t,e){var r=e.clipboardType,n=e.fromScript,o=void 0===n||n,a=e.preventSendEvent,s=void 0!==a&&a,l=e.preventWriteSystem,p=void 0!==l&&l,c=(0,i.__spreadArray)([],(0,i.__read)(t),!1).sort((function(t,e){return t.begin()-e.begin()})),u=this.blockGenerateMutiRange2Html(c,r,o);u.isAllDelRevision?this.showMarkedAsDeletionTips():(this.customClipboard.setPasteType(r),this.setClipboardData(u,p),this.fireCopyEvent(s))},t.prototype.getRefText=function(t){return this.copyParserManager.doCopy(t).refText||""},t.prototype.getCopyContent=function(t){var e=document.createElement("div"),r=document.createElement("meta");r.setAttribute("charset","utf-8"),e.appendChild(r);var o=this.copyInternal.doCopy(t,{keepFormatRevision:!0}).innerDataStr,i=document.createElement("melo-data");i.setAttribute("data-src",o),i.setAttribute("data-version",n.DATA_VERSION),e.appendChild(i);var a=this.copyParserManager.doCopy(t),s=a.html,l=a.plain,p=document.createElement("div");return p.innerHTML=s,e.appendChild(p),{html:e.innerHTML,plain:l}},t.prototype.writeClipboard=function(t){this.writeClipboardContent=t},t.prototype.reportCopyWordCount=function(t){var e=null!=t?t:this.context.service.getDocument().getSelection().getRange().range(),r=this.context.service.getDocument().getTextFromGcpRange(e).length;r>15e3?u.kQ.zzsStatus({attributeId:u.GI.COPY_LENGTH_OVER_15000,status:u.eG.SUCCESS}):r>1e4?u.kQ.zzsStatus({attributeId:u.GI.COPY_LENGTH_OVER_10000,status:u.eG.SUCCESS}):r>5e3?u.kQ.zzsStatus({attributeId:u.GI.COPY_LENGTH_OVER_5000,status:u.eG.SUCCESS}):r>2500?u.kQ.zzsStatus({attributeId:u.GI.COPY_LENGTH_OVER_2500,status:u.eG.SUCCESS}):u.kQ.zzsStatus({attributeId:u.GI.COPY_LENGTH_LESS_2500,status:u.eG.SUCCESS})},t.prototype.showMarkedAsDeletionTips=function(){var t=window.$t;t&&Ha.show({message:t("review-revision:the-selection-is-marked-as-deleted-text-and-cannot-be-copied"),type:"info",autoClose:!0})},t=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==c.Qwc&&c.Qwc)?e:Object,"function"==typeof(r=void 0!==l.ZM&&l.ZM)?r:Object,"function"==typeof(a=void 0!==n.CustomClipboard&&n.CustomClipboard)?a:Object])],t)}(),Ua=(function(t){function e(e,r,n){var o=t.call(this,e,r,n)||this;return o.className="CopyByMobile",o}var r,o,a;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.copy=function(e){t.prototype.copy.call(this,e,!1,!1)},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(o=void 0!==l.ZM&&l.ZM)?o:Object,"function"==typeof(a=void 0!==n.CustomClipboard&&n.CustomClipboard)?a:Object])],e)}(Wa),Pt.Snackbar),Va=1e4,za=20;function Ka(){var t;Ga=(new Date).valueOf(),ka&&(clearTimeout(ka),ka=null),null===(t=null==Oa?void 0:Oa.close)||void 0===t||t.call(Oa),ka=window.setTimeout((function(){var t=window.$t;Oa=Ua.show({message:t("core-edit:copying"),autoClose:!1,type:"loading",id:"filter-html-image-snackbar"}),ka=null}),1e3)}function ja(){var t;ka&&(clearTimeout(ka),ka=null),null===(t=null==Oa?void 0:Oa.close)||void 0===t||t.call(Oa),o.Yd.info("filterHtmlImageUrlToBase64 cost: ".concat((new Date).valueOf()-Ga," ms"))}function Ya(t){var e=(new DOMParser).parseFromString(t,"text/html"),r=e.body,n=Array.from(r.querySelectorAll("img")).filter((function(t){return!t.src.startsWith("data:image")}));try{n.forEach((function(t){t.src=function(t){var e=t.id,r=function(t){var e,r,n=/\.(a-z)\?/;switch(null!==(r=null===(e=t.match(n))||void 0===e?void 0:e[1])&&void 0!==r?r:""){case"gif":return"image/gif";case"jpg":case"jpeg":return"image/jpeg";case"webp":return"image/webp";default:return"image/png"}}(t.src),n=document.getElementById(e);if(!(n&&n instanceof HTMLImageElement))return o.Yd.info("image element is not loaded, id is ",e),t.src;var i=n.width,a=n.height,s=document.createElement("canvas");s.width=i,s.height=a;var l=s.getContext("2d");null==l||l.drawImage(n,0,0,i,a);var p=s.toDataURL(r);return p.startsWith("data:image")?p:t.src}(t)}))}catch(t){o.Yd.error("transform url to thumbnail fail, ",t.message),u.kQ.zzsStatus({attributeId:u.GI.COPY_ERROR,status:u.eG.FAIL,errorMessage:null==t?void 0:t.message})}return e.documentElement.outerHTML}function qa(t,e,r,n){var a,s,l=(new DOMParser).parseFromString(t,"text/html").body,c=Array.from(l.querySelectorAll("img")).filter((function(t){return!t.src.startsWith("data:image")}));if(!c||0===c.length)return o.Yd.info("async clipboard html, ",t),o.Yd.info("async clipboard plain, ",e),[new ClipboardItem({"text/html":Promise.resolve(new Blob([t],{type:"text/html"})),"text/plain":Promise.resolve(new Blob([e],{type:"text/plain"}))})];if(!e.trim()&&1===c.length){var u=new AbortController,g=u.signal;setTimeout((function(){u.abort()}),Va);var h=Xa({imgSrc:c[0].src,thumb:null!==(a=c[0].getAttribute("thumb"))&&void 0!==a?a:c[0].src},{needCompress:!0,signal:g}),d=c[0].id,y=null===(s=r.getDrawingStream().getDrawingInfo(d))||void 0===s?void 0:s.property,f=p.PropertyImageUtil.cropImageFromBlob(h,y),v=function(t,e,r){return(0,i.__awaiter)(this,void 0,Promise,(function(){var n;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return[4,Za(t,e)];case 1:return n=i.sent(),o.Yd.info("clipboard html, ",n),Na(r,n.length),[2,new Blob([n],{type:"text/html"})]}}))}))}(t,[h],Ga);return[new ClipboardItem({"text/html":v,"text/plain":Promise.resolve(new Blob([e.trim()],{type:"text/plain"})),"image/png":f})]}var m=function(t,e){return(0,i.__awaiter)(this,void 0,Promise,(function(){var r;return(0,i.__generator)(this,(function(n){switch(n.label){case 0:return[4,Qa(t)];case 1:return r=n.sent(),o.Yd.info("clipboard html, ",r),Na(e,r.length),[2,new Blob([r],{type:"text/html"})]}}))}))}(t,n);return[new ClipboardItem({"text/html":m,"text/plain":Promise.resolve(new Blob([e],{type:"text/plain"}))})]}function Qa(t){return(0,i.__awaiter)(this,void 0,Promise,(function(){var e,r,n,a,s,l,p,c,g;return(0,i.__generator)(this,(function(h){switch(h.label){case 0:e=new DOMParser,r=e.parseFromString(t,"text/html"),n=r.body,a=Array.from(n.querySelectorAll("img")).filter((function(t){return!t.src.startsWith("data:image")})),s=[],l=new AbortController,p=l.signal,c=setTimeout((function(){l.abort()}),Va),Ka(),h.label=1;case 1:return h.trys.push([1,3,,4]),a.forEach((function(t){s.push(function(t,e){return(0,i.__awaiter)(this,void 0,Promise,(function(){return(0,i.__generator)(this,(function(r){switch(r.label){case 0:return[4,Xa({imgSrc:t},{signal:e})];case 1:return[2,Ja(r.sent())]}}))}))}(t.src,p))})),[4,Promise.all(s).then((function(t){t.forEach((function(t,e){t&&(a[e].src=t)}))}))];case 2:return h.sent(),clearTimeout(c),ja(),[2,r.documentElement.outerHTML];case 3:return g=h.sent(),o.Yd.error("transform image url to base64 error, ",null==g?void 0:g.message),u.kQ.zzsStatus({attributeId:u.GI.COPY_ERROR,status:u.eG.FAIL,errorMessage:null==g?void 0:g.message}),clearTimeout(c),ja(),[2,Ya(t)];case 4:return[2]}}))}))}function Xa(t,e){var r=this,n=e.needCompress,a=e.maxSize,s=e.signal;return new Promise((function(e,l){var p=t.imgSrc,c=t.thumb,u=window.$t;fetch(p,{signal:s}).then((function(t){return(0,i.__awaiter)(r,void 0,void 0,(function(){var r;return(0,i.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.blob()];case 1:return r=o.sent(),n&&r.size>=1024*(null!=a?a:za)*1024?(Ua.show({message:u("core-edit:image-compress"),autoClose:!0,type:"info"}),fetch(null!=c?c:p).then((function(t){return e(t.blob())})).catch((function(t){return l(t)})),[2]):(e(r),[2])}}))}))})).catch((function(t){if("AbortError"===t.name&&(Ua.show({message:u("core-edit:image-unable-copy"),autoClose:!0,type:"info"}),o.Yd.error("fetch image timeout, try to fetch thumb"),c))return fetch(c).then((function(t){return e(t.blob())})).catch((function(t){return l(t)}));o.Yd.error("fetch image blob fail : "+p),l(t)}))}))}function Ja(t){return(0,i.__awaiter)(this,void 0,Promise,(function(){var e,r;return(0,i.__generator)(this,(function(n){switch(n.label){case 0:return t instanceof Blob?(r=t,[3,3]):[3,1];case 1:return[4,t];case 2:r=n.sent(),n.label=3;case 3:return(e=r)?[2,new Promise((function(t){var r=new FileReader;r.onloadend=function(){t(r.result)},r.readAsDataURL(e)}))]:[2,""]}}))}))}function Za(t,e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var r,n,a,s,l;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:r=new DOMParser,n=r.parseFromString(t,"text/html"),a=n.body,Ka(),s=a.querySelectorAll("img"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.all(e.map((function(t){return Ja(t)})))];case 2:return i.sent().forEach((function(t,e){s[e].src=t})),ja(),[2,n.documentElement.outerHTML];case 3:return l=i.sent(),ja(),o.Yd.error("transform image blob to base64 error, ",null==l?void 0:l.message),u.kQ.zzsStatus({attributeId:u.GI.COPY_ERROR,status:u.eG.FAIL,errorMessage:null==l?void 0:l.message}),[2,Ya(t)];case 4:return[2]}}))}))}function $a(t,e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var r,n,o,a;return(0,i.__generator)(this,(function(i){return r=new DOMParser,n=r.parseFromString(t,"text/html"),o=n.body,(a=Array.from(o.querySelectorAll("img")).filter((function(t){return!t.src.startsWith("data:image")})))&&0!==a.length?[2,ts(t,e)]:[2,{html:t,plain:e}]}))}))}function ts(t,e){return(0,i.__awaiter)(this,void 0,void 0,(function(){return(0,i.__generator)(this,(function(r){switch(r.label){case 0:return[4,Qa(t)];case 1:return[2,{html:r.sent(),plain:e}]}}))}))}!function(t){function e(e,r,n){var o=t.call(this,e,r,n)||this;return o.className="CopyByMqq",o}var r,o,a;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.copy=function(e){t.prototype.copy.call(this,e,!1,!1)},e.prototype.setClipboardData=function(t,e){return void 0===e&&(e=!1),(0,i.__awaiter)(this,void 0,void 0,(function(){var r,n;return(0,i.__generator)(this,(function(o){switch(o.label){case 0:return this.customClipboard.setData(t.htmlWithMeloData,t.plain,t.innerData),e?[2]:(r=window.top.mqq)&&"0"!==r.clientVersion?[4,Qa(t.htmlWithMeloData)]:[3,2];case 1:return n=o.sent(),r.invoke("docx","writeSystemClipboard",{plain:t.plain,html:n}),[3,3];case 2:this.customClipboard.writeToSysytemClipboard(),o.label=3;case 3:return[2]}}))}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(o=void 0!==l.ZM&&l.ZM)?o:Object,"function"==typeof(a=void 0!==n.CustomClipboard&&n.CustomClipboard)?a:Object])],e)}(Wa);var es=function(t){function e(e,r,a){var s,l=this;return(l=t.call(this,e,r,a)||this).className="CopyByWeb",l.copyFromMenuClick=!1,l.isCut=!1,l.hasAsyncCopyPermission=!1,l.textarea=null,l.attached=!1,l.onCopyByMenu=function(t){l.copyFromMenuClick&&(o.Yd.info("copyFromMenuClick"),l.onCopyByEvent(t),l.copyFromMenuClick=!1,l.range=void 0)},l.onCopyByEvent=function(t,e){return void 0===e&&(e=!1),(0,i.__awaiter)(l,void 0,void 0,(function(){var r,a,s,l,p,c,u,g;return(0,i.__generator)(this,(function(i){return this.context.isCopyable()?(this.copyFromMenuClick&&(o.Yd.info("copyFromMenuClick"),this.copyFromMenuClick=!1),o.Yd.info("onCopyByEvent start with event: ".concat(t)),this.isCut=this.isCut?this.isCut:e,e||this.context.fire(new n.BeforeClipboardActionNotification(!0),!1),(r=o.wV.isIE()?window.clipboardData:t.clipboardData)?(a=Date.now(),(s=this.generateHtml(this.range,this.isCut)).isAllDelRevision?(this.showMarkedAsDeletionTips(),[2]):(l=(null===(u=this.writeClipboardContent)||void 0===u?void 0:u.html)||s.htmlWithMeloData,p=(null===(g=this.writeClipboardContent)||void 0===g?void 0:g.plain)||s.plain,c=s.innerData,this.customClipboard.setData(l,p,c),o.wV.isIE()?(r.setData("Text",p),o.Yd.info("IE clipboardData plain: ".concat(r.plain)),Na(a,l.length)):this.isBugSafariForErrorCode()?(r.setData("Text",p),o.Yd.info("BugSafari clipboardData plain: ".concat(r.getData("text/plain"))),Na(a,l.length)):o.wV.isSafari()?this.writeToClipboardInSafari(l,p,a,r):function(t,e){var r=(new DOMParser).parseFromString(t,"text/html").body;return 1===Array.from(r.querySelectorAll("img")).filter((function(t){return!t.src.startsWith("data:image")})).length&&!e.trim()}(l,p)&&this.isSupportAsyncClipboardWrite()?this.writeWithAsyncClipboardApi(l,p,a,r):this.writeWithExecCommand(l,p,a),this.afterCopy(t),[2])):[2]):(o.Yd.info("Document is not copyable"),[2])}))}))},null===(s=null===navigator||void 0===navigator?void 0:navigator.permissions)||void 0===s||s.query({name:"clipboard-write"}).then((function(t){l.hasAsyncCopyPermission="granted"===t.state})).catch((function(){return l.hasAsyncCopyPermission=!0})),l}var r,a,s;return(0,i.__extends)(e,t),e.prototype.isSupportAsyncClipboardWrite=function(){return!!navigator.clipboard&&!!navigator.clipboard.write&&this.hasAsyncCopyPermission},e.prototype.isBugSafariForErrorCode=function(){return!(!o.wV.isSafari()||!o.wV.isMac())&&navigator.userAgent.toLocaleLowerCase().indexOf("version/13.1")>-1},e.prototype.afterCopy=function(t){null==t||t.preventDefault(),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_COPY,{isCut:this.isCut})),this.isCut=!1,this.range=void 0,this.writeClipboardContent=void 0},e.prototype.copyFromMenuInSafari=function(){var t,e,r=Date.now(),n=this.generateHtml(this.range,this.isCut),o=n.plain,i=n.innerData,a=n.htmlWithMeloData;this.customClipboard.setData(a,o,i);var s=qa((null===(t=this.writeClipboardContent)||void 0===t?void 0:t.html)||a,((null===(e=this.writeClipboardContent)||void 0===e?void 0:e.plain)||o).trim(),this.state,r);window!==window.top&&window.focus(),navigator.clipboard.write(s),this.afterCopy()},e.prototype.attach=function(){if(this.attached)o.Yd.info("copy has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("copy",this.onCopyByEvent),document.addEventListener("copy",this.onCopyByMenu),this.attached=!0,o.Yd.info("CopyByWeb attach surfaceDom is true")):o.Yd.error("CopyByWeb attach surfaceDom is null")}},e.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("copy",this.onCopyByEvent):o.Yd.error("CopyByWeb detach surfaceDom is null"),document.removeEventListener("copy",this.onCopyByMenu),this.textarea&&(document.body.removeChild(this.textarea),this.textarea=null),this.attached=!1},e.prototype.copy=function(t,e){if(void 0===e&&(e=!1),this.context.isCopyable()){if(o.Yd.info("copy by web"),this.copyFromMenuClick=!0,this.range=t,this.isCut=e,e||this.context.fire(new n.BeforeClipboardActionNotification(!0),!1),o.wV.isSafari()&&this.isSupportAsyncClipboardWrite())try{return void this.copyFromMenuInSafari()}catch(t){o.Yd.error("safari copy from menu click error, ",null==t?void 0:t.message),u.kQ.zzsStatus({attributeId:u.GI.COPY_ERROR,status:u.eG.FAIL,errorMessage:null==t?void 0:t.message})}this.isNeedTextAreaForExecCopy()?(this.selectTextAreaForCopy(),document.execCommand("copy")):document.execCommand("copy")}},e.prototype.isNeedTextAreaForExecCopy=function(){var t=/WeComCEF/.test(navigator.userAgent),e=o.wV.isSafari()&&!t,r=o.wV.isMac()&&o.wV.isWXMiniProgram(),n=o.wV.isWeWork()&&!o.wV.isWindows()&&!t;return e||n||r||o.wV.isIE()},e.prototype.createTextArea=function(){var t=document.createElement("textarea");t.style.opacity="0",t.contentEditable="true",t.value="",document.body.appendChild(t),this.textarea=t},e.prototype.selectTextAreaForCopy=function(){document.body.style.webkitUserSelect="text",this.textarea||this.createTextArea();var t=document.createRange();t.selectNode(this.textarea),this.textarea.select();var e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(t))},e.prototype.writeToClipboardInSafari=function(t,e,r,n){this.isSupportAsyncClipboardWrite()?this.writeWithAsyncClipboardApi(t,e,r,n):this.writeWithSyncClipboardData(t,e,r,n)},e.prototype.writeWithAsyncClipboardApi=function(t,e,r,n){try{var i=qa(t,e,this.state,r);window!==window.top&&window.focus(),navigator.clipboard.write(i)}catch(i){o.Yd.error("write async clipboard error, ",null==i?void 0:i.message),u.kQ.zzsStatus({attributeId:u.GI.COPY_ERROR,status:u.eG.FAIL,errorMessage:null==i?void 0:i.message}),this.writeWithSyncClipboardData(t,e,r,n)}},e.prototype.writeWithSyncClipboardData=function(t,e,r,n){var i=Ya(t);Na(r,i.length),n.setData("text/html",i),n.setData("text/plain",e),o.Yd.info("set clipboardData html, ",i),o.Yd.info("set clipboardData plain, ",e)},e.prototype.writeWithExecCommand=function(t,e,r){var a;return(0,i.__awaiter)(this,void 0,void 0,(function(){var s;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return[4,$a(t,e)];case 1:return s=i.sent(),Na(r,s.html.length),o.Yd.info("execCommand clipboard html, ",s.html),o.Yd.info("execCommand clipboard plain, ",s.plain),this.selectTextAreaForCopy(),(0,n.writeInClipBoard)(s),null===(a=this.context.surface)||void 0===a||a.requestFocus(),[2]}}))}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Wa),rs=(function(t){function e(e,r,a){var s=t.call(this,e,r,a)||this;return s.className="CopyByWeWork",s.setClickboardData=function(t,e){return(0,i.__awaiter)(s,void 0,void 0,(function(){var r,a,s=this;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return r=function(){s.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_COPY))},[4,Qa(t)];case 1:return a=i.sent(),n.tdocsCopyPaste.isSupportWrite?(o.Yd.info("copy use tdocsCopyPaste"),[2,n.tdocsCopyPaste.write({html:a,plain:e}).then(r)]):[2,(0,n.writeWeworkClipboard)({html:a,plain:e}).then(r)]}}))}))},s}var r,a,s;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.copy=function(t,e){void 0===e&&(e=!1);var r=Date.now(),n=this.generateHtml(t,e);if(n.isAllDelRevision)this.showMarkedAsDeletionTips();else{var i=n.htmlWithMeloData,a=n.plain,s=n.innerData;Na(r,i.length),o.Yd.info("copy by wework with html: ".concat(i,", plain: ").concat(a,", innerData: ").concat(s)),this.customClipboard.setData(i,a,s),this.setClickboardData(i,a)}},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Wa),function(t){function e(e,r,n){var o=t.call(this,e,r,n)||this;return o.className="CopyByWXRTF",o}var r,a,s;return(0,i.__extends)(e,t),e.prototype.copy=function(e){t.prototype.copy.call(this,e,!0,!1)},e.prototype.setClipboardData=function(t,e){return void 0===e&&(e=!1),(0,i.__awaiter)(this,void 0,void 0,(function(){var r,a=this;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(this.customClipboard.setData(t.htmlWithMeloData,t.plain,t.innerData),e)return[2];if(!window.WeixinJSBridge)try{if(!window.top)return o.Yd.info("window.top not found"),[2];window.WeixinJSBridge=window.top.WeixinJSBridge,o.Yd.info("WeixinJSBridge acquired from top window")}catch(t){return o.Yd.info("can not get WeixinJSBridge, ",t),[2]}return[4,Qa(t.htmlWithMeloData)];case 1:return r=i.sent(),(0,n.writeWXRTFClipboard)({html:r,plain:t.plain}).then((function(){u.kQ.tdwReport({opername:"doc_word_editor",module:"copy_paste",action:"wx_write_rich_text"}),o.Yd.info("writeWXRTFClipboard success: ".concat(t.htmlWithMeloData)),a.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_COPY))})).catch((function(){o.Yd.info("writeWXRTFClipboard fail"),u.kQ.idkeyReport(u.bP.WECHAT_COPYPASTE_FAILED)})),[2]}}))}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Wa)),ns=(function(t){function e(e,r,n){var o=t.call(this,e,r,n)||this;return o.className="CopyByQQBrowser",o}var r,a,s;(0,i.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.write=function(t,e){return(0,i.__awaiter)(this,void 0,void 0,(function(){var r,n;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Qa(t)];case 1:return r=i.sent(),o.Yd.info("window.browser.file",window.browser.file),window.browser.file.setClipboardData((function(){o.Yd.info("setClipboardData success")}),(function(){o.Yd.info("setClipboardData fail")}),{plain:e,html:r}),[3,3];case 2:return n=i.sent(),o.Yd.error("setClipboardData:error",n),[3,3];case 3:return[2]}}))}))},e.prototype.copy=function(t,e){return void 0===e&&(e=!1),(0,i.__awaiter)(this,void 0,void 0,(function(){var r,a,s,l,p;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:if(!this.context.isCopyable())return[2];if(r=Date.now(),a=this.generateHtml(t,e),s=a.htmlWithMeloData,l=a.plain,a.isAllDelRevision)return this.showMarkedAsDeletionTips(),[2];Na(r,s.length),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,(0,n.loadQQBrowserJSSDK)()];case 2:return i.sent(),[3,4];case 3:return p=i.sent(),o.Yd.error("loadQQBrowserJSSDK fail",p),[3,4];case 4:return[2,this.write(s,l)]}}))}))},e=(0,i.__decorate)([(0,i.__param)(0,c.Qwc),(0,i.__param)(1,l.yg),(0,i.__param)(2,n.ICustomClipboard),(0,i.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qwc&&c.Qwc)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Wa),function(t){var e,r=t.factory;e="web"===(0,o.Gr)(window.location.href,"copy_type")?es:(0,n.isSupportWXRTF)()&&!(0,n.isSupportWeDriveMini)()?rs:es;var i=r.inject(c.ygL,(0,u.vM)(e));i&&(o.Yd.info("copy injector use class: ".concat(i.className)),i.attach()),i instanceof Wa&&(r.inject(c.vPf,i),o.Yd.info("copy injector with ICopyParserManager"))}),os=function(){function t(){}return t.load=function(t){this.addons.forEach((function(e){return e(t)}))},t.loadService=function(t){Eo(t)},t.loadSurface=function(t){ua(t)},t.loadClipboard=function(t){ns(t),da(t),Bt(t)},t.addons=[Eo,ua,ns,da,Bt],t}()}}]),"object"==typeof globalThis&&(globalThis.jsExecEndTimeStamp=Date.now(),globalThis.cachedPerformanceEntries||(globalThis.cachedPerformanceEntries=[]),globalThis.cachedPerformanceEntries.push({name:"jsExec: js/public-9111-3ec20aea.js",entryType:"jsExec",startTime:globalThis.jsExecStartTimeStamp,endTime:globalThis.jsExecEndTimeStamp}));
//# sourceMappingURL=public-9111-3ec20aea.js.map