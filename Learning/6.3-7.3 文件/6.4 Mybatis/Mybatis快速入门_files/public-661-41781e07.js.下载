"object"==typeof globalThis&&(globalThis.jsExecStartTimeStamp=Date.now()),(self.webpackChunkuni=self.webpackChunkuni||[]).push([[661],{704918:function(e,t,n){n.d(t,{AG:function(){return c},Rs:function(){return d},a1:function(){return i},c9:function(){return f},fC:function(){return l},lW:function(){return p},oc:function(){return h}});var i,o=n(839461),r=n(750670);!function(e){e.anchorId="tdaci",e.extraData="tded"}(i||(i={}));var a,s={addonId:"tdadi",displayText:"tddt",width:"tdw",height:"tdh",link:"tdl",originUrl:"tdo",embedUrl:"tdeu",iframeId:"tdid",lockAspectRatio:r.FieldCommonSwitchesName.lockAspectRatio},l=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},r.FieldCommonSwitchesName),i),s);!function(e){e.ERROR="error",e.DELETED="deleted",e.AUTH="auth",e.LOADING="loading",e.ICON="icon"}(a||(a={}));var d=(0,o.__assign)((0,o.__assign)((0,o.__assign)((0,o.__assign)({},r.FieldCommonSwitchesName),i),s),{type:"tdty",padId:"tdpid",subId:"tdsid"}),c=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},r.FieldCommonSwitchesName),i),{addonId:"tdadi",width:"tdw",height:"tdh",url:"tdo",store:"tds",lockAspectRatio:"tdlar"}),u={height:"tdh",width:"tdw",fitToParent:"tdfpw",placeholder:"tdpd"},f=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},r.FieldCommonSwitchesName),i),u),h=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},r.FieldCommonSwitchesName),i),{height:"tdh",width:"tdw"}),p=[s.width,s.height,u.fitToParent,u.placeholder,s.lockAspectRatio]},967844:function(e,t,n){n.d(t,{R2:function(){return s},a:function(){return c},fy:function(){return i},h_:function(){return u},hq:function(){return f},m_:function(){return l}});var i,o=n(839461),r=n(750670);!function(e){e.extraData="extraData",e.fileName="fileName",e.displayText="displayText"}(i||(i={}));var a,s,l,d,c={internalJump:"l"},u=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},r.FieldCommonSwitchesName),{fileId:"tdfid",fileExt:"tdfe",fileType:"tdft",fileUrl:"tdfu",fileName:"tdfn",docPolicy:"tddp",fileDesc:"tdds",fileFavicon:"tdfvi",openType:"tdop",docLinkFrom:"tdlf",fileCreatorNick:"tdcnk"}),c),f=(0,o.__assign)((0,o.__assign)((0,o.__assign)({},r.FieldCommonSwitchesName),{fileId:"tdfid",fileDesc:"tdds",fileFavicon:"tdfvi",fileName:"tdfn",internalJump:"l"}),c);!function(e){e[e.WxworkDefaultBrowser=1]="WxworkDefaultBrowser"}(a||(a={})),function(e){e.FromDialog="FromDialog",e.FromInput="FromInput",e.FromPaste="FromPaste",e.FromUploadFile="FromUploadFile"}(s||(s={})),function(e){e.Link="Link",e.Doc="Doc",e.Wedoc="Wedoc",e.Wedrive="Wedrive",e.Loading="Loading",e.ProgressLoading="ProgressLoading",e.Placeholder="Placeholder",e.Bookmark="Bookmark"}(l||(l={})),function(e){e[e.PRIVATE=0]="PRIVATE",e[e.PARTIAL=1]="PARTIAL",e[e.ALL=2]="ALL"}(d||(d={}))},26414:function(e,t,n){n.d(t,{G:function(){return i}});var i={canJump:"h",relativePosition:"p"}},252783:function(e,t,n){n.d(t,{Au:function(){return r},Dm:function(){return l},Uc:function(){return d},e8:function(){return a},m7:function(){return o}});var i,o,r,a,s=n(750670),l="toolbar-field";!function(e){e.Default="normalLink",e.File="file",e.Audio="audio",e.Video="video",e.Location="location",e.Calendar="calendar",e.Database="database",e.AddonIframe="addonIframe",e.TDSheetIFrame="tdSheetIframe",e.Attachment="attachment",e.NormalLink="normalLink",e.DocLink="docLink",e.AddonLink="addonLink",e.AddonHina="addonHina"}(o||(o={})),function(e){e[e.COLLAB_SPACE=-2]="COLLAB_SPACE",e[e.FOLDER_SHARE=-1]="FOLDER_SHARE",e[e.WORD=0]="WORD",e[e.EXCEL=1]="EXCEL",e[e.FORM=2]="FORM",e[e.FOLDER=3]="FOLDER",e[e.SLIDE=4]="SLIDE",e[e.NOTE=5]="NOTE",e[e.PDF=6]="PDF",e[e.MINIPROGRAM=7]="MINIPROGRAM",e[e.SMARTSHEET=8]="SMARTSHEET",e[e.FORM_JOURNAL=9]="FORM_JOURNAL",e[e.MIND=90]="MIND",e[e.FLOWCHART=91]="FLOWCHART",e[e.UNKNOWN=10]="UNKNOWN",e[e.DRIVE=101]="DRIVE",e[e.SMARTCANVAS=8e3]="SMARTCANVAS",e[e.NORMAL_LINK=-10]="NORMAL_LINK",e[e.WEDRIVE_TXT=1e3]="WEDRIVE_TXT",e[e.WEDRIVE_HTML=1001]="WEDRIVE_HTML",e[e.WEDRIVE_IMAGE=1002]="WEDRIVE_IMAGE",e[e.WEDRIVE_AUDIO=1003]="WEDRIVE_AUDIO",e[e.WEDRIVE_VIDEO=1004]="WEDRIVE_VIDEO",e[e.WEDRIVE_ZIP=1005]="WEDRIVE_ZIP",e[e.WEDRIVE_FONT=1006]="WEDRIVE_FONT",e[e.WEDRIVE_MAIL=1007]="WEDRIVE_MAIL",e[e.WEDRIVE_XMIND=1008]="WEDRIVE_XMIND",e[e.WEDRIVE_EXE=1009]="WEDRIVE_EXE",e[e.WEDRIVE_EXCEL=1010]="WEDRIVE_EXCEL",e[e.WEDRIVE_PPT=1011]="WEDRIVE_PPT",e[e.WEDRIVE_WORD=1012]="WEDRIVE_WORD",e[e.WEDRIVE_NUMBERS=1013]="WEDRIVE_NUMBERS",e[e.WEDRIVE_KEYNOTE=1014]="WEDRIVE_KEYNOTE",e[e.WEDRIVE_PAGES=1015]="WEDRIVE_PAGES",e[e.WEDRIVE_CAD=1016]="WEDRIVE_CAD",e[e.WEDRIVE_CDR=1017]="WEDRIVE_CDR",e[e.WEDRIVE_SW=1018]="WEDRIVE_SW",e[e.WEDRIVE_PSD=1019]="WEDRIVE_PSD",e[e.WEDRIVE_AI=1020]="WEDRIVE_AI",e[e.WEDRIVE_PDF=1021]="WEDRIVE_PDF",e[e.WEDRIVE_SKETCH=1022]="WEDRIVE_SKETCH",e[e.WEDRIVE_ANDROID=1023]="WEDRIVE_ANDROID",e[e.WEDRIVE_MAC=1024]="WEDRIVE_MAC",e[e.WEDRIVE_SVG=1025]="WEDRIVE_SVG",e[e.WEDRIVE_FOLDER=1026]="WEDRIVE_FOLDER",e[e.WEDRIVE_OTHER=1027]="WEDRIVE_OTHER",e[e.APP_LINK=2e3]="APP_LINK"}(r||(r={})),function(e){e[e.WORD=0]="WORD",e[e.EXCEL=1]="EXCEL",e[e.FORM=2]="FORM",e[e.FOLDER=3]="FOLDER",e[e.SLIDE=4]="SLIDE",e[e.NOTE=5]="NOTE",e[e.PDF=6]="PDF",e[e.MINI_PROGRAM=7]="MINI_PROGRAM",e[e.SMARTCANVAS=8]="SMARTCANVAS",e[e.SMARTSHEET=9]="SMARTSHEET",e[e.UNKNOW=10]="UNKNOW",e[e.RESUME=11]="RESUME",e[e.DRAWING=89]="DRAWING",e[e.MIND=90]="MIND",e[e.FLOWCHART=91]="FLOWCHART",e[e.FILE=100]="FILE",e[e.DRIVE=101]="DRIVE",e[e.SOGOU_SPEECH=102]="SOGOU_SPEECH",e[e.ADDON=110]="ADDON"}(a||(a={}));var d=40;(i={})[s.FieldCommonSwitchesName.key]="",i[s.FieldCommonSwitchesName.isEscape]=!1,i[s.FieldCommonSwitchesName.width]=600,i[s.FieldCommonSwitchesName.height]=400},187846:function(e,t,n){n.d(t,{A9:function(){return u},Ao:function(){return S},Cj:function(){return D},HH:function(){return w},Ie:function(){return y},MI:function(){return T},OL:function(){return I},P5:function(){return R},Po:function(){return v},Rm:function(){return E},Vo:function(){return C},Xn:function(){return p},YQ:function(){return h},_r:function(){return f},dt:function(){return b},s0:function(){return _},wV:function(){return F}});var i=n(750670),o=n(814808),r=n(495155),a=n(252783),s=n(218581),l=n(704918),d=n(967844),c=n(26414),u=o.default;function f(e){return function(t,n){return e([t],n).component}}function h(e){return function(t){return e(null,t).overrideStyle}}function p(e,t){if(void 0===t&&(t=0),(0,i.isFieldContainerBox)(e)){var n=i.CssUtil.boxSize(e),o=n.width,a=n.height;return{width:o?parseFloat(o):void 0,height:a?parseFloat(a):void 0}}var s=e.property,l=document.getElementById("melo-container-placeholder-".concat(null==s?void 0:s.anchorId));if(!l){var d=(0,r.twipsToPx)(s.drawing.extent.cx),c=(0,r.twipsToPx)(s.drawing.extent.cy);return s.drawing.cNvGraphicFramePr.graphicFrameLocks.noChangeAspect||(c*=t/d),{width:d=t,height:c}}var u=l.style,f=u.width,h=u.height;return{width:f?parseFloat(f):void 0,height:h?parseFloat(h):void 0}}var g=new RegExp("\\\\".concat(i.FieldCommonSwitchesName.key," (\\w+)"),"g"),m=new RegExp("\\\\".concat(l.a1.anchorId," (\\w+)"),"g"),v={isHighlightOnBackspace:!0,isHighlightOnHover:function(e){return e.layoutType===i.FieldLayoutType.Text},onHighlight:function(e,t){e.fire(new i.FieldCodeNotification(i.FieldCodeNotificationType.Highlight,t))},onCancelHighlight:function(e,t){e.fire(new i.FieldCodeNotification(i.FieldCodeNotificationType.cancelHighlight,t))},onPasteDelta:{fieldCode:function(e,t){if("string"==typeof t.param.text){var n=r.StringUtil.generateRandomId();t.param.text=t.param.text.replace(g,"\\".concat(i.FieldCommonSwitchesName.key," ").concat(n)).replace(m,"\\".concat(l.a1.anchorId," ").concat(n))}return t}}},y=function(e,t,n){var o,r,a=(null===(o=n.fieldCode.switches)||void 0===o?void 0:o[i.FieldCommonSwitchesName.key])||(null===(r=n.fieldCode.switches)||void 0===r?void 0:r[l.fC.anchorId]);if(a)return a;var s=e.getIndexFromRange(t.getRange()),d=s.first,c=s.last;return"".concat(d,"-").concat(c)};function _(e,t){for(var n=t,o=e.service.getDocument();n>0&&o.getTextFromGcpRange(new i.GCPRange(n-1,1))===i.PlaceholderChar.CommentReference;)n-=1;return n-=1}function R(e){var t,n=e.name,o=e.instructions;return n!==i.FieldName.HYPERLINK?null:null!==(t=null==o?void 0:o[0])&&void 0!==t?t:null}function b(e,t,n){var i=null!=n?n:R(e.fieldCode);if(i)try{t.clipboardManager.writeToClipboard(i),u.show({message:(0,s.$t)("复制链接成功"),type:"success",autoClose:!0})}catch(e){u.show({message:(0,s.$t)("复制链接失败: ".concat(e)),type:"error",autoClose:!0})}else r.Logger.error("[HYPERLINK] 无法获取准确链接，造成无法复制链接")}function F(e){var t;if(R(e))return null;var n=null===(t=e.switches)||void 0===t?void 0:t[d.a.internalJump];return null!=n?n:null}function S(e){var t,n,i=null===(t=e.switches)||void 0===t?void 0:t[c.G.canJump],o=null===(n=e.instructions)||void 0===n?void 0:n[0];return i&&o?o:null}function E(e){return e.name===i.FieldName.HYPERLINK?F(e):e.name===i.FieldName.PAGE_REF?S(e):null}function T(e,t){return r.PlatformUtil.isMac()?t.metaKey:t.ctrlKey}function w(e){var t,n;return!!(null===(n=null===(t=e.fieldCode.switches)||void 0===t?void 0:t[d.a.internalJump])||void 0===n?void 0:n.startsWith("_"))}function C(e,t){var n=e.getCurrentState(),o=n.contextState,r=n.docViewType,a=n.isFocusHeaderFooter,s=n.isInHeaderFooter;return i.CssUtil.computeContainerStyles(t,null==o?void 0:o.clipInfo,r,a,s)}function I(e){var t=e.switches,n=e.instructions,o=e.name,r=null==t?void 0:t[i.FieldCommonSwitchesName.subtype];return r||(o===i.FieldName.HYPERLINK?null==n?void 0:n[1]:void 0)}function D(e,t,n,o){void 0===n&&(n=a.Uc);var s=t.getRange();if(t instanceof i.TextBox&&o){var l=o.begin(),d=o.end(),c=s.begin(),u=t.parentBox,f=null==u?void 0:u.getRangeBegin();l!==c&&void 0!==u&&f!==c&&u.children.some((function(e){var t=e.getRangeBegin();return t>c||t>d?(r.Logger.error("[FIELD TOOLBAR] 无法正确获取工具栏起点位置：".concat(t>c,",").concat(t>d)),!0):t>=l?(s=e.getRange(),!0):void 0}))}var h=e.service.getDocument().getRange(s.gcpBegin,s.gcpBegin+s.len),p=e.getViewRangeFromGcpRange(s);if(!p)return r.Logger.error("[FIELD TOOLBAR] 当前无法获取".concat(e.uuid,"编辑器的当前box起点位置")),{left:0,top:0};var g=p.start.getSurfaceOffset(e.zoom);if([i.STStoryType.headerContent,i.STStoryType.footerContent].includes(h.storyType())){var m=i.LayoutUtil.getOffsetPoint(t,i.BoxKind.Document);g.y=(0,r.twipsToPx)(m.y)}var v={left:g.x,top:g.y-n};return v.top<0&&(v.top=g.y+(0,r.twipsToPx)(t.totalHeight)),v}},116896:function(e,t,n){n.d(t,{Ds:function(){return o},Ld:function(){return r},Lk:function(){return p},xo:function(){return i}});var i,o,r,a=n(839461),s=n(750670),l=n(495155),d=n(989094),c=n(218581),u=n(991287),f=n(252783),h=n(967844);!function(e){e[e.Mobile=1123]="Mobile",e[e.Pc=1600]="Pc"}(i||(i={})),function(e){e.image="img",e.width="image-wrapper-width",e.height="image-wrapper-height",e.originWidth="image-width",e.originHeight="image-height",e.id="attachmentId",e.cropBottom="image-blipFill-srcRect-b",e.cropLeft="image-blipFill-srcRect-l",e.cropRight="image-blipFill-srcRect-r",e.cropTop="image-blipFill-srcRect-t",e.rotateDegree="image-rotateDegree",e.sourceType="image-sourceType"}(o||(o={})),function(e){e[e.Toolbar=1]="Toolbar",e[e.ContextMenu=2]="ContextMenu"}(r||(r={}));var p=function(){function e(){}return e.getImageThumb=function(e,t){if(!this.isValidQqadaptDomain(e)&&!this.isValidDocImageDomain(e)&&!this.isValidWecomDocImgDomain(e))return e;if(e.indexOf("type=image/gif")>0){var n=e.indexOf("type=image/gif")-1;return e.substring(0,n)}var i=(0,a.__read)(e.split("?"),1)[0];return this.isValidQqadaptDomain(e)?e:"".concat(i.substring(0,i.length),"?imageMogr2/thumbnail/").concat(t,"x>/ignore-error/1")},e.isValidDocImageDomain=function(e){if(!e||e.length<1)return!1;var t=new RegExp(u.X.getInstance().getConfig("custom.domains.validDocImageDomain"));return e.search(t)>=0},e.isValidQqadaptDomain=function(e){if(!e||e.length<1)return!1;var t=u.X.getInstance().getConfig("custom.domains.validAdaptDomain");return e.indexOf(t)>0},e.isValidWecomDocImgDomain=function(e){if(!e||e.length<1)return!1;var t=u.X.getInstance().getConfig("custom.domains.validWedocImageDomain"),n=u.X.getInstance().getConfig("custom.domains.validWeworkImageDomain");return e.indexOf(t)>0||e.indexOf(n)>0},e.copyErrorTips=function(){return l.PlatformUtil.isMac()?(0,c.$t)("图片粘贴不成功。试试单独复制原图并用Cmd+V粘贴，或导入文档。"):(0,c.$t)("图片粘贴不成功。试试单独复制原图并用Ctrl+V粘贴，或导入文档。")},e.isPlaceHolder=function(e){return e&&e.indexOf("blob:https")>=0},e.getMaxWidthFromLayoutBox=function(e){var t=0;return(0,s.isContainerBoxLite)(e)?e.parentBox&&(t=(0,l.pxToTwips)(s.CssUtil.computeParagraphWidth(e.parentBox))):t=e.rect.width,t},e.getAttachmentId=function(){return Math.random().toString(16).substr(2,8)},e.getImgElementByContainerBox=function(t){var n;if(!t||!(0,s.isImageBox)(t)&&!(0,s.isImageBoxLite)(t))return null;var i=e.getUniqueAnchorId(t),o=document.getElementById(i);if(!o){var r=t.__node__;return r&&"IMG"===(null===(n=null==r?void 0:r.children[0])||void 0===n?void 0:n.nodeName)?null==r?void 0:r.children[0]:null}var a=$(o)[0];return a&&a instanceof HTMLImageElement?a:null},e.getRotateStyle=function(e,t){var n=t.marginLeft,i=t.marginTop,o=t.originWidth,r=t.originHeight,a=s.PropertyImageUtil.getTranslateFromRotate(e,o,r),l=a.x,d=a.y;return{width:o,height:r,transformOrigin:"left top",transform:"translate(".concat(l.toFixed(4),"px, ").concat(d.toFixed(4),"px) ")+"rotate(".concat(e/s.DefaultsUnit.rotate,"deg) translate(").concat(n,"px, ").concat(i,"px)")}},e.dataURLToBlob=function(e){for(var t=e.split(";base64,"),n=(0,a.__read)(t[0].split(":"),2)[1],i=window.atob(t[1]),o=i.length,r=new Uint8Array(o),s=0;s<o;++s)r[s]=i.charCodeAt(s);return new Blob([r],{type:n})},e.isOCRAvailable=function(){return!1},e.sortImageAttributes=function(e){var t,n,i=[],o=[],r=[],c=[],u=[],f=[];try{for(var h=(0,a.__values)(e),p=h.next();!p.done;p=h.next()){var g=p.value,m=g.drawingProp,v=s.PropertyImageUtil.getImageProperty(m),y=v.imgSrc;if(!(""===y||v.sourceType&&d.JY[v.sourceType])&&"string"==typeof y){var _=this.getAuthCdnUrl(y);if(!m)continue;var R=this.getImageNatureSize(m.anchorId),b=R.naturalWidth,F=void 0===b?(0,l.twipsToPx)(v.originHeight):b,S=R.naturalHeight,E=void 0===S?(0,l.twipsToPx)(v.originWidth):S,T=(0,l.twipsToPx)(v.originHeight)/(0,l.twipsToPx)(v.originWidth),w=E>F?E/T:F,C=E>F?E:F*T,I={cropLeft:v.cropLeft/s.DefaultsUnit.percentage,cropRight:v.cropRight/s.DefaultsUnit.percentage,cropBottom:v.cropBottom/s.DefaultsUnit.percentage,cropTop:v.cropTop/s.DefaultsUnit.percentage};i.push({imageWidth:w,imageHeight:C}),c.push(I),o.push(_),r.push(g.getAnchorId()),u.push(v.rotateDegree/s.DefaultsUnit.rotate%360),f.push(g.getRange())}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}return{imageSizeList:i,imageList:o,imageIdList:r,cropValueList:c,rotateList:u,gcpList:f}},e.getEntSortImageAttributes=function(e,t,n){void 0===n&&(n=!1);var i=[],o=this.sortImageAttributes(e),r=o.imageSizeList,a=o.imageIdList,s=o.imageList,l=o.cropValueList,d=o.rotateList,c=o.gcpList,u=this.getWedriveImageAttributes(t,n),h=u.imageList,p=u.fieldIdList,g=u.gcpList,m=u.nameList,v=u.fileExtList;function y(){var e=a.shift();return{type:"image",url:s.shift(),size:r.shift(),imageId:e,cropValue:l.shift(),rotate:d.shift(),gcp:c.shift(),id:e}}function _(){var e=g.shift(),t=e.begin();return{type:v.shift()==="".concat(f.Au.WEDRIVE_VIDEO)?"wedrive_video":"wedrive_image",url:h.shift(),fieldId:p.shift(),gcp:e,name:m.shift(),id:"".concat(t,"gcp")}}for(;a.length>0&&p.length>0;)c[0].begin()<g[0].begin()?i.push(y()):i.push(_());for(;a.length>0;)i.push(y());for(;p.length>0;)i.push(_());return i},e.getFileExt=function(e){var t=/.*\.(.*)$/.exec(e);return(null==t?void 0:t[1])||""},e.getWedriveImageAttributes=function(e,t){var n=this;void 0===t&&(t=!1);var i=[],o=[],r=[],s=[],l=[],d=e.getFields();return(0,a.__spreadArray)([],(0,a.__read)(d),!1).forEach((function(e){var a=e.getFieldInfo().fieldCode,d=a.switches?a.switches[h.h_.fileExt]:"";if(a.switches&&["".concat(f.Au.WEDRIVE_IMAGE),"".concat(f.Au.WEDRIVE_VIDEO)].includes(d)&&a.instructions){var c=a.switches[h.h_.fileName];if(t&&"tiff"===n.getFileExt(c))return;i.push(a.instructions[0]),o.push(a.switches[h.h_.fileId]),r.push(e.getRange()),s.push(c),l.push(d)}})),{imageList:i,fieldIdList:o,gcpList:r,nameList:s,fileExtList:l}},e.getReportModuleNameFromWrapType=function(e){return new Map([[s.WrapType.Inline,"in_line_with_text"],[s.WrapType.Square,"square"],[s.WrapType.TopAndBottom,"top_and_bottom"],[s.WrapType.Front,"in_front_of_text"],[s.WrapType.Behind,"behind_text"]]).get(e)},e.fixImageUrl=function(e){try{return(e||"").replace(/^(http:)|(https:)/g,"")}catch(e){console.error(e)}return e},e.getAuthCdnUrl=function(e){return e=null==e?void 0:e.replace("http://","https://")},e.getImageNatureSize=function(e){var t=document.getElementById(e);return{naturalWidth:null==t?void 0:t.naturalWidth,naturalHeight:null==t?void 0:t.naturalHeight}},e.getUniqueAnchorId=function(e){var t;if(!(0,s.isImageBox)(e)&&!(0,s.isImageBoxLite)(e))return"";var n=e.property.anchorId;if((0,s.isImageBoxLite)(e))return n;var i=e.getAncestorOf(s.BoxKind.HeaderFooter);if(!i)return n;var o=i.getAncestorOf(s.BoxKind.Page);return"".concat(n,"-").concat(null!==(t=null==o?void 0:o.getPageIndex())&&void 0!==t?t:0)},e.imageSizeInit=function(t,n){var i=n.height,o=n.width,r=n.range,a=t.onDocument().getRange(r.begin(),r.end()).getInlineShapes().item(0);if(a){var d=a.getProperty(),c=new(s.PropertyFactory.getPropertyClass(s.PropertyType.DrawingProperty)),u=!1,f=d.isFloating?c.anchor:c.inlineKeyword;i>0&&o>0&&!Number.isNaN(i)&&!Number.isNaN(o)&&(f.extent.cx=(0,l.twipsToEmu)(o),f.extent.cy=(0,l.twipsToEmu)(i),f.graphic.graphicData.pic.spPr.xfrm.ext.cx=c.drawing.extent.cx,f.graphic.graphicData.pic.spPr.xfrm.ext.cy=c.drawing.extent.cy,f.graphic.graphicData.pic.isNotAutoFitLayout=!1,u=!0),a.getAnchorId()||(c.anchorId=e.getAttachmentId(),u=!0),u&&a.setImageProperties(c,t.isEditable())}},e}()},989094:function(e,t,n){n.d(t,{Ew:function(){return u},JY:function(){return c},X9:function(){return l},b3:function(){return s},lb:function(){return d}});var i,o,r=n(218581),a=n(750670),s=(n(495155),(i={})[a.STAddonSourceType.none]="image-needhover",i[a.STAddonSourceType.PBDEFAULT]="image-needhover",i[a.STAddonSourceType.sign]="image-needhover",i[a.STAddonSourceType.latex]="",i[a.STAddonSourceType.signbar]="image-signbar",i),l=function(e){var t,n,i=e.isEditable,o=e.isOcr,r=((t={"":"move"})[a.STAddonSourceType.none]="zoom-in",t[a.STAddonSourceType.PBDEFAULT]="zoom-in",t[a.STAddonSourceType.sign]="zoom-in",t[a.STAddonSourceType.latex]="default",t[a.STAddonSourceType.signbar]="pointer",t),s=((n={"":{move:i,default:o}})[a.STAddonSourceType.none]={move:i,default:o},n[a.STAddonSourceType.PBDEFAULT]={move:i,default:o},n[a.STAddonSourceType.sign]={move:i,default:o},n[a.STAddonSourceType.latex]={move:i},n[a.STAddonSourceType.signbar]={default:o},n);return Object.keys(s).forEach((function(e){return Object.keys(s[e]).forEach((function(t){s[e][t]&&(r[e]=t)}))})),r},d=function(e){var t;return(t={})[a.STAddonSourceType.signbar]={originWidth:e,originHeight:96,marginTop:0,marginLeft:0},t},c=((o={})[a.STAddonSourceType.signbar]=!0,o[a.STAddonSourceType.latex]=!0,o),u=function(e,t){if(e!==a.STAddonSourceType.signbar)return{imageUrl:void 0,customActionButtonRect:void 0};var n=Math.max(window.devicePixelRatio||1,1),i=document.createElement("canvas");i.width=t*n,i.height=96*n;var o=i.getContext("2d"),s=(0,r.$t)("e-signature:click-to-sign"),l="#1e6fff";o.fillStyle=l;var d=a.CssUtil.parseFontFamily("");o.font="bold ".concat(17*n,'px "').concat(d,'"'),o.textBaseline="top";var c=o.measureText(s);o.fillText(s,(i.width-c.width)/2,26*n);var u=(0,r.$t)("e-signature:e-signature-message-full"),f="rgba(0, 0, 0, 0.24)";o.fillStyle=f,o.font="".concat(12*n,'px "').concat(d,'"');var h=o.measureText(u);o.translate((i.width-h.width)/2,0);var p=(0,r.$t)("e-signature:e-signature-message-left"),g=o.measureText(p);o.fillText(p,0,55*n);var m=(0,r.$t)("e-signature:e-signature-message-middle"),v=o.measureText(m);o.fillStyle=l,o.fillText(m,g.width,55*n);var y=(0,r.$t)("e-signature:e-signature-message-right");return o.fillStyle=f,o.fillText(y,g.width+v.width,55*n),{imageUrl:i.toDataURL(),customActionButtonRect:{left:((i.width-h.width)/2+g.width)/n,top:49,width:v.width/n,height:24}}}},849678:function(e,t,n){n.d(t,{P:function(){return r}});var i=n(839461),o=n(187846),r=function(){function e(){var e=this;this.addUpsertConfigCallback=function(t,n,i){void 0===i&&(i=!0),e.upsertCallback.set(t,n),i&&e.fieldRenderConfig.forEach((function(e){return n(e)}))},this.deleteUpsertConfigCallback=function(t){e.upsertCallback.delete(t)},this.upsertFieldRenderConfig=function(t,n){var o=t.name,r=t.subtype,a=r?"".concat(o,"-").concat(r):o,s=e.fieldRenderConfig.get(a),l=t;!n&&s&&(l=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},s),t),{render:e.mergeRenderConfig(s.render,t.render)})),e.fieldRenderConfig.set(a,l),e.upsertCallback.forEach((function(e){return e(l)}))},this.parseRenderConfig=function(e){var t,n=null!==(t=null==e?void 0:e.textRenderConfig)&&void 0!==t?t:e;return"children"in n?{containerRenderConfig:n}:{textRenderConfig:n,containerRenderConfig:"containerRenderConfig"in e?e.containerRenderConfig:void 0}},this.upsertFieldHookConfig=function(t,n){var r=t.name,a=t.subtype,s=a?"".concat(r,"-").concat(a):r,l=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.Po),n?{}:e.fieldHookConfig.get(s)),t);e.fieldHookConfig.set(s,l)},this.getFieldRenderConfig=function(t){return e.fieldRenderConfig.get(t)},this.getFieldHookConfig=function(t,n){var r=n?"".concat(t,"-").concat(n):t,a=e.fieldHookConfig.get(r);return!a&&n&&(a=e.fieldHookConfig.get(t)),null!=a?a:(0,i.__assign)({name:t,subtype:n},o.Po)},this.fieldRenderConfig=new Map,this.fieldHookConfig=new Map,this.upsertCallback=new Map}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.destroy=function(){this.instance&&this.instance.upsertCallback.clear(),this.instance=null},e.prototype.mergeRenderConfig=function(e,t){if(!e||!t)return e||t;var n=this.parseRenderConfig(e),o=this.parseRenderConfig(t),r=(0,i.__assign)((0,i.__assign)({},n.textRenderConfig),o.textRenderConfig),a=(0,i.__assign)((0,i.__assign)({},n.containerRenderConfig),o.containerRenderConfig),s=!Object.keys(r).length,l=!Object.keys(a).length;return s?l?void 0:a:l?r:{textRenderConfig:r,containerRenderConfig:a}},e.prototype.getAllListByInteractiveConfigKey=function(e){var t=[];return this.fieldHookConfig.forEach((function(n){var i=n[e];i&&t.push(i)})),t},e}()},285416:function(e,t,n){n.d(t,{Z:function(){return m}});var i,o,r=n(839461),a=n(750670),s=n(187846),l=n(495155),d=function(e,t){var n=parseFloat(e);return isNaN(n)?(l.Logger.error("[FIELD SERVICE] ".concat(t," 字符串转换为数字是解析错误为 NaN, value: ").concat(e)),0):n},c=((i={})[a.FieldCommonSwitchesName.displayLayoutType]=function(e){return e},i[a.FieldCommonSwitchesName.independentRender]=function(e){return e?a.FieldBoolean.True:a.FieldBoolean.False},i[a.FieldCommonSwitchesName.layoutType]=function(e){return e},i[a.FieldCommonSwitchesName.key]=function(e){return e},i[a.FieldCommonSwitchesName.width]=function(e){return e.toString()},i[a.FieldCommonSwitchesName.height]=function(e){return e.toString()},i[a.FieldCommonSwitchesName.lockAspectRatio]=function(e){return e.toString()},i[a.FieldCommonSwitchesName.padding]=function(e){var t=e.top,n=e.right,i=e.bottom,o=e.left;return'"'.concat(t," ").concat(n," ").concat(i," ").concat(o,'"')},i[a.FieldCommonSwitchesName.subtype]=function(e){return e},i[a.FieldCommonSwitchesName.extendedData]=function(e){return escape(JSON.stringify(e))},i),u=((o={})[a.FieldCommonSwitchesName.displayLayoutType]=function(e){return e},o[a.FieldCommonSwitchesName.independentRender]=function(e){return e!==a.FieldBoolean.False},o[a.FieldCommonSwitchesName.isEscape]=function(e){return e!==a.FieldBoolean.False},o[a.FieldCommonSwitchesName.layoutType]=function(e){return e},o[a.FieldCommonSwitchesName.key]=function(e){return e},o[a.FieldCommonSwitchesName.width]=function(e){return d(e,"width")},o[a.FieldCommonSwitchesName.height]=function(e){return d(e,"height")},o[a.FieldCommonSwitchesName.lockAspectRatio]=function(e){return d(e,"lockAspectRatio")},o[a.FieldCommonSwitchesName.padding]=function(e){var t,n,i,o,r=e.replace('"',"").split(" ").map((function(e){return d(e,"padding")}));return{top:null!==(t=r[0])&&void 0!==t?t:0,right:null!==(n=r[1])&&void 0!==n?n:0,bottom:null!==(i=r[2])&&void 0!==i?i:0,left:null!==(o=r[3])&&void 0!==o?o:0}},o[a.FieldCommonSwitchesName.subtype]=function(e){return e},o[a.FieldCommonSwitchesName.extendedData]=function(e){try{return JSON.parse(unescape(e))}catch(e){return{}}},o),f=n(849678),h=n(826973),p=function(){function e(){var e=this;this.keyProcessorMap=new Map,this.getFieldProcessor=function(t,n){var i=e.getKey(t,n),o=e.keyProcessorMap.get(i);return o||(n&&(o=e.keyProcessorMap.get(t))?o:null)},this.upsertFieldProcessor=function(t){var n=t.name,i=t.subtype,o=t.processor,s=e.getKey(n,i);if(o){if(o instanceof a.FieldCodeProcessor)return e.keyProcessorMap.delete(s),void e.keyProcessorMap.set(s,o);if(i)throw new Error("[FIELD PROCESSOR] subtype 为区分域最小力度，禁止对映 map 函数，只有 field name 才允许");Object.entries(o).map((function(t){var i=(0,r.__read)(t,2),o=i[0],a=i[1],s=e.getKey(n,o);e.keyProcessorMap.delete(s),e.keyProcessorMap.set(s,a)}))}else e.keyProcessorMap.delete(s)},a.FieldCodeManager.getInstance().setFieldProcessorCallback(this.getFieldProcessor),f.P.getInstance().addUpsertConfigCallback("fieldProcessorService",this.upsertFieldProcessor)}var t;return t=e,e.getInstance=function(){return this.instance||(this.instance=new t),this.instance},e.prototype.getKey=function(e,t){return"".concat(e).concat(t?"-".concat(t):"")},e=t=(0,r.__decorate)([(0,h.t)(),(0,r.__metadata)("design:paramtypes",[])],e)}(),g=function(){function e(){var e=this;this.processorService=p.getInstance(),this.encodeField=function(t,n){var i,o,l,d=t.fieldCode,u=d.name,f=d.switches,h=(0,s.OL)(t.fieldCode),p=h?"".concat(u,"-").concat(h):u,g=e.fieldConfigService.getFieldRenderConfig(p);if(!g)throw new Error("[FIELD SERVICE] 当前并没有注入 ".concat(p," 域（子）类型配置信息，无法插入数据"));var m=t,v=(0,r.__assign)((0,r.__assign)({},null===(i=g.fieldCodeConfig)||void 0===i?void 0:i.switchesValueConvertToString),c);if(f){var y=Object.entries(f).reduce((function(e,t){var n,i,o,a=(0,r.__read)(t,2),s=a[0],l=a[1];if(void 0===l)return e;var d=v[s];return d||"boolean"!=typeof l?(0,r.__assign)((0,r.__assign)({},e),((i={})[s]=null!==(o=null==d?void 0:d(l))&&void 0!==o?o:"".concat(l),i)):l?(0,r.__assign)((0,r.__assign)({},e),((n={})[s]="",n)):e}),{});m.fieldCode=(0,r.__assign)((0,r.__assign)({},t.fieldCode),{switches:y})}var _=(null!==(o=g.fieldCodeConfig)&&void 0!==o?o:{}).forbiddenEscapeSwitches,R={fixFieldKey:null===(l=null==n?void 0:n.fixFieldKey)||void 0===l||l,forbiddenEscapeSwitches:_};return a.FieldUtil.encodeField(m,R)}}return e.prototype.parseFieldCode=function(e){var t,n=e.name,i=e.instructions,o=void 0===i?[]:i,s=e.switches,l=void 0===s?{}:s,d=e.range,c=l[a.FieldCommonSwitchesName.subtype],f=c?"".concat(n,"-").concat(c):n,h=this.fieldConfigService.getFieldRenderConfig(f);if(!h&&c&&(h=this.fieldConfigService.getFieldRenderConfig(n)),!l||!h)return{name:n,instructions:o,switches:l,range:d};var p=(0,r.__assign)((0,r.__assign)({},u),null===(t=null==h?void 0:h.fieldCodeConfig)||void 0===t?void 0:t.switchesValueConvertToCustom),g=Object.entries(l).reduce((function(e,t){var n,i,o=(0,r.__read)(t,2),a=o[0],s=o[1],l=p[a];return(0,r.__assign)((0,r.__assign)({},e),((n={})[a]=null!==(i=null==l?void 0:l(s))&&void 0!==i?i:s,n))}),{});return{name:n,instructions:o,switches:g,range:d}},e.prototype.decodeFieldCode=function(e){var t=a.FieldUtil.decodeFieldCode(e);if(!t)return null;var n=this.parseFieldCode(t);if(!n.switches[a.FieldCommonSwitchesName.displayLayoutType]){var i=n.switches[a.FieldCommonSwitchesName.subtype],o=this.processorService.getFieldProcessor(t.name,i),r=null==o?void 0:o.getFieldLayoutType(t);r&&(n.switches[a.FieldCommonSwitchesName.displayLayoutType]=r)}return n},Object.defineProperty(e.prototype,"fieldConfigService",{get:function(){return f.P.getInstance()},enumerable:!1,configurable:!0}),e}(),m=g},197781:function(e,t,n){var i=n(839461),o=n(495155),r=n(87363),a=n.n(r),s=n(750670),l=n(903021),d=n(259356),c=n(874650),u=n(344695),f=n(137600),h=n(252783),p=n(187846),g=n(974238),m=function(){function e(){this.floatSchema=new Map,this.fieldSearchService=new g.Z}var t,n,r;return e.prototype.handFieldSchema=function(e,t){var n,o=e.floatToolbarSchema,r=e.name,a=e.subtype,s=a?"".concat(r,"-").concat(a):r,l=this.floatSchema.get(s),d=!!l;if(o){var c=!t&&d?(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(l),!1),(0,i.__read)(o),!1):o;this.floatSchema.set(s,c),this.toolbarService.mergeSchemaWithoutUpdate(((n={})[s]={data:c},n))}else d&&t&&this.floatSchema.delete(s)},e.prototype.updateFloatToolbarSchema=function(e,t){var n=e;t&&this.floatSchema.has("".concat(e,"-").concat(t))&&(n="".concat(e,"-").concat(t)),this.stateManager.upsert(h.Dm,n)},e.prototype.showFloatToolbar=function(e,t){var n,r=this,d=e.layoutBox,c=e.position,u=e.toolbarHeight,f=e.onMouseEnterToolbar,g=e.onMouseLeaveToolbar,m=this.fieldSearchService.getFieldByBox(d,t);if(m){var v=(0,p.Ie)(t,d,m);(null===(n=this.floatToolbarFieldInfo)||void 0===n?void 0:n.key)!==v&&(this.updateFloatToolbarSchema(m.fieldCode.name,m.fieldCode.switches[s.FieldCommonSwitchesName.subtype]),this.hideFloatToolbar(t),this.floatToolbarShowFieldInfo=(0,i.__assign)((0,i.__assign)({},m),{layoutBox:d,key:v}),t.createRangeManager(!1).insertRange(v,m.fieldRange));var y=null!=c?c:(0,p.Cj)(t,d,u,m.layoutType===s.FieldLayoutType.Text?m.fieldRange:void 0),_=this.stateManager.getValue(h.Dm);return this.widgetService.embed({name:h.Dm,component:a().createElement(l.o,{schemaKey:_,placement:"top",position:y,onMouseEnter:f,onMouseLeave:g,onOutsideClick:function(){return r.hideFloatToolbar(t)}})}),t.on(s.StateNotification.ModelChange,(function(){r.floatToolbarFieldInfo&&r.hideFloatToolbar(t)})),t.on(s.RenderNotificationTypes.TABLE_DID_SCROLL,(function(e){var n=e.gcp;if(r.floatToolbarShowFieldInfo&&!1!==r.floatToolbarShowFieldInfo.isInTable){var i=r.floatToolbarShowFieldInfo,o=i.fieldRange,a=i.isInTable;if(void 0===a){var s=t.service.getDocument().getTableFromGcp(n),l=null==s?void 0:s.getRange().contains(o.begin());if(r.floatToolbarShowFieldInfo.isInTable=a,!l)return}r.hideFloatToolbar(t)}})),o.Logger.info("[FIELD TOOLBAR]显示域的工具栏",v,m.fieldRange),v}o.Logger.error("[FIELD TOOLBAR] 当前无法对应区间展示域工具栏，请传入正确区间")},Object.defineProperty(e.prototype,"floatToolbarFieldInfo",{get:function(){return this.floatToolbarShowFieldInfo},enumerable:!1,configurable:!0}),e.prototype.hideFloatToolbar=function(e,t){var n;t&&t!==(null===(n=this.floatToolbarFieldInfo)||void 0===n?void 0:n.key)||(this.floatToolbarShowFieldInfo=void 0,this.widgetService.remove(h.Dm,"embed"),e.removeListener(s.RenderNotificationTypes.SELECTION_END,this),e.removeListener(s.RenderNotificationTypes.TABLE_DID_SCROLL,this),o.Logger.info("[FIELD TOOLBAR]隐藏域的工具栏",t))},e.prototype.shouldShowFieldFloatToolbarByRange=function(e,t){var n,i,o,r,a,l,d,c=null!==(o=null===(i=this.floatToolbarFieldInfo)||void 0===i?void 0:i.fieldRange)&&void 0!==o?o:{},u=c.gcpBegin,f=c.len,h=null===(a=null===(r=this.floatToolbarFieldInfo)||void 0===r?void 0:r.fieldCode.switches)||void 0===a?void 0:a[s.FieldCommonSwitchesName.displayLayoutType];if(!this.floatToolbarFieldInfo){var p=this.fieldSearchService.getFieldByPoint(t,e.begin());u=(n=null!==(l=null==p?void 0:p.fieldRange)&&void 0!==l?l:{}).gcpBegin,f=n.len,h=null==p?void 0:p.displayLayoutType}if(void 0===u||void 0===f)return!1;if((null===(d=this.floatToolbarFieldInfo)||void 0===d?void 0:d.fieldCode.name)===s.FieldName.TOC){var g=t.service.getDocument().getSdts().getSdtInfo(u);if("Table of Contents"===(null==g?void 0:g.property.sdtPr.readOnly((function(){return g.property.sdtPr.docPartObj.docPartGallery.val}))))return!0}var m=u+f,v=e.gcpBegin,y=e.len,_=v+y;return!y&&v<=m&&v>=u||!(_<=u||v>=m)&&!!(v>u&&_<m&&h&&h!==s.FieldDisplayLayoutTypeChar.Text)},(0,i.__decorate)([(0,d.tB)(),(0,i.__metadata)("design:type","function"==typeof(t=void 0!==c.O&&c.O)?t:Object)],e.prototype,"toolbarService",void 0),(0,i.__decorate)([(0,d.tB)(),(0,i.__metadata)("design:type","function"==typeof(n=void 0!==u.i&&u.i)?n:Object)],e.prototype,"widgetService",void 0),(0,i.__decorate)([(0,d.tB)(),(0,i.__metadata)("design:type","function"==typeof(r=void 0!==f.O&&f.O)?r:Object)],e.prototype,"stateManager",void 0),e}();t.Z=m},974238:function(e,t,n){var i=n(839461),o=n(750670),r=n(131636),a=n(285416),s=function(){function e(){this.fieldDataService=new a.Z}var t,n,s,l,d,c,u,f,h,p,g,m,v,y,_;return e.prototype.getFieldRangeByPoint=function(e,t,n){var i=e.service.getDocument().getRange(t,t,{fixRange:!1}).getFieldRanges(n);return i.length?i[0]:null},e.prototype.getFieldProperty=function(e,t,n){return e.service.getDocument().getRange(t,t,{fixRange:!1}).getFieldProperty(t,n)},e.prototype.getFieldByRange=function(e,t,n){var o=this;void 0===n&&(n=1);var r=null!=t?t:e.service.getSelection().range(),a=r.begin(),s=r.len,l=e.service.getDocument().getRange(a,a+s,{fixRange:!1});if(0===r.len){var d=this.getFieldByPoint(e,a,n);return d?[d]:[]}return l.getDecodedFieldInfos(n).map((function(e){return(0,i.__assign)((0,i.__assign)({},e),{fieldCode:(0,i.__assign)((0,i.__assign)({},o.fieldDataService.parseFieldCode(e.fieldCode)),{range:e.fieldCode.range})})}))},e.prototype.getFieldByPoint=function(e,t,n){var o=e.service.getDocument().getRange(t,t,{fixRange:!1}).getDecodedFieldInfo(t,n);return o?(0,i.__assign)((0,i.__assign)({},o),{fieldCode:(0,i.__assign)((0,i.__assign)({},this.fieldDataService.parseFieldCode(o.fieldCode)),{range:o.fieldCode.range})}):null},e.prototype.getFieldByBox=function(e,t){var n=e.fieldInfo;if(n)return(0,i.__assign)((0,i.__assign)({},n),{fieldCode:(0,i.__assign)((0,i.__assign)({},this.fieldDataService.parseFieldCode(n.fieldCode)),{range:n.fieldCode.range})});var o=e.getRange();return this.getFieldByPoint(t,o.begin())},e.prototype.getFieldByKey=function(e,t,n){void 0===n&&(n=1);var i=new o.GCPRange(0,t.service.getDocument().getDocumentLength()),r=this.getFieldByRange(t,i,n),a=null;return r.some((function(t){var n=t.fieldCode.switches[o.FieldCommonSwitchesName.key];return e===n&&(a=t,!0)})),a},e.prototype.getFieldList=function(e,t,n){var i=new o.GCPRange(0,e.service.getDocument().getDocumentLength()),r=this.getFieldByRange(e,i,n);if(void 0===n){var a=2,s=[];do{s=this.getFieldByRange(e,i,a),r=r.concat(s),a+=1}while(s.length)}return t.size?r.reduce((function(e,n){var i=n.fieldCode,r=i.name,a=i.switches,s=t.get(r);if(s){if(s.length){var l=a[o.FieldCommonSwitchesName.subtype];return l&&s.includes(l)?e.concat(n):e}return e.concat(n)}return e}),[]):r},e.prototype.findField=function(e,t,n){for(var o=n?e.service.getDocument().getRange(n.begin(),n.end(),{fixRange:!1}).getFields():e.service.getDocument().getFields(),r=o.next();r&&!r.done;){var a=r.value.getFieldInfo(),s=(0,i.__assign)((0,i.__assign)({},a),{fieldCode:(0,i.__assign)((0,i.__assign)({},this.fieldDataService.parseFieldCode(a.fieldCode)),{range:a.fieldCode.range})});if(t(s))return s;r=o.next()}return null},(0,i.__decorate)([(0,r.p)(null),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(t=void 0!==o.MeloEditor&&o.MeloEditor)?t:Object,"function"==typeof(n=void 0!==o.CP_Type&&o.CP_Type)?n:Object,Number]),(0,i.__metadata)("design:returntype",Object)],e.prototype,"getFieldRangeByPoint",null),(0,i.__decorate)([(0,r.p)(null),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(s=void 0!==o.MeloEditor&&o.MeloEditor)?s:Object,"function"==typeof(l=void 0!==o.CP_Type&&o.CP_Type)?l:Object,Number]),(0,i.__metadata)("design:returntype",Object)],e.prototype,"getFieldProperty",null),(0,i.__decorate)([(0,r.p)([]),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(d=void 0!==o.MeloEditor&&o.MeloEditor)?d:Object,"function"==typeof(c=void 0!==o.GCPRange&&o.GCPRange)?c:Object,Object]),(0,i.__metadata)("design:returntype",Array)],e.prototype,"getFieldByRange",null),(0,i.__decorate)([(0,r.p)(null),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(u=void 0!==o.MeloEditor&&o.MeloEditor)?u:Object,"function"==typeof(f=void 0!==o.CP_Type&&o.CP_Type)?f:Object,Number]),(0,i.__metadata)("design:returntype",Object)],e.prototype,"getFieldByPoint",null),(0,i.__decorate)([(0,r.p)(null),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(h=void 0!==o.IBoxCommon&&o.IBoxCommon)?h:Object,"function"==typeof(p=void 0!==o.MeloEditor&&o.MeloEditor)?p:Object]),(0,i.__metadata)("design:returntype",Object)],e.prototype,"getFieldByBox",null),(0,i.__decorate)([(0,r.p)(null),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[String,"function"==typeof(g=void 0!==o.MeloEditor&&o.MeloEditor)?g:Object,Object]),(0,i.__metadata)("design:returntype",Object)],e.prototype,"getFieldByKey",null),(0,i.__decorate)([(0,r.p)([]),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(m=void 0!==o.MeloEditor&&o.MeloEditor)?m:Object,"function"==typeof(v="undefined"!=typeof Map&&Map)?v:Object,Number]),(0,i.__metadata)("design:returntype",Array)],e.prototype,"getFieldList",null),(0,i.__decorate)([(0,r.p)(null),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",["function"==typeof(y=void 0!==o.MeloEditor&&o.MeloEditor)?y:Object,Function,"function"==typeof(_=void 0!==o.GCPRange&&o.GCPRange)?_:Object]),(0,i.__metadata)("design:returntype",Object)],e.prototype,"findField",null),e}();t.Z=s},339106:function(e,t,n){n.d(t,{D:function(){return h}});var i=n(839461),o=n(750670),r=n(826973),a=n(45972),s=n(228593),l=n(197781),d=n(974238),c=n(285416),u=n(849678),f=n(495155),h=function(){function e(e){var t=this;this.contextService=e,this.getFieldPropertyByPoint=function(e,n,i){return t.fieldSearchService.getFieldProperty(e,n,i)},this.getFieldByPoint=function(e,n,i){return t.fieldSearchService.getFieldByPoint(e,n,i)},this.fieldFloatToolbarService=new l.Z,this.fieldSearchService=new d.Z,this.fieldDataService=new c.Z,this.fieldConfigService=u.P.getInstance()}var t;return e.prototype.convertToFieldCodeInfo=function(e){return o.FieldUtil.getFieldCodeInfoByFieldInfo(e)},Object.defineProperty(e.prototype,"editor",{get:function(){return this.contextService.context.editor},enumerable:!1,configurable:!0}),e.prototype.getFieldHookConfig=function(e,t){return this.fieldConfigService.getFieldHookConfig(e,t)},e.prototype.addFieldRenderConfig=function(e,t){void 0===t&&(t=!1),this.fieldConfigService.upsertFieldRenderConfig(e,t)},e.prototype.addFieldInteractiveConfig=function(e,t){void 0===t&&(t=!1),this.fieldConfigService.upsertFieldHookConfig(e,t),this.fieldFloatToolbarService.handFieldSchema(e,t)},e.prototype.getRangeByGcpRange=function(e){var t=null!=e?e:this.editor.service.getSelection().range();return this.editor.service.getDocument().getRange(t.begin(),t.end())},e.prototype.insertField=function(e,t){void 0===t&&(t={});var n=this.fieldDataService.encodeField(e,{fixFieldKey:t.fixFieldKey}),o=n.fieldCode,r=n.fieldResult,a=n.key;return this.getRangeByGcpRange(e.fieldRange).insertField(o,r,(0,i.__assign)({},t)),a},e.prototype.insertFieldByStep=function(e,t){var n;return(0,i.__awaiter)(this,void 0,void 0,(function(){var o,r,a,s,l,d,c,u,f,h,p=this;return(0,i.__generator)(this,(function(i){switch(i.label){case 0:return o=this.editor.service,r=this.fieldDataService.encodeField(e),a=r.fieldCode,s=r.fieldResult,l=r.key,d=null!==(n=e.fieldRange)&&void 0!==n?n:o.getSelection().range(),c=this.editor.service.getDocument().getRange(d.begin(),d.end()),u=l,f=function(e){var t=p.fieldDataService.encodeField(e),n=t.fieldCode,i=t.fieldResult,r=t.key;c.insertFieldFinish(n,i,u),u=r;var a=o.getSelection().nextTextBreak(d.begin(),{skipField:!0});o.getSelection().setRange(a,a,{forceNotify:!0})},h=function(){c.insertFieldCancel(u)},c.insertFieldStart(a,s,u),[4,t(h,f)];case 1:return i.sent(),[2,u]}}))}))},e.prototype.insertFieldList=function(e,t){var n=this,i=[],o=e.map((function(e){var t=e.config,o=e.options,r=void 0===o?{}:o,a=n.fieldDataService.encodeField(t,{fixFieldKey:r.fixFieldKey}),s=a.fieldCode,l=a.fieldResult,d=a.key;return i.push(d),{fieldCode:s,fieldResult:l,options:r}}));return this.getRangeByGcpRange(t).insertFields(o),i},e.prototype.insertFieldStart=function(e){var t=this.fieldDataService.encodeField(e),n=t.fieldCode,i=t.fieldResult,o=t.key;return this.getRangeByGcpRange(e.fieldRange).insertFieldStart(n,i,o),o},e.prototype.insertFieldFinish=function(e,t){var n=this.fieldDataService.encodeField(t),i=n.fieldCode,o=n.fieldResult;this.getRangeByGcpRange(t.fieldRange).insertFieldFinish(i,o,e)},e.prototype.insertFieldCancel=function(e){this.getRangeByGcpRange().insertFieldCancel(e)},e.prototype.deleteField=function(e,t,n){var i,o,r,a=this;void 0===t&&(t=this.editor);var s=e.begin(),l=e.end(),d=null!==(i=this.fieldSearchService.getFieldByPoint(t,s))&&void 0!==i?i:{},c=d.fieldRange,u=d.nestingLevel,h=void 0===u?1:u,p=null!==(o=this.fieldSearchService.getFieldByPoint(t,l))&&void 0!==o?o:{},g=p.fieldRange,m=p.nestingLevel,v=void 0===m?1:m,y=Math.min(v,h);if(c&&g){if(c.contains(g.begin()))return t.onSelection().delete(c,n),!0;if(g.contains(c.begin()))return t.onSelection().delete(g,n),!0;for(var _=v>h?c.end()+1:g.begin()-1,R=v>h?g.begin():c.begin();1!==y;){var b=null!==(r=this.fieldSearchService.getFieldByPoint(t,_))&&void 0!==r?r:{},F=b.fieldRange,S=b.nestingLevel,E=void 0===S?1:S;if(!F||!E){f.Logger.info("[DELETE FIELD]: ".concat(s,"-").concat(l," error")),y=1;break}if(F.contains(R))return t.onSelection().delete(c,n),!0;y=Math.min(y,E),_=F.begin()-1}}else y=1;var T=this.fieldSearchService.getFieldByRange(this.editor,e,y).reverse();return T.map((function(e){var t=e.fieldRange;a.editor.onSelection().delete(t,n)})),T.length>0},e.prototype.updateField=function(e,t){var n,i=e;!1!==(null==t?void 0:t.fixFieldKey)&&this.editor.isTrackRevisions()&&(null===(n=i.fieldCode.switches)||void 0===n?void 0:n[o.FieldCommonSwitchesName.key])&&(i.fieldCode.switches[o.FieldCommonSwitchesName.key]=f.StringUtil.generateRandomId());var r=this.fieldDataService.encodeField(e,{fixFieldKey:null==t?void 0:t.fixFieldKey}),a=r.fieldCode,s=r.fieldResult;return this.getRangeByGcpRange(e.fieldRange).updateField(a,s,t),!0},e.prototype.fieldIncludeRevision=function(e){return!!e.fieldRange&&this.editor.service.getRevision().rangeIncludeTextRevision(e.fieldRange)},e.prototype.getFieldRangeByPoint=function(e,t,n){return this.fieldSearchService.getFieldRangeByPoint(e,t,n)},e.prototype.getFieldByRange=function(e,t,n){return void 0===t&&(t=this.editor),void 0===n&&(n=1),this.fieldSearchService.getFieldByRange(t,e,n)},e.prototype.decodeField=function(e,t,n){return void 0===t&&(t=this.editor),void 0===n&&(n=1),this.getFieldByRange(e,t,n)[0]},e.prototype.encodeField=function(e,t){return this.fieldDataService.encodeField(e,t)},e.prototype.decodeFieldCode=function(e){return this.fieldDataService.decodeFieldCode(e)},e.prototype.getFieldByKey=function(e,t,n){return void 0===t&&(t=this.editor),void 0===n&&(n=1),this.fieldSearchService.getFieldByKey(e,t,n)},e.prototype.getFieldList=function(e,t,n){void 0===t&&(t=this.editor),void 0===n&&(n=1);var i=new Map;return e&&(Array.isArray(e)?e:[e]).map((function(e){var t,n=e.name,o=e.subtype,r=(null!==(t=i.get(n))&&void 0!==t?t:[]).concat(null!=o?o:[]);i.set(n,r)})),this.fieldSearchService.getFieldList(t,i,n)},e.prototype.findField=function(e,t,n){return this.fieldSearchService.findField(e,t,n)},e.prototype.getFieldByBox=function(e,t){return void 0===t&&(t=this.editor),this.fieldSearchService.getFieldByBox(e,t)},e.prototype.showFloatToolbar=function(e,t){void 0===t&&(t=this.editor),this.fieldFloatToolbarService.showFloatToolbar(e,t)},Object.defineProperty(e.prototype,"floatToolbarFieldInfo",{get:function(){return this.fieldFloatToolbarService.floatToolbarFieldInfo},enumerable:!1,configurable:!0}),e.prototype.hideFloatToolbar=function(e){void 0===e&&(e=this.editor),this.fieldFloatToolbarService.hideFloatToolbar(e)},e.prototype.shouldShowFieldFloatToolbarByRange=function(e,t){return void 0===t&&(t=this.editor),this.fieldFloatToolbarService.shouldShowFieldFloatToolbarByRange(e,t)},e.prototype.fieldHideInRevision=function(e){return this.editor.state.dataEngine.getDataManager().getRevisionsManager().isAllContentRevisionHidden(e)},e=(0,i.__decorate)([(0,r.t)({overridable:!1,provide:s.Y}),(0,i.__metadata)("design:paramtypes",["function"==typeof(t=void 0!==a.O&&a.O)?t:Object])],e)}()},228593:function(e,t,n){n.d(t,{Y:function(){return i}});var i=Symbol.for("service:field")},131636:function(e,t,n){n.d(t,{p:function(){return r}});var i=n(839461),o=n(495155);function r(e){return function(t,n,r){var a=r.value;r.value=function(){for(var r,s=[],l=0;l<arguments.length;l++)s[l]=arguments[l];try{return(r=a).call.apply(r,(0,i.__spreadArray)([this],(0,i.__read)(s),!1))}catch(i){return o.Logger.error("【".concat(t.constructor.name," - ").concat(n,"】 error:"),i),e}}}}},783637:function(e,t,n){n.d(t,{o:function(){return F}});var i=n(338104),o=n(87363),r=n.n(o),a=n(183537),s=n(130519),l=n(515238),d=n(949595),c=n(12193),u=n(382582),f=n(442441),h=n(967948),p=n(631141),g=n(378825),m=n(507342),v=n(659689),y=function(){function e(e,t,n,i){var o=this;this.groups=e,this.groupShelter=t,this.listener=n,this.preventAutoShrink=i,this.unsubscribe$=new l.xQ,this.buttonsWidth=new Map,this.totalWidth=new d.X(0),this.calculatedVisible=new Map,this.calculatedWidth=new Map,this.containerWidth=0,this.nextToShrink=[],this.shrinked=[],this.alwaysShrinked=[],this.nextToResize=[],this.resized=[],this.checkVisible=function(e){var t;return null===(t=o.calculatedVisible.get(e.name))||void 0===t||t},this.updateGroups(e)}return e.prototype.updateGroups=function(e){var t=this;this.groups=e,this.calculatedVisible=new Map,this.calculatedWidth=new Map,e.flatMap((function(e){return(0,i.__spreadArray)((0,i.__spreadArray)((0,i.__spreadArray)([e.shelter],(0,i.__read)(e.items.map((function(e){return e.shelter}))),!1),(0,i.__read)(e.items.filter((function(e){return e.key.startsWith("VG_tail_shelter_")})).flatMap((function(e){return e.buttons[0]}))),!1),[{name:v.G}],!1)})).filter(Boolean).forEach((function(e){t.calculatedVisible.set(e.name,!1)})),this.analyzePriority(this.groups),this.container&&this.handleResize(),m.s&&(this.containerWidth=9999,this.deliver({visibleMap:this.calculatedVisible,nextToShrink:this.nextToShrink,shrinked:this.shrinked,maxWidthMap:this.calculatedWidth,nextToResize:this.nextToResize,resized:this.resized}))},e.prototype.analyzePriority=function(e){var t=this,n=[],o=[],r=(0,i.__spreadArray)([],(0,i.__read)(e),!1).reverse().map((function(e,r){var a=0,s=e.items.reduce((function(s,l){var d={names:[],priority:l.priority,shrinkTo:t.getShrinkTo(l,e)},c={buttons:[],priority:l.priority};l.buttons.forEach((function(e){(0,i.__spreadArray)([],(0,i.__read)(e),!1).reverse().forEach((function(e){e.shrinkable&&e.widthRange&&c.buttons.push({name:e.name,widthRange:e.widthRange,shrinkSteps:e.shrinkSteps}),d.names.push(e.name)}))})),d.names.length>0&&!l.forceShrink?s.push(d):d.names.length>0&&l.forceShrink&&o.push(d),l.shelter&&l.shrinkType===p.f.ON_THE_SPOT&&s.push({names:[l.shelter.name],priority:l.priority,shrinkTo:""});var u=Math.ceil(Math.log(l.priority+1)/Math.LN10);return a=Math.max(u,a),c.buttons.length>0&&(c.priority=r+1+c.priority/Math.pow(10,a),n.push(c)),s}),[]).map((function(e){return Object.assign(Object.assign({},e),{priority:r+1+e.priority/Math.pow(10,a)})}));return e.shelter&&s.unshift({names:[e.shelter.name],priority:s[0].priority,shrinkTo:""}),s})).flat().sort((function(e,t){return e.shrinkTo&&!t.shrinkTo?1:!e.shrinkTo&&t.shrinkTo?-1:t.priority-e.priority}));this.nextToShrink=r,this.shrinked=[],this.nextToResize=n.sort((function(e,t){return t.priority-e.priority})),this.resized=[],o.forEach((function(e){e.names.forEach((function(e){t.calculatedVisible.set(e,!1)}));var n=e.shrinkTo||v.G;t.calculatedVisible.set(n,!0)})),this.alwaysShrinked=o},e.prototype.getShrinkTo=function(e,t){var n,i,o,r,a,s;return e.shrinkType===p.f.GROUP_TAIL?null!==(i=null===(n=e.shelter)||void 0===n?void 0:n.name)&&void 0!==i?i:"".concat(t.key,"-tail-shelter"):e.shrinkType===p.f.ON_THE_SPOT?null!==(r=null===(o=e.shelter)||void 0===o?void 0:o.name)&&void 0!==r?r:"":null!==(s=null===(a=t.shelter)||void 0===a?void 0:a.name)&&void 0!==s?s:""},e.prototype.useContainer=function(e){this.container=e,this.startMonitor()},e.prototype.updateWidth=function(e,t){this.buttonsWidth.set(e,t),this.container&&this.handleResize()},e.prototype.withdraw=function(e){this.buttonsWidth.delete(e),this.container&&this.handleResize()},e.prototype.startMonitor=function(){(0,c.R)(window,"resize").pipe((0,f.R)(u.Z)).pipe((0,h.R)(this.unsubscribe$)).subscribe(this.handleResize.bind(this)),this.totalWidth.pipe((0,f.R)(u.Z)).pipe((0,h.R)(this.unsubscribe$)).subscribe(this.calculate.bind(this)),this.handleResize()},e.prototype.handleResize=function(){var e=this.container.getBoundingClientRect().width;this.containerWidth=e;var t=this.getWidth(this.calculatedVisible,this.calculatedWidth);this.totalWidth.next(t)},e.prototype.getWidthDetail=function(e,t,n){var o=this,r=function(t){var n;return null===(n=e.get(t.name))||void 0===n||n},a=function(e,n,i){var r,a=0;return a=t.has(e.name)?t.get(e.name):null!==(r=o.buttonsWidth.get(e.name))&&void 0!==r?r:0,a+=8,0===n&&(a-=4),n===i.length-1&&(a-=4),a};return(null!=n?n:this.groups).map((function(e){return{key:e.key,shelter:e.shelter&&r(e.shelter)?e.shelter:null,items:e.items.map((function(e){return{key:e.key,priority:e.priority,shrinkType:e.shrinkType,shelter:e.shelter&&r(e.shelter)?e.shelter:null,buttons:e.buttons.map((function(e){return e.filter(r)}))}})).filter((function(e){return e.buttons.every((function(e){return e.length>0}))||null!==e.shelter}))}})).filter((function(e){return e.items.length>0||null!==e.shelter})).map((function(e,t,n){t===n.length-1&&r({name:v.G})&&e.items.push(o.groupShelter);var s=e.shelter?a(e.shelter,0,[e.shelter]):0;if(e.items.every((function(e){return 1===e.buttons.length}))){var l=!1;return e.items.reduce((function(e,t){var n=e[e.length-1];if(l||!n||t.shelter){var o=Object.assign(Object.assign({},t),{buttons:t.buttons.map((function(e){return(0,i.__spreadArray)([],(0,i.__read)(e),!1)}))});e.push(o),t.shelter&&(o.buttons[0]=t.buttons[0].concat(t.shelter))}else n.buttons[0]=n.buttons[0].concat(t.buttons[0]);return l=!!t.shelter,e}),[]).map((function(e){return e.buttons[0].map(a)})).concat([[s]])}return e.items.flatMap((function(e){var t=e.buttons.map((function(e){return e.map(a)}));return e.shelter&&e.shrinkType===p.f.ON_THE_SPOT?[t,a(e.shelter,0,[e.shelter])]:[t]})).concat([s])})).flatMap((function(e,t,n){var r;return(0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(e),!1),[t!==n.length-1&&null!==(r=o.buttonsWidth.get("toolbar-group-divider-".concat(t)))&&void 0!==r?r:0],!1)})).filter((function(e){return Array.isArray(e)&&!(0,g.mx)(e)?0!==e.reduce((function(e,t){return e+t}),0):!Array.isArray(e)||!(0,g.mx)(e)||e.every((function(e){return 0!==e.reduce((function(e,t){return e+t}),0)}))}))},e.prototype.getWidthByDetails=function(e){return e.reduce((function(e,t,n){return Array.isArray(t)?(0,g.mx)(t)?e+Math.max.apply(Math,(0,i.__spreadArray)([],(0,i.__read)(t.map((function(e){return e.reduce((function(e,t){return e+t}),0)}))),!1))+(0===n?4:8):e+t.reduce((function(e,t){return e+t}),0)+(0===n?4:8):e+t}),0)},e.prototype.getWidth=function(e,t,n){var i=this.getWidthDetail(e,t,n);return this.getWidthByDetails(i)},e.prototype.calculate=function(e){var t={visibleMap:this.calculatedVisible,nextToShrink:this.nextToShrink,shrinked:this.shrinked,maxWidthMap:this.calculatedWidth,nextToResize:this.nextToResize,resized:this.resized};if(this.preventAutoShrink)this.deliver(t);else if(0===this.containerWidth||this.containerWidth>=e){var n=this.expand(t);this.deliver(n)}else{var i=this.shrink(t);this.deliver(i)}},e.prototype.cloneParams=function(e){var t=e.visibleMap,n=e.nextToShrink,o=e.shrinked,r=e.maxWidthMap,a=e.nextToResize,s=e.resized;return{visibleMap:new Map(t),nextToShrink:(0,i.__spreadArray)([],(0,i.__read)(n),!1),shrinked:(0,i.__spreadArray)([],(0,i.__read)(o),!1),maxWidthMap:new Map(r),nextToResize:(0,i.__spreadArray)([],(0,i.__read)(a),!1),resized:(0,i.__spreadArray)([],(0,i.__read)(s),!1)}},e.prototype.expand=function(e){var t=this,n=this.cloneParams(e),o=n.visibleMap,r=n.nextToShrink,a=n.shrinked,s=n.maxWidthMap,l=n.nextToResize,d=n.resized;if(0===a.length&&d.length>0){var c=d[d.length-1];return c.buttons.map((function(e){var n,o,r,a=e.name,l=e.widthRange,d=e.shrinkSteps,c=null!==(o=null!==(n=s.get(a))&&void 0!==n?n:t.buttonsWidth.get(a))&&void 0!==o?o:0,u=c;return u=d?null!==(r=(0,i.__spreadArray)((0,i.__spreadArray)([l[0]],(0,i.__read)(d),!1),[l[1]],!1).find((function(e){return e>c})))&&void 0!==r?r:l[1]:Math.min(c+1,l[1]),s.set(a,u),{nextWidth:u,widthRange:l}})).every((function(e){return e.nextWidth===e.widthRange[1]}))&&(l.push(c),d.pop()),this.getWidth(o,s)<this.containerWidth?this.expand(n):e}if(0===a.length)return e;for(var u=[],f=a.pop();f;){u.push(f);var h=f.shrinkTo,p=f.priority,g=a[a.length-1];f=h&&g&&h===g.shrinkTo&&g.priority===p?a.pop():h||-1===f.names[0].indexOf("tail-shelter")?void 0:a.pop()}return r.push.apply(r,(0,i.__spreadArray)([],(0,i.__read)(u),!1)),u.forEach((function(e){var t=e.names,n=e.shrinkTo;t.forEach((function(e){o.set(e,!0)}));var i=a.some((function(e){return e.shrinkTo===n})),r=n||v.G;o.set(r,i)})),this.getWidth(o,s)<this.containerWidth?this.expand(n):e},e.prototype.shrink=function(e){var t,n=this,o=this.cloneParams(e),r=o.visibleMap,a=o.nextToShrink,s=o.shrinked,l=o.maxWidthMap,d=o.nextToResize,c=o.resized;if(d.length>0){var u=d[d.length-1],f=u.buttons.map((function(e){var t,o,r,a=e.name,s=e.widthRange,d=e.shrinkSteps,c=null!==(o=null!==(t=l.get(a))&&void 0!==t?t:n.buttonsWidth.get(a))&&void 0!==o?o:0,u=c;return u=d?null!==(r=(0,i.__spreadArray)((0,i.__spreadArray)([s[0]],(0,i.__read)(d),!1),[s[1]],!1).reverse().find((function(e){return c>e})))&&void 0!==r?r:s[0]:Math.max(c-1,s[0]),l.set(a,u),{nextWidth:u,widthRange:s}})).every((function(e){return e.nextWidth===e.widthRange[0]}));u!==c[c.length-1]&&c.push(u),f&&d.pop();var h=this.getWidth(r,l);return this.containerWidth<h?this.shrink(o):o}if(1===a.length)return e;for(var p=[],g=a.pop();g;){p.push(g);var m=g.shrinkTo,y=g.priority,_=a[a.length-1];g=m&&_&&m===_.shrinkTo&&_.priority===y?a.pop():m||-1===(null==_?void 0:_.names[0].indexOf("tail-shelter"))?void 0:a.pop()}s.push.apply(s,(0,i.__spreadArray)([],(0,i.__read)(p),!1)),p.forEach((function(e){e.names.forEach((function(e){r.set(e,!1)}))}));var R=(null===(t=p[0])||void 0===t?void 0:t.shrinkTo)||v.G;r.set(R,!0);var b=this.getWidth(r,l);return this.containerWidth<b?this.shrink(o):o},e.prototype.deliver=function(e){var t,n=this,i=e.visibleMap,o=e.nextToShrink,r=e.shrinked,a=e.maxWidthMap,s=e.nextToResize,l=e.resized;this.calculatedVisible=i,this.nextToShrink=o,this.shrinked=r,this.calculatedWidth=a,this.nextToResize=s,this.resized=l;var d=this.groups.map((function(e){var t=e.items.map((function(e){var t=e.buttons.map((function(e){return e.filter(n.checkVisible).map((function(e){var t=n.calculatedWidth.get(e.name);return Object.assign(Object.assign({},e),{maxWidth:t})}))})).filter((function(e){return e.length>0}));return e.shelter&&n.checkVisible(e.shelter)?[Object.assign(Object.assign({},e),{buttons:t,shelter:null}),{key:"virtual-group-shelter-".concat(e.key),shelter:null,priority:e.priority,buttons:[[e.shelter]]}]:[Object.assign(Object.assign({},e),{buttons:t})]})).flat().filter((function(e){return e.buttons.length>0}));return e.shelter&&n.checkVisible(e.shelter)&&t.push({key:"group-shelter-".concat(e.key),shelter:null,priority:999,buttons:[[e.shelter]]}),{key:e.key,shelter:null,items:t}})).filter((function(e){return e.items.length>0}));this.checkVisible({name:v.G})&&d.length>0&&d[d.length-1].items.push(this.groupShelter);var c=this.getWidth(this.calculatedVisible,this.calculatedWidth);null===(t=this.listener)||void 0===t||t.call(this,{groups:d,totalWidth:c,containerWidth:this.containerWidth})},e.prototype.getShrinkedGroups=function(e){var t=this,n=e===v.G?"":e,o={},r=this.alwaysShrinked.concat(this.shrinked).map((function(e){var t;return e.shrinkTo!==n&&(o[e.shrinkTo]?(t=o[e.shrinkTo]).push.apply(t,(0,i.__spreadArray)([],(0,i.__read)(e.names),!1)):o[e.shrinkTo]=(0,i.__spreadArray)([],(0,i.__read)(e.names),!1)),e})).filter((function(e){return e.shrinkTo===n})).flatMap((function(e){return o[e.names[0]]?o[e.names[0]]:e.names})),a=function(e){return-1!==r.indexOf(e.name)},s=this.groups.map((function(e){var n=e.items.map((function(e){return{buttons:e.buttons.map((function(e){return e.filter(a).map((function(e){var n=t.calculatedWidth.get(e.name);return Object.assign(Object.assign({},e),{maxWidth:n})}))})).filter((function(e){return e.length>0})),key:e.key,shelter:null,priority:e.priority}})).filter((function(e){return e.buttons.length>0}));return{key:e.key,shelter:null,items:n}})).filter((function(e){return e.items.length>0})),l=this.getWidthDetail(new Map([[v.G,!1]]),this.calculatedWidth,s);return{groups:s,width:l,totalWidth:this.getWidthByDetails(l)}},e.prototype.destroy=function(){this.unsubscribe$.next(),this.unsubscribe$.complete()},e}(),_=n(448147),R=n(965430),b=n(682572),F=function(e){function t(t){var n,i=e.call(this,t)||this;return i.container=r().createRef(),i.willBeFocusdByMouseEvent=!1,i.willBeBluredByDropdownClose=!1,i.willBeBluredByDropdownOpen=!1,i.flatButtons=[],i.dropdownRefs=new Map,i.getShrinkedGroups=function(e){return i.shrinkManager.getShrinkedGroups(e)},i.isSplitButton=function(e){var t=e.dropdownContent,n=e.onClick,i=e.hasArrow;return t&&n.hasRaw&&!1!==i},i.moveToLeft=function(){var e=i.state,t=e.focusIndex,n=e.focusOnArrow,o=i.flatButtons.length;if(n)i.setState({focusOnArrow:!1});else{var r=0===t?o-1:t-1,a=i.flatButtons[r];i.isSplitButton(a)&&i.setState({focusOnArrow:!0}),i.setState({focusIndex:r})}},i.moveToRight=function(){var e=i.state,t=e.focusIndex,n=e.focusOnArrow,o=t===i.flatButtons.length-1?0:t+1;if(n)i.setState({focusOnArrow:!1,focusIndex:o});else{var r=i.flatButtons[t];i.isSplitButton(r)?i.setState({focusOnArrow:!0}):i.setState({focusIndex:o,focusOnArrow:!1})}},i.handleAction=function(e){var t,n,o,r,a,s;void 0===e&&(e=!1);var l=i.state,d=l.focusIndex,c=l.focusOnArrow,u=i.flatButtons[d];return i.isSplitButton(u)&&c?(i.willBeBluredByDropdownOpen=!0,void(null===(t=i.dropdownRefs.get(u.name))||void 0===t||t.show())):i.isSplitButton(u)?void(e&&(null===(o=(n=i.flatButtons[d]).onClick)||void 0===o||o.call(n))):u.dropdownContent?(i.willBeBluredByDropdownOpen=!0,void(null===(r=i.dropdownRefs.get(u.name))||void 0===r||r.show())):void(e&&(null===(s=(a=i.flatButtons[d]).onClick)||void 0===s||s.call(a)))},i.handleCancel=function(e){var t,n;void 0===e&&(e=!1);var o=i.state.focusIndex,r=i.flatButtons[o];if(null===(t=i.dropdownRefs.get(r.name))||void 0===t?void 0:t.isVisible())return i.willBeBluredByDropdownClose=!0,void(null===(n=i.dropdownRefs.get(r.name))||void 0===n||n.hide());e&&i.setState({focusIndex:-1,focusOnArrow:!1})},i.handleKeyDown=function(e){-1!==i.state.focusIndex&&("ArrowLeft"!==e.key?"ArrowRight"!==e.key?"Escape"!==e.key?["Enter"," "].includes(e.key)?i.handleAction(!0):"ArrowDown"!==e.key||i.handleAction():i.handleCancel(!0):i.moveToRight():i.moveToLeft())},i.state={groups:[],focusIndex:-1,focusOnArrow:!1},i.shrinkManager=new y(t.groups,(void 0===(n={text:t.multirows?t.moreText:void 0,tooltip:t.moreTooltip})&&(n={}),{key:"overall-shelter",priority:1/0,shelter:null,buttons:[[Object.assign(Object.assign({name:v.G,badge:!1,icon:b.k,hasArrow:!1,force:0},n),{dropdownContent:(0,R.N)(v.G)})]]}),(function(e){i.setState(Object.assign(Object.assign({},e),{focusIndex:-1,focusOnArrow:!1}))}),i.props.preventAutoShrink),i}return(0,i.__extends)(t,e),t.prototype.UNSAFE_componentWillReceiveProps=function(e){this.shrinkManager.updateGroups(e.groups)},t.prototype.componentDidMount=function(){this.container.current&&this.shrinkManager.useContainer(this.container.current)},t.prototype.componentWillUnmount=function(){this.shrinkManager.destroy()},t.prototype.render=function(){var e=this,t=this.props,n=t.groups,i=t.multirows,o=t.moreText,l=t.label,d=t.pinned,c=t.style,u=void 0===c?{}:c,f=t.className,h=t.tooltipPlacement,p=this.state,g=p.groups,v=p.focusIndex,y=p.focusOnArrow;return this.flatButtons=(d?n:g).flatMap((function(e){return e.items})).flatMap((function(e){return e.buttons})).flat().map((function(e){return e.isFocus=!1,e.isFocusArrow=!1,e})),-1!==v&&(this.flatButtons[v].isFocus=!0,this.flatButtons[v].isFocusArrow=y),r().createElement("div",{ref:this.container,style:Object.assign({position:"relative"},u),tabIndex:0,role:"toolbar","aria-label":l,onMouseDown:function(){e.willBeFocusdByMouseEvent=!0},onKeyDown:this.handleKeyDown,onFocus:function(t){e.willBeFocusdByMouseEvent?e.willBeFocusdByMouseEvent=!1:t.target===t.currentTarget&&-1===v&&e.flatButtons.length>0&&e.setState({focusIndex:0})},onBlur:function(){e.willBeBluredByDropdownOpen?e.willBeBluredByDropdownOpen=!1:e.willBeBluredByDropdownClose?e.willBeBluredByDropdownClose=!1:-1!==v&&e.setState({focusIndex:-1})}},!d&&!m.s&&r().createElement(s.h.Provider,{value:{multirows:i,getShrinkedGroups:this.getShrinkedGroups,shrinkManager:this.shrinkManager}},r().createElement("div",{className:[a.Z.container,a.Z.hidden,f].join(" "),"aria-hidden":!0},r().createElement(_.V,{groups:n,addShelter:!0,moreText:i?o:void 0,tooltipPlacement:h}))),r().createElement(s.h.Provider,{value:{multirows:i,getShrinkedGroups:this.getShrinkedGroups,dropdownRefs:this.dropdownRefs}},r().createElement("div",{className:[a.Z.container,f].join(" ")},r().createElement(_.V,{groups:d?n:g,focusIndex:v,focusOnArrow:y,tooltipPlacement:h}))))},t}(o.PureComponent)},903021:function(e,t,n){n.d(t,{o:function(){return h}});var i=n(87363),o=n.n(i),r=n(996391),a=n(725771),s=n(678464),l="float-toolbar_container__zdDax";(0,s.Z)(".float-toolbar_container__zdDax {\n  padding: 8px 12px;\n  box-sizing: border-box;\n  transition: box-shadow 0.3s ease-in-out, background 0.3s ease;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n          user-select: none;\n  background: var(--workbench-theme-toolbar-background, #f9fafb);\n  pointer-events: auto;\n  box-shadow: 0 2px 8px 0 rgba(68, 73, 77, 0.16);\n  border-radius: 4px;\n  width: auto;\n}\n");var d=n(973684),c=n(338104),u=n(249607),f=n(783637),h=(0,a.x)([r.j.Badge,r.j.ModelState])(o().memo((function(e){var t=function(e){var t=(0,c.__read)((0,i.useState)(!1),2),n=t[0],o=t[1],r=e.onOutsideClick;return(0,i.useEffect)((function(){var e=function(){n||null==r||r()};return document.addEventListener("click",e,!0),function(){document.removeEventListener("click",e,!0)}}),[n,r]),{onMouseEnter:function(){o(!0)},onMouseLeave:function(){o(!1)}}}(e),n=t.onMouseEnter,r=t.onMouseLeave,a=(0,d.p)(e.schemaKey,{data:[]}),s=u.O.getToolbarProps(a,e.badge),h=!!s.length,p=e.position,g=void 0===p?{left:0,top:0}:p,m=e.visible,v=void 0===m||m,y=function(t){var i;n(),null===(i=e.onMouseEnter)||void 0===i||i.call(e,t)},_=function(t){var n;r(),null===(n=e.onMouseLeave)||void 0===n||n.call(e,t)};return o().createElement("div",{style:{display:h&&v?"flex":"none",position:"absolute",width:"100%",top:g.top,pointerEvents:"none"},onMouseEnter:y,onMouseLeave:_},o().createElement("div",{style:{flexShrink:1,width:g.left}}),o().createElement("div",{className:l},o().createElement(f.o,{groups:s,preventAutoShrink:!0})),o().createElement("div",{style:{flexGrow:1,flexShrink:1}}))})))},249607:function(e,t,n){n.d(t,{O:function(){return l}});var i=n(259356),o=n(996965),r=n(616140),a=n(874650),s=n(965430),l=function(){function e(){}return e.getButtonProps=function(e,t,n,i){void 0===i&&(i=!1);var o=n(e.shouldHide,!1);if(o)return null;var a=Object.assign(Object.assign({},e),{badge:t.includes(e.name),force:0,icon:n(e.icon,""),tooltip:n(e.tooltip,""),text:n(e.text,""),content:n(e.content,void 0),color:n(e.color,""),hide:o,disabled:n(e.shouldDisabled,!1),checked:n(e.shouldCheck,!1),style:n(e.style,void 0),hasArrow:n(e.hasArrow,void 0),outlineType:n(e.outlineType,r.V.DEFAULT)});return i&&!a.dropdownContent&&(a.dropdownContent=(0,s.N)(e.name)),a},e.getToolbarProps=function(e,t,n){var r=this;if(void 0===t&&(t=[]),void 0===n&&(n=o.k),!e)return[];var s=i.Am.get(a.O).force,l=t.filter((function(e){return"toolbar"===e.position})).map((function(e){return e.key}));return e.data.map((function(e){var t=e.items.map((function(e){var t=e.buttons.map((function(e){return e.map((function(e){var t=r.getButtonProps(e,l,n);return t&&(t.force=s),t})).filter((function(e){return null!==e}))})).filter((function(e){return e.length>0}));return{key:e.key,buttons:t,priority:e.priority,forceShrink:e.forceShrink,shelter:e.shelter?r.getButtonProps(e.shelter,l,n,!0):null,shrinkType:e.shrinkType}})).filter((function(e){return e.buttons.length>0}));return{key:e.key,shelter:e.shelter?r.getButtonProps(e.shelter,l,n,!0):null,items:t}})).filter((function(e){return e.items.length>0}))},e}()},378825:function(e,t,n){function i(e,t){return Array.from({length:Math.ceil(e.length/t)},(function(n,i){return e.slice(i*t,i*t+t)}))}function o(e){return Array.isArray(e[0])}function r(e,t,n){return void 0===n&&(n="default"),e.map("function"==typeof t?t:function(e){return e[t]}).reduce((function(t,i,o){var r=null!=i?i:n;return t[r]=(t[r]||[]).concat(e[o]),t}),{})}n.d(t,{mx:function(){return o},vM:function(){return r},yo:function(){return i}})}}]),"object"==typeof globalThis&&(globalThis.jsExecEndTimeStamp=Date.now(),globalThis.cachedPerformanceEntries||(globalThis.cachedPerformanceEntries=[]),globalThis.cachedPerformanceEntries.push({name:"jsExec: js/public-661-41781e07.js",entryType:"jsExec",startTime:globalThis.jsExecStartTimeStamp,endTime:globalThis.jsExecEndTimeStamp}));
//# sourceMappingURL=public-661-41781e07.js.map