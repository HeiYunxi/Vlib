"object"==typeof globalThis&&(globalThis.jsExecStartTimeStamp=Date.now()),(self.webpackChunkuni=self.webpackChunkuni||[]).push([[8040],{166178:function(e,t,n){n.d(t,{Mp:function(){return Ht},Pf:function(){return qt},TU:function(){return Nt},aG:function(){return Wt},eU:function(){return Ct},jE:function(){return j},jR:function(){return Kt},y5:function(){return $}});var r=n(478247),i=(n(860903),n(568287),n(70324)),o=n(178940),a=n(133013),s=n(184253),c=n(948763),u=n(493626),d=n(765274),l=n.n(d),f=(n(715360),n(836554),n(233339),n(750477),n(649858),n(320701),n(757970),n(397583),n(338104)),p=n(734460),v=n(908576),h=n(35742),g=n(816473),_=n(982764),m=n(653952),S=n(446134),w=n(727353),I=n(694335),y=n(887689),E=n(661950),k=(n(884689),n(959293),n(495789)),D=(n(810839),n(305986),n(360841),n(836484),n(349807),n(930501),n(666410)),A=n(159729),b=(n(755728),n(7991),n(88813),n(621256),n(93827),n(766506),n(183495),n(744907),n(646066)),O=n(95862),C=(n(698312),n(759798)),R=(n(840431),n(864102),n(897612),n(721672),n(563715),n(820614),n(982511),n(811616),n(661487),n(928347),n(832733),n(396285)),x=n(25389),U=(n(977204),n(236161),n(962969),n(962704),n(961970)),L=n(74320),M=(n(917484),n(860215),n(64792)),T=n.n(M),N=(n(625847),n(425734)),P=n.n(N),F=(n(396799),n(510864),n(478861),n(558352)),Q=(n(528015),n(446720),n(779929),n(151615),n(333885),n(334121),n(174833),n(836223),n(626734),n(936319),n(320085),n(242794),n(285485)),W=(n(251816),n(352177)),q=n(972925),j=(0,r.y)("IConnectionControllerService"),B=function(e){return"".concat(String(e),"__locked")},G=function(e){return"".concat(String(e),"__result")};function Z(){return function(e,t,n){var r=n.value,i=B(t),o=G(t);n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this[i]||(this[o]=r.call.apply(r,(0,f.__spreadArray)([this],(0,f.__read)(e),!1)),this[i]=!0),this[o]}}}function H(e){return function(t,n,r){var i=r.value,o=B(e),a=G(e);r.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this[o]&&(this[o]=!1,this[a]=void 0),i.call.apply(i,(0,f.__spreadArray)([this],(0,f.__read)(e),!1))}}}var K,V=function(){function e(t){this.element=t,this.next=e.Undefined,this.prev=e.Undefined}return e.Undefined=new e(void 0),e}(),X=function(){function e(){this.first=V.Undefined,this.last=V.Undefined,this.mSize=0}return Object.defineProperty(e.prototype,"size",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return this.first===V.Undefined},e.prototype.clear=function(){this.first=V.Undefined,this.last=V.Undefined,this.mSize=0},e.prototype.unshift=function(e){return this.insert(e,!1)},e.prototype.push=function(e){return this.insert(e,!0)},e.prototype.shift=function(){if(this.first!==V.Undefined){var e=this.first.element;return this.remove(this.first),e}},e.prototype.pop=function(){if(this.last!==V.Undefined){var e=this.last.element;return this.remove(this.last),e}},e.prototype[Symbol.iterator]=function(){var e;return(0,f.__generator)(this,(function(t){switch(t.label){case 0:e=this.first,t.label=1;case 1:return e===V.Undefined?[3,3]:[4,e.element];case 2:return t.sent(),e=e.next,[3,1];case 3:return[2]}}))},e.prototype.insert=function(e,t){var n=this,r=new V(e);if(this.first===V.Undefined)this.first=r,this.last=r;else if(t){var i=this.last;this.last=r,r.prev=i,i.next=r}else{var o=this.first;this.first=r,r.next=o,o.prev=r}this.mSize+=1;var a=!1;return function(){a||(a=!0,n.remove(r))}},e.prototype.remove=function(e){if(e.prev!==V.Undefined&&e.next!==V.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===V.Undefined&&e.next===V.Undefined?(this.first=V.Undefined,this.last=V.Undefined):e.next===V.Undefined?(this.last=this.last.prev,this.last.next=V.Undefined):e.prev===V.Undefined&&(this.first=this.first.next,this.first.prev=V.Undefined);this.mSize-=1},e}(),Y=function(){function e(e){this.disposed=!1,this.options=e}return Object.defineProperty(e.prototype,"event",{get:function(){var e=this;return this.mEvent||(this.mEvent=function(t,n,r){var i,o,a;e.listeners||(e.listeners=new X);var s=e.listeners.isEmpty();s&&(null===(i=e.options)||void 0===i?void 0:i.onFirstListenerAdd)&&e.options.onFirstListenerAdd(e);var c=e.listeners.push(n?[t,n]:t);s&&(null===(o=e.options)||void 0===o?void 0:o.onFirstListenerDidAdd)&&e.options.onFirstListenerDidAdd(e),(null===(a=e.options)||void 0===a?void 0:a.onListenerDidAdd)&&e.options.onListenerDidAdd(e,t,n);var u={dispose:function(){var t;e.disposed||(c(),(null===(t=e.options)||void 0===t?void 0:t.onLastListenerRemove)&&(e.listeners&&!e.listeners.isEmpty()||e.options.onLastListenerRemove(e))),(0,k.markTracked)(u)},disposableId:"event"};return Array.isArray(r)&&r.push(u),(0,k.trackDisposable)(u),u}),this.mEvent},enumerable:!1,configurable:!0}),e.prototype.fire=function(e){var t,n;if(this.listeners){this.deliveryQueue||(this.deliveryQueue=new X);try{for(var r=(0,f.__values)(this.listeners),i=r.next();!i.done;i=r.next()){var o=i.value;this.deliveryQueue.push([o,e])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}for(;this.deliveryQueue.size>0;){var a=(0,f.__read)(this.deliveryQueue.shift(),2),s=(o=a[0],a[1]);try{"function"==typeof o?o.call(void 0,s):o[0].call(o[1],s)}catch(e){console.error(e)}}}},e.prototype.dispose=function(){this.listeners&&this.listeners.clear(),this.deliveryQueue&&this.deliveryQueue.clear(),this.disposed=!0},e}();function J(e,t){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")}function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}!function(e){e[e.USER_INITIATIVE=72105]="USER_INITIATIVE"}(K||(K={}));var $=function(e){(0,s.Z)(n,e);var t=z(n);function n(e,r,o,a){var s;return(0,i.Z)(this,n),(s=t.call(this)).docMetaDomain=e,s.authDomain=r,s.collaborateDomain=o,s.likeDomain=a,s.onEnterOnlineEmitter=new Y,s.onEnterOfflineEmitter=new Y,s.onRoomStateChangeEmitter=new Y,s.onNetReconnectedFailEmitter=new Y,s.logger=new A.Yd("ConnectionControllerService").use("console"),s.onEnterOnline=s.onEnterOnlineEmitter.event,s.onEnterOffline=s.onEnterOfflineEmitter.event,s.onRoomStateChange=s.onRoomStateChangeEmitter.event,s.onNetReconnectedFail=s.onNetReconnectedFailEmitter.event,s.configEventHandlerMap(),s.configMsgHandlerMap(),s}return(0,o.Z)(n,[{key:"openRoom",value:function(){if(!this.connectionController)throw new Error("没有 connectionController 对象，需要先通过 initConnectionControllerWithClientVars 初始化");this.connectionController.connect()}},{key:"shutDown",value:function(e){if(!this.connectionController)throw new Error("没有 connectionController 对象，需要先通过 initConnectionControllerWithClientVars 初始化");var t=Object.assign({},e);t.errCode||(t.errCode=72105),this.connectionController.disconnect(t)}},{key:"setConnectionController",value:function(e){var t=this;this.connectionController=e,this.connectionController.onConnectionEvent((function(e){t.dispathEvent(e)}))}},{key:"dispose",value:function(){var e;(0,a.Z)((0,u.Z)(n.prototype),"dispose",this).call(this),null===(e=this.connectionController)||void 0===e||e.dispose(),this.connectionController=null}},{key:"init",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})))}},{key:"getConnectionController",value:function(){return this.connectionController}},{key:"initConnectionControllerWithClientVars",value:function(e){var t=this,n={serverVars:e.collab_client_vars,uuId:e.userId+e.collab_client_vars.client.sid.slice(0,5),userid:e.userId,module:"ARK",uid:e.tinyid};this.connectionController=new D.ConnectionController(n),this.connectionController.onConnectionEvent((function(e){t.dispathEvent(e)}))}},{key:"configEventHandlerMap",value:function(){var e=this;this.eventHandlerMap={onEnterOnline:function(){return e.onEnterOnlineEmitter.fire(void 0)},onEnterOffline:function(){return e.onEnterOfflineEmitter.fire(void 0)},onNetReconnectedFail:function(){return e.onNetReconnectedFailEmitter.fire(void 0)},onRoomStateChange:function(t){var n;e.onRoomStateChangeEmitter.fire(null===(n=t.data)||void 0===n?void 0:n.roomState)}}}},{key:"configMsgHandlerMap",value:function(){var e=this;this.msgHandlerMap={HANDLE_DELETE:function(){return e.handleDelete()},REVERT_MESSAGE:function(){return e.handleRevertMessage()},RIGHT_MESSAGE:function(t){return e.handleRightMessage(t)},TITLE_MESSAGE:function(t){return e.handleTitleMessage(t)},USER_NEWINFO:function(t){return e.handleNewUserInfo(t)},USER_NEWINFOS:function(t){return e.handleNewUserInfos(t)},USER_LEAVE:function(t){return e.handleUserLeave(t)},USER_LEAVES:function(t){return e.handleUserLeaves(t)},COMMERCIALIZE_MESSAGE:function(t){return e.handleCommerCializeMessage(t)},COMMERICILIZE_MESSAGE:function(t){return e.handleCommerIcilizeMessage(t)},MARK_MESSAGE:function(t){return e.handleMarkMessage(t)},COMM_NOTICE:function(t){return e.handleCommNotice(t)}}}},{key:"onRoomShutDown",value:function(e){if(e){var t=e.errCode;72105!==(void 0===t?0:t)||this.logger.info("info  = onRoomShutDown = type or errCode === USER_SHUTDOWN_CODE")}else this.logger.info("info  = onRoomShutDown = type or closeReason is null")}},{key:"onReceiveMsgFromServer",value:function(e){if((null==e?void 0:e.type)&&J("Array",null==e?void 0:e.data)){var t=e.type,n=e.data,r=this.msgHandlerMap[t];r&&r(n)}else this.logger.error("error = onReceiveMsgFromServer, type or receiveData.data is null")}},{key:"dispathEvent",value:function(e){var t,n,r=this.eventHandlerMap[e.event];r?r(e):"OnReceiveMsgFromServer"===e.event?this.onReceiveMsgFromServer(null===(t=e.data)||void 0===t?void 0:t.serverMsg):"OnRoomShutDown"===e.event&&this.onRoomShutDown(null===(n=e.data)||void 0===n?void 0:n.closeReason)}},{key:"handleDelete",value:function(){this.docMetaDomain.docMetaEntity.handleNoticeDeleted()}},{key:"handleRevertMessage",value:function(){this.logger.debug("REVERT_MESSAGE")}},{key:"handleRightMessage",value:function(e){var t=this;this.logger.debug("RIGHT_MESSAGE"),e.forEach((function(e){var n;t.authDomain.authAggregate.authInfoEntity.onReceiveMessageFromServer(null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.notice,t.connectionController)}))}},{key:"handleTitleMessage",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice;t.docMetaDomain.docMetaEntity.handleNoticeTitleChanged(n.title)}))}},{key:"handleNewUserInfo",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice,r={sessionType:n.session_type,userId:n.userId,uuId:n.uuId,vipInfo:n.vip_info},i={memCount:n.mem_count,notices:[r]};t.collaborateDomain.collaborateAggregate.handleUserComeIn(i)}))}},{key:"handleNewUserInfos",value:function(e){var t=this;e.forEach((function(e){var n=e.body,r=n.notices,i=n.mem_count,o=[];null==r||r.forEach((function(e){var t={sessionType:e.session_type,userId:e.userId,uuId:e.uuId,vipInfo:e.vip_info};o.push(t)}));var a={memCount:i,notices:o};t.collaborateDomain.collaborateAggregate.handleUserComeIn(a)}))}},{key:"handleUserLeave",value:function(e){var t=this;e.forEach((function(e){var n=e.body.notice,r={sessionType:n.session_type,userId:n.userId,uuId:n.uuId,vipInfo:n.vip_info},i={memCount:n.mem_count,notices:[r]};t.collaborateDomain.collaborateAggregate.handleUserLeave(i)}))}},{key:"handleUserLeaves",value:function(e){var t=this;e.forEach((function(e){var n=e.body,r=n.notices,i=n.mem_count,o=[];null==r||r.forEach((function(e){var t={sessionType:e.session_type,userId:e.userId,uuId:e.uuId,vipInfo:e.vip_info};o.push(t)}));var a={memCount:i,notices:o};t.collaborateDomain.collaborateAggregate.handleUserLeave(a)}))}},{key:"handleCommerCializeMessage",value:function(e){var t=this;this.likeDomain.likeEntity.handleRealTimeLikeMessage(e),e.forEach((function(e){t.collaborateDomain.collaborateAggregate.handleCommerIcilizeMessage(e)}))}},{key:"handleCommerIcilizeMessage",value:function(e){var t=this;e.forEach((function(e){t.collaborateDomain.collaborateAggregate.handleCommerIcilizeMessage(e)}))}},{key:"handleMarkMessage",value:function(e){this.logger.debug(e)}},{key:"handleCommNotice",value:function(e){this.logger.debug(e)}}]),n}(k.Disposable);(0,f.__decorate)([H("init"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",void 0)],$.prototype,"dispose",null),(0,f.__decorate)([Z(),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],$.prototype,"init",null),$=(0,f.__decorate)([(0,f.__param)(0,p.v),(0,f.__param)(1,v.i),(0,f.__param)(2,h.U),(0,f.__param)(3,g.d),(0,f.__metadata)("design:paramtypes",[Object,Object,Object,Object])],$);var ee=b.L.getConfig('npm["@tencent/ark-application"]'),te=window.location.host;null==ee||ee.TENCENT_DOCS_HOME,new RegExp((null==ee?void 0:ee.TENCENT_DOCS_EDITOR_REGEXP)||"docs\\.qq\\.com\\/.+\\/[BD].+"),null==ee||ee.WECOM_DOCS_HOME,null==ee||ee.WECOM_DOCS_EDITOR,null==ee||ee.FEEDBACK_URL;var ne=(null==ee?void 0:ee.EXACTLY_PARENT_TOC_COOKIE_DOMAIN)||"qq.com",re=(null==ee?void 0:ee.PARENT_TOC_COOKIE_DOMAIN)||".qq.com",ie=(null==ee?void 0:ee.TOC_COOKIE_DOMAIN)||".docs.qq.com",oe=(null==ee?void 0:ee.PARENT_TOB_COOKIE_DOMAIN)||".weixin.qq.com",ae=(null==ee?void 0:ee.TOB_COOKIE_DOMAIN)||".doc.weixin.qq.com",se=(null==ee?void 0:ee.WECOM_HOME_PAGE)||"https://doc.weixin.qq.com/home/recent";null==ee||ee.PAGE_JUMP_TO_C,new RegExp((null==ee?void 0:ee.TOC_HOME_PAGE_REGEXP)||"docs\\.qq\\.com\\/desktop(\\/)?","i");var ce=(null==ee?void 0:ee.TOB_LOGIN_PAGE_URL)||"https://doc.weixin.qq.com/disklogin/login",ue=(null==ee?void 0:ee.TOC_HOME_PAGE)||"https://docs.qq.com/desktop",de=(null==ee?void 0:ee.C_JUMP_TO_B_URL)||"https://docs.qq.com/scenario/page-jump-to-b.html";null==ee||ee.C_JUMP_TOB_LOGIN_PAGE_URL;var le=(null==ee?void 0:ee.C_LOGIN_URL)||"https://docs.qq.com/scenario/login.html";new RegExp((null==ee?void 0:ee.TOB_HOME_PAGE_REGEXP)||"doc\\.weixin\\.qq\\.com\\/home\\/recent(\\/)?","i"),new RegExp((null==ee?void 0:ee.TOB_MALL_PAGE_REGEXP)||"doc\\.weixin\\.qq\\.com\\/mall\\/index(\\/)?","i"),new RegExp((null==ee?void 0:ee.TOC_MALL_PAGE_REGEXP)||"docs\\.qq\\.com\\/mall(\\/)?","i"),null==ee||ee.TOC_MALL_PAGE;var fe=Symbol.for("swr-decorator:fetcherMap");function pe(e){return function(t,n){var r=Reflect.getMetadata(fe,t)||new Map;r.set(e,n),Reflect.defineMetadata(fe,r,t)}}var ve=Symbol.for("swr-decorator:properties");function he(e,t){var n,r=null!==(n=Reflect.getMetadata(ve,e))&&void 0!==n?n:[];r.push(t),Reflect.defineMetadata(ve,r,e)}function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}var _e=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,i.Z)(this,e),this.value=t,this.fetcher=n,this.subscribers=new Set,this.validating=!1,this.firstRequire=!1,this.updatePropertiesOnFirstRequire=r}return(0,o.Z)(e,[{key:"getValue",value:function(){var e=this;return this.updatePropertiesOnFirstRequire&&!this.firstRequire&&(setTimeout((function(){return e.revalidate()}),0),this.firstRequire=!0),this.value}},{key:"getValueMutate",value:function(){return this.revalidate(),this.value}},{key:"setValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.value=e,t||this.subscribers.forEach((function(t){return t(e)})),!0}},{key:"addSubscriber",value:function(e){this.subscribers.add(e)}},{key:"removeSubscriber",value:function(e){this.subscribers.delete(e)}},{key:"isValidating",value:function(){return this.validating}},{key:"revalidate",value:function(){var e=this;this.validating||this.fetcher&&(this.validating=!0,this.fetcher().then((function(t){e.validating=!1,e.setValue(t)})).catch((function(t){throw e.validating=!1,t})))}}]),e}();function me(e){var t=(null!=e?e:{}).updatePropertiesOnFirstRequire;return function(e){var n=new Map;return function(e){(0,s.Z)(a,e);var r=ge(a);function a(){var e,o,s;(0,i.Z)(this,a);for(var c=arguments.length,u=new Array(c),d=0;d<c;d++)u[d]=arguments[d];e=r.call.apply(r,[this].concat(u));var p={},v=null!==(o=Reflect.getMetadata(fe,(0,C.Z)(e)))&&void 0!==o?o:new Map;return(null!==(s=Reflect.getMetadata(ve,(0,C.Z)(e)))&&void 0!==s?s:[]).forEach((function(r){var i,o=v.get(r),a=null===(i=e[o])||void 0===i?void 0:i.bind((0,C.Z)(e)),s=new _e(e[r],a,t);n.set(r,s),p[r]={get:function(){return s.getValue()},set:function(e){return s.setValue(e),!0}},e[o]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(0,f.__awaiter)((0,C.Z)(e),void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.apply(void 0,n);case 2:return t=e.sent,s.setValue(t),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))}})),Object.defineProperties((0,C.Z)(e),p),e}return(0,o.Z)(a,[{key:"isValidating",value:function(e){var t,r;return null!==(r=null===(t=n.get(e))||void 0===t?void 0:t.isValidating())&&void 0!==r&&r}},{key:"subscribe",value:function(e,t){var r;return null===(r=n.get(e))||void 0===r||r.addSubscriber(t),function(){var r;null===(r=n.get(e))||void 0===r||r.removeSubscriber(t)}}},{key:"mutate",value:function(e,t){return(0,f.__awaiter)(this,arguments,void 0,(function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return l().mark((function i(){var o,a;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:void 0!==t&&(null===(o=n.get(e))||void 0===o||o.setValue(t,!0)),r&&(null===(a=n.get(e))||void 0===a||a.revalidate());case 2:case"end":return i.stop()}}),i)}))()}))}}]),a}(e)}}var Se={nick:"nickname",avatar:"avatarURI",uType:"accountType",phone:"phoneNumber",isHasPassword:"enabled",utype:"accountType",uin:"qq"},we={raw:Se,words:Object.keys(Se)},Ie={};function ye(){return"undefined"!=typeof window}function Ee(){return void 0!==n.g}var ke=ye()?window:Ee()?n.g:ye||"undefined"==typeof self?(Ee()&&n.g.describe,Ie):self;function De(e,t){return null!==e&&Object.prototype.hasOwnProperty.call(e,t)}var Ae="location";function be(){return De(ke,Ae)?location.search:""}function Oe(e,t){if(void 0===t&&(t={shouldDecodeURI:!1}),!De(ke,Ae))return"";var n=new RegExp("(\\?|&)".concat(e,"=([^&]*)(#|&|$)")),r=((null==t?void 0:t.shouldDecodeURI)?decodeURIComponent(be()):be()).match(n);return r?decodeURIComponent(r[2]):""}var Ce,Re=["/doc/","/sheet/","/slide/","/form/","/mind/","/flowchart/","/pdf/"],xe=function(){function e(){if((0,i.Z)(this,e),O.default.isMiniProgram)return new Ue;try{var t=new x.StorageManager({type:this.isSupportClientDB()?x.DBEngineType.nativeDB:x.DBEngineType.indexDB,disableAutoOpen:!1}).storage.collection(R.UserInfo);this.userInfoStorage=new x.UserInfoStorage(t),this.onOfflineState=!1}catch(e){return console.error(e),new Ue}}return(0,o.Z)(e,[{key:"setOnOfflineState",value:function(e){this.onOfflineState=e}},{key:"addUserInfo",value:function(e){if(U.L.isOnline&&!this.onOfflineState&&(null==e?void 0:e.tinyId)&&e.tinyId!==_.Dr){var t=new R.UserInfo(Object.assign(Object.assign({},e),this.getDocInfo()));this.userInfoStorage.addUserInfo(t)}}},{key:"updateUserInfo",value:function(e){U.L.isOnline&&(e.tinyId===_.Dr||this.onOfflineState||this.userInfoStorage.updateUserInfo({tinyId:e.tinyId},e))}},{key:"getUserInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=Oe("u"))){e.next=7;break}return e.t0=this,e.next=5,this.userInfoStorage.getUserInfoByNowUserIndex(t);case 5:return e.t1=e.sent,e.abrupt("return",e.t0.changeOfflineData.call(e.t0,e.t1));case 7:return n=this.getDocInfo(),r=n.pageType,i=n.docId,e.t2=this,e.next=11,this.userInfoStorage.getUserInfoByDocInfo(r,i);case 11:return e.t3=e.sent,e.abrupt("return",e.t2.changeOfflineData.call(e.t2,e.t3));case 13:case"end":return e.stop()}}),e,this)})))}},{key:"changeOfflineData",value:function(e){if(!e)return null;var t={tinyId:e.tinyId,corpId:e.corpId,corpName:e.corpName,englishName:e.englishName,loginType:e.loginType,uidSource:e.uidSource,openId:e.openId,uin:e.uin,userId:e.userId,userName:e.userName,userPic:e.userPic,nowUserIndex:e.nowUserIndex,settings:e.settings,wedriveUin:e.wedriveUin||""},n=e.bindUserInfo;return{userInfo:t,vipInfo:e.vipUserInfo,bindUserInfo:n}}},{key:"isSupportClientDB",value:function(){var e=/_tdocFlag\/(\d+)/.exec(navigator.userAgent);return!!(null==e?void 0:e[1])&&(2&parseInt(e[1],10))>0}},{key:"getDocInfo",value:function(){var e=null===globalThis||void 0===globalThis?void 0:globalThis.location.pathname.split("/"),t=e[1];return Re.filter((function(e){return globalThis.location.pathname.includes(e)})).length>0?{pageType:t,docId:e[2],updateTime:Date.now().toString()}:{pageType:t,docId:t,updateTime:Date.now().toString()}}}]),e}(),Ue=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"setOnOfflineState",value:function(){}},{key:"addUserInfo",value:function(){}},{key:"updateUserInfo",value:function(){}},{key:"getUserInfo",value:function(){return Promise.resolve(null)}}]),e}();!function(e){e.SUCCESS="SUCCESS",e.MAIN_SUCCESS_SECOND_FAIL="MAIN_SUCCESS_SECOND_FAIL",e.MAIN_FAIL_SECOND_SUCCESS="MAIN_FAIL_SECOND_SUCCESS",e.FAIL="FAIL",e.NOT_EXIST="NOT_EXIST"}(Ce||(Ce={}));var Le,Me=function(){function e(t,n){(0,i.Z)(this,e),this.accountDomainService=t,this.messageDomainService=n}return(0,o.Z)(e,[{key:"getPersonalAccountList",value:function(e,t){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getFetchAccountList(e,t);case 2:return this.fetchAccountList=n.sent,n.abrupt("return",this.mergeAccountList(this.fetchAccountList,[]));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getFetchAccountList",value:function(e,t){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function n(){return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountDomainService.accountAggregate.accountListEntity.getAccountList(e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"deleteAccountForList",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uid,r=e.userIndex,i=!0,!this.isHasSameTinyID(this.fetchAccountList,n)){t.next=7;break}return t.next=6,this.deleteFetchAccountList(e);case 6:i=t.sent;case 7:return i&&T().postMessage({type:m.p.LOGOUT,data:r,needCookie:!0}),t.abrupt("return",this.changeDeleteAccountState(i,!0));case 9:case"end":return t.stop()}}),t,this)})))}},{key:"changeSign",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.userIndex){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,this.accountDomainService.accountAggregate.accountListEntity.changeSign(n);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){this.messageDomainService.getEnterpriseAccountListMessage.dispose()}},{key:"changeDeleteAccountState",value:function(e,t){return e&&t?Ce.SUCCESS:e?Ce.MAIN_SUCCESS_SECOND_FAIL:t?Ce.MAIN_FAIL_SECOND_SUCCESS:Ce.FAIL}},{key:"deleteFetchAccountList",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.userIndex){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=5,this.accountDomainService.accountAggregate.accountListEntity.delAccountForList(n);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"mergeAccountList",value:function(e,t){var n=this;return t.reduce((function(e,t){return n.isHasSameTinyID(e,t.uid)?e:[].concat((0,L.Z)(e),[t])}),e)}},{key:"isHasSameTinyID",value:function(e,t){return e.some((function(e){return e.uid===t}))}},{key:"getEnterpriseAccountList",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.messageDomainService.getEnterpriseAccountListMessage.connect(),this.getIframeMountMessage(),this.messageDomainService.getEnterpriseAccountListMessage.createGetAccountListIframe((function(){n.messageDomainService.getEnterpriseAccountListMessage.sendAccountListMessage()})),e.next=5,this.getAccountListMessage();case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"deleteEnterpriseAccountList",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie){t.next=3;break}return t.abrupt("return",!1);case 3:return this.messageDomainService.getEnterpriseAccountListMessage.sendDeleteAccountMessage(n),t.next=6,this.getDeleteAccountMessage();case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getAccountListMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getAccountListMessage((function(e){var n=e.data.userList;t(n)}))}))}},{key:"getDeleteAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getDeleteAccountMessage((function(){t(!0)}))}))}},{key:"getIframeMountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.getEnterpriseAccountListMessage.getIframeMountMessage((function(){t(!0),e.messageDomainService.getEnterpriseAccountListMessage.sendAccountListMessage()}))}))}}]),e}();Me=(0,f.__decorate)([(0,f.__param)(0,S.b),(0,f.__param)(1,w.x),(0,f.__metadata)("design:paramtypes",[Object,Object])],Me),function(e){e.BIND_CGI_SUCCESS="BIND_CGI_SUCCESS",e.CHECK_KEY_IS_READY="CHECK_KEY_IS_READY",e.BIND_POLLING_RUNNING="BIND_POLLING_RUNNING",e.BIND_POLLING_FINISH="BIND_POLLING_FINISH",e.BIND_TIMEOUT="BIND_TIMEOUT",e.ERROR="ERROR"}(Le||(Le={}));var Te,Ne,Pe=function(){function e(t){(0,i.Z)(this,e),this.accountDomainService=t,this.isExpired=!1}return(0,o.Z)(e,[{key:"getBindingQQAccountInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.bindingQQInfo();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getStatus",value:function(e){var t=this;return this.runBindProcess(e),{dispose:function(){return t.dispose()}}}},{key:"runBindProcess",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.accountAggregate.accountRepository.bindUserInfo();case 2:n=t.sent,0===(null==(r=n.resData)?void 0:r.cgicode)?(e(Le.BIND_CGI_SUCCESS),this.getKey(e)):e(Le.ERROR,{errBindQQStatus:Le.BIND_CGI_SUCCESS});case 5:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"getKey",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r,i;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,t.next=3,this.accountDomainService.accountAggregate.accountRepository.getBindWxQrCode(n);case 3:if(r=t.sent,0!==(null==(i=r.resData)?void 0:i.cgicode)){t.next=9;break}return e(Le.CHECK_KEY_IS_READY),this.runPolling(i.data.checkKey,e),t.abrupt("return");case 9:e(Le.ERROR,{errBindQQStatus:Le.CHECK_KEY_IS_READY});case 10:case"end":return t.stop()}}),t,this)})))}},{key:"runPolling",value:function(e,t){var n=this;this.isExpired||(this.pollingTimer=setTimeout((function(){return(0,f.__awaiter)(n,void 0,void 0,l().mark((function n(){var r,i;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountDomainService.accountAggregate.accountRepository.getBindProcess(e);case 2:if(r=n.sent,i=r.resData,clearTimeout(this.pollingTimer),0!==(null==i?void 0:i.cgicode)){n.next=15;break}if(!i.data.isFinish){n.next=9;break}return t(Le.BIND_POLLING_FINISH),n.abrupt("return");case 9:if(!(Number(i.data.lastUpdateRs)>15)){n.next=12;break}return t(Le.BIND_POLLING_FINISH,{progress:this.getProgress(i.data.totalNum,i.data.succNum)}),n.abrupt("return");case 12:return t(Le.BIND_POLLING_RUNNING,{progress:this.getProgress(i.data.totalNum,i.data.succNum)}),this.runPolling(e,t),n.abrupt("return");case 15:t(Le.ERROR,{errBindQQStatus:Le.BIND_POLLING_RUNNING});case 16:case"end":return n.stop()}}),n,this)})))}),1e3))}},{key:"getProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e?Math.floor(t/e):1}}]),e}();function Fe(e,t){var n,r=this;return Ne=t,function(i){return function o(){return(0,f.__awaiter)(r,void 0,void 0,l().mark((function r(){var a,s,c;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(Ne===t){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,e.loginRepository.updateWeChatLoginQRCodeStatus(t);case 4:if(a=r.sent,s=a.error,c=a.resData,!s){r.next=10;break}return i({status:Te.ERROR}),r.abrupt("return");case 10:if(!(null==c?void 0:c.data.status.isFinish)){r.next=13;break}return i({status:Te.USER_HAS_CONFIRMED}),r.abrupt("return");case 13:n=setTimeout(o,1e3);case 14:case"end":return r.stop()}}),r)})))}(),setTimeout((function(){Ne===t&&i({status:Te.CODE_WAS_EXPIRED}),clearTimeout(n)}),58e3),function(){return clearTimeout(n)}}}Pe=(0,f.__decorate)([(0,f.__param)(0,S.b),(0,f.__metadata)("design:paramtypes",[Object])],Pe),function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.ERROR="ERROR"}(Te||(Te={}));var Qe=function(){function e(t,n){(0,i.Z)(this,e),this.accountDomainService=t,this.loginDomainService=n}return(0,o.Z)(e,[{key:"getQRCode",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,e.next=3,this.accountDomainService.accountAggregate.accountRepository.getBindWxQrCode(t);case 3:if(n=e.sent,r=n.error,i=n.resData,!r){e.next=7;break}throw r;case 7:return e.abrupt("return",this.convertWeChatQRCodeResponse(null==i?void 0:i.data));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"convertWeChatQRCodeResponse",value:function(e){var t=null!=e?e:{},n=t.img,r=t.checkKey;if(!n||!r)throw Error("获取微信二维码失败");return{id:r,image:"data:image/png;base64,".concat(n),subscribe:Fe(this.loginDomainService.loginAggregate,r)}}}]),e}();Qe=(0,f.__decorate)([(0,f.__param)(0,S.b),(0,f.__param)(1,I.C),(0,f.__metadata)("design:paramtypes",[Object,Object])],Qe);var We,qe,je=function(){function e(t,n){(0,i.Z)(this,e),this.accountDomainService=t,this.loginDomainService=n}return(0,o.Z)(e,[{key:"qqBind",value:function(e){return this.qqBindApplication||(this.qqBindApplication=new Pe(this.accountDomainService)),this.qqBindApplication.getStatus(e)}},{key:"wechatBind",value:function(){return this.wechatBindApplication=new Qe(this.accountDomainService,this.loginDomainService),this.wechatBindApplication.getQRCode()}},{key:"getQQBindingInfo",value:function(){return this.qqBindApplication||(this.qqBindApplication=new Pe(this.accountDomainService)),this.qqBindApplication.getBindingQQAccountInfo()}},{key:"getCurrentAccountBindingInfo",value:function(){return this.accountDomainService.accountAggregate.currentLoginAccountBindInfo()}}]),e}();je=(0,f.__decorate)([(0,f.__param)(0,S.b),(0,f.__param)(1,I.C),(0,f.__metadata)("design:paramtypes",[Object,Object])],je),function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(We||(We={})),function(e){e[e.WECHAT_LOGIN_CASE_DEFAULT=0]="WECHAT_LOGIN_CASE_DEFAULT",e[e.WECHAT_LOGIN_CASE_H5=1]="WECHAT_LOGIN_CASE_H5"}(qe||(qe={}));var Be,Ge=function(){function e(t){(0,i.Z)(this,e),this.loginDomainService=t,this.isExpired=!1}return(0,o.Z)(e,[{key:"login",value:function(e){var t=this;return this.runLoginProcess(e),{dispose:function(){return t.dispose()}}}},{key:"dispose",value:function(){this.qrTimer&&clearTimeout(this.qrTimer),this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"runLoginProcess",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getWechatLoginQRcode(e);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:this.isExpired=!1,this.runPolling(n,e),this.runQRTimer(e);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getWechatLoginQRcode",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r,i,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRCodeURI();case 2:if(n=t.sent,0!==(null==(r=n.resData)?void 0:r.retcode)){t.next=11;break}return i=r.data.checkKey,t.next=8,this.getQRcode(i,e);case 8:return o=t.sent,e(We.CODE_IS_READY,{qrCodeImage:o}),t.abrupt("return",r.data.checkKey);case 11:return e(We.ERROR,{errorQrQQLoginStatus:We.CODE_IS_READY}),t.abrupt("return","");case 13:case"end":return t.stop()}}),t,this)})))}},{key:"getQRcode",value:function(e,t){return new Promise((function(n){P().make("https://".concat(te,"/scenario/qr-h5login.html?key=").concat(e)).then((function(e){return n(e)})).catch((function(){t(We.ERROR,{errorQrQQLoginStatus:We.CODE_IS_READY})}))}))}},{key:"runPolling",value:function(e,t){var n=this;this.isExpired||(this.pollingTimer=setTimeout((function(){return(0,f.__awaiter)(n,void 0,void 0,l().mark((function n(){var r,i,o,a,s,c;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loginDomainService.loginAggregate.loginRepository.updateEnterpriseWeChatLoginQRCodeStatus(e);case 2:if(o=n.sent,0===(null==(a=o.resData)?void 0:a.retcode)){n.next=9;break}return t(We.ERROR,{errorQrQQLoginStatus:We.USER_HAS_SCANNED}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),n.abrupt("return");case 9:if(s=null!==(i=null===(r=null==a?void 0:a.data)||void 0===r?void 0:r.status)&&void 0!==i?i:{},c=s.loginScanFlag,!s.login){n.next=15;break}return t(We.LOGIN_SUCCESS,{changeKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),n.abrupt("return");case 15:c&&t(We.USER_HAS_SCANNED),clearTimeout(this.pollingTimer),this.runPolling(e,t);case 18:case"end":return n.stop()}}),n,this)})))}),1e3))}},{key:"runQRTimer",value:function(e){var t=this;this.qrTimer=setTimeout((function(){e(We.CODE_WAS_EXPIRED),t.isExpired=!0,clearTimeout(t.qrTimer)}),58e3)}}]),e}();Ge=(0,f.__decorate)([(0,f.__param)(0,I.C),(0,f.__metadata)("design:paramtypes",[Object])],Ge),function(e){e.UPDATE_USER_INDEX="account:update-user-index",e.DELETE_USER_INDEX="account:delete-user-index",e.SWITCH_USER_INDEX="account:switch-user-index"}(Be||(Be={}));var Ze,He="https://".concat(te,"/tim/docs/components/BindQQ.html?type=login"),Ke=function(e){return He+(e?"&autojump=1":"")};!function(e){e.IFRAME_MESSAGE_CONNECTED="IFRAME_MESSAGE_CONNECTED",e.IFRAME_DOM_MOUNTED="IFRAME_DOM_MOUNTED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(Ze||(Ze={}));var Ve=function(){function e(t,n){(0,i.Z)(this,e),this.loginDomainService=t,this.messageDomainService=n}return(0,o.Z)(e,[{key:"login",value:function(e,t){var n=this;return this.runLoginProcess(e,t),{dispose:function(){return n.disposeQQLoginIframe()}}}},{key:"disposeQQLoginIframe",value:function(){this.messageDomainService.qqMessage.qqLoginMessage.dispose()}},{key:"loadQQLoginIframe",value:function(e,t){var n,r,i;this.messageDomainService.qqMessage.qqLoginMessage.connect(),this.getLoadQQLoginIframeMessage(t),this.messageDomainService.qqMessage.qqLoginMessage.createQQLoginIframe(e.qqPtLoginIframeRenderDom,this.getQQLoginIframeSrc(null!==(n=null==e?void 0:e.useOauth)&&void 0!==n&&n,null===(r=e.isCheckAutoLogin)||void 0===r||r,null!==(i=e.isJumpFromQQClient)&&void 0!==i&&i,e.isJumpFromQQClient?Oe("jumpuin"):""))}},{key:"runLoginProcess",value:function(e,t){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.loadQQLoginIframe(e,t),n.next=3,this.getQQLoginSuccessMessage(t);case 3:if(r=n.sent,!e.disableUserInfoAutoUpdating){n.next=7;break}return t(Ze.LOGIN_SUCCESS,{}),n.abrupt("return");case 7:this.checkQQLogin(t,r);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"getQQLoginIframeSrc",value:function(e,t,n,r){var i,o=e?(i=Ke(n),"https://graph.qq.com/oauth2.0/authorize?which=Login&display=pc&response_type=code&theme=10&client_id=101458937&redirect_uri=".concat(encodeURIComponent(i),"&state=state")):function(e,t){return"https://xui.ptlogin2.qq.com/cgi-bin/xlogin?theme=4&appid=1600000931&pt_no_auth=1&daid=536&link_target=blank&target=self&hide_close_icon=1&style=20&low_login_enable=".concat(e?1:0,"&low_login_foreced=1&low_login_hour=720&hide_border=1&s_url=").concat(encodeURIComponent(t),"&pt_isdocs=0")}(t,Ke(n));return r?"".concat(o,"&jumpuin=").concat(r):o}},{key:"getLoadQQLoginIframeMessage",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageDomainService.qqMessage.qqLoginMessage.getQQIframeMessage((function(){e(Ze.IFRAME_DOM_MOUNTED)}));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getQQLoginSuccessMessage",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.messageDomainService.qqMessage.qqLoginMessage.getQQLoginSuccessMessage((function(n){e(Ze.USER_HAS_CONFIRMED);var r=n.data;if("string"==typeof r&&r.startsWith("login qq oauth success")&&r.includes("code=")){var i=r.slice(r.indexOf("code=")+5);t({success:!0,code:i})}t({success:!0})}))})));case 1:case"end":return t.stop()}}),t)})))}},{key:"checkQQLogin",value:function(e,t){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function n(){var r,i,o,a,s,c;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s={},!t.code){n.next=7;break}return n.next=4,this.loginDomainService.loginAggregate.loginRepository.checkQQOAuthLogin(t.code);case 4:s=n.sent,n.next=10;break;case 7:return n.next=9,this.loginDomainService.loginAggregate.loginRepository.checkQQLogin();case 9:s=n.sent;case 10:if(!(null==(c=s.resData)?void 0:c.data.userIndex)){n.next=15;break}return e(Ze.LOGIN_SUCCESS,{userIndex:null==c?void 0:c.data.userIndex}),null===(i=null===(r=navigator.serviceWorker)||void 0===r?void 0:r.controller)||void 0===i||i.postMessage({type:Be.SWITCH_USER_INDEX,data:{userIndex:c.data.userIndex,url:location.href}}),n.abrupt("return");case 15:if(0!==(null==c?void 0:c.cgicode)){n.next=19;break}return e(Ze.LOGIN_SUCCESS),null===(a=null===(o=navigator.serviceWorker)||void 0===o?void 0:o.controller)||void 0===a||a.postMessage({type:Be.SWITCH_USER_INDEX,data:{url:location.href}}),n.abrupt("return");case 19:e(Ze.ERROR,{errorQrQQLoginStatus:Ze.LOGIN_SUCCESS});case 20:case"end":return n.stop()}}),n,this)})))}}]),e}();Ve=(0,f.__decorate)([(0,f.__param)(0,I.C),(0,f.__param)(1,w.x),(0,f.__metadata)("design:paramtypes",[Object,Object])],Ve);var Xe,Ye=function(){function e(t,n,r){(0,i.Z)(this,e),this.messageDomainService=t,this.loginDomainService=n,this.accountDomainService=r,this.isExpired=!1}return(0,o.Z)(e,[{key:"login",value:function(e,t){var n=this;return this.runLoginProcess(e,t),{dispose:function(){return n.dispose()}}}},{key:"dispose",value:function(){this.qrTimer&&clearTimeout(this.qrTimer),this.pollingTimer&&clearTimeout(this.pollingTimer),this.isExpired=!0}},{key:"runLoginProcess",value:function(e,t){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(null==t?void 0:t.useOfficialAccountOrH5)?this.getWechatLoginQRUrl(e,t):this.getWechatLoginQRcode(e);case 2:if(r=n.sent){n.next=5;break}return n.abrupt("return");case 5:this.isExpired=!1,this.runPolling(r,e),this.runQRTimer(r,e);case 8:case"end":return n.stop()}}),n,this)})))}},{key:"getWechatLoginQRcode",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRCodeURI();case 2:if(n=t.sent,0!==(null==(r=n.resData)?void 0:r.retcode)){t.next=7;break}return e(We.CODE_IS_READY,{qrCodeImage:"data:image/png;base64,".concat(r.data.img),checkKey:r.data.checkKey}),t.abrupt("return",r.data.checkKey);case 7:return e(We.ERROR,{errorQrQQLoginStatus:We.CODE_IS_READY}),t.abrupt("return","");case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getWechatLoginQRUrl",value:function(e,t){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function n(){var r,i;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loginDomainService.loginAggregate.loginRepository.getWeChatLogInQRURI(null==t?void 0:t.wechatLoginCase);case 2:if(r=n.sent,0!==(null==(i=r.resData)?void 0:i.retcode)){n.next=7;break}return e(We.CODE_IS_READY,{qrCodeUrl:i.data.url,checkKey:i.data.checkKey}),n.abrupt("return",i.data.checkKey);case 7:return e(We.ERROR,{errorQrQQLoginStatus:We.CODE_IS_READY}),n.abrupt("return","");case 9:case"end":return n.stop()}}),n,this)})))}},{key:"runPolling",value:function(e,t){var n=this,r=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;this.isExpired||(this.pollingTimer=setTimeout((function(){return(0,f.__awaiter)(n,void 0,void 0,l().mark((function n(){var i,o,a,s,c,u,d,f;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loginDomainService.loginAggregate.loginRepository.updateWeChatLoginQRCodeStatus(e);case 2:if(c=n.sent,0===(null==(u=c.resData)?void 0:u.retcode)){n.next=10;break}return T().postMessage({type:m.p.LOGIN,data:r,needCookie:!0}),t(We.ERROR,{errorQrQQLoginStatus:We.USER_HAS_SCANNED,checkKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),n.abrupt("return");case 10:if(d=null!==(o=null===(i=null==u?void 0:u.data)||void 0===i?void 0:i.status)&&void 0!==o?o:{},f=d.loginScanFlag,!d.login){n.next=18;break}return T().postMessage({type:m.p.LOGIN,data:r,needCookie:!0}),t(We.LOGIN_SUCCESS,{userIndex:u.data.userIndex,checkKey:e}),clearTimeout(this.qrTimer),clearTimeout(this.pollingTimer),null===(s=null===(a=navigator.serviceWorker)||void 0===a?void 0:a.controller)||void 0===s||s.postMessage({type:Be.SWITCH_USER_INDEX,data:{userIndex:u.data.userIndex,url:location.href}}),n.abrupt("return");case 18:f&&t(We.USER_HAS_SCANNED,{checkKey:e}),clearTimeout(this.pollingTimer),this.runPolling(e,t);case 21:case"end":return n.stop()}}),n,this)})))}),1e3))}},{key:"runQRTimer",value:function(e,t){var n=this;this.qrTimer=setTimeout((function(){t(We.CODE_WAS_EXPIRED,{checkKey:e}),n.isExpired=!0,clearTimeout(n.qrTimer)}),58e3)}}]),e}();Ye=(0,f.__decorate)([(0,f.__param)(0,w.x),(0,f.__param)(1,I.C),(0,f.__metadata)("design:paramtypes",[Object,Object,Object])],Ye),function(e){e.IFRAME_MESSAGE_CONNECTED="IFRAME_MESSAGE_CONNECTED",e.IFRAME_DOM_MOUNTED="IFRAME_DOM_MOUNTED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.GOT_CHANGE_KEY="GOT_CHANGE_KEY",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.ERROR="ERROR"}(Xe||(Xe={}));var Je=function(){function e(t){(0,i.Z)(this,e),this.messageDomainService=t}return(0,o.Z)(e,[{key:"login",value:function(e,t){var n=this;return this.loadWeworkLoginIframe(e,t),this.getWeworkLoginSuccessMessage(t),{dispose:function(){return n.dispose()}}}},{key:"loadWeworkLoginIframe",value:function(e,t){var n,r;this.messageDomainService.weworkMessage.weworkLoginMessage.connect("enterprise"),this.getLoadWeworkLoginIframeMessage(t),this.messageDomainService.weworkMessage.weworkLoginMessage.createWeworkLoginIframe(e.weworkLoginIframeRenderDom,(r=e.targetUrl,n=r.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),"https://".concat(te,"/components/feature/WeworkLogin.html?redirect_uri=").concat(encodeURIComponent(n),"&open_id_gray=1&code_gray=1")))}},{key:"dispose",value:function(){this.messageDomainService.weworkMessage.weworkLoginMessage.dispose()}},{key:"getLoadWeworkLoginIframeMessage",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.messageDomainService.weworkMessage.weworkLoginMessage.getWeworkIframeMessage((function(){e(Xe.IFRAME_DOM_MOUNTED)}));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getWeworkLoginSuccessMessage",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.messageDomainService.weworkMessage.weworkLoginMessage.getWeworkLoginSuccessMessage((function(n){var r,i,o=n.data;o.includes("code=")?e(Xe.LOGIN_SUCCESS,{code:o.slice(o.indexOf("code=")+5)}):e(Xe.LOGIN_SUCCESS),null===(i=null===(r=navigator.serviceWorker)||void 0===r?void 0:r.controller)||void 0===i||i.postMessage({type:Be.SWITCH_USER_INDEX,data:{url:location.href}}),T().postMessage({type:m.p.LOGIN,data:"",needCookie:!0}),t(o)}))})));case 1:case"end":return t.stop()}}),t)})))}}]),e}();Je=(0,f.__decorate)([(0,f.__param)(0,w.x),(0,f.__metadata)("design:paramtypes",[Object])],Je);var ze=function(){function e(t,n,r){(0,i.Z)(this,e),this.loginDomainService=t,this.messageDomainService=n,this.accountDomainService=r}return(0,o.Z)(e,[{key:"qrQQLogin",value:function(e,t){return new Ve(this.loginDomainService,this.messageDomainService).login(e,t)}},{key:"qrWechatLogin",value:function(e,t){return new Ye(this.messageDomainService,this.loginDomainService,this.accountDomainService).login(e,t)}},{key:"enterpriseQrWechatLogin",value:function(e){return new Ge(this.loginDomainService).login(e)}},{key:"qrWecomLogin",value:function(e,t){return new Je(this.messageDomainService).login(e,t)}}]),e}();ze=(0,f.__decorate)([(0,f.__param)(0,I.C),(0,f.__param)(1,w.x),(0,f.__metadata)("design:paramtypes",[Object,Object,Object])],ze);var $e,et="document";function tt(e){return J("Object",e)?JSON.stringify(e):e}function nt(e,t,n,r,i){if(De(ke,et)){var o=encodeURIComponent(tt(t)),a=2592e6;n&&(a=864e5*n);var s=new Date;a+=s.getTime(),s.setTime(a);var c=s.toUTCString(),u=r||"/",d=i?"domain=".concat(i,";"):"";document.cookie="".concat(e,"=").concat(o,";expires=").concat(c,";path=").concat(u,";").concat(d)}}function rt(e,t,n){if(De(ke,et)){var r=t||"/",i=n?"domain=".concat(n,";"):"",o=new Date(0).toUTCString();document.cookie="".concat(e,"=;expires=").concat(o,";path=").concat(r,";").concat(i)}}function it(e){if(!De(ke,et))return null;var t=new RegExp("(?:^|;+|\\s+)".concat(e,"=([^;]*)")),n=document.cookie.match(t);return(n?n[1]:null)||null}!function(e){e.xsrf="TOK",e.devRouteId="dev_route_id",e.devOaName="dev_oa_name",e.fd="fd",e.envId="env_id",e.sid="SID",e.sids="SID_S",e.uid="uid",e.uidKey="uid_key",e.uin="uin",e.loginTime="loginTime",e.hasBeenLogin="has_been_login",e.adtag="adtag",e.plUin="p_luin",e.pUin="p_uin",e.pSkey="p_skey",e.plSkey="p_lskey"}($e||($e={}));var ot="#",at="?",st="&";function ct(e,t){var n,r=e.split(at),i=null===(n=r[1])||void 0===n?void 0:n.split(st);if(!i)return e;var o=i;return t.forEach((function(e){i.forEach((function(t){if(0===t.indexOf("".concat(e,"="))){var n=o.indexOf(t);o.splice(n,1)}}))})),0===o.length?r[0]:(r[1]=o.join(st),r.join(at))}function ut(e,t){if(e.includes(at)){var n=e;return Object.keys(t).map((function(e){n=function(e,t,n){var r=e.split(at),i=r[1].split(st),o=!0,a=new Map;i.forEach((function(e){var t=e.split("=");a.set(t[0],t[1])})),i.some((function(e){0===e.indexOf("".concat(t,"="))&&(a.set(t,n),o=!1)})),o&&a.set(t,n);var s=[];return a.forEach((function(e,t){var n="".concat(t,"=").concat(e);s.push(n)})),r[1]=s.join(st),r.join(at)}(n,e,t[e])})),n}var r=Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join(st);return"".concat(e,"?").concat(r)}function dt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e.split(at).length<2||t.length<1)return e;if(e.includes(ot)){var r=e.split(ot);return r[0]=ct(r[0],t),r.join(ot)}return ct(e,t)}function lt(e,t){if(Object.keys(t).length<1)return e;if(e.includes(ot)){var n=e.split(ot);return n[0]=ut(n[0],t),n.join(ot)}return ut(e,t)}var ft=se,pt=function(){function e(t){(0,i.Z)(this,e),this.accountDomainService=t}return(0,o.Z)(e,[{key:"loginSuccessJumpUrl",value:function(e,t,n,r){var i=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;if(t){var o=window.btoa(ft).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),a="".concat(ce,"?product=2&from=30&code=").concat(n,"&redirect_url=").concat(o);(0,Q.tencentDocOpenUrlForAll)({replace:null==r?void 0:r.replace,url:a})}else{var s=lt(dt(e,"autoshowlogin","u","jumpuin"),(0,F.Z)({},"_t",Date.now()));T().postMessage({type:m.p.LOGIN,data:i,needCookie:!0}),(0,Q.tencentDocOpenUrlForAll)({replace:!0,url:s})}}},{key:"logoutSuccessJumpUrl",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i,o,a,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=dt(window.location.href,"u"),e.next=3,this.accountDomainService.accountAggregate.accountListEntity.getAccountList();case 3:if(n=e.sent,r=it("uid")||null,i=n.find((function(e){return e.uid!==r})),!(null==(o=i)?void 0:o.userIndex)){e.next=13;break}return e.next=10,this.accountDomainService.accountAggregate.accountListEntity.changeSign(o.userIndex);case 10:return a=lt(dt(t,"u"),{u:o.userIndex}),(0,Q.tencentDocOpenUrlForAll)({replace:!0,url:a}),e.abrupt("return");case 13:s=lt(dt(t,"needShowTips"),{needShowTips:1}),(0,Q.tencentDocOpenUrlForAll)({replace:!0,url:s,noUserIndex:!0});case 15:case"end":return e.stop()}}),e,this)})))}}]),e}();pt=(0,f.__decorate)([(0,f.__param)(0,S.b),(0,f.__metadata)("design:paramtypes",[Object])],pt);var vt,ht,gt=O.default.isPC||O.default.isIPad&&!(O.default.isMiniProgram||O.default.isTencentDocsApp||O.default.isWeChat||O.default.isQQ||O.default.isTim||O.default.isWxWork),_t=function(){function e(t){(0,i.Z)(this,e),this.loginDomainService=t}return(0,o.Z)(e,[{key:"login",value:function(e,t,n){document.location.pathname.indexOf("/desktop")>-1?this.desktopLogin(e,t):this.docLogin(e,t,n)}},{key:"docLogin",value:function(e,t,n){var r=this.loginDomainService.loginAggregate;O.default.isMiniProgram?r.loginDocsInMiniProgram(e):O.default.isWeChat?n():O.default.isWxWork?r.loginDocsInWework(e):(O.default.isTimOrQQ&&r.timOrQQH5Login(),gt?t():r.jumpToLoginInCommonView(e))}},{key:"desktopLogin",value:function(e,t){var n=this.loginDomainService.loginAggregate;O.default.isMiniProgram?n.reloadMiniProgramForDesktop():O.default.isWeChat?n.jumpToLoginInWechatWebview(e):O.default.isWxWork?n.jumpToLoginInWeworkWebview(e):gt?t():n.jumpToLoginInCommonView(e)}}]),e}();_t=(0,f.__decorate)([(0,f.__param)(0,I.C),(0,f.__metadata)("design:paramtypes",[Object])],_t),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.QQ=1]="QQ",e[e.WX=2]="WX",e[e.WORK=3]="WORK",e[e.EMAIL=4]="EMAIL",e[e.PHONE=8]="PHONE",e[e.WORK_COMBINATION=9]="WORK_COMBINATION",e[e.TOWER=10]="TOWER",e[e.ROBOT=11]="ROBOT",e[e.QFYF=12]="QFYF",e[e.OPEN=13]="OPEN",e[e.MEETING=14]="MEETING"}(vt||(vt={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WECHAT=4]="WECHAT",e[e.WEWORK=3]="WEWORK"}(ht||(ht={}));var mt=function(){rt("p_uin","/",ie),rt("p_skey","/",ie),rt("p_luin","/",ie),rt("p_lskey","/",ie),rt("p_uin","/",re),rt("p_skey","/",re),rt("p_luin","/",re),rt("p_lskey","/",re),rt("txdoc_pwd_token","/",ie)},St=function(){function e(t){(0,i.Z)(this,e),this.accountDomainService=t}return(0,o.Z)(e,[{key:"logout",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.accountDomainService.accountAggregate.userInfo.loginType!==vt.WORK){e.next=5;break}return e.next=4,this.logoutForEnterpriseAccount();case 4:case 7:return e.abrupt("return",e.sent);case 5:return e.next=7,this.logoutForPersonAccount();case 8:case"end":return e.stop()}}),e,this)})))}},{key:"getLogoutMessage",value:function(e){T().setCallback((function(){e()}))}},{key:"logoutForEnterpriseAccount",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i,o,a,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.accountDomainService.accountAggregate.userInfo,i=r.tinyId,o=r.nowUserIndex,e.next=3,this.accountDomainService.accountAggregate.accountRepository.wecomLogoutForCDomain(i);case 3:if(a=e.sent,0!==(null==(s=a.resData)?void 0:s.retcode)){e.next=9;break}return T().postMessage({type:m.p.LOGOUT,data:o,needCookie:!0}),null===(n=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===n||n.postMessage({type:Be.DELETE_USER_INDEX,data:{userIndex:o}}),e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"logoutForPersonAccount",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.accountDomainService.accountAggregate.userInfo.nowUserIndex,e.next=3,this.accountDomainService.accountAggregate.accountRepository.logout();case 3:if(i=e.sent,0!==(null==(o=i.resData)?void 0:o.retcode)){e.next=10;break}return T().postMessage({type:m.p.LOGOUT,data:r,needCookie:!0}),null===(n=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===n||n.postMessage({type:Be.DELETE_USER_INDEX,data:{userIndex:r}}),mt(),e.abrupt("return",!0);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this)})))}}]),e}();St=(0,f.__decorate)([(0,f.__param)(0,S.b),(0,f.__metadata)("design:paramtypes",[Object])],St);var wt,It,yt=function(){return it("TOK")};function Et(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){setTimeout(t,e)})));case 1:case"end":return t.stop()}}),t)})))}!function(e){e[e.CAN_NOT_VIEW=0]="CAN_NOT_VIEW",e[e.CAN_VIEW=1]="CAN_VIEW"}(wt||(wt={})),function(e){e.QQ="qq",e.WX="wx",e.WX_WORK="wx-work",e.WW="ww",e.QFYF="qfyf"}(It||(It={}));var kt=function(){function e(t,n){(0,i.Z)(this,e),this.accountDomainService=t,this.messageDomainService=n,this.accountListApplicationService=new Me(t,n)}return(0,o.Z)(e,[{key:"switchAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.accountType,r=e.userIndex,T().postMessage({type:m.p.SWITCH,data:r,needCookie:!0}),n!==It.WW||!document.location.pathname.includes("/desktop")){t.next=5;break}return(0,Q.tencentDocOpenUrlForAll)({url:se}),t.abrupt("return");case 5:if(n!==It.WW||!document.location.pathname.includes("/mall")){t.next=8;break}return(0,Q.tencentDocOpenUrlForAll)({url:se,replace:!0}),t.abrupt("return");case 8:if(n!==It.WW||!document.location.pathname.includes("/resume")){t.next=11;break}return(0,Q.tencentDocOpenUrlForAll)({url:se,replace:!0}),t.abrupt("return");case 11:return mt(),t.next=14,this.accountListApplicationService.changeSign(e);case 14:this.switchFetchAccount(r);case 15:case"end":return t.stop()}}),t,this)})))}},{key:"switchFetchAccount",value:function(e){var t,n;null===(n=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===n||n.postMessage({type:Be.SWITCH_USER_INDEX,data:{userIndex:e,url:location.href}}),(0,Q.tencentDocOpenUrlForAll)({url:this.getNewJumpUrl(e),replace:!0,noUserIndex:!0})}},{key:"switchEnterpriseAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie){t.next=3;break}return t.abrupt("return",!1);case 3:return this.messageDomainService.switchEnterpriseAccountMessage.connect(),this.getIframeMountMessage(n),this.messageDomainService.switchEnterpriseAccountMessage.createSwitchEnterpriseAccount((function(){r.messageDomainService.switchEnterpriseAccountMessage.sendSwitchAccountMessage(n)})),t.next=8,this.getSwitchAccountMessage();case 8:if(t.sent){t.next=11;break}return t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"getNewJumpUrl",value:function(e){var t=location,n=t.pathname,r=t.hostname,i="https://".concat(r).concat(n);(function(e){return/^(https?:)?\/\/(\w*\.)*(docs\.qq\.com|txdocs\.qq\.com|doc\.weixin\.qq\.com)($|\/|\\|\?)/i.test(decodeURIComponent(e))})(Oe("success_jump_url"))&&(i=dt((i=decodeURIComponent(Oe("success_jump_url"))||"https://".concat(r).concat(n)).replace(/&$/gi,""),"u"));var o=location.search;if(o=dt(o.replace(/&$/gi,""),"hst"),o=dt(o.replace(/&$/gi,""),"success_jump_url"),""===(o=dt(o.replace(/&$/gi,""),"show_type"))&&e)return"".concat(i,"?u=").concat(e);if(""===o)return"".concat(i);var a=o.replace(/(&)*u=(\w+)(\/|\?|#|&|$)/,"");return e?"".concat(i).concat(a,"&u=").concat(e):"".concat(i).concat(a)}},{key:"getIframeMountMessage",value:function(e){var t=this;return new Promise((function(n){t.messageDomainService.switchEnterpriseAccountMessage.getIframeMountMessage((function(){n(!0),t.messageDomainService.switchEnterpriseAccountMessage.sendSwitchAccountMessage(e)}))}))}},{key:"getSwitchAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.switchEnterpriseAccountMessage.getSwitchAccountMessage((function(){t(!0)}))}))}}]),e}();kt=(0,f.__decorate)([(0,f.__param)(0,S.b),(0,f.__param)(1,w.x),(0,f.__metadata)("design:paramtypes",[Object,Object])],kt);var Dt=function e(t,n){if(Array.isArray(t))return t.map((function(t){return e(t,n)}));if(!t)return t;for(var r={},i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];r[n.words.includes(a)?n.raw[a]:a]=t[a]}return r},At=function(e){return function(t){return Dt(t,e)}};function bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}var Ot=At(we),Ct=function(e){(0,s.Z)(n,e);var t=bt(n);function n(e,r,o){var a;(0,i.Z)(this,n),(a=t.call(this)).accountDomainService=e,a.loginDomainService=r,a.messageDomainService=o,a.accountApplicationOfflineService=new xe;var s=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars;a.isInitFinish=a.accountDomainService.createPersonalEnvAccountAggregateByBasicClientVars(null==s?void 0:s.userInfo);var c=a.accountDomainService.accountAggregate.userInfo.tinyId;return a.loginDomainService.createLoginAggregate(c),a.initDomainService(),a.accountListApplicationService=new Me(e,o),a.dcLoginApplicationService=new ze(r,o,e),a}return(0,o.Z)(n,[{key:"updatePasswordsSettings",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate,e.next=3,t.passwordEntity.updatePwdTips();case 3:return e.abrupt("return",{enabled:t.passwordEntity.isHasPassword,phoneNumber:t.passwordEntity.phone});case 4:case"end":return e.stop()}}),e,this)})))}},{key:"updateVipInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUserVipInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.vipInfo,r=t.userInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},r),{vipUserInfo:n})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateBindUserInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.userInfo,r=t.bindUserInfo,i=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},n),{bindUserInfo:r,officialInfo:i})),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateOfficialInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.userInfo,r=t.bindUserInfo,i=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},n),{bindUserInfo:r,officialInfo:i})),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateUserInfo",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.updatePersonalEnvAccountAggregate(e);case 2:return n=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(n),this.initDomainService(),t.abrupt("return",this.accountDomainService.accountAggregate.userInfo);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"init",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitFinish){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.initForUserInfoFetch();case 4:if(!e.sent){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",this.initForUserInfoOfflineData());case 8:case"end":return e.stop()}}),e,this)})))}},{key:"dispose",value:function(){}},{key:"updatePersonalNicknameAndAvatar",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.accountDomainService.updatePersonalNicknameAndAvatar(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getPasswordsModifyQuestionList",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.accountDomainService.accountAggregate,e.next=3,t.passwordEntity.updatePwdQuestionList();case 3:return e.abrupt("return",t.passwordEntity.pwdQuestionList);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getAccountProfileList",value:function(e,t){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function n(){var r;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.accountListApplicationService.getPersonalAccountList(e,t);case 2:return r=n.sent,n.abrupt("return",Ot(r));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"getFetchAccountList",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountListApplicationService.getFetchAccountList();case 2:return t=e.sent,e.abrupt("return",Ot(t));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"completionUserInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.completionUserInfo();case 2:return t=e.sent,this.bindUserInfo=this.accountDomainService.accountAggregate.bindUserInfo,this.officialInfo=this.accountDomainService.accountAggregate.officialInfo,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"getUserVipInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.getUserVipInfo();case 2:return t=e.sent,this.vipInfo=this.accountDomainService.accountAggregate.vipInfo,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loginSuccessJumpUrl",value:function(e,t,n,r){new pt(this.accountDomainService).loginSuccessJumpUrl(e,t,n,r)}},{key:"logoutSuccessJumpUrl",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new pt(this.accountDomainService),e.next=3,t.logoutSuccessJumpUrl();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"login",value:function(e,t,n){new _t(this.loginDomainService).login(e,t,n)}},{key:"logout",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new St(this.accountDomainService),e.abrupt("return",t.logout());case 2:case"end":return e.stop()}}),e,this)})))}},{key:"deleteAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.accountListApplicationService.deleteAccountForList(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"switchToAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new kt(this.accountDomainService,this.messageDomainService),t.next=3,n.switchAccount(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"bindQQAccount",value:function(e){return new je(this.accountDomainService,this.loginDomainService).qqBind(e)}},{key:"getCertificationGrey",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.accountRepository.getCertificationGrey();case 2:return r=e.sent,i=r.resData,e.abrupt("return",(null===(n=null===(t=null==i?void 0:i.data)||void 0===t?void 0:t.result)||void 0===n?void 0:n.open)||!1);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"bindWeChatAccount",value:function(){return new je(this.accountDomainService,this.loginDomainService).wechatBind()}},{key:"getQQBindingInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.accountDomainService.accountAggregate.bindingQQInfo());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"getTipsStatus",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.accountDomainService.getTipsStatus(e);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"initDomainAction",value:function(){var e=this.accountDomainService.accountAggregate,t=e.passwordEntity.passwordRepository;this.sendVerifyCodeSMS=t.pwdVerifyCodeGet.bind(t),this.addPasswordsWithNewPhoneNumber=t.pwdAdd.bind(t),this.resetPasswords=t.pwdReset.bind(t),this.verifyCodeSMS=t.pwdVerifyCodeCheck.bind(t),this.verifyQuestionAnswers=t.pwdQuestionCheck.bind(t),this.delPasswords=t.pwdDel.bind(t),this.verifyPasswords=t.pwdVerify.bind(t),this.unbindAccount=e.accountRepository.unbindUserInfo.bind(e.accountRepository),this.getCurrentAccountBindingInfo=e.currentLoginAccountBindInfo.bind(e)}},{key:"initDomainService",value:function(){var e=this.accountDomainService.accountAggregate;this.userInfo=e.userInfo;var t=e.passwordEntity,n=t.isHasPassword,r=t.phone;this.passwordsSettings={enabled:n,phoneNumber:r},this.vipInfo=e.vipInfo,this.bindUserInfo=e.bindUserInfo,this.officialInfo=e.officialInfo,this.accountApplicationOfflineService.addUserInfo(Object.assign(Object.assign({},this.userInfo),{vipUserInfo:this.vipInfo,bindUserInfo:this.bindUserInfo})),this.initDomainAction()}},{key:"initForUserInfoFetch",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.userInfoRepository.getPersonalUserInfo();case 2:if(t=e.sent,n=t.resData,!t.error){e.next=7;break}return e.abrupt("return",!1);case 7:return 0===(null==n?void 0:n.cgicode)&&(r=window.nowUserIndex||"",this.accountDomainService.createPersonalEnvAccountAggregateByUserInfoCgi(n.data,r),i=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(i),this.initDomainService()),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoOfflineData",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountApplicationOfflineService.getUserInfo();case 2:if(t=e.sent,this.accountApplicationOfflineService.setOnOfflineState(!0),t){e.next=6;break}return e.abrupt("return",!1);case 6:return this.userInfo=t.userInfo,this.vipInfo=t.vipInfo,this.bindUserInfo=t.bindUserInfo,e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})))}}]),n}(k.Disposable);(0,f.__decorate)([he,(0,f.__metadata)("design:type",Object)],Ct.prototype,"userInfo",void 0),(0,f.__decorate)([he,(0,f.__metadata)("design:type",Object)],Ct.prototype,"passwordsSettings",void 0),(0,f.__decorate)([he,(0,f.__metadata)("design:type",Object)],Ct.prototype,"vipInfo",void 0),(0,f.__decorate)([he,(0,f.__metadata)("design:type",Object)],Ct.prototype,"bindUserInfo",void 0),(0,f.__decorate)([he,(0,f.__metadata)("design:type",Object)],Ct.prototype,"officialInfo",void 0),(0,f.__decorate)([pe("passwordsSettings"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],Ct.prototype,"updatePasswordsSettings",null),(0,f.__decorate)([pe("vipInfo"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],Ct.prototype,"updateVipInfo",null),(0,f.__decorate)([pe("bindUserInfo"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],Ct.prototype,"updateBindUserInfo",null),(0,f.__decorate)([pe("officialInfo"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],Ct.prototype,"updateOfficialInfo",null),(0,f.__decorate)([pe("userInfo"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[String]),(0,f.__metadata)("design:returntype",Promise)],Ct.prototype,"updateUserInfo",null),(0,f.__decorate)([Z(),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],Ct.prototype,"init",null),(0,f.__decorate)([H("init"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",void 0)],Ct.prototype,"dispose",null),Ct=(0,f.__decorate)([me(),(0,f.__param)(0,S.b),(0,f.__param)(1,I.C),(0,f.__param)(2,w.x),(0,f.__metadata)("design:paramtypes",[Object,Object,Object])],Ct);var Rt=function(){function e(t,n){(0,i.Z)(this,e),this.messageDomainService=t,this.accountDomainService=n}return(0,o.Z)(e,[{key:"getAccountList",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFetchEnterpriseAccountList();case 2:return this.fetchEnterpriseAccountList=e.sent,e.abrupt("return",this.fetchEnterpriseAccountList);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deleteAccountForList",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uid,r=!0,!this.isHasSameUid(this.fetchEnterpriseAccountList,n)){t.next=7;break}return t.next=6,this.deleteFetchEnterpriseAccountList(e);case 6:r=t.sent;case 7:return t.abrupt("return",this.changeDeleteAccountState(r));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"addAccountForList",value:function(){}},{key:"dispose",value:function(){this.messageDomainService.getPersonAccountListMessage.dispose()}},{key:"deleteFetchEnterpriseAccountList",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r,i,o;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie,r=n.wedocSid,i=n.wedriveSid,o=r||i){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,this.accountDomainService.accountAggregate.enterpriseAccountListEntity.delEnterpriseAccountForList(o);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)})))}},{key:"getFetchEnterpriseAccountList",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.accountAggregate.enterpriseAccountListEntity.getEnterpiseAccountList();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"changeDeleteAccountState",value:function(e){return e?Ce.SUCCESS:Ce.FAIL}},{key:"isHasSameUid",value:function(e,t){return e.some((function(e){return e.uid===t}))}}]),e}();Rt=(0,f.__decorate)([(0,f.__param)(0,w.x),(0,f.__param)(1,y.b),(0,f.__metadata)("design:paramtypes",[Object,Object])],Rt);var xt=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"loginSuccessJumpUrl",value:function(e,t){(0,Q.tencentDocOpenUrlForAll)({replace:!0,url:e,noUserIndex:!0})}},{key:"logoutSuccessJumpUrl",value:function(){var e=dt(window.location.href,"u","wwapp_deviceid","wwapp_vid","wwapp_cst","needShowTips");window.location.pathname.includes("home/recent")?window.location.replace("".concat(le,"?success_jump_url=").concat(encodeURIComponent(ue))):window.location.replace(e)}}]),e}(),Ut=function(){function e(t){(0,i.Z)(this,e),this.accountDomainService=t}return(0,o.Z)(e,[{key:"logout",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.accountDomainService.accountAggregate.userInfo,n=t.loginType,r=t.tinyId,n!==vt.WORK){e.next=4;break}return e.next=4,this.logoutForEnterpriseAccount();case 4:return rt("utype","/",ae),rt("uid","/",ae),rt("uid","/",ne),rt("uid_key","/",ae),rt("login_client","/",ae),rt("CheckKey","/",ae),rt("TOK","/",ae),rt("ES2","/",ae),rt("loginTime","/",ae),rt("wedrive_uin","/",ie),rt("wedrive_sids","/",ie),rt("wedrive_sid","/",ie),rt("wedrive_skey","/",ie),rt("wedrive_ticket","/",ie),rt("wedrive_uin","/",oe),rt("wedrive_sids","/",oe),rt("wedrive_sid","/",oe),rt("wedrive_skey","/",oe),rt("wedrive_ticket","/",oe),rt("wedrive_uin","/",ae),rt("wedrive_sids","/",ae),rt("wedrive_sid","/",ae),rt("wedrive_skey","/",ae),rt("wedrive_ticket","/",ae),rt("tdoc_vid","/",ie),rt("tdoc_sid","/",ie),rt("tdoc_skey","/",ie),rt("tdoc_vid","/",oe),rt("tdoc_sid","/",oe),rt("tdoc_skey","/",oe),rt("tdoc_vid","/",ae),rt("tdoc_sid","/",ae),rt("tdoc_skey","/",ae),rt("wedoc_openid","/",ae),rt("wedoc_skey","/",ae),rt("wedoc_ticket","/",ae),rt("wedoc_sid","/",ae),rt("tdoc_uid","/",ae),rt("tdoc_skey","/",ae),T().postMessage({type:m.p.LOGOUT,data:r,needCookie:!0}),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"logoutForEnterpriseAccount",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=it("wedoc_sid"),n=it("wedrive_sid"),!(r=t||n)){e.next=10;break}return e.next=6,this.accountDomainService.accountAggregate.accountRepository.wecomLogoutForBDomain(r);case 6:if(i=e.sent,0!==(null==(o=i.resData)?void 0:o.retcode)){e.next=10;break}return e.abrupt("return",!0);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this)})))}}]),e}();Ut=(0,f.__decorate)([(0,f.__param)(0,y.b),(0,f.__metadata)("design:paramtypes",[Object])],Ut);var Lt=function(){function e(t){(0,i.Z)(this,e),this.messageDomainService=t}return(0,o.Z)(e,[{key:"switchAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r,i,o,a;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.cookie,r=e.uid,e.fromDomain!==E.zM.C_DOMAIN){t.next=9;break}if(n){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,this.switchPersonAccount(n);case 6:return(i=t.sent)&&(o=this.isInDesktopPage()?ue:"".concat(location.origin).concat(location.pathname),a="".concat(de,"?redirect_uri=").concat(o,"u=").concat(e.userIndex),window.location.href=a),t.abrupt("return",i);case 9:return this.switchEnterpriseAccount(e),T().postMessage({type:m.p.SWITCH,data:r,needCookie:!0}),t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"switchPersonAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n=this;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.messageDomainService.switchPersonAccountMessage.connect(),this.getIframeMountMessage(e),this.messageDomainService.switchPersonAccountMessage.createSwitchEnterpriseAccount((function(){n.messageDomainService.switchPersonAccountMessage.sendSwitchAccountMessage(e)})),t.next=5,this.getSwitchAccountMessage();case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"switchEnterpriseAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r,i,o,a,s,c,u;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=null===(n=e.cookie)||void 0===n?void 0:n.wedocSid,s=null===(r=e.cookie)||void 0===r?void 0:r.tdocUid,c=null===(i=e.cookie)||void 0===i?void 0:i.wedocOpenid,u=null===(o=e.cookie)||void 0===o?void 0:o.wedriveSid,a?(nt("wedoc_sid",a,30,"/",ae),s&&nt("tdoc_uid",s,30,"/",ae),c&&nt("wedoc_openid",c,30,"/",ae)):u&&nt("wedrive_sid",u,30,"/",oe),location.reload(),t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t)})))}},{key:"getIframeMountMessage",value:function(e){var t=this;return new Promise((function(n){t.messageDomainService.switchPersonAccountMessage.getIframeMountMessage((function(){n(!0),t.messageDomainService.switchPersonAccountMessage.sendSwitchAccountMessage(e)}))}))}},{key:"getSwitchAccountMessage",value:function(){var e=this;return new Promise((function(t){e.messageDomainService.switchPersonAccountMessage.getSwitchAccountMessage((function(e){"SUCCESS_SET_COOKIE"===e.data.event&&t(!0),t(!1)}))}))}},{key:"isInDesktopPage",value:function(){return document.location.pathname.indexOf("/home/")>-1}}]),e}();function Mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}Lt=(0,f.__decorate)([(0,f.__param)(0,w.x),(0,f.__metadata)("design:paramtypes",[Object])],Lt);var Tt=At(we),Nt=function(e){(0,s.Z)(n,e);var t=Mt(n);function n(e,r,o){var a,s;(0,i.Z)(this,n),(a=t.call(this)).accountDomainService=e,a.loginDomainService=r,a.messageDomainService=o,a.accountApplicationOfflineService=new xe,a.enterpriseAccountListApplicationService=new Rt(o,e),a.dcLoginApplicationService=new ze(r,o,e);var c=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars;return a.loginDomainService.createLoginAggregate((null===(s=null==c?void 0:c.userInfo)||void 0===s?void 0:s.tinyId)||_.Dr),a.createEnterpriseEnvAccountAggregateByBasicClientVarsAndDocInfo(),a}return(0,o.Z)(n,[{key:"updateVipInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.completionUserInfo();case 2:return t=this.accountDomainService.accountAggregate,n=t.vipInfo,r=t.userInfo,i=t.bindUserInfo,o=t.officialInfo,this.accountApplicationOfflineService.updateUserInfo(Object.assign(Object.assign({},r),{vipUserInfo:n,bindUserInfo:i,officialInfo:o})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"updateUserInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.userInfoRepository.getEnterpriseUserInfo();case 2:return t=e.sent,e.next=5,this.accountDomainService.userInfoRepository.getEnterpriseDocInfo();case 5:if(n=e.sent,r=n.resData,!t||0!==(null==r?void 0:r.cgicode)){e.next=12;break}return i=this.accountDomainService.accountAggregate.userInfo.tinyId,this.loginDomainService.createLoginAggregate(i),o=this.accountDomainService.accountAggregate,e.abrupt("return",o.userInfo);case 12:return this.accountApplicationOfflineService.updateUserInfo(Object.assign({},this.userInfo)),e.abrupt("return",this.userInfo);case 14:case"end":return e.stop()}}),e,this)})))}},{key:"init",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initForUserInfoFetch();case 2:if(!e.sent){e.next=5;break}return e.abrupt("return",!0);case 5:return e.abrupt("return",this.initForUserInfoOfflineData());case 6:case"end":return e.stop()}}),e,this)})))}},{key:"dispose",value:function(){}},{key:"getAccountProfileList",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enterpriseAccountListApplicationService.getAccountList();case 2:return t=e.sent,e.abrupt("return",Tt(t));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"deleteAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.enterpriseAccountListApplicationService.deleteAccountForList(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"addAccount",value:function(){}},{key:"switchToAccount",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Lt(this.messageDomainService),t.next=3,n.switchAccount(e);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"completionUserInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountDomainService.completionUserInfo();case 2:return t=e.sent,this.vipInfo=this.accountDomainService.accountAggregate.vipInfo,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"loginSuccessJumpUrl",value:function(e,t){var n=this.accountDomainService.accountAggregate.userInfo.nowUserIndex;T().postMessage({type:m.p.LOGIN,data:n,needCookie:!0}),(new xt).loginSuccessJumpUrl(e,t)}},{key:"logoutSuccessJumpUrl",value:function(){(new xt).logoutSuccessJumpUrl()}},{key:"login",value:function(e,t,n){new _t(this.loginDomainService).login(e,t,n)}},{key:"logout",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Ut(this.accountDomainService),e.abrupt("return",t.logout());case 2:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoFetch",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.accountDomainService.userInfoRepository.getEnterpriseUserInfo(),this.accountDomainService.userInfoRepository.getEnterpriseDocInfo()]).then((function(e){var n=(0,W.Z)(e,2),r=n[0],i=n[1],o=i.resData;if(i.error)return!1;if(r&&0===(null==o?void 0:o.retcode)){t.accountDomainService.createEnterpriseEnvAccountAggregateByUserInfoCgi(r,o.data);var a=t.accountDomainService.accountAggregate.userInfo.tinyId;t.loginDomainService.createLoginAggregate(a);var s=t.accountDomainService.accountAggregate;t.userInfo=s.userInfo,t.accountApplicationOfflineService.addUserInfo(Object.assign({},t.userInfo))}return!0})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"initForUserInfoOfflineData",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.accountApplicationOfflineService.getUserInfo();case 2:if(t=e.sent,this.accountApplicationOfflineService.setOnOfflineState(!0),t){e.next=6;break}return e.abrupt("return",!1);case 6:return this.userInfo=t.userInfo,e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"createEnterpriseEnvAccountAggregateByBasicClientVarsAndDocInfo",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null===globalThis||void 0===globalThis?void 0:globalThis.basicClientVars,n=this.accountDomainService.createEnterpriseEnvAccountAggregateByBasicClientVars(null==t?void 0:t.userInfo),r=this.accountDomainService.accountAggregate,this.userInfo=r.userInfo,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}}]),n}(k.Disposable);(0,f.__decorate)([he,(0,f.__metadata)("design:type",Object)],Nt.prototype,"userInfo",void 0),(0,f.__decorate)([he,(0,f.__metadata)("design:type",Object)],Nt.prototype,"vipInfo",void 0),(0,f.__decorate)([pe("vipInfo"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],Nt.prototype,"updateVipInfo",null),(0,f.__decorate)([pe("userInfo"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],Nt.prototype,"updateUserInfo",null),(0,f.__decorate)([Z(),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",Promise)],Nt.prototype,"init",null),(0,f.__decorate)([H("init"),(0,f.__metadata)("design:type",Function),(0,f.__metadata)("design:paramtypes",[]),(0,f.__metadata)("design:returntype",void 0)],Nt.prototype,"dispose",null),Nt=(0,f.__decorate)([me(),(0,f.__param)(0,y.b),(0,f.__param)(1,I.C),(0,f.__param)(2,w.x),(0,f.__metadata)("design:paramtypes",[Object,Object,Object])],Nt);var Pt,Ft,Qt,Wt=(0,r.y)("IAccountApplicationService"),qt=(0,r.y)("IEnterpriseAccountApplicationService");!function(e){e.CODE_IS_READY="CODE_IS_READY",e.USER_HAS_SCANNED="USER_HAS_SCANNED",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.USER_HAS_CONFIRMED="USER_HAS_CONFIRMED",e.ERROR="ERROR"}(Pt||(Pt={})),function(e){e.TENCENT_DOCS="TENCENT_DOCS"}(Ft||(Ft={})),function(e){e.CODE_IS_READY="CODE_IS_READY",e.BIND_POLLING_RUNNING="BIND_POLLING_RUNNING",e.BIND_POLLING_FINISH="BIND_POLLING_FINISH",e.BIND_TIMEOUT="BIND_TIMEOUT",e.CODE_WAS_EXPIRED="CODE_WAS_EXPIRED",e.ERROR="ERROR"}(Qt||(Qt={}));var jt=function(){function e(t){var n,r,o;(0,i.Z)(this,e),this.title=t.title,this.padId=t.padId,this.domainId=t.domainId,this.docType=t.docType,this.create_type=null!==(n=t.create_type)&&void 0!==n?n:"",this.redirect=null!==(r=t.redirect)&&void 0!==r?r:"",this.isMiniProgram=null!==(o=t.isMiniProgram)&&void 0!==o?o:""}return(0,o.Z)(e,[{key:"send",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).append("domain_id",this.domainId),t.append("title",this.title),t.append("pad_id",this.padId),t.append("xsrf",yt()),t.append("create_type",this.create_type),t.append("redirect",this.redirect),t.append("isMiniProgram",this.isMiniProgram),e.next=10,q.networkRequest.post("/cgi-bin/online-docs/createdoc_new",t);case 10:return n=e.sent,r=n.data,e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})))}}]),e}(),Bt=function(){function e(t){(0,i.Z)(this,e),this.file_id=t.file_id,this.parent_id=t.parent_id}return(0,o.Z)(e,[{key:"send",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q.networkRequest.post("".concat("/v2/file/clone","?xsrf=").concat(yt()),{file_id:this.file_id,parent_id:this.parent_id});case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})))}}]),e}(),Gt={retcode:-1,doc_url:"",message:"创建副本存到本地失败",doc_id:{pad_id:""}},Zt=function(){function e(t){(0,i.Z)(this,e),this.logger=new A.Yd("IDocsManagementService").use("console"),this.title=t.title,this.padId=t.padId,this.domainId=t.domainId}return(0,o.Z)(e,[{key:"send",value:function(){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function e(){var t,n,r,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData).append("domain_id",this.domainId),t.append("title",this.title),t.append("pad_id",this.padId),t.append("xsrf",yt()),e.next=7,q.networkRequest.post("/cgi-bin/online_docs/copydoc_async",t);case 7:if(n=e.sent,r=n.data,i=r.retcode,o=r.doc_id.pad_id,0===i&&o){e.next=13;break}return this.logger.error(r),e.abrupt("return",r);case 13:return e.next=15,this.requestCreateCopyLoop(r);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)})))}},{key:"requestCreateCopyLoop",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n,r,i,o,a,s;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.doc_id.pad_id,r=e.doc_url,i=30;case 3:if(!(i-=1)){t.next=20;break}return t.next=6,Et(2e3);case 6:return(o=new FormData).append("domain_id",this.domainId),o.append("pad_id",n),o.append("xsrf",yt()),t.next=12,q.networkRequest.post("/cgi-bin/online_docs/copydoc_loop",o);case 12:if(a=t.sent,s=a.data,r=r||s.doc_url,10027!==s.retcode){t.next=17;break}return t.abrupt("continue",3);case 17:return t.abrupt("return",s);case 20:return t.abrupt("return",Gt);case 21:case"end":return t.stop()}}),t,this)})))}}]),e}(),Ht=(0,r.y)("IDocsManagementService"),Kt=function(){function e(){(0,i.Z)(this,e)}return(0,o.Z)(e,[{key:"loopClone",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Zt(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"createDocClone",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new jt(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"driveClone",value:function(e){return(0,f.__awaiter)(this,void 0,void 0,l().mark((function t(){var n;return l().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Bt(e.params).send();case 2:n=t.sent,this.handleResult(e,n);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"handleResult",value:function(e,t){t?e.success(t):e.fail()}}]),e}()}}]),"object"==typeof globalThis&&(globalThis.jsExecEndTimeStamp=Date.now(),globalThis.cachedPerformanceEntries||(globalThis.cachedPerformanceEntries=[]),globalThis.cachedPerformanceEntries.push({name:"jsExec: js/public-ark-application-7b07f2cd.js",entryType:"jsExec",startTime:globalThis.jsExecStartTimeStamp,endTime:globalThis.jsExecEndTimeStamp}));
//# sourceMappingURL=public-ark-application-7b07f2cd.js.map