import{a as i,n as te,m as oe,r as S,o as se,z as ue,b as u,c as B,d as E,f as U,e,w as t,F as H,x as pe,u as b,h as w,B as ne,D as C,E as d,H as re,I as de,J as ie,G as x}from"./index.cc30dbfe.js";import{a as V}from"./apply.47040eee.js";import"./http.f2a51fde.js";const me=U("p",null,"\u5B9E\u9A8C\u5BA4\u7533\u8BF7",-1),ce={class:"dialog-footer"},ge={__name:"Apply",setup(ye){const v=i(!1);te();const g=oe();let h=i();const m="100px",z=i(""),N=i("");N.value=sessionStorage.getItem("userId"),console.log(N.value);const o=i({applyId:"",labName:"",labNumber:"",applyDay:"",applyReason:"",applyDatetime:"",applyStatus:"",reviewComments:"",reviewDatetime:"",usersId:N.value}),y=i(),$=S({labNumber:[{required:!0,message:"\u5B9E\u9A8C\u5BA4\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],applyDay:[{required:!1,message:"\u8001\u5E08\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],applyReason:[{required:!1,message:"\u8001\u5E08\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],applyDatetime:[{required:!1,message:"\u8001\u5E08\u7F16\u53F7\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}),L=()=>{!y||y.value.validate(async s=>{if(s){const l=await V.saveApplyInfo(o.value);l.data!=null?l.data?l.data.data==0?d.error("\u8BE5\u5B9E\u9A8C\u5BA4\u5DF2\u88AB\u7533\u8BF7"):(d.info("\u65B0\u589E\u7533\u8BF7\u6210\u529F"),location.reload()):d.error("\u65B0\u589E\u7533\u8BF7\u5931\u8D25"):d.error("\u670D\u52A1\u5668\u5185\u90E8\u9519\u8BEF")}else return d.error("\u683C\u5F0F\u9519\u8BEF"),!1})},R=()=>{!y||y.value.resetFields()},T=()=>{o.value.applyId?J():L()},j=async(s,l)=>{v.value=!0;const r=await V.getApplyDetail({applyId:l.applyId});console.log(r.data.data[0]),o.value=r.data.data[0]},G=[{value:3,label:"\u5F85\u5BA1\u6279"},{value:1,label:"\u5DF2\u9A73\u56DE"},{value:2,label:"\u5DF2\u901A\u8FC7"}],J=()=>{y.value.validate(async s=>{if(s){const l=await V.updateApply(o.value);l.data.code===200?(v.value=!1,d({message:l.data.message,type:"success"}),await _(),R()):d({message:l.data.message,type:"error"})}else console.log("\u6821\u9A8C\u4E0D\u901A\u8FC7")})};i([]),se(async()=>{console.log(111),console.log(g.query.applyId),g.query.userId!=null&&(h.value=g.query.userId,sessionStorage.setItem("userId",g.query.userId)),g.query.userId==null&&(h.value=sessionStorage.getItem("userId")),O.userId=h.value,n.userId=h.value}),ue(()=>{_()});let q=i([]),A=i(0);const O=S({userId:"",labId:""}),n=S({pageNum:1,pageSize:10,labName:"",applyStatus:3}),_=async()=>{const s=await V.getApplyList(n);console.log(s),q.value=s.data.data,console.log(s.data.data),A.value=s.data.total},W=s=>{n.pageSize=s,_()},K=s=>{n.pageNum=s,_()},F=()=>{n.pageNum=1,_()},P=async s=>{try{(await V.cancelApply({applyId:s})).data?(d.success("\u53D6\u6D88\u7533\u8BF7\u6210\u529F"),location.reload(),k):d.error("\u53D6\u6D88\u7533\u8BF7\u5931\u8D25")}catch(l){console.error("\u8BF7\u6C42\u51FA\u9519:",l),d.error("\u53D6\u6D88\u7533\u8BF7\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF")}};return(s,l)=>{const r=u("el-input"),p=u("el-form-item"),I=u("el-col"),D=u("el-option"),Y=u("el-select"),f=u("el-button"),M=u("el-row"),c=u("el-table-column"),Q=u("el-pagination"),X=u("el-card"),Z=u("el-date-picker"),ee=u("el-form"),le=u("el-dialog");return B(),E(H,null,[U("div",null,[me,e(X,null,{default:t(()=>[e(M,{gutter:20},{default:t(()=>[e(I,{span:6},{default:t(()=>[e(p,{label:"\u5B9E\u9A8C\u5BA4\u540D\u79F0"},{default:t(()=>[e(r,{style:{width:"440px"},onClear:F,clearable:"",modelValue:n.labName,"onUpdate:modelValue":l[0]||(l[0]=a=>n.labName=a),placeholder:"\u8BF7\u8F93\u5165\u5B9E\u9A8C\u5BA4\u540D\u79F0",class:"input-with-select"},null,8,["modelValue"])]),_:1})]),_:1}),e(I,{span:6},{default:t(()=>[e(p,{label:"\u7533\u8BF7\u72B6\u6001"},{default:t(()=>[e(Y,{modelValue:n.applyStatus,"onUpdate:modelValue":l[1]||(l[1]=a=>n.applyStatus=a),style:{width:"300px"},placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001",clearable:""},{default:t(()=>[(B(),E(H,null,pe(G,a=>e(D,{label:a.label,value:a.value,key:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(I,{span:6},{default:t(()=>[e(p,null,{default:t(()=>[e(f,{icon:b(re),type:"primary",onClick:F},{default:t(()=>[w("\u67E5\u8BE2")]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1}),e(M,null,{default:t(()=>[e(I,{span:2},{default:t(()=>[e(f,{type:"primary",onClick:l[2]||(l[2]=a=>{v.value=!0,z.value="\u65B0\u589E\u7533\u8BF7"})},{default:t(()=>[w("\u65B0\u589E\u7533\u8BF7")]),_:1})]),_:1})]),_:1}),w(" \xA0\xA0\xA0 "),e(b(ne),{data:b(q),border:"",style:{width:"100%"}},{default:t(()=>[e(c,{prop:"applyId",label:"\u7533\u8BF7\u7F16\u53F7",width:"150"}),e(c,{prop:"labName",label:"\u5B9E\u9A8C\u5BA4\u540D\u79F0",width:"150"}),e(c,{prop:"applyReason",label:"\u5B9E\u9A8C\u5BA4\u7533\u8BF7\u539F\u56E0",width:"150"}),e(c,{prop:"applyStatus",label:"\u5B9E\u9A8C\u5BA4\u7533\u8BF7\u72B6\u6001",width:"150"}),e(c,{prop:"applyDatetime",label:"\u5B9E\u9A8C\u5BA4\u7533\u8BF7\u65F6\u95F4",width:"200"}),e(c,{prop:"reviewComments",label:"\u7533\u8BF7\u5BA1\u6279\u610F\u89C1",width:"150"}),e(c,{prop:"reviewDatetime",label:"\u7533\u8BF7\u5BA1\u6279\u65F6\u95F4",width:"200"}),e(c,{label:"\xA0\xA0\xA0\xA0\xA0\xA0\xA0\u64CD\u4F5C",width:"120"},{default:t(a=>[e(f,{type:"primary",icon:b(de),onClick:ae=>j(a.$index,a.row),circle:""},null,8,["icon","onClick"]),e(f,{type:"danger",icon:b(ie),onClick:ae=>P(a.row.applyId),circle:""},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"]),e(Q,{style:{"margin-top":"20px"},"current-page":n.pageNum,"page-size":n.pageSize,"page-sizes":[10,20,30,40],layout:"->,total, sizes, prev, pager, next, jumper",total:b(A),onSizeChange:W,onCurrentChange:K},null,8,["current-page","page-size","total"])]),_:1})]),e(le,{modelValue:v.value,"onUpdate:modelValue":l[13]||(l[13]=a=>v.value=a),title:z.value},{footer:t(()=>[U("span",ce,[e(f,{type:"primary",onClick:l[12]||(l[12]=a=>R())},{default:t(()=>[w("\u91CD\u7F6E")]),_:1}),e(f,{type:"primary",onClick:T},{default:t(()=>[w(" \u63D0\u4EA4 ")]),_:1})])]),default:t(()=>[e(ee,{model:o.value,rules:$,ref_key:"ruleFormRef",ref:y},{default:t(()=>[C(e(p,{label:"\u7533\u8BF7id",prop:"applyId"},{default:t(()=>[e(r,{modelValue:o.value.applyId,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.applyId=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},512),[[x,!1]]),e(p,{label:"\u5B9E\u9A8C\u5BA4\u7F16\u53F7:",prop:"labNumber","label-width":m},{default:t(()=>[e(r,{modelValue:o.value.labNumber,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.labNumber=a),style:{width:"300px"},placeholder:"\u8BF7\u8F93\u5165\u5B9E\u9A8C\u5BA4\u7F16\u53F7",class:"input-with-select"},null,8,["modelValue"])]),_:1}),e(p,{label:"\u5B9E\u9A8C\u5BA4\u540D\u79F0:",prop:"labName","label-width":m},{default:t(()=>[e(r,{modelValue:o.value.labName,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.labName=a),style:{width:"300px"},placeholder:"\u8BF7\u8F93\u5165\u5B9E\u9A8C\u5BA4\u540D\u79F0",class:"input-with-select"},null,8,["modelValue"])]),_:1}),e(p,{label:"\u7533\u8BF7\u5929\u6570:",prop:"applyDay","label-width":m},{default:t(()=>[e(r,{modelValue:o.value.applyDay,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.applyDay=a),style:{width:"300px"},placeholder:"\u8BF7\u8F93\u5165\u7533\u8BF7\u5929\u6570",class:"input-with-select"},null,8,["modelValue"])]),_:1}),e(p,{label:"\u7533\u8BF7\u539F\u56E0:",prop:"applyReason","label-width":m},{default:t(()=>[e(r,{modelValue:o.value.applyReason,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.applyReason=a),style:{width:"300px"},placeholder:"\u8BF7\u8F93\u5165\u7533\u8BF7\u539F\u56E0",class:"input-with-select"},null,8,["modelValue"])]),_:1}),e(p,{label:"\u7533\u8BF7\u65F6\u95F4:",prop:"applyDatetime","label-width":m},{default:t(()=>[e(Z,{modelValue:o.value.applyDatetime,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.applyDatetime=a),style:{width:"300px"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",type:"datetime",laceholder:"\u9009\u62E9\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),C(e(p,{label:"\u5BA1\u6838\u72B6\u6001:","label-width":m},{default:t(()=>[e(Y,{disabled:"",modelValue:o.value.applyStatus,"onUpdate:modelValue":l[9]||(l[9]=a=>o.value.applyStatus=a),style:{width:"300px"},placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001",selected:0},{default:t(()=>[e(D,{label:"\u53EF\u9884\u7EA6",value:"1"}),e(D,{label:"\u5DF2\u9884\u7EA6",value:"2"}),e(D,{label:"\u4E0D\u53EF\u7528",value:"3"})]),_:1},8,["modelValue"])]),_:1},512),[[x,!1]]),C(e(p,{label:"\u5BA1\u6838\u610F\u89C1:","label-width":m},{default:t(()=>[e(r,{disabled:"",modelValue:o.value.reviewComments,"onUpdate:modelValue":l[10]||(l[10]=a=>o.value.reviewComments=a),style:{width:"300px"},placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6838\u610F\u89C1",class:"input-with-select"},null,8,["modelValue"])]),_:1},512),[[x,!1]]),C(e(p,{label:"\u5BA1\u6279\u65F6\u95F4:","label-width":m},{default:t(()=>[e(r,{disabled:"",modelValue:o.value.reviewDatetime,"onUpdate:modelValue":l[11]||(l[11]=a=>o.value.reviewDatetime=a),style:{width:"300px"},placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u65F6\u95F4",class:"input-with-select"},null,8,["modelValue"])]),_:1},512),[[x,!1]])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}};export{ge as default};
